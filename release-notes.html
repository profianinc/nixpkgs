<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Appendix B. Release Notes</title><link rel="stylesheet" type="text/css" href="style.css" /><link rel="stylesheet" type="text/css" href="overrides.css" /><link rel="stylesheet" type="text/css" href="highlightjs/mono-blue.css" /><script src="./highlightjs/highlight.pack.js" type="text/javascript"></script><script src="./highlightjs/loader.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="index.html" title="NixOS Manual" /><link rel="up" href="index.html" title="NixOS Manual" /><link rel="prev" href="options.html" title="Appendix A. Configuration Options" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix B. Release Notes</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="options.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> </td></tr></table><hr /></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="ch-release-notes"></a>Appendix B. Release Notes</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="release-notes.html#sec-release-22.05">B.1. Release 22.05 (“Quokka”, 2022.05/30)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-21.11">B.2. Release 21.11 (“Porcupine”, 2021/11/30)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-21.05">B.3. Release 21.05 (<span class="quote">“<span class="quote">Okapi</span>”</span>, 2021.05/31)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-20.09">B.4. Release 20.09 (<span class="quote">“<span class="quote">Nightingale</span>”</span>, 2020.10/27)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-20.03">B.5. Release 20.03 (<span class="quote">“<span class="quote">Markhor</span>”</span>, 2020.04/20)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-19.09">B.6. Release 19.09 (<span class="quote">“<span class="quote">Loris</span>”</span>, 2019/10/09)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-19.03">B.7. Release 19.03 (<span class="quote">“<span class="quote">Koi</span>”</span>, 2019/04/11)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-18.09">B.8. Release 18.09 (<span class="quote">“<span class="quote">Jellyfish</span>”</span>, 2018/10/05)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-18.03">B.9. Release 18.03 (<span class="quote">“<span class="quote">Impala</span>”</span>, 2018/04/04)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-17.09">B.10. Release 17.09 (<span class="quote">“<span class="quote">Hummingbird</span>”</span>, 2017/09/??)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-17.03">B.11. Release 17.03 (<span class="quote">“<span class="quote">Gorilla</span>”</span>, 2017/03/31)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-16.09">B.12. Release 16.09 (<span class="quote">“<span class="quote">Flounder</span>”</span>, 2016/09/30)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-16.03">B.13. Release 16.03 (<span class="quote">“<span class="quote">Emu</span>”</span>, 2016/03/31)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-15.09">B.14. Release 15.09 (<span class="quote">“<span class="quote">Dingo</span>”</span>, 2015/09/30)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-14.12">B.15. Release 14.12 (<span class="quote">“<span class="quote">Caterpillar</span>”</span>, 2014/12/30)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-14.04">B.16. Release 14.04 (<span class="quote">“<span class="quote">Baboon</span>”</span>, 2014/04/30)</a></span></dt><dt><span class="section"><a href="release-notes.html#sec-release-13.10">B.17. Release 13.10 (<span class="quote">“<span class="quote">Aardvark</span>”</span>, 2013/10/31)</a></span></dt></dl></div><p>
  This section lists the release notes for each stable version of NixOS and
  current unstable revision.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-22.05"></a>B.1. Release 22.05 (“Quokka”, 2022.05/30)</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Support is planned until the end of December 2022, handing over
        to 22.11.
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-22.05-highlights"></a>B.1.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><div class="literallayout"><p>Nix has been updated from 2.3 to 2.8. This mainly brings experimental support for Flakes, but also marks the <code class="literal">nix</code> command as experimental which now has to be enabled via the configuration explicitly. For more information and instructions for upgrades, see the relase notes for <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.4.html" target="_top">nix-2.4</a>,<br />
<a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.5.html" target="_top">nix-2.5</a>, <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.6.html" target="_top">nix-2.6</a>, <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.7.html" target="_top">nix-2.7</a> and <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.8.html" target="_top">nix-2.8</a></p></div></li><li class="listitem"><p>
          The <code class="literal">firefox</code> browser on
          <code class="literal">x86_64-linux</code> now makes use of
          profile-guided optimisation, resulting in a much more
          responsive browsing experience.
        </p></li><li class="listitem"><p>
          GNOME has been upgraded to 42. Please take a look at their
          <a class="link" href="https://release.gnome.org/42/" target="_top">Release
          Notes</a> for details. In particular, it replaces gedit
          with GNOME Text Editor, GNOME Terminal with GNOME Console
          (formerly King’s Cross) and GNOME Screenshot by a tool
          integrated into the Shell.
        </p></li><li class="listitem"><p>
          PHP 8.1 is now available.
        </p></li><li class="listitem"><p>
          systemd services can now set
          <a class="link" href="options.html#opt-systemd.services">systemd.services.&lt;name&gt;.reloadTriggers</a>
          instead of <code class="literal">reloadIfChanged</code> for a more
          granular distinction between reloads and restarts.
        </p></li><li class="listitem"><p>
          Systemd has been upgraded to the version 250.
        </p></li><li class="listitem"><p>
          Pulseaudio has been updated to version 15.0 and now optionally
          <a class="link" href="https://www.freedesktop.org/wiki/Software/PulseAudio/Notes/15.0/#supportforldacandaptxbluetoothcodecsplussbcxqsbcwithhigher-qualityparameters" target="_top">supports
          additional Bluetooth audio codecs</a> such as aptX or LDAC,
          with codec switching available in
          <code class="literal">pavucontrol</code>. This feature is disabled by
          default, but can be enabled with the option
          <code class="literal">hardware.pulseaudio.package = pkgs.pulseaudioFull;</code>.
          Existing third-party modules that offered similar functions,
          such as <code class="literal">pulseaudio-modules-bt</code> or
          <code class="literal">pulseaudio-hsphfpd</code>, are obsolete and have
          been removed.
        </p></li><li class="listitem"><p>
          PostgreSQL now defaults to major version 14.
        </p></li><li class="listitem"><p>
          Module authors can use
          <code class="literal">mkRenamedOptionModuleWith</code> to automate the
          deprecation cycle without annoying out-of-tree module authors
          and their users.
        </p></li><li class="listitem"><p>
          The default GHC version has been updated from 8.10.7 to 9.0.2.
          <code class="literal">pkgs.haskellPackages</code> and
          <code class="literal">pkgs.ghc</code> will now use this version by
          default.
        </p></li><li class="listitem"><p>
          The GNOME and Plasma installation CDs now use
          <code class="literal">pkgs.calamares</code> and
          <code class="literal">pkgs.calamares-nixos-extensions</code> to allow
          users to easily install and set up NixOS with a GUI.
        </p></li><li class="listitem"><p>
          <code class="literal">security.acme.defaults</code> has been added to
          simplify the configuration of settings for many certificates
          at once. This also opens up the option to use DNS-01
          validation when using <code class="literal">enableACME</code> web server
          virtual hosts (e.g.
          <code class="literal">services.nginx.virtualHosts.*.enableACME</code>).
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-22.05-new-services"></a>B.1.2. New Services</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="https://1password.com/" target="_top">1password</a>,
          command-lines and graphic interface for 1Password. Available
          as
          <a class="link" href="options.html#opt-programs._1password.enable">programs._1password</a>
          and
          <a class="link" href="options.html#opt-programs._1password.enable">programs._1password-gui</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/intel/linux-sgx#install-the-intelr-sgx-psw" target="_top">aesmd</a>,
          the Intel SGX Architectural Enclave Service Manager. Available
          as
          <a class="link" href="options.html#opt-services.aesmd.enable">services.aesmd</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/mbrubeck/agate" target="_top">agate</a>,
          a very simple server for the Gemini hypertext protocol.
          Available as
          <a class="link" href="options.html#opt-services.agate.enable">services.agate</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://docs.docker.com/engine/security/rootless/" target="_top">rootless
          Docker</a>, a <code class="literal">systemd --user</code> Docker
          service which runs without root permissions. Available as
          <a class="link" href="options.html#opt-virtualisation.docker.rootless.enable" target="_top">virtualisation.docker.rootless.enable</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://conduit.rs/" target="_top">matrix-conduit</a>,
          a simple, fast and reliable chat server powered by matrix.
          Available as
          <a class="link" href="option.html#opt-services.matrix-conduit.enable" target="_top">services.matrix-conduit</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/vvilhonen/nethoscope" target="_top">nethoscope</a>,
          listen to your network traffic. Available as
          <a class="link" href="options.html#opt-programs.nethoscope.enable">programs.nethoscope</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-overview.html" target="_top">filebeat</a>,
          a lightweight shipper for forwarding and centralizing log
          data. Available as
          <a class="link" href="options.html#opt-services.filebeat.enable">services.filebeat</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/linux-apfs/linux-apfs-rw" target="_top">apfs</a>,
          a kernel module for mounting the Apple File System (APFS).
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/JustArchiNET/ArchiSteamFarm" target="_top">ArchiSteamFarm</a>,
          a C# application with primary purpose of idling Steam cards
          from multiple accounts simultaneously. Available as
          <a class="link" href="options.html#opt-services.archisteamfarm.enable">services.archisteamfarm</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://loic-sharma.github.io/BaGet/" target="_top">BaGet</a>,
          a lightweight NuGet and symbol server. Available at
          <a class="link" href="options.html#opt-services.baget.enable">services.baget</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://0xerr0r.github.io/blocky/" target="_top">blocky</a>,
          fast and lightweight DNS proxy as ad-blocker for local network
          with many features. Available as
          <a class="link" href="options.html#opt-services.blocky.enable">services.blocky</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/kissgyorgy/cloudflare-dyndns" target="_top">cloudflare-dyndns</a>,
          CloudFlare Dynamic DNS client. Available as
          <a class="link" href="options.html#opt-services.cloudflare-dyndns.enable">services.cloudflare-dyndns</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://corosync.github.io/corosync/" target="_top">Corosync</a>
          and
          <a class="link" href="https://clusterlabs.org/pacemaker/" target="_top">Pacemaker</a>,
          A open-source high availability resource manager. Available as
          <a class="link" href="options.html#opt-services.corosync.enable">services.corosync</a>
          and
          <a class="link" href="options.html#opt-services.pacemaker.enable">services.pacemaker</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/lakinduakash/linux-wifi-hotspot" target="_top">create_ap</a>,
          a module for creating wifi hotspots using the program
          linux-wifi-hotspot. Available as
          <a class="link" href="options.html#opt-services.create_ap.enable">services.create_ap</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.envoyproxy.io/" target="_top">Envoy</a>, a
          high-performance reverse proxy. Available as
          <a class="link" href="options.html#opt-services.envoy.enable">services.envoy</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://ergo.chat" target="_top">ergochat</a>, a modern
          IRC with IRCv3 features. Available as
          <a class="link" href="options.html#opt-services.ergochat.enable">services.ergochat</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/audreyt/ethercalc" target="_top">ethercalc</a>,
          an online collaborative spreadsheet. Available as
          <a class="link" href="options.html#opt-services.ethercalc.enable">services.ethercalc</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-overview.html" target="_top">filebeat</a>,
          a lightweight shipper for forwarding and centralizing log
          data. Available as
          <a class="link" href="options.html#opt-services.filebeat.enable">services.filebeat</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://frrouting.org/" target="_top">FRRouting</a>, a
          popular suite of Internet routing protocol daemons (BGP, BFD,
          OSPF, IS-IS, VRRP and others). Available as
          <a class="link" href="options.html#opt-services.frr.babel.enable">services.frr</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://grafana.com/oss/mimir/" target="_top">Grafana
          Mimir</a>, an open source, horizontally scalable, highly
          available, multi-tenant, long-term storage for Prometheus.
          Available as
          <a class="link" href="options.html#opt-services.mimir.enable">services.mimir</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://hastebin.com/about.md" target="_top">Haste</a>,
          a pastebin written in node.js. Available as
          <a class="link" href="options.html#opt-services.haste-server.enable">services.haste</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/juanfont/headscale" target="_top">headscale</a>,
          an Open Source implementation of the
          <a class="link" href="https://tailscale.io" target="_top">Tailscale</a>
          Control Server. Available as
          <a class="link" href="options.html#opt-services.headscale.enable">services.headscale</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/hifi/heisenbridge" target="_top">heisenbridge</a>,
          a bouncer-style Matrix IRC bridge. Available as
          <a class="link" href="options.html#opt-services.heisenbridge.enable">services.heisenbridge</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/aarond10/https_dns_proxy" target="_top">https-dns-proxy</a>,
          DNS to DNS over HTTPS (DoH) proxy. Available as
          <a class="link" href="options.html#opt-services.https-dns-proxy.enable">services.https-dns-proxy</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/sezanzeb/input-remapper" target="_top">input-remapper</a>,
          an easy to use tool to change the mapping of your input device
          buttons. Available at
          <a class="link" href="options.html#opt-services.input-remapper.enable">services.input-remapper</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://invoiceplane.com" target="_top">InvoicePlane</a>,
          web application for managing and creating invoices. Available
          at
          <a class="link" href="options.html#opt-services.invoiceplane.sites._name_.enable">services.invoiceplane</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://userbase.kde.org/K3b" target="_top">k3b</a>,
          the KDE disk burning application. Available as
          <a class="link" href="options.html#opt-programs.k3b.enable">programs.k3b</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.scorchworks.com/K40whisperer/k40whisperer.html" target="_top">K40-Whisperer</a>,
          a program to control cheap Chinese laser cutters. Available as
          <a class="link" href="options.html#opt-programs.k40-whisperer.enable">programs.k40-whisperer.enable</a>.
          Users must add themselves to the <code class="literal">k40</code> group
          to be able to access the device.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://kanidm.github.io/kanidm/stable/" target="_top">kanidm</a>,
          an identity management server written in Rust. Available as
          <a class="link" href="options.html#opt-services.kanidm.enableServer">services.kanidm</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="https://maddy.email" target="_top">maddy</a>, a
          composable all-in-one mail server. Available as
          <a class="link" href="options.html#opt-services.maddy.enable">services.maddy</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://maddy.email/" target="_top">Maddy</a>, a free
          an open source mail server. Availabe as
          <a class="link" href="options.html#opt-services.maddy.enable">services.maddy</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://conduit.rs/" target="_top">matrix-conduit</a>,
          a simple, fast and reliable chat server powered by matrix.
          Available as
          <a class="link" href="option.html#opt-services.matrix-conduit.enable" target="_top">services.matrix-conduit</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://moosefs.com" target="_top">Moosefs</a>, fault
          tolerant petabyte distributed file system. Available as
          <a class="link" href="options.html#opt-services.moosefs.master.enable">moosefs</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/mozilla-mobile/mozilla-vpn-client" target="_top">mozillavpn</a>,
          the client for the
          <a class="link" href="https://vpn.mozilla.org/" target="_top">Mozilla VPN</a>
          service. Available as
          <a class="link" href="options.html#opt-services.mozillavpn.enable">services.mozillavpn</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/mgumz/mtr-exporter" target="_top">mtr-exporter</a>,
          a Prometheus exporter for mtr metrics. Available as
          <a class="link" href="options.html#opt-services.mtr-exporter.enable">services.mtr-exporter</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://nbd.sourceforge.io/" target="_top">nbd</a>, a
          Network Block Device server. Available as
          <a class="link" href="options.html#opt-services.nbd.server.enable">services.nbd</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/netbox-community/netbox" target="_top">netbox</a>,
          infrastructure resource modeling (IRM) tool. Available as
          <a class="link" href="options.html#opt-services.netbox.enable">services.netbox</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/vvilhonen/nethoscope" target="_top">nethoscope</a>,
          listen to your network traffic. Available as
          <a class="link" href="options.html#opt-programs.nethoscope.enable">programs.nethoscope</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://nifi.apache.org" target="_top">nifi</a>, an
          easy to use, powerful, and reliable system to process and
          distribute data. Available as
          <a class="link" href="options.html#opt-services.nifi.enable">services.nifi</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/Mic92/nix-ld" target="_top">nix-ld</a>,
          Run unpatched dynamic binaries on NixOS. Available as
          <a class="link" href="options.html#opt-programs.nix-ld.enable">programs.nix-ld</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="http://www.nncpgo.org" target="_top">NNCP</a>, NNCP
          (Node to Node copy) utilities and configuration, Available as
          <a class="link" href="options.html#opt-programs.nncp.enable">programs.nncp</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/postgres/pgadmin4" target="_top">pgadmin4</a>,
          an admin interface for the PostgreSQL database. Available at
          <a class="link" href="options.html#opt-services.pgadmin.enable">services.pgadmin</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/ngoduykhanh/PowerDNS-Admin" target="_top">PowerDNS-Admin</a>,
          a web interface for the PowerDNS server. Available at
          <a class="link" href="options.html#opt-services.powerdns-admin.enable">services.powerdns-admin</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/prometheus-pve/prometheus-pve-exporter" target="_top">prometheus-pve-exporter</a>,
          a tool that exposes information from the Proxmox VE API for
          use by Prometheus. Available as
          <a class="link" href="options.html#opt-services.prometheus.exporters.pve.enable">services.prometheus.exporters.pve</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/ThomasLeister/prosody-filer" target="_top">prosody-filer</a>,
          a server for handling XMPP HTTP Upload requests. Available at
          <a class="link" href="options.html#opt-services.prosody-filer.enable">services.prosody-filer</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://public-inbox.org" target="_top">Public
          Inbox</a>, an <span class="quote">“<span class="quote">archives first</span>”</span> approach to
          mailing lists. Available as
          <a class="link" href="options.html#opt-services.public-inbox.enable">services.public-inbox</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/fleaz/r53-ddns" target="_top">r53-ddns</a>,
          a small tool to run your own DDNS service via AWS Route53.
          Available as
          <a class="link" href="options.html#opt-services.r53-ddns.enable">services.r53-ddns</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://ddvk.github.io/rmfakecloud/" target="_top">rmfakecloud</a>,
          a clone of the cloud sync the remarkable tablet. Available as
          <a class="link" href="options.html#opt-services.rmfakecloud.enable">services.rmfakecloud</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://docs.docker.com/engine/security/rootless/" target="_top">rootless
          Docker</a>, a <code class="literal">systemd --user</code> Docker
          service which runs without root permissions. Available as
          <a class="link" href="options.html#opt-virtualisation.docker.rootless.enable" target="_top">virtualisation.docker.rootless.enable</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.rstudio.com/products/rstudio/#rstudio-server" target="_top">rstudio-server</a>,
          a browser-based version of the RStudio IDE for the R
          programming language. Available as
          <a class="link" href="options.html#opt-services.rstudio-server.enable">services.rstudio-server</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/aler9/rtsp-simple-server" target="_top">rtsp-simple-server</a>,
          ready-to-use RTSP / RTMP / HLS server and proxy that allows to
          read, publish and proxy video and audio streams. Available as
          <a class="link" href="options.html#opt-services.rtsp-simple-server.enable">services.rtsp-simple-server</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://snipeitapp.com" target="_top">Snipe-IT</a>, a
          free open source IT asset/license management system. Available
          as
          <a class="link" href="options.html#opt-services.snipe-it.enable">services.snipe-it</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://snowflake.torproject.org/" target="_top">snowflake-proxy</a>,
          a system to defeat internet censorship. Available as
          <a class="link" href="options.html#opt-services.snowflake-proxy.enable">services.snowflake-proxy</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://sslmate.com/" target="_top">sslmate-agent</a>,
          a daemon for managing SSL/TLS certificates on a server.
          Available as
          <a class="link" href="services.sslmate-agent.enable" target="_top">services.sslmate-agent</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://starship.rs" target="_top">starship</a>, a
          minimal, blazing-fast, and infinitely customizable prompt for
          any shell. Available at
          <a class="link" href="options.html#opt-programs.starship.enable">programs.startship</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/rfjakob/systembus-notify" target="_top">systembus-notify</a>,
          allow system level notifications to reach the users. Available
          as
          <a class="link" href="opt-services.systembus-notify.enable" target="_top">services.systembus-notify</a>.
          Please keep in mind that this service should only be enabled
          on machines with fully trusted users, as any local user is
          able to DoS user sessions by spamming notifications.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://goteleport.com" target="_top">teleport</a>,
          allows engineers and security professionals to unify access
          for SSH servers, Kubernetes clusters, web applications, and
          databases across all environments. Available at
          <a class="link" href="options.html#opt-services.teleport.enable">services.teleport</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://tetrd.app" target="_top">tetrd</a>, share your
          internet connection from your device to your PC and vice versa
          through a USB cable. Available at
          <a class="link" href="options.html#opt-services.tetrd.enable">services.tetrd</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://upterm.dev" target="_top">uptermd</a>, an
          open-source solution for sharing terminal sessions instantly
          over the public internet via secure tunnels. Available at
          <a class="link" href="options.html#opt-services.uptermd.enable">services.uptermd</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/darrylb123/usbrelay" target="_top">usbrelayd</a>,
          an USB Relay MQTT daemon. Available as
          <a class="link" href="options.html#opt-services.usbrelayd.enable">services.usbrelayd</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/miquels/webdav-server-rs" target="_top">webdav-server-rs</a>,
          Webdav server in rust. Available as
          <a class="link" href="options.html#opt-services.webdav-server-rs.enable">services.webdav-server-rs</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/gin66/wg_netmanager" target="_top">wg-netmanager</a>,
          the Wireguard network manager. Available as
          <a class="link" href="options.html#opt-services.wg-netmanager.enable">services.wg-netmanager</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://zammad.org/" target="_top">Zammad</a>, a
          web-based, open source user support/ticketing solution.
          Available as
          <a class="link" href="options.html#opt-services.zammad.enable">services.zammad</a>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-22.05-incompatibilities"></a>B.1.3. Backward Incompatibilities</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">pkgs.ghc</code> now refers to
          <code class="literal">pkgs.targetPackages.haskellPackages.ghc</code>.
          This <span class="emphasis"><em>only</em></span> makes a difference if you are
          cross-compiling and will ensure that
          <code class="literal">pkgs.ghc</code> always runs on the host platform
          and compiles for the target platform (similar to
          <code class="literal">pkgs.gcc</code> for example).
          <code class="literal">haskellPackages.ghc</code> still behaves as
          before, running on the build platform and compiling for the
          host platform (similar to <code class="literal">stdenv.cc</code>). This
          means you don’t have to adjust your derivations if you use
          <code class="literal">haskellPackages.callPackage</code>, but when using
          <code class="literal">pkgs.callPackage</code> and taking
          <code class="literal">ghc</code> as an input, you should now use
          <code class="literal">buildPackages.ghc</code> instead to ensure cross
          compilation keeps working (or switch to
          <code class="literal">haskellPackages.callPackage</code>).
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.ghc.withPackages</code> as well as
          <code class="literal">haskellPackages.ghcWithPackages</code> etc. now
          needs be overridden directly, as opposed to overriding the
          result of calling it. Additionally, the
          <code class="literal">withLLVM</code> parameter has been renamed to
          <code class="literal">useLLVM</code>. So instead of
          <code class="literal">(ghc.withPackages (p: [])).override { withLLVM = true; }</code>,
          one needs to use
          <code class="literal">(ghc.withPackages.override { useLLVM = true; }) (p: [])</code>.
        </p></li><li class="listitem"><p>
          The update of the haskell package set brings with it a new
          version of the <code class="literal">xmonad</code> module, which will
          break your configuration if you use <code class="literal">launch</code>
          as entrypoint. The example code the corresponding nixos module
          was adjusted, you may want to have a look at it.
        </p></li><li class="listitem"><p>
          The <code class="literal">home-assistant</code> module now requires
          users that don’t want their configuration to be managed
          declaratively to set
          <code class="literal">services.home-assistant.config = null;</code>.
          This is required due to the way default settings are handled
          with the new settings style.
        </p><p>
          Additionally the default list of
          <code class="literal">extraComponents</code> now includes the minimal
          dependencies to successfully complete the
          <a class="link" href="https://www.home-assistant.io/getting-started/onboarding/" target="_top">onboarding</a>
          procedure.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.emacsPackages.orgPackages</code> is removed
          because org elpa is deprecated. The packages in the top level
          of <code class="literal">pkgs.emacsPackages</code>, such as org and
          org-contrib, refer to the ones in
          <code class="literal">pkgs.emacsPackages.elpaPackages</code> and
          <code class="literal">pkgs.emacsPackages.nongnuPackages</code> where the
          new versions will release.
        </p></li><li class="listitem"><p>
          The configuration and state directories used by
          <code class="literal">nixos-containers</code> have been moved from
          <code class="literal">/etc/containers</code> and
          <code class="literal">/var/lib/containers</code> to
          <code class="literal">/etc/nixos-containers</code> and
          <code class="literal">/var/lib/nixos-containers</code>.
        </p><p>
          If you are changing <code class="literal">system.stateVersion</code> to
          <code class="literal">"22.05"</code> manually on an existing
          system you are responsible for migrating these directories
          yourself.
        </p><p>
          This is to improve compatibility with
          <code class="literal">libcontainer</code> based software such as Podman
          and Skopeo which assumes they have ownership over
          <code class="literal">/etc/containers</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.systems.supported</code> has been removed, as
          it was overengineered for determining the systems to support
          in the nixpkgs flake. The list of systems exposed by the
          nixpkgs flake can now be accessed as
          <code class="literal">lib.systems.flakeExposed</code>.
        </p></li><li class="listitem"><p>
          For new installations
          <code class="literal">virtualisation.oci-containers.backend</code> is
          now set to <code class="literal">podman</code> by default. If you still
          want to use Docker on systems where
          <code class="literal">system.stateVersion</code> is set to to
          <code class="literal">"22.05"</code> set
          <code class="literal">virtualisation.oci-containers.backend = "docker";</code>.Old
          systems with older <code class="literal">stateVersion</code>s stay with
          <span class="quote">“<span class="quote">docker</span>”</span>.
        </p></li><li class="listitem"><p>
          <code class="literal">security.klogd</code> was removed. Logging of
          kernel messages is handled by systemd since Linux 3.5.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.ssmtp</code> has been dropped due to the
          program being unmaintained. <code class="literal">pkgs.msmtp</code> can
          be used instead as a substitute <code class="literal">sendmail</code>
          implementation. The corresponding options
          <code class="literal">services.ssmtp.*</code> have been removed as well.
          <code class="literal">programs.msmtp.*</code> can be used instead for an
          equivalent setup. For example:
        </p><pre class="programlisting">
{
  # Original ssmtp configuration:
  services.ssmtp = {
    enable = true;
    useTLS = true;
    useSTARTTLS = true;
    hostName = "smtp.example:587";
    authUser = "someone";
    authPassFile = "/secrets/password.txt";
  };

  # Equivalent msmtp configuration:
  programs.msmtp = {
    enable = true;
    accounts.default = {
      tls = true;
      tls_starttls = true;
      auth = true;
      host = "smtp.example";
      port = 587;
      user = "someone";
      passwordeval = "cat /secrets/password.txt";
    };
  };
}
</pre></li><li class="listitem"><p>
          <code class="literal">services.kubernetes.addons.dashboard</code> was
          removed due to it being an outdated version.
        </p></li><li class="listitem"><p>
          <code class="literal">services.kubernetes.scheduler.{port,address}</code>
          now set <code class="literal">--secure-port</code> and
          <code class="literal">--bind-address</code> instead of
          <code class="literal">--port</code> and <code class="literal">--address</code>,
          since the former have been deprecated and are no longer
          functional in kubernetes&gt;=1.23. Ensure that you are not
          relying on the insecure behaviour before upgrading.
        </p></li><li class="listitem"><p>
          In the PowerDNS Recursor module
          (<code class="literal">services.pdns-recursor</code>), default values of
          several IP address-related NixOS options have been updated to
          match the default upstream behavior. In particular, Recursor
          by default will:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              listen on (and allows connections from) both IPv4 and IPv6
              addresses
              (<code class="literal">services.pdns-recursor.dns.address</code>,
              <code class="literal">services.pdns-recursor.dns.allowFrom</code>);
            </p></li><li class="listitem"><p>
              allow only local connections to the REST API server
              (<code class="literal">services.pdns-recursor.api.allowFrom</code>).
            </p></li></ul></div></li><li class="listitem"><p>
          In the ncdns module, the default value of
          <code class="literal">services.ncdns.address</code> has been changed to
          the IPv6 loopback address (<code class="literal">::1</code>).
        </p></li><li class="listitem"><p>
          <code class="literal">openldap</code> (and therefore the slapd LDAP
          server) were updated to version 2.6.2. The project introduced
          backwards-incompatible changes, namely the removal of the bdb,
          hdb, ndb, and shell backends in slapd. Therefore before
          updating, dump your database <code class="literal">slapcat -n 1</code>
          in LDIF format, and reimport it after updating your
          <code class="literal">services.openldap.settings</code>, which
          represents your <code class="literal">cn=config</code>.
        </p><p>
          Additionally with 2.5 the argon2 module was included in the
          standard distrubtion and renamed from
          <code class="literal">pw-argon2</code> to <code class="literal">argon2</code>.
          Remember to update your <code class="literal">olcModuleLoad</code> entry
          in <code class="literal">cn=config</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">openssh</code> has been update to 8.9p1, changing
          the FIDO security key middleware interface.
        </p></li><li class="listitem"><p>
          <code class="literal">git</code> no longer hardcodes the path to
          openssh’ ssh binary to reduce the amount of rebuilds. If you
          are using git with ssh remotes and do not have a ssh binary in
          your enviroment consider adding <code class="literal">openssh</code> to
          it or switching to <code class="literal">gitFull</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.k3s.enable</code> no longer implies
          <code class="literal">systemd.enableUnifiedCgroupHierarchy = false</code>,
          and will default to the <span class="quote">“<span class="quote">systemd</span>”</span> cgroup driver
          when using <code class="literal">services.k3s.docker = true</code>. This
          change may require a reboot to take effect, and k3s may not be
          able to run if the boot cgroup hierarchy does not match its
          configuration. The previous behavior may be retained by
          explicitly setting
          <code class="literal">systemd.enableUnifiedCgroupHierarchy = false</code>
          in your configuration.
        </p></li><li class="listitem"><p>
          <code class="literal">fonts.fonts</code> no longer includes ancient
          bitmap fonts when both
          <code class="literal">config.services.xserver.enable</code> and
          <code class="literal">config.nixpkgs.config.allowUnfree</code> are
          enabled. If you still want these fonts, use:
        </p><pre class="programlisting">
{
  fonts.fonts = [
    pkgs.xorg.fontbhlucidatypewriter100dpi
    pkgs.xorg.fontbhlucidatypewriter75dpi
    pkgs.xorg.fontbh100dpi
  ];
}
</pre></li><li class="listitem"><p>
          <code class="literal">services.prometheus.alertManagerTimeout</code> has
          been removed as it has been deprecated upstream and has no
          effect.
        </p></li><li class="listitem"><p>
          The DHCP server (<code class="literal">services.dhcpd4</code>,
          <code class="literal">services.dhcpd6</code>) has been hardened. The
          service is now using the systemd’s
          <code class="literal">DynamicUser</code> mechanism to run as an
          unprivileged dynamically-allocated user with limited
          capabilities. The dhcpd state files are now always stored in
          <code class="literal">/var/lib/dhcpd{4,6}</code> and the
          <code class="literal">services.dhcpd4.stateDir</code> and
          <code class="literal">service.dhcpd6.stateDir</code> options have been
          removed. If you were depending on root privileges or
          set{uid,gid,cap} binaries in dhcpd shell hooks, you may give
          dhcpd more capabilities with e.g.
          <code class="literal">systemd.services.dhcpd6.serviceConfig.AmbientCapabilities</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">mailpile</code> email webclient
          (<code class="literal">services.mailpile</code>) has been removed due to
          its reliance on python2.
        </p></li><li class="listitem"><p>
          <code class="literal">services.ipfs.extraFlags</code> is now escaped
          with <code class="literal">utils.escapeSystemdExecArgs</code>. If you
          rely on systemd interpolating <code class="literal">extraFlags</code> in
          the service <code class="literal">ExecStart</code>, this will no longer
          work.
        </p></li><li class="listitem"><p>
          <code class="literal">hbase</code> version 0.98.24 has been removed. The
          package now defaults to version 2.4.11. Versions 1.7.1 and
          3.0.0-alpha-2 are also available.
        </p></li><li class="listitem"><p>
          <code class="literal">services.paperless-ng</code> was renamed to
          <code class="literal">services.paperless</code>. Accordingly, the
          <code class="literal">paperless-ng-manage</code> script (located in
          <code class="literal">dataDir</code>) was renamed to
          <code class="literal">paperless-manage</code>.
          <code class="literal">services.paperless</code> now uses
          <code class="literal">paperless-ngx</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">matrix-synapse</code> service
          (<code class="literal">services.matrix-synapse</code>) has been
          converted to use the <code class="literal">settings</code> option
          defined in RFC42. This means that options that are part of
          your <code class="literal">homeserver.yaml</code> configuration, and
          that were specified at the top-level of the module
          (<code class="literal">services.matrix-synapse</code>) now need to be
          moved into
          <code class="literal">services.matrix-synapse.settings</code>. And while
          not all options you may use are defined in there, they are
          still supported, because you can set arbitrary values in this
          freeform type.
        </p><p>
          The <code class="literal">listeners.*.bind_address</code> option was
          renamed to <code class="literal">bind_addresses</code> in order to match
          the upstream <code class="literal">homeserver.yaml</code> option name.
          It is now also a list of strings instead of a string.
        </p><p>
          An example to make the required migration clearer:
        </p><p>
          Before:
        </p><pre class="programlisting">
{
  services.matrix-synapse = {
    enable = true;

    server_name = "example.com";
    public_baseurl = "https://example.com:8448";

    enable_registration = false;
    registration_shared_secret = "xohshaeyui8jic7uutuDogahkee3aehuaf6ei3Xouz4iicie5thie6nohNahceut";
    macaroon_secret_key = "xoo8eder9seivukaiPh1cheikohquuw8Yooreid0The4aifahth3Ou0aiShaiz4l";

    tls_certificate_path = "/var/lib/acme/example.com/fullchain.pem";
    tls_certificate_path = "/var/lib/acme/example.com/fullchain.pem";

    listeners = [ {
      port = 8448;
      bind_address = "";
      type = "http";
      tls = true;
      resources = [ {
        names = [ "client" ];
        compress = true;
      } {
        names = [ "federation" ];
        compress = false;
      } ];
    } ];

  };
}
</pre><p>
          After:
        </p><pre class="programlisting">
{
  services.matrix-synapse = {
    enable = true;

    # this attribute set holds all values that go into your homeserver.yaml configuration
    # See https://github.com/matrix-org/synapse/blob/develop/docs/sample_config.yaml for
    # possible values.
    settings = {
      server_name = "example.com";
      public_baseurl = "https://example.com:8448";

      enable_registration = false;
      # pass `registration_shared_secret` and `macaroon_secret_key` via `extraConfigFiles` instead

      tls_certificate_path = "/var/lib/acme/example.com/fullchain.pem";
      tls_certificate_path = "/var/lib/acme/example.com/fullchain.pem";

      listeners = [ {
        port = 8448;
        bind_addresses = [
          "::"
          "0.0.0.0"
        ];
        type = "http";
        tls = true;
        resources = [ {
          names = [ "client" ];
          compress = true;
        } {
          names = [ "federation" ];
          compress = false;
        } ];
      } ];
    };

    extraConfigFiles = [
      "/run/keys/matrix-synapse/secrets.yaml"
    ];
  };
}
</pre><p>
          The secrets in your original config should be migrated into a
          YAML file that is included via
          <code class="literal">extraConfigFiles</code>. The filename must be
          quoted to prevent nix from copying it to the (world readable)
          store.
        </p><p>
          Additionally a few option defaults have been synced up with
          upstream default values, for example the
          <code class="literal">max_upload_size</code> grew from
          <code class="literal">10M</code> to <code class="literal">50M</code>. For the same
          reason, the default <code class="literal">media_store_path</code> was
          changed from <code class="literal">${dataDir}/media</code> to
          <code class="literal">${dataDir}/media_store</code> if
          <code class="literal">system.stateVersion</code> is at least
          <code class="literal">22.05</code>. Files will need to be manually moved
          to the new location if the <code class="literal">stateVersion</code> is
          updated.
        </p><p>
          As of Synapse 1.58.0, the old groups/communities feature has
          been disabled by default. It will be completely removed with
          Synapse 1.61.0.
        </p></li><li class="listitem"><p>
          The Keycloak package (<code class="literal">pkgs.keycloak</code>) has
          been switched from the Wildfly version, which will soon be
          deprecated, to the Quarkus based version. The Keycloak service
          (<code class="literal">services.keycloak</code>) has been updated to
          accommodate the change and now differs from the previous
          version in a few ways:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.keycloak.extraConfig</code> has been
              removed in favor of the new
              <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">settings-style</a>
              <a class="link" href="options.html#opt-services.keycloak.settings"><code class="literal">services.keycloak.settings</code></a>
              option. The available options correspond directly to
              parameters in <code class="literal">conf/keycloak.conf</code>. Some
              of the most important parameters are documented as
              suboptions, the rest can be found in the
              <a class="link" href="https://www.keycloak.org/server/all-config" target="_top">All
              configuration section of the Keycloak Server Installation
              and Configuration Guide</a>. While the new
              configuration is much simpler and cleaner than the old
              JBoss CLI one, this unfortunately mean that there’s no
              straightforward way to convert an old configuration to the
              new format and some settings may not even be available
              anymore.
            </p></li><li class="listitem"><p>
              <code class="literal">services.keycloak.frontendUrl</code> was
              removed and the frontend URL is now configured through the
              <code class="literal">hostname</code> family of settings in
              <a class="link" href="options.html#opt-services.keycloak.settings"><code class="literal">services.keycloak.settings</code></a>
              instead. See the
              <a class="link" href="https://www.keycloak.org/server/hostname" target="_top">Hostname
              section of the Keycloak Server Installation and
              Configuration Guide</a> for more details. Additionally,
              <code class="literal">/auth</code> was removed from the default
              context path and needs to be added back in
              <a class="link" href="options.html#opt-services.keycloak.settings.http-relative-path"><code class="literal">services.keycloak.settings.http-relative-path</code></a>
              if you want to keep compatibility with your current
              clients.
            </p></li><li class="listitem"><p>
              <code class="literal">services.keycloak.bindAddress</code>,
              <code class="literal">services.keycloak.forceBackendUrlToFrontendUrl</code>,
              <code class="literal">services.keycloak.httpPort</code> and
              <code class="literal">services.keycloak.httpsPort</code> have been
              removed in favor of their equivalent options in
              <a class="link" href="options.html#opt-services.keycloak.settings"><code class="literal">services.keycloak.settings</code></a>.
              <code class="literal">httpPort</code> and
              <code class="literal">httpsPort</code> have additionally had their
              types changed from <code class="literal">str</code> to
              <code class="literal">port</code>.
            </p><p>
              The new names are as follows:
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  <code class="literal">bindAddress</code>:
                  <a class="link" href="options.html#opt-services.keycloak.settings.http-host"><code class="literal">services.keycloak.settings.http-host</code></a>
                </p></li><li class="listitem"><p>
                  <code class="literal">forceBackendUrlToFrontendUrl</code>:
                  <a class="link" href="options.html#opt-services.keycloak.settings.hostname-strict-backchannel"><code class="literal">services.keycloak.settings.hostname-strict-backchannel</code></a>
                </p></li><li class="listitem"><p>
                  <code class="literal">httpPort</code>:
                  <a class="link" href="options.html#opt-services.keycloak.settings.http-port"><code class="literal">services.keycloak.settings.http-port</code></a>
                </p></li><li class="listitem"><p>
                  <code class="literal">httpsPort</code>:
                  <a class="link" href="options.html#opt-services.keycloak.settings.https-port"><code class="literal">services.keycloak.settings.https-port</code></a>
                </p></li></ul></div></li></ul></div><p>
          For example, when using a reverse proxy the migration could
          look like this:
        </p><p>
          Before:
        </p><pre class="programlisting">
  services.keycloak = {
    enable = true;
    httpPort = "8080";
    frontendUrl = "https://keycloak.example.com/auth";
    database.passwordFile = "/run/keys/db_password";
    extraConfig = {
      "subsystem=undertow"."server=default-server"."http-listener=default".proxy-address-forwarding = true;
    };
  };
</pre><p>
          After:
        </p><pre class="programlisting">
  services.keycloak = {
    enable = true;
    settings = {
      http-port = 8080;
      hostname = "keycloak.example.com";
      http-relative-path = "/auth";
      proxy = "edge";
    };
    database.passwordFile = "/run/keys/db_password";
  };
</pre></li><li class="listitem"><p>
          The MoinMoin wiki engine
          (<code class="literal">services.moinmoin</code>) has been removed,
          because Python 2 is being retired from nixpkgs.
        </p></li><li class="listitem"><p>
          Services in the <code class="literal">hadoop</code> module previously
          set <code class="literal">openFirewall</code> to true by default. This
          has now been changed to false. Node definitions for multi-node
          clusters would need <code class="literal">openFirewall = true;</code> to
          be added to to hadoop services when upgrading from NixOS
          21.11.
        </p></li><li class="listitem"><p>
          <code class="literal">services.hadoop.yarn.nodemanager</code> now uses
          cgroup-based CPU limit enforcement by default. Additionally,
          the option <code class="literal">useCGroups</code> was added to
          nodemanagers as an easy way to switch back to the old
          behavior.
        </p></li><li class="listitem"><p>
          The <code class="literal">wafHook</code> hook now honors
          <code class="literal">NIX_BUILD_CORES</code> when
          <code class="literal">enableParallelBuilding</code> is not set
          explicitly. Packages can restore the old behaviour by setting
          <code class="literal">enableParallelBuilding=false</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.claws-mail-gtk2</code>, representing Claws
          Mail’s older release version three, was removed in order to
          get rid of Python 2. Please switch to
          <code class="literal">claws-mail</code>, which is Claws Mail’s latest
          release based on GTK+3 and Python 3.
        </p></li><li class="listitem"><p>
          The <code class="literal">writers.writePython2</code> and corresponding
          <code class="literal">writers.writePython2Bin</code> convenience
          functions to create executable Python 2 scripts in the store
          were removed in preparation of removal of the Python 2
          interpreter. Scripts have to be converted to Python 3 for use
          with <code class="literal">writers.writePython3</code> or
          <code class="literal">writers.writePyPy2</code> needs to be used.
        </p></li><li class="listitem"><p>
          <code class="literal">buildGoModule</code> was updated to use
          <code class="literal">go_1_17</code>, third party derivations that
          specify &gt;= go 1.17 in the main <code class="literal">go.mod</code>
          will need to regenerate their <code class="literal">vendorSha256</code>
          hash.
        </p></li><li class="listitem"><p>
          The <code class="literal">gnome-passwordsafe</code> package updated to
          <a class="link" href="https://gitlab.gnome.org/World/secrets/-/tags/6.0" target="_top">version
          6.x</a> and renamed to <code class="literal">gnome-secrets</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.gnome.experimental-features.realtime-scheduling</code>
          option has been removed, as GNOME Shell now
          <a class="link" href="https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/2060" target="_top">uses
          rtkit</a>. Use
          <code class="literal">security.rtkit.enable = true;</code> instead. As
          before, you will need to have it enabled using GSettings.
        </p></li><li class="listitem"><p>
          <code class="literal">services.telepathy</code> will no longer be
          enabled by default for GNOME desktops, one should enable it in
          their configs if using Empathy or Polari.
        </p></li><li class="listitem"><p>
          If you previously used
          <code class="literal">/etc/docker/daemon.json</code>, you need to
          incorporate the changes into the new option
          <code class="literal">virtualisation.docker.daemon.settings</code>.
        </p></li><li class="listitem"><p>
          Ntopng (<code class="literal">services.ntopng</code>) is updated to
          5.2.1 and uses a separate Redis instance if
          <code class="literal">system.stateVersion</code> is at least
          <code class="literal">22.05</code>. Existing setups shouldn’t be
          affected.
        </p></li><li class="listitem"><p>
          The backward compatibility in
          <code class="literal">services.wordpress</code> to configure sites with
          the old interface has been removed. Please use
          <code class="literal">services.wordpress.sites</code> instead.
        </p></li><li class="listitem"><p>
          The backward compatibility in
          <code class="literal">services.dokuwiki</code> to configure sites with
          the old interface has been removed. Please use
          <code class="literal">services.dokuwiki.sites</code> instead.
        </p></li><li class="listitem"><p>
          opensmtpd-extras is no longer build with python2 scripting
          support due to python2 deprecation in nixpkgs
        </p></li><li class="listitem"><p>
          <code class="literal">services.miniflux.adminCredentialFiles</code> is
          now required, instead of defaulting to
          <code class="literal">admin</code> and <code class="literal">password</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">taskserver</code> module no longer implicitly
          opens ports in the firewall configuration. This is now
          controlled through the option
          <code class="literal">services.taskserver.openFirewall</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">autorestic</code> package has been upgraded
          from 1.3.0 to 1.5.0 which introduces breaking changes in
          config file, check
          <a class="link" href="https://autorestic.vercel.app/migration/1.4_1.5" target="_top">their
          migration guide</a> for more details.
        </p></li><li class="listitem"><p>
          <code class="literal">teleport</code> has been upgraded to major version
          9. Please see upstream
          <a class="link" href="https://goteleport.com/docs/setup/operations/upgrading/" target="_top">upgrade
          instructions</a> and
          <a class="link" href="https://goteleport.com/docs/changelog/#900" target="_top">release
          notes</a>.
        </p></li><li class="listitem"><p>
          For <code class="literal">pkgs.python3.pkgs.ipython</code>, its direct
          dependency
          <code class="literal">pkgs.python3.pkgs.matplotlib-inline</code> (which
          is really an adapter to integrate matplotlib in ipython if it
          is installed) does not depend on
          <code class="literal">pkgs.python3.pkgs.matplotlib</code> anymore. This
          is closer to a non-Nix install of ipython. This has the added
          benefit to reduce the closure size of
          <code class="literal">ipython</code> from ~400MB to ~160MB (including
          ~100MB for python itself).
        </p></li><li class="listitem"><p>
          <code class="literal">documentation.man</code> has been refactored to
          support choosing a man implementation other than GNU’s
          <code class="literal">man-db</code>. For this,
          <code class="literal">documentation.man.manualPages</code> has been
          renamed to
          <code class="literal">documentation.man.man-db.manualPages</code>. If
          you want to use the new alternative man implementation
          <code class="literal">mandoc</code>, add
          <code class="literal">documentation.man = { enable = true; man-db.enable = false; mandoc.enable = true; }</code>
          to your configuration.
        </p></li><li class="listitem"><p>
          Normal users (with <code class="literal">isNormalUser = true</code>)
          which have non-empty <code class="literal">subUidRanges</code> or
          <code class="literal">subGidRanges</code> set no longer have additional
          implicit ranges allocated. To enable automatic allocation back
          set <code class="literal">autoSubUidGidRange = true</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">idris2</code> now requires
          <code class="literal">--package</code> when using packages
          <code class="literal">contrib</code> and <code class="literal">network</code>,
          while previously these idris2 packages were automatically
          loaded.
        </p></li><li class="listitem"><p>
          The iputils package, which is installed by default, no longer
          provides the legacy tools <code class="literal">tftpd</code> and
          <code class="literal">traceroute6</code>. More tools
          (<code class="literal">ninfod</code>, <code class="literal">rarpd</code>, and
          <code class="literal">rdisc</code>) are going to be removed in the next
          release. See
          <a class="link" href="https://github.com/iputils/iputils/releases/tag/20211215" target="_top">upstream’s
          release notes</a> for more details and available
          replacements.
        </p></li><li class="listitem"><p>
          <code class="literal">services.thelounge.private</code> was removed in
          favor of <code class="literal">services.thelounge.public</code>, to
          follow with upstream changes.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.docbookrx</code> was removed since it’s
          unmaintained
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs._7zz</code> is now correctly licensed as
          LGPL3+ and BSD3 with optional unfree unRAR licensed code
        </p></li><li class="listitem"><p>
          The <code class="literal">vim.customize</code> function produced by
          <code class="literal">vimUtils.makeCustomizable</code> now has a
          slightly different interface:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              The wrapper now includes everything in the given Vim
              derivation if <code class="literal">name</code> is
              <code class="literal">"vim"</code> (the default). This
              makes the <code class="literal">wrapManual</code> argument obsolete,
              but this behavior can be overriden by setting the
              <code class="literal">standalone</code> argument.
            </p></li><li class="listitem"><p>
              All the executables present in the given derivation (or,
              in <code class="literal">standalone</code> mode, only the
              <code class="literal">*vim</code> ones) are wrapped. This makes the
              <code class="literal">wrapGui</code> argument obsolete.
            </p></li><li class="listitem"><p>
              The <code class="literal">vimExecutableName</code> and
              <code class="literal">gvimExecutableName</code> arguments were
              replaced by a single <code class="literal">executableName</code>
              argument in which the shell variable
              <code class="literal">$exe</code> can be used to refer to the
              wrapped executable’s name.
            </p></li></ul></div><p>
          See the comments in
          <code class="literal">pkgs/applications/editors/vim/plugins/vim-utils.nix</code>
          for more details.
        </p><p>
          <code class="literal">vimUtils.vimWithRC</code> was removed. You should
          instead use <code class="literal">customize</code> on a Vim derivation,
          which now accepts <code class="literal">vimrcFile</code> and
          <code class="literal">gvimrcFile</code> arguments.
        </p></li><li class="listitem"><p>
          <code class="literal">tilp2</code> was removed together with its module
        </p></li><li class="listitem"><p>
          The F-PROT antivirus (<code class="literal">fprot</code> package) and
          its service module were removed because it reached
          <a class="link" href="https://kb.cyren.com/av-support/index.php?/Knowledgebase/Article/View/434/0/end-of-sale--end-of-life-for-f-prot-and-csam" target="_top">end-of-life</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">bird1</code> and its modules
          <code class="literal">services.bird</code> as well as
          <code class="literal">services.bird6</code> have been removed. Upgrade
          to <code class="literal">services.bird2</code>.
        </p></li><li class="listitem"><p>
          The options
          <code class="literal">networking.interfaces.&lt;name&gt;.ipv4.routes</code>
          and
          <code class="literal">networking.interfaces.&lt;name&gt;.ipv6.routes</code>
          are no longer ignored when using networkd instead of the
          default scripted network backend by setting
          <code class="literal">networking.useNetworkd</code> to
          <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">miller</code> package has been upgraded from
          5.10.3 to
          <a class="link" href="https://github.com/johnkerl/miller/releases/tag/v6.2.0" target="_top">6.2.0</a>.
          See
          <a class="link" href="https://miller.readthedocs.io/en/latest/new-in-miller-6" target="_top">What’s
          new in Miller 6</a>.
        </p></li><li class="listitem"><p>
          MultiMC has been replaced with the fork PolyMC due to upstream
          developers being hostile to 3rd party package maintainers.
          PolyMC removes all MultiMC branding and is aimed at providing
          proper 3rd party packages like the one contained in Nixpkgs.
          This change affects the data folder where game instances and
          other save and configuration files are stored. Users with
          existing installations should rename
          <code class="literal">~/.local/share/multimc</code> to
          <code class="literal">~/.local/share/polymc</code>. The main config
          file’s path has also moved from
          <code class="literal">~/.local/share/multimc/multimc.cfg</code> to
          <code class="literal">~/.local/share/polymc/polymc.cfg</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">systemd-nspawn@.service</code> settings have been
          reverted to the default systemd behaviour. User namespaces are
          now activated by default. If you want to keep running nspawn
          containers without user namespaces you need to set
          <code class="literal">systemd.nspawn.&lt;name&gt;.execConfig.PrivateUsers = false</code>
        </p></li><li class="listitem"><p>
          <code class="literal">systemd-shutdown</code> is now properly linked on
          shutdown to unmount all filesystems and device mapper devices
          cleanly. This can be disabled using
          <code class="literal">systemd.shutdownRamfs.enable</code>.
        </p></li><li class="listitem"><p>
          The Tor SOCKS proxy is now actually disabled if
          <code class="literal">services.tor.client.enable</code> is set to
          <code class="literal">false</code> (the default). If you are using this
          functionality but didn’t change the setting or set it to
          <code class="literal">false</code>, you now need to set it to
          <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.github-runner</code> has been hardened.
          Notably address families and system calls have been
          restricted, which may adversely affect some kinds of testing,
          e.g. using <code class="literal">AF_BLUETOOTH</code> to test bluetooth
          devices.
        </p></li><li class="listitem"><p>
          The terraform 0.12 compatibility has been removed and the
          <code class="literal">terraform.withPlugins</code> and
          <code class="literal">terraform-providers.mkProvider</code>
          implementations simplified. Providers now need to be stored
          under
          <code class="literal">$out/libexec/terraform-providers/&lt;registry&gt;/&lt;owner&gt;/&lt;name&gt;/&lt;version&gt;/&lt;os&gt;_&lt;arch&gt;/terraform-provider-&lt;name&gt;_v&lt;version&gt;</code>
          (which mkProvider does).
        </p><p>
          This breaks back-compat so it’s not possible to mix-and-match
          with previous versions of nixpkgs. In exchange, it now becomes
          possible to use the providers from
          <a class="link" href="https://github.com/numtide/nixpkgs-terraform-providers-bin" target="_top">nixpkgs-terraform-providers-bin</a>
          directly.
        </p></li><li class="listitem"><p>
          The <code class="literal">dendrite</code> package has been upgraded from
          0.5.1 to
          <a class="link" href="https://github.com/matrix-org/dendrite/releases/tag/v0.6.5" target="_top">0.6.5</a>.
          Instances configured with split sqlite databases, which has
          been the default in NixOS, require merging of the federation
          sender and signing key databases. See upstream
          <a class="link" href="https://github.com/matrix-org/dendrite/releases/tag/v0.6.0" target="_top">release
          notes</a> on version 0.6.0 for details on database changes.
        </p></li><li class="listitem"><p>
          The existing <code class="literal">pkgs.opentelemetry-collector</code>
          has been moved to
          <code class="literal">pkgs.opentelemetry-collector-contrib</code> to
          match the actual source being the <span class="quote">“<span class="quote">contrib</span>”</span>
          edition. <code class="literal">pkgs.opentelemetry-collector</code> is
          now the actual core release of opentelemetry-collector. If you
          use the community contributions you should change the package
          you refer to. If you don’t need them update your commands from
          <code class="literal">otelcontribcol</code> to
          <code class="literal">otelcorecol</code> and enjoy a 7x smaller binary.
        </p></li><li class="listitem"><p>
          <code class="literal">services.zookeeper</code> has a new option
          <code class="literal">jre</code> for specifying the JRE to start
          zookeeper with. It defaults to the JRE that
          <code class="literal">pkgs.zookeeper</code> was wrapped with, instead of
          <code class="literal">pkgs.jre</code>. This changes the JRE to
          <code class="literal">pkgs.jdk11_headless</code> by default.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.pgadmin</code> now refers to
          <code class="literal">pkgs.pgadmin4</code>. <code class="literal">pgadmin3</code>
          has been removed.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.minetestclient_4</code> and
          <code class="literal">pkgs.minetestserver_4</code> have been removed, as
          the last 4.x release was in 2018.
          <code class="literal">pkgs.minetestclient</code> (equivalent to
          <code class="literal">pkgs.minetest</code> ) and
          <code class="literal">pkgs.minetestserver</code> can be used instead.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.noto-fonts-cjk</code> is now deprecated in
          favor of <code class="literal">pkgs.noto-fonts-cjk-sans</code> and
          <code class="literal">pkgs.noto-fonts-cjk-serif</code> because they each
          have different release schedules. To maintain compatibility
          with prior releases of Nixpkgs,
          <code class="literal">pkgs.noto-fonts-cjk</code> is currently an alias
          of <code class="literal">pkgs.noto-fonts-cjk-sans</code> and doesn’t
          include serif fonts.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.epgstation</code> has been upgraded from v1
          to v2, resulting in incompatible changes in the database
          scheme and configuration format.
        </p></li><li class="listitem"><p>
          Some top-level settings under
          <a class="link" href="options.html#opt-services.epgstation.enable">services.epgstation</a>
          is now deprecated because it was redudant due to the same
          options being present in
          <a class="link" href="options.html#opt-services.epgstation.settings">services.epgstation.settings</a>.
        </p></li><li class="listitem"><p>
          The option <code class="literal">services.epgstation.basicAuth</code>
          was removed because basic authentication support was dropped
          by upstream.
        </p></li><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-services.epgstation.database.passwordFile">services.epgstation.database.passwordFile</a>
          no longer has a default value. Make sure to set this option
          explicitly before upgrading. Change the database password if
          necessary.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.epgstation.settings">services.epgstation.settings</a>
          option now expects options for <code class="literal">config.yml</code>
          in EPGStation v2.
        </p></li><li class="listitem"><p>
          Existing data for the
          <a class="link" href="options.html#opt-services.epgstation.enable">services.epgstation</a>
          module would have to be backed up prior to the upgrade. To
          back up exising data to
          <code class="literal">/tmp/epgstation.bak</code>, run
          <code class="literal">sudo -u epgstation epgstation run backup /tmp/epgstation.bak</code>.
          To import that data after to the upgrade, run
          <code class="literal">sudo -u epgstation epgstation run v1migrate /tmp/epgstation.bak</code>
        </p></li><li class="listitem"><p>
          <code class="literal">switch-to-configuration</code> (the script that is
          run when running <code class="literal">nixos-rebuild switch</code> for
          example) has been reworked
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              The interface that allows activation scripts to restart
              units has been streamlined. Restarting and reloading is
              now done by a single file
              <code class="literal">/run/nixos/activation-restart-list</code> that
              honors <code class="literal">restartIfChanged</code> and
              <code class="literal">reloadIfChanged</code> of the units.
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  Preferring to reload instead of restarting can still
                  be achieved using
                  <code class="literal">/run/nixos/activation-reload-list</code>.
                </p></li></ul></div></li><li class="listitem"><p>
              The script now uses a proper ini-file parser to parse
              systemd units. Some values are now only searched in one
              section instead of in the entire unit. This is only
              relevant for units that don’t use the NixOS systemd moule.
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  <code class="literal">RefuseManualStop</code>,
                  <code class="literal">X-OnlyManualStart</code>,
                  <code class="literal">X-StopOnRemoval</code>,
                  <code class="literal">X-StopOnReconfiguration</code> are only
                  searched in the <code class="literal">[Unit]</code> section
                </p></li><li class="listitem"><p>
                  <code class="literal">X-ReloadIfChanged</code>,
                  <code class="literal">X-RestartIfChanged</code>,
                  <code class="literal">X-StopIfChanged</code> are only searched
                  in the <code class="literal">[Service]</code> section
                </p></li></ul></div></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">services.bookstack.cacheDir</code> option has
          been removed, since the cache directory is now handled by
          systemd.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.bookstack.extraConfig</code> option
          has been replaced by
          <code class="literal">services.bookstack.config</code> which implements
          a
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">settings-style</a>
          configuration.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.assertMsg</code> and
          <code class="literal">lib.assertOneOf</code> no longer return
          <code class="literal">false</code> if the passed condition is
          <code class="literal">false</code>, <code class="literal">throw</code>ing the
          given error message instead (which makes the resulting error
          message less cluttered). This will not impact the behaviour of
          code using these functions as intended, namely as top-level
          wrapper for <code class="literal">assert</code> conditions.
        </p></li><li class="listitem"><p>
          The <code class="literal">vpnc</code> package has been changed to use
          GnuTLS instead of OpenSSL by default for licensing reasons.
        </p></li><li class="listitem"><p>
          The default version of <code class="literal">nextcloud</code> is
          <span class="strong"><strong>nextcloud24</strong></span>. Please note
          that it’s <span class="strong"><strong>not</strong></span> possible to
          upgrade <code class="literal">nextcloud</code> across multiple major
          versions! This means it’s e.g. not possible to upgrade from
          <code class="literal">nextcloud22</code> to
          <code class="literal">nextcloud24</code> in a single deploy and most
          <code class="literal">21.11</code> users will have to upgrade to
          <code class="literal">nextcloud23</code> first.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.vimPlugins.onedark-nvim</code> now refers to
          <a class="link" href="https://github.com/navarasu/onedark.nvim" target="_top">navarasu/onedark.nvim</a>
          (formerly refers to
          <a class="link" href="https://github.com/olimorris/onedarkpro.nvim" target="_top">olimorris/onedarkpro.nvim</a>).
        </p></li><li class="listitem"><p>
          <code class="literal">services.pipewire.enable</code> will default to
          enabling the WirePlumber session manager instead of
          pipewire-media-session. pipewire-media-session is deprecated
          by upstream and not recommended, but can still be manually
          enabled by setting
          <code class="literal">services.pipewire.media-session.enable</code> to
          <code class="literal">true</code> and
          <code class="literal">services.pipewire.wireplumber.enable</code> to
          <code class="literal">false</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.makeDesktopItem</code> has been refactored to
          provide a more idiomatic API. Specifically:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              All valid options as of FDO Desktop Entry specification
              version 1.4 can now be passed in as explicit arguments
            </p></li><li class="listitem"><p>
              <code class="literal">exec</code> can now be null, for entries that
              are not of type Application
            </p></li><li class="listitem"><p>
              <code class="literal">mimeType</code> argument is renamed to
              <code class="literal">mimeTypes</code> for consistency
            </p></li><li class="listitem"><p>
              <code class="literal">mimeTypes</code>,
              <code class="literal">categories</code>,
              <code class="literal">implements</code>,
              <code class="literal">keywords</code>, <code class="literal">onlyShowIn</code>
              and <code class="literal">notShowIn</code> take lists of strings
              instead of one string with semicolon separators
            </p></li><li class="listitem"><p>
              <code class="literal">extraDesktopEntries</code> renamed to
              <code class="literal">extraConfig</code> for consistency
            </p></li><li class="listitem"><p>
              Actions should now be provided as an attrset
              <code class="literal">actions</code>, the <code class="literal">Actions</code>
              line will be autogenerated.
            </p></li><li class="listitem"><p>
              <code class="literal">extraEntries</code> is removed.
            </p></li><li class="listitem"><p>
              Additional validation is added both at eval time and at
              build time.
            </p></li></ul></div><p>
          See the <code class="literal">vscode</code> package for a more detailed
          example.
        </p></li><li class="listitem"><p>
          Existing <code class="literal">resholve*</code> functions have been
          renamed and nested under <code class="literal">pkgs.resholve</code>.
          Update uses to:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">resholvePackage</code> -&gt;
              <code class="literal">resholve.mkDerivation</code>
            </p></li><li class="listitem"><p>
              <code class="literal">resholveScript</code> -&gt;
              <code class="literal">resholve.writeScript</code>
            </p></li><li class="listitem"><p>
              <code class="literal">resholveScriptBin</code> -&gt;
              <code class="literal">resholve.writeScriptBin</code>
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">pkgs.cosmopolitan</code> no longer provides the
          <code class="literal">cosmoc</code> command. It has been moved to
          <code class="literal">pkgs.cosmoc</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.graalvmXX-ce</code> packages no longer
          provide support for Python/Ruby/WASM, instead focusing only in
          Java and Native Image Support. If you need to add support
          back, please see the
          <code class="literal">pkgs.graalvmCEPackages.mkGraal</code> function to
          create your own customized version of GraalVM with support for
          what you need.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-22.05-notable-changes"></a>B.1.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-services.redis.servers">services.redis.servers</a>
          was added to support per-application
          <code class="literal">redis-server</code> which is more secure since
          Redis databases are only mere key prefixes without any
          configuration or ACL of their own. Backward-compatibility is
          preserved by mapping old
          <code class="literal">services.redis.settings</code> to
          <code class="literal">services.redis.servers."".settings</code>,
          but you are strongly encouraged to name each
          <code class="literal">redis-server</code> instance after the application
          using it, instead of keeping that nameless one. Except for the
          nameless
          <code class="literal">services.redis.servers.""</code> still
          accessible at <code class="literal">127.0.0.1:6379</code>, and to the
          members of the Unix group <code class="literal">redis</code> through the
          Unix socket <code class="literal">/run/redis/redis.sock</code>, all
          other <code class="literal">services.redis.servers.${serverName}</code>
          are only accessible by default to the members of the Unix
          group <code class="literal">redis-${serverName}</code> through the Unix
          socket <code class="literal">/run/redis-${serverName}/redis.sock</code>.
        </p></li><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-virtualisation.vmVariant">virtualisation.vmVariant</a>
          was added to allow users to make changes to the
          <code class="literal">nixos-rebuild build-vm</code> configuration that
          do not apply to their normal system.
        </p><p>
          The <code class="literal">config.system.build.vm</code> attribute now
          always exists and defaults to the value from
          <code class="literal">vmVariant</code>. Configurations that import the
          <code class="literal">virtualisation/qemu-vm.nix</code> module
          themselves will override this value, such that
          <code class="literal">vmVariant</code> is not used.
        </p><p>
          Similarly
          <a class="link" href="options.html#opt-virtualisation.vmVariantWithBootLoader">virtualisation.vmVariantWithBootloader</a>
          was added.
        </p></li><li class="listitem"><p>
          The configuration portion of the <code class="literal">nix-daemon</code>
          module has been reworked and exposed as
          <a class="link" href="options.html#opt-nix-settings" target="_top">nix.settings</a>:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              Legacy options have been mapped to the corresponding
              options under under
              <a class="link" href="options.html#opt-nix.settings" target="_top">nix.settings</a>
              and will be deprecated when NixOS 21.11 reaches end of
              life.
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-nix.buildMachines.publicHostKey" target="_top">nix.buildMachines.publicHostKey</a>
              has been added.
            </p></li></ul></div></li><li class="listitem"><p>
          <a class="link" href="https://kops.sigs.k8s.io" target="_top"><code class="literal">kops</code></a>
          defaults to 1.23.2, which will enable
          <a class="link" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html" target="_top">Instance
          Metadata Service Version 2</a> and require tokens on new
          clusters with Kubernetes &gt;= 1.22. This will increase
          security by default, but may break some types of workloads.
          The default behaviour for
          <code class="literal">spec.kubeDNS.nodeLocalDNS.forwardToKubeDNS</code>
          has changed from <code class="literal">true</code> to
          <code class="literal">false</code>. Cilium now has
          <code class="literal">disable-cnp-status-updates: true</code> by
          default. Set this to false if you rely on the
          CiliumNetworkPolicy status fields. Support for Kubernetes
          1.17, the Lyft CNI, Weave CNI on Kubernetes &gt;= 1.23, CentOS
          7 and 8, Debian 9, RHEL 7, and Ubuntu 16.05 (Xenial) has been
          removed. See the
          <a class="link" href="https://kops.sigs.k8s.io/releases/1.22-notes/" target="_top">1.22
          release notes</a> and
          <a class="link" href="https://kops.sigs.k8s.io/releases/1.23-notes/" target="_top">1.23
          release notes</a> for more details, including other
          significant changes.
        </p></li><li class="listitem"><p>
          Mattermost has been upgraded to extended support version 6.3
          as the previously packaged extended support version 5.37 is
          <a class="link" href="https://docs.mattermost.com/upgrade/extended-support-release.html" target="_top">reaching
          end of life</a>. Migration may take some time, see the
          <a class="link" href="https://docs.mattermost.com/install/self-managed-changelog.html#release-v6-3-extended-support-release" target="_top">changelog</a>
          and
          <a class="link" href="https://docs.mattermost.com/upgrade/important-upgrade-notes.html" target="_top">important
          upgrade notes</a>.
        </p></li><li class="listitem"><p>
          The
          <code class="literal">writers.writePyPy2</code>/<code class="literal">writers.writePyPy3</code>
          and corresponding
          <code class="literal">writers.writePyPy2Bin</code>/<code class="literal">writers.writePyPy3Bin</code>
          convenience functions to create executable Python 2/3 scripts
          using the PyPy interpreter were added.
        </p></li><li class="listitem"><p>
          Some improvements have been made to the
          <code class="literal">hadoop</code> module:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              A <code class="literal">gatewayRole</code> option has been added,
              for deploying hadoop cluster configuration files to a node
              that does not have any active services
            </p></li><li class="listitem"><p>
              Support for older versions of hadoop have been added to
              the module
            </p></li><li class="listitem"><p>
              Overriding and extending site XML files has been made
              easier
            </p></li></ul></div></li><li class="listitem"><p>
          The auto-upgrade service now accepts persistent (default:
          true) parameter. By default auto-upgrade will now run
          immediately if it would have been triggered at least once
          during the time when the timer was inactive.
        </p></li><li class="listitem"><p>
          Mastodon now uses <code class="literal">services.redis.servers</code> to
          start a new redis server, instead of using a global redis
          server. This improves compatibility with other services that
          use redis.
        </p><p>
          Note that this will recreate the redis database, although
          according to the
          <a class="link" href="https://docs.joinmastodon.org/admin/backups/" target="_top">Mastodon
          docs</a>, this is almost harmless:
        </p><div class="blockquote"><blockquote class="blockquote"><p>
            Losing the Redis database is almost harmless: The only
            irrecoverable data will be the contents of the Sidekiq
            queues and scheduled retries of previously failed jobs. The
            home and list feeds are stored in Redis, but can be
            regenerated with tootctl.
          </p></blockquote></div><p>
          If you do want to save the redis database, you can use the
          following commands:
        </p><pre class="programlisting">
redis-cli save
cp /var/lib/redis/dump.rdb "/var/lib/redis-mastodon/dump.rdb"
</pre></li><li class="listitem"><p>
          Peertube now uses services.redis.servers to start a new redis
          server, instead of using a global redis server. This improves
          compatibility with other services that use redis.
        </p><p>
          Redis database is used for storage only cache and job queue.
          More information can be found here -
          <a class="link" href="https://docs.joinpeertube.org/contribute-architecture" target="_top">Peertube
          architecture</a>.
        </p><p>
          If you do want to save the redis database, you can use the
          following commands before upgrade OS:
        </p><pre class="programlisting">
redis-cli save
sudo mkdir /var/lib/redis-peertube
sudo cp /var/lib/redis/dump.rdb /var/lib/redis-peertube/dump.rdb
</pre></li><li class="listitem"><p>
          If you are using Wayland you can choose to use the Ozone
          Wayland support in Chrome and several Electron apps by setting
          the environment variable <code class="literal">NIXOS_OZONE_WL=1</code>
          (for example via
          <code class="literal">environment.sessionVariables.NIXOS_OZONE_WL = "1"</code>).
          This is not enabled by default because Ozone Wayland is still
          under heavy development and behavior is not always flawless.
          Furthermore, not all Electron apps use the latest Electron
          versions.
        </p></li><li class="listitem"><p>
          A new option group
          <code class="literal">systemd.network.wait-online</code> was added, with
          options to configure
          <code class="literal">systemd-networkd-wait-online.service</code>:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">anyInterface</code> allows specifying that the
              network should be considered online when <span class="emphasis"><em>at
              least one</em></span> interface is online (useful on
              laptops)
            </p></li><li class="listitem"><p>
              <code class="literal">timeout</code> defines how long to wait for
              the network to come online
            </p></li><li class="listitem"><p>
              <code class="literal">extraArgs</code> for everything else
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">influxdb2</code> package was split into
          <code class="literal">influxdb2-server</code> and
          <code class="literal">influxdb2-cli</code>, matching the split that took
          place upstream. A combined <code class="literal">influxdb2</code>
          package is still provided in this release for backwards
          compatibilty, but will be removed at a later date.
        </p></li><li class="listitem"><p>
          The <code class="literal">unifi</code> package was switched from
          <code class="literal">unifi6</code> to <code class="literal">unifi7</code>. Direct
          downgrades from Unifi 7 to Unifi 6 are not possible and
          require restoring from a backup made by Unifi 6.
        </p></li><li class="listitem"><p>
          <code class="literal">programs.zsh.autosuggestions.strategy</code> now
          takes a list of strings instead of a string.
        </p></li><li class="listitem"><p>
          The <code class="literal">asterisk</code> and
          <code class="literal">asterisk-stable</code> packages were switched from
          <code class="literal">asterisk_18</code> to the newly-packaged
          <code class="literal">asterisk_19</code>. Asterisk 13 and 17 have been
          removed as they have reached their end of life.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.unifi.openPorts</code> option default
          value of <code class="literal">true</code> is now deprecated and will be
          changed to <code class="literal">false</code> in 22.11. Configurations
          using this default will print a warning when rebuilt.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.unifi-video.openPorts</code> option
          default value of <code class="literal">true</code> is now deprecated and
          will be changed to <code class="literal">false</code> in 22.11.
          Configurations using this default will print a warning when
          rebuilt.
        </p></li><li class="listitem"><p>
          <code class="literal">security.acme</code> certificates will now
          correctly check for CA revokation before reaching their
          minimum age.
        </p></li><li class="listitem"><p>
          Removing domains from
          <code class="literal">security.acme.certs._name_.extraDomainNames</code>
          will now correctly remove those domains during rebuild/renew.
        </p></li><li class="listitem"><p>
          MariaDB is now offered in several versions, not just the
          newest one. So if you have a need for running MariaDB 10.4 for
          example, you can now just set
          <code class="literal">services.mysql.package = pkgs.mariadb_104;</code>.
          In general, it is recommended to run the newest version, to
          get the newest features, while sticking with an LTS version
          will most likely provide a more stable experience. Sometimes
          software is also incompatible with the newest version of
          MariaDB.
        </p></li><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-programs.ssh.enableAskPassword">programs.ssh.enableAskPassword</a>
          was added, decoupling the setting of
          <code class="literal">SSH_ASKPASS</code> from
          <code class="literal">services.xserver.enable</code>. This allows easy
          usage in non-X11 environments, e.g. Wayland.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-programs.ssh.knownHosts">programs.ssh.knownHosts</a>
          has gained an <code class="literal">extraHostNames</code> option to
          augment <code class="literal">hostNames</code>. It is now possible to
          use the attribute name of a <code class="literal">knownHosts</code>
          entry as the primary host name and specify secondary host
          names using <code class="literal">extraHostNames</code> without having
          to duplicate the primary host name.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.stubby</code> module was converted to
          a
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">settings-style</a>
          configuration.
        </p></li><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-services.xserver.desktopManager.runXdgAutostartIfNone">services.xserver.desktopManager.runXdgAutostartIfNone</a>
          was added in order to automatically run XDG autostart files
          for sessions without a desktop manager. This replaces helpers
          like the <code class="literal">dex</code> package.
        </p></li><li class="listitem"><p>
          When setting
          <a class="link" href="options.html#opt-i18n.inputMethod.enabled">i18n.inputMethod.enabled</a>
          to <code class="literal">fcitx5</code>, it no longer creates
          corresponding systemd user services. It now relies on XDG
          autostart files to start and work properly in your desktop
          sessions. If you are using only a window manager without a
          desktop manager, you need to enable
          <code class="literal">services.xserver.desktopManager.runXdgAutostartIfNone</code>
          or using the <code class="literal">dex</code> package to make
          <code class="literal">fcitx5</code> work.
        </p></li><li class="listitem"><p>
          The option <code class="literal">services.duplicati.dataDir</code> has
          been added to allow changing the location of duplicati’s
          files.
        </p></li><li class="listitem"><p>
          The options <code class="literal">boot.extraModprobeConfig</code> and
          <code class="literal">boot.blacklistedKernelModules</code> now also take
          effect in the initrd by copying the file
          <code class="literal">/etc/modprobe.d/nixos.conf</code> into the initrd.
        </p></li><li class="listitem"><p>
          <code class="literal">nixos-generate-config</code> now puts the dhcp
          configuration in <code class="literal">hardware-configuration.nix</code>
          instead of <code class="literal">configuration.nix</code>.
        </p></li><li class="listitem"><p>
          ORY Kratos was updated to version 0.9.0-alpha.3, which
          introduces some breaking changes:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              All endpoints at the Admin API are now exposed at
              <code class="literal">/admin/</code>. For example, endpoint
              <code class="literal">https://kratos:4434/identities</code> is now
              exposed at
              <code class="literal">https://kratos:4434/admin/identities</code>
            </p></li><li class="listitem"><p>
              Configuration key
              <code class="literal">selfservice.whitelisted_return_urls</code> has
              been renamed to <code class="literal">allowed_return_urls</code>
            </p></li><li class="listitem"><p>
              The <code class="literal">password_identifier</code> form field of
              the password login strategy has been renamed to
              <code class="literal">identifier</code> to make compatibility with
              passwordless flows possible.
            </p></li><li class="listitem"><p>
              Instead of having a global
              <code class="literal">default_schema_url</code> which developers
              used to update their schema, you now need to define the
              <code class="literal">default_schema_id</code> which must reference
              schema ID in your config.
            </p></li><li class="listitem"><p>
              Calling <code class="literal">/self-service/recovery</code> without
              flow ID or with an invalid flow ID while authenticated
              will now respond with an error instead of redirecting to
              the default page.
            </p></li><li class="listitem"><p>
              If you are relying on the SQLite images, update your
              Docker Pull commands as follows:
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  <code class="literal">docker pull oryd/kratos:{version}</code>
                </p></li></ul></div></li><li class="listitem"><p>
              Additionally, all passwords now have to be at least 8
              characters long.
            </p></li><li class="listitem"><p>
              For more details, see:
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.8.1-alpha.1" target="_top">Release
                  Notes for v0.8.1-alpha-1</a>
                </p></li><li class="listitem"><p>
                  <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.8.2-alpha.1" target="_top">Release
                  Notes for v0.8.2-alpha-1</a>
                </p></li><li class="listitem"><p>
                  <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.9.0-alpha.1" target="_top">Release
                  Notes for v0.9.0-alpha-1</a>
                </p></li><li class="listitem"><p>
                  <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.9.0-alpha.3" target="_top">Release
                  Notes for v0.9.0-alpha-3</a>
                </p></li></ul></div></li></ul></div></li><li class="listitem"><p>
          <code class="literal">fetchFromSourcehut</code> now allows fetching
          repositories recursively using <code class="literal">fetchgit</code> or
          <code class="literal">fetchhg</code> if the argument
          <code class="literal">fetchSubmodules</code> is set to
          <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          A module for declarative configuration of openconnect VPN
          profiles was added under
          <code class="literal">networking.openconnect</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">element-desktop</code> package now has an
          <code class="literal">useKeytar</code> option (defaults to
          <code class="literal">true</code>), which allows disabling
          <code class="literal">keytar</code> and in turn
          <code class="literal">libsecret</code> usage (which binds to native
          credential managers / keychain libraries).
        </p></li><li class="listitem"><p>
          The option <code class="literal">services.thelounge.plugins</code> has
          been added to allow installing plugins for The Lounge. Plugins
          can be found in
          <code class="literal">pkgs.theLoungePlugins.plugins</code> and
          <code class="literal">pkgs.theLoungePlugins.themes</code>.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.xserver.videoDriver = [ "nvidia" ];</code>
          will now also install
          <a class="link" href="https://github.com/elFarto/nvidia-vaapi-driver" target="_top">nvidia
          VA-API drivers</a> by default.
        </p></li><li class="listitem"><p>
          The <code class="literal">firmwareLinuxNonfree</code> package has been
          renamed to <code class="literal">linux-firmware</code>.
        </p></li><li class="listitem"><p>
          It is now possible to specify wordlists to include as handy to
          access environment variables using the
          <code class="literal">config.environment.wordlist</code> configuration
          options.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.mbpfan</code> module was converted to
          a
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">RFC
          0042</a> configuration.
        </p></li><li class="listitem"><p>
          The default value for
          <code class="literal">programs.spacefm.settings.graphical_su</code> got
          unset. It previously pointed to <code class="literal">gksu</code> which
          has been removed.
        </p></li><li class="listitem"><p>
          The <a class="link" href="https://dino.im" target="_top">Dino</a> XMPP client
          was updated to 0.3, adding support for audio and video calls.
        </p></li><li class="listitem"><p>
          <code class="literal">services.mattermost.plugins</code> has been added
          to allow the declarative installation of Mattermost plugins.
          Plugins are automatically repackaged using autoPatchelf.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-services.logrotate.enable">services.logrotate.enable</a>
          now defaults to true if any rotate path has been defined, and
          some paths have been added by default.
        </p></li><li class="listitem"><p>
          The logrotate module also has been updated to freeform syntax:
          <a class="link" href="options.html#opt-services.logrotate.paths">services.logrotate.paths</a>
          and
          <a class="link" href="options.html#opt-services.logrotate.extraConfig">services.logrotate.extraConfig</a>
          will work, but issue deprecation warnings and
          <a class="link" href="options.html#opt-services.logrotate.settings">services.logrotate.settings</a>
          should now be used instead.
        </p></li><li class="listitem"><p>
          <code class="literal">security.pam.ussh</code> has been added, which
          allows authorizing PAM sessions based on SSH
          <span class="emphasis"><em>certificates</em></span> held within an SSH agent,
          using
          <a class="link" href="https://github.com/uber/pam-ussh" target="_top">pam-ussh</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">vscode-extensions.ionide.ionide-fsharp</code>
          package has been updated to 6.0.0 and now requires .NET 6.0.
        </p></li><li class="listitem"><p>
          The <code class="literal">phpPackages.box</code> package has been
          updated from 2.7.5 to 3.16.0. See the
          <a class="link" href="https://github.com/box-project/box/blob/master/UPGRADE.md#from-27-to-30" target="_top">upgrade
          guide</a> for more details.
        </p></li><li class="listitem"><p>
          The <code class="literal">zrepl</code> package has been updated from
          0.4.0 to 0.5:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              The RPC protocol version was bumped; all zrepl daemons in
              a setup must be updated and restarted before replication
              can resume.
            </p></li><li class="listitem"><p>
              A bug involving encrypt-on-receive has been fixed. Read
              the
              <a class="link" href="https://zrepl.github.io/configuration/sendrecvoptions.html#job-recv-options-placeholder" target="_top">zrepl
              documentation</a> and check the output of
              <code class="literal">zfs get -r encryption,zrepl:placeholder PATH_TO_ROOTFS</code>
              on the receiver.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">polybar</code> package has been updated from
          3.5.7 to 3.6.2. See
          <a class="link" href="https://github.com/polybar/polybar/releases/tag/3.6.0" target="_top">the
          changelog</a> for more details.
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              Breaking changes include changes to escaping rules in
              configuration values, changes in behavior when
              encountering invalid tag names, and changes to
              inter-process-messaging (IPC).
            </p></li></ul></div></li><li class="listitem"><p>
          Renamed option
          <code class="literal">services.openssh.challengeResponseAuthentication</code>
          to
          <code class="literal">services.openssh.kbdInteractiveAuthentication</code>.
          Reason is that the old name has been deprecated upstream.
          Using the old option name will still work, but produce a
          warning.
        </p></li><li class="listitem"><p>
          <code class="literal">services.autorandr</code> now allows for adding
          hooks and profiles declaratively.
        </p></li><li class="listitem"><p>
          The <code class="literal">pomerium-cli</code> command has been moved out
          of the <code class="literal">pomerium</code> package into the
          <code class="literal">pomerium-cli</code> package, following upstream’s
          repository split. If you are using the
          <code class="literal">pomerium-cli</code> command, you should now
          install the <code class="literal">pomerium-cli</code> package.
        </p></li><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-networking.networkmanager.enableFccUnlock">services.networking.networkmanager.enableFccUnlock</a>
          was added to support FCC unlock procedures. Since release
          1.18.4, the ModemManager daemon no longer automatically
          performs the FCC unlock procedure by default. See
          <a class="link" href="https://modemmanager.org/docs/modemmanager/fcc-unlock/" target="_top">the
          docs</a> for more details.
        </p></li><li class="listitem"><p>
          <code class="literal">programs.tmux</code> has a new option
          <code class="literal">plugins</code> that accepts a list of packages
          from the <code class="literal">tmuxPlugins</code> group. The specified
          packages are added to the system and loaded by
          <code class="literal">tmux</code>.
        </p></li><li class="listitem"><p>
          The polkit service, available at
          <code class="literal">security.polkit.enable</code>, is now disabled by
          default. It will automatically be enabled through services and
          desktop environments as needed.
        </p></li><li class="listitem"><p>
          <code class="literal">mercury</code> was updated to 22.01.1, which has
          some breaking changes
          (<a class="link" href="https://dl.mercurylang.org/release/release-notes-22.01.html" target="_top">Mercury
          22.01 news</a>).
        </p></li><li class="listitem"><p>
          xfsprogs was update to version 5.15, which enables inobtcount
          and bigtime by default on filesystem creation. Support for
          these features was added in kernel 5.10 and deemed stable in
          kernel 5.15. If you want to be able to mount XFS filesystems
          created with this release of xfsprogs on kernel releases older
          than 5.10, you need to format them with
          <code class="literal">mkfs.xfs -m bigtime=0 -m inobtcount=0</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.xserver.desktopManager.xfce</code> now
          includes Xfce’s screen locker,
          <code class="literal">xfce4-screensaver</code> that is enabled by
          default. You can disable it by setting
          <code class="literal">false</code> to
          <a class="link" href="options.html#opt-services.xserver.desktopManager.xfce.enableScreensaver">services.xserver.desktopManager.xfce.enableScreensaver</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">hadoop</code> package has added support for
          <code class="literal">aarch64-linux</code> and
          <code class="literal">aarch64-darwin</code> as of 3.3.1
          (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/158613" target="_top">#158613</a>).
        </p></li><li class="listitem"><p>
          The <code class="literal">R</code> package now builds again on
          <code class="literal">aarch64-darwin</code>
          (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/158992" target="_top">#158992</a>).
        </p></li><li class="listitem"><p>
          The <code class="literal">nss</code> package was split into
          <code class="literal">nss_esr</code> and <code class="literal">nss_latest</code>,
          with <code class="literal">nss</code> being an alias for
          <code class="literal">nss_esr</code>. This was done to ease maintenance
          of <code class="literal">nss</code> and dependent high-profile packages
          like <code class="literal">firefox</code>.
        </p></li><li class="listitem"><p>
          The default <code class="literal">scribus</code> version is now 1.5,
          while version 1.4 is still available as
          <code class="literal">scribus_1_4</code>
          (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/172700" target="_top">#172700</a>).
        </p></li><li class="listitem"><p>
          The Nextcloud module now supports to create a Mysql database
          automatically with
          <code class="literal">services.nextcloud.database.createLocally</code>
          enabled.
        </p></li><li class="listitem"><p>
          Matrix Synapse now requires entries in the
          <code class="literal">state_group_edges</code> table to be unique, in
          order to prevent accidentally introducing duplicate
          information (for example, because a database backup was
          restored multiple times). If your Synapse database already has
          duplicate rows in this table, this could fail with an error
          and require manual remediation.
        </p></li><li class="listitem"><p>
          The Nextcloud module now allows setting the value of the
          <code class="literal">max-age</code> directive of the
          <code class="literal">Strict-Transport-Security</code> HTTP header,
          which is now controlled by the
          <code class="literal">services.nextcloud.https</code> option, rather
          than <code class="literal">services.nginx.recommendedHttpHeaders</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">spark3</code> package has been updated from
          3.1.2 to 3.2.1
          (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/160075" target="_top">#160075</a>):
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              Testing has been enabled for
              <code class="literal">aarch64-linux</code> in addition to
              <code class="literal">x86_64-linux</code>.
            </p></li><li class="listitem"><p>
              The <code class="literal">spark3</code> package is now usable on
              <code class="literal">aarch64-darwin</code> as a result of
              <a class="link" href="https://github.com/NixOS/nixpkgs/pull/158613" target="_top">#158613</a>
              and
              <a class="link" href="https://github.com/NixOS/nixpkgs/pull/158992" target="_top">#158992</a>.
            </p></li></ul></div></li><li class="listitem"><p>
          The option <code class="literal">services.snapserver.openFirewall</code>
          will no longer default to <code class="literal">true</code> starting
          with NixOS 22.11. Enable it explicitly if you need to control
          Snapserver remotely or connect streamig clients from other
          hosts.
        </p></li><li class="listitem"><p>
          The option
          <a class="link" href="options.html#opt-networking.useDHCP" target="_top">networking.useDHCP</a>
          isn’t deprecated anymore. When using
          <a class="link" href="options.html#opt-networking.useNetworkd" target="_top"><code class="literal">systemd-networkd</code></a>,
          a generic <code class="literal">.network</code>-unit is added which
          enables DHCP for each interface matching
          <code class="literal">en*</code>, <code class="literal">eth*</code> or
          <code class="literal">wl*</code> with priority 99 (which means that it
          doesn’t have any effect if such an interface is matched by a
          <code class="literal">.network-</code>unit with a lower priority). In
          case of scripted networking, no behavior was changed.
        </p></li><li class="listitem"><p>
          The new
          <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook" target="_top"><code class="literal">postgresqlTestHook</code></a>
          runs a PostgreSQL server for the duration of package checks.
        </p></li><li class="listitem"><p>
          <code class="literal">zfs</code> was updated from 2.1.4 to 2.1.5,
          enabling it to be used with Linux kernel 5.18.
        </p></li><li class="listitem"><p>
          <code class="literal">stdenv.mkDerivation</code> now supports a
          self-referencing <code class="literal">finalAttrs:</code> parameter
          containing the final <code class="literal">mkDerivation</code> arguments
          including overrides. <code class="literal">drv.overrideAttrs</code> now
          supports two parameters
          <code class="literal">finalAttrs: previousAttrs:</code>. This allows
          packaging configuration to be overridden in a consistent
          manner by providing an alternative to
          <code class="literal">rec {}</code> syntax.
        </p><p>
          Additionally, <code class="literal">passthru</code> can now reference
          <code class="literal">finalAttrs.finalPackage</code> containing the
          final package, including attributes such as the output paths
          and <code class="literal">overrideAttrs</code>.
        </p><p>
          New language integrations can be simplified by overriding a
          <span class="quote">“<span class="quote">prototype</span>”</span> package containing the
          language-specific logic. This removes the need for a extra
          layer of overriding for the <span class="quote">“<span class="quote">generic builder</span>”</span>
          arguments, thus removing a usability problem and source of
          error.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-21.11"></a>B.2. Release 21.11 (“Porcupine”, 2021/11/30)</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        Support is planned until the end of June 2022, handing over to
        22.05.
      </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.11-highlights"></a>B.2.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Nix has been updated to version 2.4, reference its
          <a class="link" href="https://discourse.nixos.org/t/nix-2-4-released/15822" target="_top">release
          notes</a> for more information on what has changed. The
          previous version of Nix, 2.3.16, remains available for the
          time being in the <code class="literal">nix_2_3</code> package.
        </p></li><li class="listitem"><p>
          <code class="literal">iptables</code> is now using
          <code class="literal">nf_tables</code> under the hood, by using
          <code class="literal">iptables-nft</code>, similar to
          <a class="link" href="https://wiki.debian.org/nftables#Current_status" target="_top">Debian</a>
          and
          <a class="link" href="https://fedoraproject.org/wiki/Changes/iptables-nft-default" target="_top">Fedora</a>.
          This means, <code class="literal">ip[6]tables</code>,
          <code class="literal">arptables</code> and <code class="literal">ebtables</code>
          commands will actually show rules from some specific tables in
          the <code class="literal">nf_tables</code> kernel subsystem. In case
          you’re migrating from an older release without rebooting,
          there might be cases where you end up with iptable rules
          configured both in the legacy <code class="literal">iptables</code>
          kernel backend, as well as in the <code class="literal">nf_tables</code>
          backend. This can lead to confusing firewall behaviour. An
          <code class="literal">iptables-save</code> after switching will complain
          about <span class="quote">“<span class="quote">iptables-legacy tables present</span>”</span>. It’s
          probably best to reboot after the upgrade, or manually
          removing all legacy iptables rules (via the
          <code class="literal">iptables-legacy</code> package).
        </p></li><li class="listitem"><p>
          systemd got an <code class="literal">nftables</code> backend, and
          configures (networkd) rules in their own
          <code class="literal">io.systemd.*</code> tables. Check
          <code class="literal">nft list ruleset</code> to see these rules, not
          <code class="literal">iptables-save</code> (which only shows
          <code class="literal">iptables</code>-created rules.
        </p></li><li class="listitem"><p>
          PHP now defaults to PHP 8.0, updated from 7.4.
        </p></li><li class="listitem"><p>
          kops now defaults to 1.21.1, which uses containerd as the
          default runtime.
        </p></li><li class="listitem"><p>
          <code class="literal">python3</code> now defaults to Python 3.9, updated
          from Python 3.8.
        </p></li><li class="listitem"><p>
          PostgreSQL now defaults to major version 13.
        </p></li><li class="listitem"><p>
          spark now defaults to spark 3, updated from 2. A
          <a class="link" href="https://spark.apache.org/docs/latest/core-migration-guide.html#upgrading-from-core-24-to-30" target="_top">migration
          guide</a> is available.
        </p></li><li class="listitem"><p>
          Improvements have been made to the Hadoop module and package:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              HDFS and YARN now support production-ready highly
              available deployments with automatic failover.
            </p></li><li class="listitem"><p>
              Hadoop now defaults to Hadoop 3, updated from 2.
            </p></li><li class="listitem"><p>
              JournalNode, ZKFS and HTTPFS services have been added.
            </p></li></ul></div></li><li class="listitem"><p>
          Activation scripts can now, optionally, be run during a
          <code class="literal">nixos-rebuild dry-activate</code> and can detect
          the dry activation by reading
          <code class="literal">$NIXOS_ACTION</code>. This allows activation
          scripts to output what they would change if the activation was
          really run. The users/modules activation script supports this
          and outputs some of is actions.
        </p></li><li class="listitem"><p>
          KDE Plasma now finally works on Wayland.
        </p></li><li class="listitem"><p>
          bash now defaults to major version 5.
        </p></li><li class="listitem"><p>
          Systemd was updated to version 249 (from 247).
        </p></li><li class="listitem"><p>
          Pantheon desktop has been updated to version 6. Due to changes
          of screen locker, if locking doesn’t work for you, please try
          <code class="literal">gsettings set org.gnome.desktop.lockdown disable-lock-screen false</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">kubernetes-helm</code> now defaults to 3.7.0,
          which introduced some breaking changes to the experimental OCI
          manifest format. See
          <a class="link" href="https://github.com/helm/community/blob/main/hips/hip-0006.md" target="_top">HIP
          6</a> for more details. <code class="literal">helmfile</code> also
          defaults to 0.141.0, which is the minimum compatible version.
        </p></li><li class="listitem"><p>
          GNOME has been upgraded to 41. Please take a look at their
          <a class="link" href="https://help.gnome.org/misc/release-notes/41.0/" target="_top">Release
          Notes</a> for details.
        </p></li><li class="listitem"><p>
          LXD support was greatly improved:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              building LXD images from configurations is now directly
              possible with just nixpkgs
            </p></li><li class="listitem"><p>
              hydra is now building nixOS LXD images that can be used
              standalone with full nixos-rebuild support
            </p></li></ul></div></li><li class="listitem"><p>
          OpenSSH was updated to version 8.8p1
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              This breaks connections to old SSH daemons as ssh-rsa host
              keys and ssh-rsa public keys that were signed with SHA-1
              are disabled by default now
            </p></li><li class="listitem"><p>
              These can be re-enabled, see the
              <a class="link" href="https://www.openssh.com/txt/release-8.8" target="_top">OpenSSH
              changelog</a> for details
            </p></li></ul></div></li><li class="listitem"><p>
          ORY Kratos was updated to version 0.8.0-alpha.3
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              This release requires you to run SQL migrations. Please,
              as always, create a backup of your database first!
            </p></li><li class="listitem"><p>
              The SDKs are now generated with tag v0alpha2 to reflect
              that some signatures have changed in a breaking fashion.
              Please update your imports from v0alpha1 to v0alpha2.
            </p></li><li class="listitem"><p>
              The SMTPS scheme used in courier config URL with
              cleartext/StartTLS/TLS SMTP connection types is now only
              supporting implicit TLS. For StartTLS and cleartext SMTP,
              please use the SMTP scheme instead.
            </p></li><li class="listitem"><p>
              for more details, see
              <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.8.0-alpha.1" target="_top">Release
              Notes</a>.
            </p></li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.11-new-services"></a>B.2.2. New Services</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="https://digint.ch/btrbk/index.html" target="_top">btrbk</a>,
          a backup tool for btrfs subvolumes, taking advantage of btrfs
          specific capabilities to create atomic snapshots and transfer
          them incrementally to your backup locations. Available as
          <a class="link" href="options.html#opt-services.brtbk.instances" target="_top">services.btrbk</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/xrelkd/clipcat/" target="_top">clipcat</a>,
          an X11 clipboard manager written in Rust. Available at
          <a class="link" href="options.html#opt-services.clipcat.enable" target="_top">services.clipcat</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/dexidp/dex" target="_top">dex</a>,
          an OpenID Connect (OIDC) identity and OAuth 2.0 provider.
          Available at
          <a class="link" href="options.html#opt-services.dex.enable" target="_top">services.dex</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/maxmind/geoipupdate" target="_top">geoipupdate</a>,
          a GeoIP database updater from MaxMind. Available as
          <a class="link" href="options.html#opt-services.geoipupdate.enable" target="_top">services.geoipupdate</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/jitsi/jibri" target="_top">Jibri</a>,
          a service for recording or streaming a Jitsi Meet conference.
          Available as
          <a class="link" href="options.html#opt-services.jibri.enable" target="_top">services.jibri</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.isc.org/kea/" target="_top">Kea</a>, ISCs
          2nd generation DHCP and DDNS server suite. Available at
          <a class="link" href="options.html#opt-services.kea.dhcp4" target="_top">services.kea</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://owncast.online/" target="_top">owncast</a>,
          self-hosted video live streaming solution. Available at
          <a class="link" href="options.html#opt-services.owncast.enable" target="_top">services.owncast</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://joinpeertube.org/" target="_top">PeerTube</a>,
          developed by Framasoft, is the free and decentralized
          alternative to video platforms. Available at
          <a class="link" href="options.html#opt-services.peertube.enable" target="_top">services.peertube</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://sr.ht" target="_top">sourcehut</a>, a
          collection of tools useful for software development. Available
          as
          <a class="link" href="options.html#opt-services.sourcehut.enable" target="_top">services.sourcehut</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://download.pureftpd.org/pub/ucarp/README" target="_top">ucarp</a>,
          an userspace implementation of the Common Address Redundancy
          Protocol (CARP). Available as
          <a class="link" href="options.html#opt-networking.ucarp.enable" target="_top">networking.ucarp</a>.
        </p></li><li class="listitem"><p>
          Users of flashrom should migrate to
          <a class="link" href="options.html#opt-programs.flashrom.enable" target="_top">programs.flashrom.enable</a>
          and add themselves to the <code class="literal">flashrom</code> group to
          be able to access programmers supported by flashrom.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://vikunja.io" target="_top">vikunja</a>, a to-do
          list app. Available as
          <a class="link" href="options.html#opt-services.vikunja.enable">services.vikunja</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/evilsocket/opensnitch" target="_top">opensnitch</a>,
          an application firewall. Available as
          <a class="link" href="options.html#opt-services.opensnitch.enable">services.opensnitch</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.snapraid.it/" target="_top">snapraid</a>, a
          backup program for disk arrays. Available as
          <a class="link" href="options.html#opt-snapraid.enable">snapraid</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/hockeypuck/hockeypuck" target="_top">Hockeypuck</a>,
          a OpenPGP Key Server. Available as
          <a class="link" href="options.html#opt-services.hockeypuck.enable">services.hockeypuck</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/buildkite/buildkite-agent-metrics" target="_top">buildkite-agent-metrics</a>,
          a command-line tool for collecting Buildkite agent metrics,
          now has a Prometheus exporter available as
          <a class="link" href="options.html#opt-services.prometheus.exporters.buildkite-agent.enable">services.prometheus.exporters.buildkite-agent</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/prometheus/influxdb_exporter" target="_top">influxdb-exporter</a>
          a Prometheus exporter that exports metrics received on an
          InfluxDB compatible endpoint is now available as
          <a class="link" href="options.html#opt-services.prometheus.exporters.influxdb.enable">services.prometheus.exporters.influxdb</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/matrix-discord/mx-puppet-discord" target="_top">mx-puppet-discord</a>,
          a discord puppeting bridge for matrix. Available as
          <a class="link" href="options.html#opt-services.mx-puppet-discord.enable">services.mx-puppet-discord</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.meshcommander.com/meshcentral2/overview" target="_top">MeshCentral</a>,
          a remote administration service (<span class="quote">“<span class="quote">TeamViewer but
          self-hosted and with more features</span>”</span>) is now available
          with a package and a module:
          <a class="link" href="options.html#opt-services.meshcentral.enable">services.meshcentral.enable</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/Arksine/moonraker" target="_top">moonraker</a>,
          an API web server for Klipper. Available as
          <a class="link" href="options.html#opt-services.moonraker.enable">moonraker</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/influxdata/influxdb" target="_top">influxdb2</a>,
          a Scalable datastore for metrics, events, and real-time
          analytics. Available as
          <a class="link" href="options.html#opt-services.influxdb2.enable">services.influxdb2</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://posativ.org/isso/" target="_top">isso</a>, a
          commenting server similar to Disqus. Available as
          <a class="link" href="options.html#opt-services.isso.enable">isso</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.navidrome.org/" target="_top">navidrome</a>,
          a personal music streaming server with subsonic-compatible
          api. Available as
          <a class="link" href="options.html#opt-services.navidrome.enable">navidrome</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://docs.fluidd.xyz/" target="_top">fluidd</a>, a
          Klipper web interface for managing 3d printers using
          moonraker. Available as
          <a class="link" href="options.html#opt-services.fluidd.enable">fluidd</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/earnestly/sx" target="_top">sx</a>,
          a simple alternative to both xinit and startx for starting a
          Xorg server. Available as
          <a class="link" href="options.html#opt-services.xserver.displayManager.sx.enable">services.xserver.displayManager.sx</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="https://postfixadmin.sourceforge.io/" target="_top">postfixadmin</a>,
          a web based virtual user administration interface for Postfix
          mail servers. Available as
          <a class="link" href="options.html#opt-services.postfixadmin.enable">postfixadmin</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://wiki.servarr.com/prowlarr" target="_top">prowlarr</a>,
          an indexer manager/proxy built on the popular arr .net/reactjs
          base stack
          <a class="link" href="options.html#opt-services.prowlarr.enable">services.prowlarr</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://sr.ht/~emersion/soju" target="_top">soju</a>, a
          user-friendly IRC bouncer. Available as
          <a class="link" href="options.html#opt-services.soju.enable" target="_top">services.soju</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://nats.io/" target="_top">nats</a>, a high
          performance cloud and edge messaging system. Available as
          <a class="link" href="options.html#opt-services.nats.enable">services.nats</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://git-scm.com" target="_top">git</a>, a
          distributed version control system. Available as
          <a class="link" href="options.html#opt-programs.git.enable" target="_top">programs.git</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://domainaware.github.io/parsedmarc/" target="_top">parsedmarc</a>,
          a service which parses incoming
          <a class="link" href="https://dmarc.org/" target="_top">DMARC</a> reports and
          stores or sends them to a downstream service for further
          analysis. Documented in
          <a class="link" href="index.html#module-services-parsedmarc" title="Chapter 35. parsedmarc">its manual
          entry</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://spark.apache.org/" target="_top">spark</a>, a
          unified analytics engine for large-scale data processing.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/JoseExposito/touchegg" target="_top">touchegg</a>,
          a multi-touch gesture recognizer. Available as
          <a class="link" href="options.html#opt-services.touchegg.enable">services.touchegg</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/pantheon-tweaks/pantheon-tweaks" target="_top">pantheon-tweaks</a>,
          an unofficial system settings panel for Pantheon. Available as
          <a class="link" href="options.html#opt-programs.pantheon-tweaks.enable">programs.pantheon-tweaks</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/DanielOgorchock/joycond" target="_top">joycond</a>,
          a service that uses <code class="literal">hid-nintendo</code> to provide
          nintendo joycond pairing and better nintendo switch pro
          controller support.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/opensvc/multipath-tools" target="_top">multipath</a>,
          the device mapper multipath (DM-MP) daemon. Available as
          <a class="link" href="options.html#opt-services.multipath.enable">services.multipath</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.seafile.com/en/home/" target="_top">seafile</a>,
          an open source file syncing &amp; sharing software. Available
          as
          <a class="link" href="options.html#opt-services.seafile.enable" target="_top">services.seafile</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/mchehab/rasdaemon" target="_top">rasdaemon</a>,
          a hardware error logging daemon. Available as
          <a class="link" href="options.html#opt-hardware.rasdaemon.enable">hardware.rasdaemon</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">code-server</code>-module now available
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/xmrig/xmrig" target="_top">xmrig</a>,
          a high performance, open source, cross platform RandomX,
          KawPow, CryptoNight and AstroBWT unified CPU/GPU miner and
          RandomX benchmark.
        </p></li><li class="listitem"><p>
          Auto nice daemons
          <a class="link" href="https://github.com/Nefelim4ag/Ananicy" target="_top">ananicy</a>
          and
          <a class="link" href="https://gitlab.com/ananicy-cpp/ananicy-cpp/" target="_top">ananicy-cpp</a>.
          Available as
          <a class="link" href="options.html#opt-services.ananicy.enable">services.ananicy</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://github.com/prometheus-community/smartctl_exporter" target="_top">smartctl_exporter</a>,
          a Prometheus exporter for
          <a class="link" href="https://en.wikipedia.org/wiki/S.M.A.R.T." target="_top">S.M.A.R.T.</a>
          data. Available as
          <a class="link" href="options.html#opt-services.prometheus.exporters.smartctl.enable" target="_top">services.prometheus.exporters.smartctl</a>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.11-incompatibilities"></a>B.2.3. Backward Incompatibilities</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The NixOS VM test framework,
          <code class="literal">pkgs.nixosTest</code>/<code class="literal">make-test-python.nix</code>
          (<code class="literal">pkgs.testers.nixosTest</code> since 22.05), now
          requires detaching commands such as
          <code class="literal">succeed("foo &amp;")</code> and
          <code class="literal">succeed("foo | xclip -i")</code> to
          close stdout. This can be done with a redirect such as
          <code class="literal">succeed("foo &gt;&amp;2 &amp;")</code>.
          This breaking change was necessitated by a race condition
          causing tests to fail or hang. It applies to all methods that
          invoke commands on the nodes, including
          <code class="literal">execute</code>, <code class="literal">succeed</code>,
          <code class="literal">fail</code>,
          <code class="literal">wait_until_succeeds</code>,
          <code class="literal">wait_until_fails</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.wakeonlan</code> option was removed,
          and replaced with
          <code class="literal">networking.interfaces.&lt;name&gt;.wakeOnLan</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">security.wrappers</code> option now requires
          to always specify an owner, group and whether the
          setuid/setgid bit should be set. This is motivated by the fact
          that before NixOS 21.11, specifying either setuid or setgid
          but not owner/group resulted in wrappers owned by
          nobody/nogroup, which is unsafe.
        </p></li><li class="listitem"><p>
          Since <code class="literal">iptables</code> now uses
          <code class="literal">nf_tables</code> backend and
          <code class="literal">ipset</code> doesn’t support it, some applications
          (ferm, shorewall, firehol) may have limited functionality.
        </p></li><li class="listitem"><p>
          The <code class="literal">paperless</code> module and package have been
          removed. All users should migrate to the successor
          <code class="literal">paperless-ng</code> instead. The Paperless project
          <a class="link" href="https://github.com/the-paperless-project/paperless/commit/9b0063c9731f7c5f65b1852cb8caff97f5e40ba4" target="_top">has
          been archived</a> and advises all users to use
          <code class="literal">paperless-ng</code> instead.
        </p><p>
          Users can use the <code class="literal">services.paperless-ng</code>
          module as a replacement while noting the following
          incompatibilities:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.paperless.ocrLanguages</code> has no
              replacement. Users should migrate to
              <a class="link" href="options.html#opt-services.paperless-ng.extraConfig" target="_top"><code class="literal">services.paperless-ng.extraConfig</code></a>
              instead:
            </p></li></ul></div><pre class="programlisting">
{
  services.paperless-ng.extraConfig = {
    # Provide languages as ISO 639-2 codes
    # separated by a plus (+) sign.
    # https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes
    PAPERLESS_OCR_LANGUAGE = "deu+eng+jpn"; # German &amp; English &amp; Japanse
  };
}
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If you previously specified
              <code class="literal">PAPERLESS_CONSUME_MAIL_*</code> settings in
              <code class="literal">services.paperless.extraConfig</code> you
              should remove those options now. You now
              <span class="emphasis"><em>must</em></span> define those settings in the
              admin interface of paperless-ng.
            </p></li><li class="listitem"><p>
              Option <code class="literal">services.paperless.manage</code> no
              longer exists. Use the script at
              <code class="literal">${services.paperless-ng.dataDir}/paperless-ng-manage</code>
              instead. Note that this script only exists after the
              <code class="literal">paperless-ng</code> service has been started
              at least once.
            </p></li><li class="listitem"><p>
              After switching to the new system configuration you should
              run the Django management command to reindex your
              documents and optionally create a user, if you don’t have
              one already.
            </p><p>
              To do so, enter the data directory (the value of
              <code class="literal">services.paperless-ng.dataDir</code>,
              <code class="literal">/var/lib/paperless</code> by default), switch
              to the paperless user and execute the management command
              like below:
            </p><pre class="programlisting">
$ cd /var/lib/paperless
$ su paperless -s /bin/sh
$ ./paperless-ng-manage document_index reindex
# if not already done create a user account, paperless-ng requires a login
$ ./paperless-ng-manage createsuperuser
Username (leave blank to use 'paperless'): my-user-name
Email address: me@example.com
Password: **********
Password (again): **********
Superuser created successfully.
</pre></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">staticjinja</code> package has been upgraded
          from 1.0.4 to 4.1.1
        </p></li><li class="listitem"><p>
          Firefox v91 does not support addons with invalid signature
          anymore. Firefox ESR needs to be used for nix addon support.
        </p></li><li class="listitem"><p>
          The <code class="literal">erigon</code> ethereum node has moved to a new
          database format in <code class="literal">2021-05-04</code>, and requires
          a full resync
        </p></li><li class="listitem"><p>
          The <code class="literal">erigon</code> ethereum node has moved it’s
          database location in <code class="literal">2021-08-03</code>, users
          upgrading must manually move their chaindata (see
          <a class="link" href="https://github.com/ledgerwatch/erigon/releases/tag/v2021.08.03" target="_top">release
          notes</a>).
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-users.users._name_.group" target="_top">users.users.&lt;name&gt;.group</a>
          no longer defaults to <code class="literal">nogroup</code>, which was
          insecure. Out-of-tree modules are likely to require
          adaptation: instead of
        </p><pre class="programlisting">
{
  users.users.foo = {
    isSystemUser = true;
  };
}
</pre><p>
          also create a group for your user:
        </p><pre class="programlisting">
{
  users.users.foo = {
    isSystemUser = true;
    group = "foo";
  };
  users.groups.foo = {};
}
</pre></li><li class="listitem"><p>
          <code class="literal">services.geoip-updater</code> was broken and has
          been replaced by
          <a class="link" href="options.html#opt-services.geoipupdate.enable" target="_top">services.geoipupdate</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">ihatemoney</code> has been updated to version
          5.1.1
          (<a class="link" href="https://github.com/spiral-project/ihatemoney/blob/5.1.1/CHANGELOG.rst" target="_top">release
          notes</a>). If you serve ihatemoney by HTTP rather than
          HTTPS, you must set
          <a class="link" href="options.html#opt-services.ihatemoney.secureCookie" target="_top">services.ihatemoney.secureCookie</a>
          to <code class="literal">false</code>.
        </p></li><li class="listitem"><p>
          PHP 7.3 is no longer supported due to upstream not supporting
          this version for the entire lifecycle of the 21.11 release.
        </p></li><li class="listitem"><p>
          Those making use of <code class="literal">buildBazelPackage</code> will
          need to regenerate the fetch hashes (preferred), or set
          <code class="literal">fetchConfigured = false;</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">consul</code> was upgraded to a new major release
          with breaking changes, see
          <a class="link" href="https://github.com/hashicorp/consul/releases/tag/v1.10.0" target="_top">upstream
          changelog</a>.
        </p></li><li class="listitem"><p>
          fsharp41 has been removed in preference to use the latest
          dotnet-sdk
        </p></li><li class="listitem"><p>
          The following F#-related packages have been removed for being
          unmaintaned. Please use <code class="literal">fetchNuGet</code> for
          specific packages.
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              ExtCore
            </p></li><li class="listitem"><p>
              Fake
            </p></li><li class="listitem"><p>
              Fantomas
            </p></li><li class="listitem"><p>
              FsCheck
            </p></li><li class="listitem"><p>
              FsCheck262
            </p></li><li class="listitem"><p>
              FsCheckNunit
            </p></li><li class="listitem"><p>
              FSharpAutoComplete
            </p></li><li class="listitem"><p>
              FSharpCompilerCodeDom
            </p></li><li class="listitem"><p>
              FSharpCompilerService
            </p></li><li class="listitem"><p>
              FSharpCompilerTools
            </p></li><li class="listitem"><p>
              FSharpCore302
            </p></li><li class="listitem"><p>
              FSharpCore3125
            </p></li><li class="listitem"><p>
              FSharpCore4001
            </p></li><li class="listitem"><p>
              FSharpCore4117
            </p></li><li class="listitem"><p>
              FSharpData
            </p></li><li class="listitem"><p>
              FSharpData225
            </p></li><li class="listitem"><p>
              FSharpDataSQLProvider
            </p></li><li class="listitem"><p>
              FSharpFormatting
            </p></li><li class="listitem"><p>
              FsLexYacc
            </p></li><li class="listitem"><p>
              FsLexYacc706
            </p></li><li class="listitem"><p>
              FsLexYaccRuntime
            </p></li><li class="listitem"><p>
              FsPickler
            </p></li><li class="listitem"><p>
              FsUnit
            </p></li><li class="listitem"><p>
              Projekt
            </p></li><li class="listitem"><p>
              Suave
            </p></li><li class="listitem"><p>
              UnionArgParser
            </p></li><li class="listitem"><p>
              ExcelDnaRegistration
            </p></li><li class="listitem"><p>
              MathNetNumerics
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">programs.x2goserver</code> is now
          <code class="literal">services.x2goserver</code>
        </p></li><li class="listitem"><p>
          The following dotnet-related packages have been removed for
          being unmaintaned. Please use <code class="literal">fetchNuGet</code>
          for specific packages.
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              Autofac
            </p></li><li class="listitem"><p>
              SystemValueTuple
            </p></li><li class="listitem"><p>
              MicrosoftDiaSymReader
            </p></li><li class="listitem"><p>
              MicrosoftDiaSymReaderPortablePdb
            </p></li><li class="listitem"><p>
              SystemCollectionsImmutable
            </p></li><li class="listitem"><p>
              SystemCollectionsImmutable131
            </p></li><li class="listitem"><p>
              SystemReflectionMetadata
            </p></li><li class="listitem"><p>
              NUnit350
            </p></li><li class="listitem"><p>
              Deedle
            </p></li><li class="listitem"><p>
              ExcelDna
            </p></li><li class="listitem"><p>
              GitVersionTree
            </p></li><li class="listitem"><p>
              NDeskOptions
            </p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">antlr</code> package now defaults to the 4.x
          release instead of the old 2.7.7 version.
        </p></li><li class="listitem"><p>
          The <code class="literal">pulseeffects</code> package updated to
          <a class="link" href="https://github.com/wwmm/easyeffects/releases/tag/v6.0.0" target="_top">version
          4.x</a> and renamed to <code class="literal">easyeffects</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">libwnck</code> package now defaults to the 3.x
          release instead of the old 2.31.0 version.
        </p></li><li class="listitem"><p>
          The <code class="literal">bitwarden_rs</code> packages and modules were
          renamed to <code class="literal">vaultwarden</code>
          <a class="link" href="https://github.com/dani-garcia/vaultwarden/discussions/1642" target="_top">following
          upstream</a>. More specifically,
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">pkgs.bitwarden_rs</code>,
              <code class="literal">pkgs.bitwarden_rs-sqlite</code>,
              <code class="literal">pkgs.bitwarden_rs-mysql</code> and
              <code class="literal">pkgs.bitwarden_rs-postgresql</code> were
              renamed to <code class="literal">pkgs.vaultwarden</code>,
              <code class="literal">pkgs.vaultwarden-sqlite</code>,
              <code class="literal">pkgs.vaultwarden-mysql</code> and
              <code class="literal">pkgs.vaultwarden-postgresql</code>,
              respectively.
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  Old names are preserved as aliases for backwards
                  compatibility, but may be removed in the future.
                </p></li><li class="listitem"><p>
                  The <code class="literal">bitwarden_rs</code> executable was
                  also renamed to <code class="literal">vaultwarden</code> in all
                  packages.
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">pkgs.bitwarden_rs-vault</code> was renamed to
              <code class="literal">pkgs.vaultwarden-vault</code>.
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  <code class="literal">pkgs.bitwarden_rs-vault</code> is
                  preserved as an alias for backwards compatibility, but
                  may be removed in the future.
                </p></li><li class="listitem"><p>
                  The static files were moved from
                  <code class="literal">/usr/share/bitwarden_rs</code> to
                  <code class="literal">/usr/share/vaultwarden</code>.
                </p></li></ul></div></li><li class="listitem"><p>
              The <code class="literal">services.bitwarden_rs</code> config module
              was renamed to <code class="literal">services.vaultwarden</code>.
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  <code class="literal">services.bitwarden_rs</code> is preserved
                  as an alias for backwards compatibility, but may be
                  removed in the future.
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">systemd.services.bitwarden_rs</code>,
              <code class="literal">systemd.services.backup-bitwarden_rs</code>
              and <code class="literal">systemd.timers.backup-bitwarden_rs</code>
              were renamed to
              <code class="literal">systemd.services.vaultwarden</code>,
              <code class="literal">systemd.services.backup-vaultwarden</code> and
              <code class="literal">systemd.timers.backup-vaultwarden</code>,
              respectively.
            </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square; "><li class="listitem"><p>
                  Old names are preserved as aliases for backwards
                  compatibility, but may be removed in the future.
                </p></li></ul></div></li><li class="listitem"><p>
              <code class="literal">users.users.bitwarden_rs</code> and
              <code class="literal">users.groups.bitwarden_rs</code> were renamed
              to <code class="literal">users.users.vaultwarden</code> and
              <code class="literal">users.groups.vaultwarden</code>, respectively.
            </p></li><li class="listitem"><p>
              The data directory remains located at
              <code class="literal">/var/lib/bitwarden_rs</code>, for backwards
              compatibility.
            </p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">yggdrasil</code> was upgraded to a new major
          release with breaking changes, see
          <a class="link" href="https://github.com/yggdrasil-network/yggdrasil-go/releases/tag/v0.4.0" target="_top">upstream
          changelog</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">icingaweb2</code> was upgraded to a new release
          which requires a manual database upgrade, see
          <a class="link" href="https://github.com/Icinga/icingaweb2/releases/tag/v2.9.0" target="_top">upstream
          changelog</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">isabelle</code> package has been upgraded from
          2020 to 2021
        </p></li><li class="listitem"><p>
          the <code class="literal">mingw-64</code> package has been upgraded from
          6.0.0 to 9.0.0
        </p></li><li class="listitem"><p>
          <code class="literal">tt-rss</code> was upgraded to the commit on
          2021-06-21, which has breaking changes. If you use
          <code class="literal">services.tt-rss.extraConfig</code> you should
          migrate to the <code class="literal">putenv</code>-style configuration.
          See
          <a class="link" href="https://community.tt-rss.org/t/rip-config-php-hello-classes-config-php/4337" target="_top">this
          Discourse post</a> in the tt-rss forums for more details.
        </p></li><li class="listitem"><p>
          The following Visual Studio Code extensions were renamed to
          keep the naming convention uniform.
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">bbenoist.Nix</code> -&gt;
              <code class="literal">bbenoist.nix</code>
            </p></li><li class="listitem"><p>
              <code class="literal">CoenraadS.bracket-pair-colorizer</code> -&gt;
              <code class="literal">coenraads.bracket-pair-colorizer</code>
            </p></li><li class="listitem"><p>
              <code class="literal">golang.Go</code> -&gt;
              <code class="literal">golang.go</code>
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">services.uptimed</code> now uses
          <code class="literal">/var/lib/uptimed</code> as its stateDirectory
          instead of <code class="literal">/var/spool/uptimed</code>. Make sure to
          move all files to the new directory.
        </p></li><li class="listitem"><p>
          Deprecated package aliases in <code class="literal">emacs.pkgs.*</code>
          have been removed. These aliases were remnants of the old
          Emacs package infrastructure. We now use exact upstream names
          wherever possible.
        </p></li><li class="listitem"><p>
          <code class="literal">programs.neovim.runtime</code> switched to a
          <code class="literal">linkFarm</code> internally, making it impossible
          to use wildcards in the <code class="literal">source</code> argument.
        </p></li><li class="listitem"><p>
          The <code class="literal">openrazer</code> and
          <code class="literal">openrazer-daemon</code> packages as well as the
          <code class="literal">hardware.openrazer</code> module now require users
          to be members of the <code class="literal">openrazer</code> group
          instead of <code class="literal">plugdev</code>. With this change, users
          no longer need be granted the entire set of
          <code class="literal">plugdev</code> group permissions, which can
          include permissions other than those required by
          <code class="literal">openrazer</code>. This is desirable from a
          security point of view. The setting
          <a class="link" href="options.html#opt-services.hardware.openrazer.users" target="_top"><code class="literal">harware.openrazer.users</code></a>
          can be used to add users to the <code class="literal">openrazer</code>
          group.
        </p></li><li class="listitem"><p>
          The fontconfig service’s dpi option has been removed.
          Fontconfig should use Xft settings by default so there’s no
          need to override one value in multiple places. The user can
          set DPI via ~/.Xresources properly, or at the system level per
          monitor, or as a last resort at the system level with
          <code class="literal">services.xserver.dpi</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">yambar</code> package has been split into
          <code class="literal">yambar</code> and
          <code class="literal">yambar-wayland</code>, corresponding to the xorg
          and wayland backend respectively. Please switch to
          <code class="literal">yambar-wayland</code> if you are on wayland.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.minio</code> module gained an
          additional option <code class="literal">consoleAddress</code>, that
          configures the address and port the web UI is listening, it
          defaults to <code class="literal">:9001</code>. To be able to access the
          web UI this port needs to be opened in the firewall.
        </p></li><li class="listitem"><p>
          The <code class="literal">varnish</code> package was upgraded from 6.3.x
          to 7.x. <code class="literal">varnish60</code> for the last LTS release
          is also still available.
        </p></li><li class="listitem"><p>
          The <code class="literal">kubernetes</code> package was upgraded to
          1.22. The <code class="literal">kubernetes.apiserver.kubeletHttps</code>
          option was removed and HTTPS is always used.
        </p></li><li class="listitem"><p>
          The attribute <code class="literal">linuxPackages_latest_hardened</code>
          was dropped because the hardened patches lag behind the
          upstream kernel which made version bumps harder. If you want
          to use a hardened kernel, please pin it explicitly with a
          versioned attribute such as
          <code class="literal">linuxPackages_5_10_hardened</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">nomad</code> package now defaults to a 1.1.x
          release instead of 1.0.x
        </p></li><li class="listitem"><p>
          If <code class="literal">exfat</code> is included in
          <code class="literal">boot.supportedFilesystems</code> and when using
          kernel 5.7 or later, the <code class="literal">exfatprogs</code>
          user-space utilities are used instead of
          <code class="literal">exfat</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">todoman</code> package was upgraded from 3.9.0
          to 4.0.0. This introduces breaking changes in the
          <a class="link" href="https://todoman.readthedocs.io/en/stable/configure.html#configuration-file" target="_top">configuration
          file</a> format.
        </p></li><li class="listitem"><p>
          The <code class="literal">datadog-agent</code>,
          <code class="literal">datadog-integrations-core</code> and
          <code class="literal">datadog-process-agent</code> packages were
          upgraded from 6.11.2 to 7.30.2, git-2018-09-18 to 7.30.1 and
          6.11.1 to 7.30.2, respectively. As a result
          <code class="literal">services.datadog-agent</code> has had breaking
          changes to the configuration file. For details, see the
          <a class="link" href="https://github.com/DataDog/datadog-agent/blob/main/CHANGELOG.rst" target="_top">upstream
          changelog</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">opencv2</code> no longer includes the non-free
          libraries by default, and consequently
          <code class="literal">pfstools</code> no longer includes OpenCV support
          by default. Both packages now support an
          <code class="literal">enableUnfree</code> option to re-enable this
          functionality.
        </p></li><li class="listitem"><p>
          <code class="literal">services.xserver.displayManager.defaultSession = "plasma5"</code>
          does not work anymore, instead use either
          <code class="literal">"plasma"</code> for the Plasma X11
          session or <code class="literal">"plasmawayland"</code> for
          the Plasma Wayland sesison.
        </p></li><li class="listitem"><p>
          <code class="literal">boot.kernelParams</code> now only accepts one
          command line parameter per string. This change is aimed to
          reduce common mistakes like <span class="quote">“<span class="quote">param = 12</span>”</span>, which
          would be parsed as 3 parameters.
        </p></li><li class="listitem"><p>
          <code class="literal">nix.daemonNiceLevel</code> and
          <code class="literal">nix.daemonIONiceLevel</code> have been removed in
          favour of the new options
          <a class="link" href="options.html#opt-nix.daemonCPUSchedPolicy" target="_top"><code class="literal">nix.daemonCPUSchedPolicy</code></a>,
          <a class="link" href="options.html#opt-nix.daemonIOSchedClass" target="_top"><code class="literal">nix.daemonIOSchedClass</code></a>
          and
          <a class="link" href="options.html#opt-nix.daemonIOSchedPriority" target="_top"><code class="literal">nix.daemonIOSchedPriority</code></a>.
          Please refer to the options documentation and the
          <code class="literal">sched(7)</code> and
          <code class="literal">ioprio_set(2)</code> man pages for guidance on how
          to use them.
        </p></li><li class="listitem"><p>
          The <code class="literal">coursier</code> package’s binary was renamed
          from <code class="literal">coursier</code> to <code class="literal">cs</code>.
          Completions which haven’t worked for a while should now work
          with the renamed binary. To keep using
          <code class="literal">coursier</code>, you can create a shell alias.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.mosquitto</code> module has been
          rewritten to support multiple listeners and per-listener
          configuration. Module configurations from previous releases
          will no longer work and must be updated.
        </p></li><li class="listitem"><p>
          The <code class="literal">fluidsynth_1</code> attribute has been
          removed, as this legacy version is no longer needed in
          nixpkgs. The actively maintained 2.x series is available as
          <code class="literal">fluidsynth</code> unchanged.
        </p></li><li class="listitem"><p>
          Nextcloud 20 (<code class="literal">pkgs.nextcloud20</code>) has been
          dropped because it was EOLed by upstream in 2021-10.
        </p></li><li class="listitem"><p>
          The <code class="literal">virtualisation.pathsInNixDB</code> option was
          renamed
          <a class="link" href="options.html#opt-virtualisation.additionalPaths" target="_top"><code class="literal">virtualisation.additionalPaths</code></a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.ddclient.password</code> option was
          removed, and replaced with
          <code class="literal">services.ddclient.passwordFile</code>.
        </p></li><li class="listitem"><p>
          The default GNAT version has been changed: The
          <code class="literal">gnat</code> attribute now points to
          <code class="literal">gnat11</code> instead of <code class="literal">gnat9</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">retroArchCores</code> has been removed. This means
          that using <code class="literal">nixpkgs.config.retroarch</code> to
          customize RetroArch cores is not supported anymore. Instead,
          use package overrides, for example:
          <code class="literal">retroarch.override { cores = with libretro; [ citra snes9x ]; };</code>.
          Also, <code class="literal">retroarchFull</code> derivation is available
          for those who want to have all RetroArch cores available.
        </p></li><li class="listitem"><p>
          The Linux kernel for security reasons now restricts access to
          BPF syscalls via <code class="literal">BPF_UNPRIV_DEFAULT_OFF=y</code>.
          Unprivileged access can be reenabled via the
          <code class="literal">kernel.unprivileged_bpf_disabled</code> sysctl
          knob.
        </p></li><li class="listitem"><p>
          <code class="literal">/usr</code> will always be included in the initial
          ramdisk. See the
          <code class="literal">fileSystems.&lt;name&gt;.neededForBoot</code>
          option. If any files exist under <code class="literal">/usr</code>
          (which is not typical for NixOS), they will be included in the
          initial ramdisk, increasing its size to a possibly problematic
          extent.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.11-notable-changes"></a>B.2.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The linux kernel package infrastructure was moved out of
          <code class="literal">all-packages.nix</code>, and restructured. Linux
          related functions and attributes now live under the
          <code class="literal">pkgs.linuxKernel</code> attribute set. In
          particular the versioned <code class="literal">linuxPackages_*</code>
          package sets (such as <code class="literal">linuxPackages_5_4</code>)
          and kernels from <code class="literal">pkgs</code> were moved there and
          now live under <code class="literal">pkgs.linuxKernel.packages.*</code>.
          The unversioned ones (such as
          <code class="literal">linuxPackages_latest</code>) remain untouched.
        </p></li><li class="listitem"><p>
          In NixOS virtual machines (QEMU), the
          <code class="literal">virtualisation</code> module has been updated with
          new options:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-virtualisation.forwardPorts" target="_top"><code class="literal">forwardPorts</code></a>
              to configure IPv4 port forwarding,
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-virtualisation.sharedDirectories" target="_top"><code class="literal">sharedDirectories</code></a>
              to set up shared host directories,
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-virtualisation.resolution" target="_top"><code class="literal">resolution</code></a>
              to set the screen resolution,
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-virtualisation.useNixStoreImage" target="_top"><code class="literal">useNixStoreImage</code></a>
              to use a disk image for the Nix store instead of 9P.
            </p></li></ul></div><p>
          In addition, the default
          <a class="link" href="options.html#opt-virtualisation.msize" target="_top"><code class="literal">msize</code></a>
          parameter in 9P filesystems (including /nix/store and all
          shared directories) has been increased to 16K for improved
          performance.
        </p></li><li class="listitem"><p>
          The setting
          <a class="link" href="options.html#opt-services.openssh.logLevel" target="_top"><code class="literal">services.openssh.logLevel</code></a>
          <code class="literal">"VERBOSE"</code>
          <code class="literal">"INFO"</code>. This brings NixOS in line
          with upstream and other Linux distributions, and reduces log
          spam on servers due to bruteforcing botnets.
        </p><p>
          However, if
          <a class="link" href="options.html#opt-services.fail2ban.enable" target="_top"><code class="literal">services.fail2ban.enable</code></a>
          is <code class="literal">true</code>, the <code class="literal">fail2ban</code>
          will override the verbosity to
          <code class="literal">"VERBOSE"</code>, so that
          <code class="literal">fail2ban</code> can observe the failed login
          attempts from the SSH logs.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.xserver.extraLayouts" target="_top"><code class="literal">services.xserver.extraLayouts</code></a>
          no longer cause additional rebuilds when a layout is added or
          modified.
        </p></li><li class="listitem"><p>
          Sway: The terminal emulator <code class="literal">rxvt-unicode</code> is
          no longer installed by default via
          <code class="literal">programs.sway.extraPackages</code>. The current
          default configuration uses <code class="literal">alacritty</code> (and
          soon <code class="literal">foot</code>) so this is only an issue when
          using a customized configuration and not installing
          <code class="literal">rxvt-unicode</code> explicitly.
        </p></li><li class="listitem"><p>
          <code class="literal">python3</code> now defaults to Python 3.9. Python
          3.9 introduces many deprecation warnings, please look at the
          <a class="link" href="https://docs.python.org/3/whatsnew/3.9.html" target="_top">What’s
          New In Python 3.9 post</a> for more information.
        </p></li><li class="listitem"><p>
          <code class="literal">qtile</code> hase been updated from
          <span class="quote">“<span class="quote">0.16.0</span>”</span> to <span class="quote">“<span class="quote">0.18.0</span>”</span>, please check
          <a class="link" href="https://github.com/qtile/qtile/blob/master/CHANGELOG" target="_top">qtile
          changelog</a> for changes.
        </p></li><li class="listitem"><p>
          The <code class="literal">claws-mail</code> package now references the
          new GTK+ 3 release branch, major version 4. To use the GTK+ 2
          releases, one can install the
          <code class="literal">claws-mail-gtk2</code> package.
        </p></li><li class="listitem"><p>
          The wordpress module provides a new interface which allows to
          use different webservers with the new option
          <a class="link" href="options.html#opt-services.wordpress.webserver" target="_top"><code class="literal">services.wordpress.webserver</code></a>.
          Currently <code class="literal">httpd</code>, <code class="literal">caddy</code>
          and <code class="literal">nginx</code> are supported. The definitions of
          wordpress sites should now be set in
          <a class="link" href="options.html#opt-services.wordpress.sites" target="_top"><code class="literal">services.wordpress.sites</code></a>.
        </p><p>
          Sites definitions that use the old interface are automatically
          migrated in the new option. This backward compatibility will
          be removed in 22.05.
        </p></li><li class="listitem"><p>
          The dokuwiki module provides a new interface which allows to
          use different webservers with the new option
          <a class="link" href="options.html#opt-services.dokuwiki.webserver" target="_top"><code class="literal">services.dokuwiki.webserver</code></a>.
          Currently <code class="literal">caddy</code> and
          <code class="literal">nginx</code> are supported. The definitions of
          dokuwiki sites should now be set in
          <a class="link" href="options.html#opt-services.dokuwiki.sites" target="_top"><code class="literal">services.dokuwiki.sites</code></a>.
        </p><p>
          Sites definitions that use the old interface are automatically
          migrated in the new option. This backward compatibility will
          be removed in 22.05.
        </p></li><li class="listitem"><p>
          The order of NSS (host) modules has been brought in line with
          upstream recommendations:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              The <code class="literal">myhostname</code> module is placed before
              the <code class="literal">resolve</code> (optional) and
              <code class="literal">dns</code> entries, but after
              <code class="literal">file</code> (to allow overriding via
              <code class="literal">/etc/hosts</code> /
              <code class="literal">networking.extraHosts</code>, and prevent ISPs
              with catchall-DNS resolvers from hijacking
              <code class="literal">.localhost</code> domains)
            </p></li><li class="listitem"><p>
              The <code class="literal">mymachines</code> module, which provides
              hostname resolution for local containers (registered with
              <code class="literal">systemd-machined</code>) is placed to the
              front, to make sure its mappings are preferred over other
              resolvers.
            </p></li><li class="listitem"><p>
              If systemd-networkd is enabled, the
              <code class="literal">resolve</code> module is placed before
              <code class="literal">files</code> and
              <code class="literal">myhostname</code>, as it provides the same
              logic internally, with caching.
            </p></li><li class="listitem"><p>
              The <code class="literal">mdns(_minimal)</code> module has been
              updated to the new priorities.
            </p></li></ul></div><p>
          If you use your own NSS host modules, make sure to update your
          priorities according to these rules:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              NSS modules which should be queried before
              <code class="literal">resolved</code> DNS resolution should use
              mkBefore.
            </p></li><li class="listitem"><p>
              NSS modules which should be queried after
              <code class="literal">resolved</code>, <code class="literal">files</code> and
              <code class="literal">myhostname</code>, but before
              <code class="literal">dns</code> should use the default priority
            </p></li><li class="listitem"><p>
              NSS modules which should come after <code class="literal">dns</code>
              should use mkAfter.
            </p></li></ul></div></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-networking.wireless.enable" target="_top">networking.wireless</a>
          module (based on wpa_supplicant) has been heavily reworked,
          solving a number of issues and adding useful features:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              The automatic discovery of wireless interfaces at boot has
              been made reliable again (issues
              <a class="link" href="https://github.com/NixOS/nixpkgs/issues/101963" target="_top">#101963</a>,
              <a class="link" href="https://github.com/NixOS/nixpkgs/issues/23196" target="_top">#23196</a>).
            </p></li><li class="listitem"><p>
              WPA3 and Fast BSS Transition (802.11r) are now enabled by
              default for all networks.
            </p></li><li class="listitem"><p>
              Secrets like pre-shared keys and passwords can now be
              handled safely, meaning without including them in a
              world-readable file
              (<code class="literal">wpa_supplicant.conf</code> under /nix/store).
              This is achieved by storing the secrets in a secured
              <a class="link" href="options.html#opt-networking.wireless.environmentFile" target="_top">environmentFile</a>
              and referring to them though environment variables that
              are expanded inside the configuration.
            </p></li><li class="listitem"><p>
              With multiple interfaces declared, independent
              wpa_supplicant daemons are started, one for each interface
              (the services are named
              <code class="literal">wpa_supplicant-wlan0</code>,
              <code class="literal">wpa_supplicant-wlan1</code>, etc.).
            </p></li><li class="listitem"><p>
              The generated <code class="literal">wpa_supplicant.conf</code> file
              is now formatted for easier reading.
            </p></li><li class="listitem"><p>
              A new
              <a class="link" href="options.html#opt-networking.wireless.scanOnLowSignal" target="_top">scanOnLowSignal</a>
              option has been added to facilitate fast roaming between
              access points (enabled by default).
            </p></li><li class="listitem"><p>
              A new
              <a class="link" href="options.html#opt-networking.wireless.networks._name_.authProtocols" target="_top">networks.&lt;name&gt;.authProtocols</a>
              option has been added to change the authentication
              protocols used when connecting to a network.
            </p></li></ul></div></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-networking.wireless.iwd.enable" target="_top">networking.wireless.iwd</a>
          module has a new
          <a class="link" href="options.html#opt-networking.wireless.iwd.settings" target="_top">networking.wireless.iwd.settings</a>
          option.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.smokeping.host" target="_top">services.smokeping.host</a>
          option was added and defaulted to
          <code class="literal">localhost</code>. Before,
          <code class="literal">smokeping</code> listened to all interfaces by
          default. NixOS defaults generally aim to provide
          non-Internet-exposed defaults for databases and internal
          monitoring tools, see e.g.
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/100192" target="_top">#100192</a>.
          Further, the systemd service for <code class="literal">smokeping</code>
          got reworked defaults for increased operational stability, see
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/144127" target="_top">PR
          #144127</a> for details.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.syncoid.enable" target="_top">services.syncoid.enable</a>
          module now properly drops ZFS permissions after usage. Before
          it delegated permissions to whole pools instead of datasets
          and didn’t clean up after execution. You can manually look
          this up for your pools by running
          <code class="literal">zfs allow your-pool-name</code> and use
          <code class="literal">zfs unallow syncoid your-pool-name</code> to clean
          this up.
        </p></li><li class="listitem"><p>
          Zfs: <code class="literal">latestCompatibleLinuxPackages</code> is now
          exported on the zfs package. One can use
          <code class="literal">boot.kernelPackages = config.boot.zfs.package.latestCompatibleLinuxPackages;</code>
          to always track the latest compatible kernel with a given
          version of zfs.
        </p></li><li class="listitem"><p>
          Nginx will use the value of
          <code class="literal">sslTrustedCertificate</code> if provided for a
          virtual host, even if <code class="literal">enableACME</code> is set.
          This is useful for providers not using the same certificate to
          sign OCSP responses and server certificates.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.formats.yaml</code>’s
          <code class="literal">generate</code> will not generate JSON anymore,
          but instead use more of the YAML-specific syntax.
        </p></li><li class="listitem"><p>
          MariaDB was upgraded from 10.5.x to 10.6.x. Please read the
          <a class="link" href="https://mariadb.com/kb/en/changes-improvements-in-mariadb-106/" target="_top">upstream
          release notes</a> for changes and upgrade instructions.
        </p></li><li class="listitem"><p>
          The MariaDB C client library, also known as libmysqlclient or
          mariadb-connector-c, was upgraded from 3.1.x to 3.2.x. While
          this should hopefully not have any impact, this upgrade comes
          with some changes to default behavior, so you might want to
          review the
          <a class="link" href="https://mariadb.com/kb/en/changes-and-improvements-in-mariadb-connector-c-32/" target="_top">upstream
          release notes</a>.
        </p></li><li class="listitem"><p>
          GNOME desktop environment now enables
          <code class="literal">QGnomePlatform</code> as the Qt platform theme,
          which should avoid crashes when opening file chooser dialogs
          in Qt apps by using XDG desktop portal. Additionally, it will
          make the apps fit better visually.
        </p></li><li class="listitem"><p>
          <code class="literal">rofi</code> has been updated from
          <span class="quote">“<span class="quote">1.6.1</span>”</span> to <span class="quote">“<span class="quote">1.7.0</span>”</span>, one important
          thing is the removal of the old xresources based configuration
          setup. Read more
          <a class="link" href="https://github.com/davatorium/rofi/blob/cb12e6fc058f4a0f4f/Changelog#L1" target="_top">in
          rofi’s changelog</a>.
        </p></li><li class="listitem"><p>
          ipfs now defaults to not listening on you local network. This
          setting was change as server providers won’t accept port
          scanning on their private network. If you have several ipfs
          instances running on a network you own, feel free to change
          the setting <code class="literal">ipfs.localDiscovery = true;</code>.
          localDiscovery enables different instances to discover each
          other and share data.
        </p></li><li class="listitem"><p>
          <code class="literal">lua</code> and <code class="literal">luajit</code>
          interpreters have been patched to avoid looking into /usr/lib
          directories, thus increasing the purity of the build.
        </p></li><li class="listitem"><p>
          Three new options,
          <a class="link" href="options.html#opt-xdg.mime.addedAssociations">xdg.mime.addedAssociations</a>,
          <a class="link" href="options.html#opt-xdg.mime.defaultApplications">xdg.mime.defaultApplications</a>,
          and
          <a class="link" href="options.html#opt-xdg.mime.removedAssociations">xdg.mime.removedAssociations</a>
          have been added to the
          <a class="link" href="options.html#opt-xdg.mime.enable">xdg.mime</a> module to
          allow the configuration of
          <code class="literal">/etc/xdg/mimeapps.list</code>.
        </p></li><li class="listitem"><p>
          Kopia was upgraded from 0.8.x to 0.9.x. Please read the
          <a class="link" href="https://github.com/kopia/kopia/releases/tag/v0.9.0" target="_top">upstream
          release notes</a> for changes and upgrade instructions.
        </p></li><li class="listitem"><p>
          The <code class="literal">systemd.network</code> module has gained
          support for the FooOverUDP link type.
        </p></li><li class="listitem"><p>
          The <code class="literal">networking</code> module has a new
          <code class="literal">networking.fooOverUDP</code> option to configure
          Foo-over-UDP encapsulations.
        </p></li><li class="listitem"><p>
          <code class="literal">networking.sits</code> now supports Foo-over-UDP
          encapsulation.
        </p></li><li class="listitem"><p>
          The <code class="literal">virtualisation.libvirtd</code> module has been
          refactored and updated with new options:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">virtualisation.libvirtd.qemu*</code> options
              (e.g.:
              <code class="literal">virtualisation.libvirtd.qemuRunAsRoot</code>)
              were moved to
              <a class="link" href="options.html#opt-virtualisation.libvirtd.qemu" target="_top"><code class="literal">virtualisation.libvirtd.qemu</code></a>
              submodule,
            </p></li><li class="listitem"><p>
              software TPM1/TPM2 support (e.g.: Windows 11 guests)
              (<a class="link" href="options.html#opt-virtualisation.libvirtd.qemu.swtpm" target="_top"><code class="literal">virtualisation.libvirtd.qemu.swtpm</code></a>),
            </p></li><li class="listitem"><p>
              custom OVMF package (e.g.:
              <code class="literal">pkgs.OVMFFull</code> with HTTP, CSM and Secure
              Boot support)
              (<a class="link" href="options.html#opt-virtualisation.libvirtd.qemu.ovmf.package" target="_top"><code class="literal">virtualisation.libvirtd.qemu.ovmf.package</code></a>).
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">cawbird</code> Twitter client now uses its own
          API keys to count as different application than upstream
          builds. This is done to evade application-level rate limiting.
          While existing accounts continue to work, users may want to
          remove and re-register their account in the client to enjoy a
          better user experience and benefit from this change.
        </p></li><li class="listitem"><p>
          A new option
          <code class="literal">services.prometheus.enableReload</code> has been
          added which can be enabled to reload the prometheus service
          when its config file changes instead of restarting.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.prometheus.environmentFile</code> has
          been removed since it was causing
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/126083" target="_top">issues</a>
          and Prometheus now has native support for secret files, i.e.
          <code class="literal">basic_auth.password_file</code> and
          <code class="literal">authorization.credentials_file</code>.
        </p></li><li class="listitem"><p>
          Dokuwiki now supports caddy! However
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              the nginx option has been removed, in the new
              configuration, please use the
              <code class="literal">dokuwiki.webserver = "nginx"</code>
              instead.
            </p></li><li class="listitem"><p>
              The <span class="quote">“<span class="quote">${hostname}</span>”</span> option has been deprecated,
              please use
              <code class="literal">dokuwiki.sites = [ "${hostname}" ]</code>
              instead
            </p></li></ul></div></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.unifi.enable" target="_top">services.unifi</a>
          module has been reworked, solving a number of issues. This
          leads to several user facing changes:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              The <code class="literal">services.unifi.dataDir</code> option is
              removed and the data is now always located under
              <code class="literal">/var/lib/unifi/data</code>. This is done to
              make better use of systemd state direcotiry and thus
              making the service restart more reliable.
            </p></li><li class="listitem"><p>
              The unifi logs can now be found under:
              <code class="literal">/var/log/unifi</code> instead of
              <code class="literal">/var/lib/unifi/logs</code>.
            </p></li><li class="listitem"><p>
              The unifi run directory can now be found under:
              <code class="literal">/run/unifi</code> instead of
              <code class="literal">/var/lib/unifi/run</code>.
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">security.pam.services.&lt;name&gt;.makeHomeDir</code>
          now uses <code class="literal">umask=0077</code> instead of
          <code class="literal">umask=0022</code> when creating the home
          directory.
        </p></li><li class="listitem"><p>
          Loki has had another release. Some default values have been
          changed for the configuration and some configuration options
          have been renamed. For more details, please check
          <a class="link" href="https://grafana.com/docs/loki/latest/upgrading/#240" target="_top">the
          upgrade guide</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">julia</code> now refers to
          <code class="literal">julia-stable</code> instead of
          <code class="literal">julia-lts</code>. In practice this means it has
          been upgraded from <code class="literal">1.0.4</code> to
          <code class="literal">1.5.4</code>.
        </p></li><li class="listitem"><p>
          RetroArch has been upgraded from version
          <code class="literal">1.8.5</code> to <code class="literal">1.9.13.2</code>. Since
          the previous release was quite old, if you’re having issues
          after the upgrade, please delete your
          <code class="literal">$XDG_CONFIG_HOME/retroarch/retroarch.cfg</code>
          file.
        </p></li><li class="listitem"><p>
          hydrus has been upgraded from version <code class="literal">438</code>
          to <code class="literal">463</code>. Since upgrading between releases
          this old is advised against, be sure to have a backup of your
          data before upgrading. For details, see
          <a class="link" href="https://hydrusnetwork.github.io/hydrus/help/getting_started_installing.html#big_updates" target="_top">the
          hydrus manual</a>.
        </p></li><li class="listitem"><p>
          More jdk and jre versions are now exposed via
          <code class="literal">java-packages.compiler</code>.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-21.05"></a>B.3. Release 21.05 (<span class="quote">“<span class="quote">Okapi</span>”</span>, 2021.05/31)</h2></div></div></div><p>
    Support is planned until the end of December 2021, handing over to
    21.11.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.05-highlights"></a>B.3.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Core version changes:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              gcc: 9.3.0 -&gt; 10.3.0
            </p></li><li class="listitem"><p>
              glibc: 2.30 -&gt; 2.32
            </p></li><li class="listitem"><p>
              default linux: 5.4 -&gt; 5.10, all supported kernels
              available
            </p></li><li class="listitem"><p>
              mesa: 20.1.7 -&gt; 21.0.1
            </p></li></ul></div></li><li class="listitem"><p>
          Desktop Environments:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              GNOME: 3.36 -&gt; 40, see its
              <a class="link" href="https://help.gnome.org/misc/release-notes/40.0/" target="_top">release
              notes</a>
            </p></li><li class="listitem"><p>
              Plasma5: 5.18.5 -&gt; 5.21.3
            </p></li><li class="listitem"><p>
              kdeApplications: 20.08.1 -&gt; 20.12.3
            </p></li><li class="listitem"><p>
              cinnamon: 4.6 -&gt; 4.8.1
            </p></li></ul></div></li><li class="listitem"><p>
          Programming Languages and Frameworks:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              Python optimizations were disabled again. Builds with
              optimizations enabled are not reproducible. Optimizations
              can now be enabled with an option.
            </p></li></ul></div></li><li class="listitem"><p>
          The linux_latest kernel was updated to the 5.13 series. It
          currently is not officially supported for use with the zfs
          filesystem. If you use zfs, you should use a different kernel
          version (either the LTS kernel, or track a specific one).
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.05-new-services"></a>B.3.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="https://www.gnuradio.org/" target="_top">GNURadio</a>
          3.8 and 3.9 were
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/82263" target="_top">finally</a>
          packaged, along with a rewrite to the Nix expressions,
          allowing users to override the features upstream supports
          selecting to compile or not to. Additionally, the attribute
          <code class="literal">gnuradio</code> (3.9),
          <code class="literal">gnuradio3_8</code> and
          <code class="literal">gnuradio3_7</code> now point to an externally
          wrapped by default derivations, that allow you to also add
          `extraPythonPackages` to the Python interpreter used by
          GNURadio. Missing environmental variables needed for
          operational GUI were also added
          (<a class="link" href="https://github.com/NixOS/nixpkgs/issues/75478" target="_top">#75478</a>).
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.keycloak.org/" target="_top">Keycloak</a>,
          an open source identity and access management server with
          support for
          <a class="link" href="https://openid.net/connect/" target="_top">OpenID
          Connect</a>, <a class="link" href="https://oauth.net/2/" target="_top">OAUTH
          2.0</a> and
          <a class="link" href="https://en.wikipedia.org/wiki/SAML_2.0" target="_top">SAML
          2.0</a>.
        </p><p>
          See the <a class="link" href="index.html#module-services-keycloak" title="Chapter 24. Keycloak">Keycloak
          section of the NixOS manual</a> for more information.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-services.samba-wsdd.enable" target="_top">services.samba-wsdd.enable</a>
          Web Services Dynamic Discovery host daemon
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.discourse.org/" target="_top">Discourse</a>,
          a modern and open source discussion platform.
        </p><p>
          See the <a class="link" href="index.html#module-services-discourse" title="Chapter 27. Discourse">Discourse
          section of the NixOS manual</a> for more information.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-services.nebula.networks" target="_top">services.nebula.networks</a>
          <a class="link" href="https://github.com/slackhq/nebula" target="_top">Nebula
          VPN</a>
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.05-incompatibilities"></a>B.3.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          GNOME desktop environment was upgraded to 40, see the release
          notes for
          <a class="link" href="https://help.gnome.org/misc/release-notes/40.0/" target="_top">40.0</a>
          and
          <a class="link" href="https://help.gnome.org/misc/release-notes/3.38/" target="_top">3.38</a>.
          The <code class="literal">gnome3</code> attribute set has been renamed
          to <code class="literal">gnome</code> and so have been the NixOS
          options.
        </p></li><li class="listitem"><p>
          If you are using <code class="literal">services.udev.extraRules</code>
          to assign custom names to network interfaces, this may stop
          working due to a change in the initialisation of dhcpcd and
          systemd networkd. To avoid this, either move them to
          <code class="literal">services.udev.initrdRules</code> or see the new
          <a class="link" href="index.html#sec-custom-ifnames" title="14.8.1. Assigning custom names">Assigning custom
          names</a> section of the NixOS manual for an example using
          networkd links.
        </p></li><li class="listitem"><p>
          The <code class="literal">security.hideProcessInformation</code> module
          has been removed. It was broken since the switch to
          cgroups-v2.
        </p></li><li class="listitem"><p>
          The <code class="literal">linuxPackages.ati_drivers_x11</code> kernel
          modules have been removed. The drivers only supported kernels
          prior to 4.2, and thus have become obsolete.
        </p></li><li class="listitem"><p>
          The <code class="literal">systemConfig</code> kernel parameter is no
          longer added to boot loader entries. It has been unused since
          September 2010, but if do have a system generation from that
          era, you will now be unable to boot into them.
        </p></li><li class="listitem"><p>
          <code class="literal">systemd-journal2gelf</code> no longer parses json
          and expects the receiving system to handle it. How to achieve
          this with Graylog is described in this
          <a class="link" href="https://github.com/parse-nl/SystemdJournal2Gelf/issues/10" target="_top">GitHub
          issue</a>.
        </p></li><li class="listitem"><p>
          If the <code class="literal">services.dbus</code> module is enabled,
          then the user D-Bus session is now always socket activated.
          The associated options
          <code class="literal">services.dbus.socketActivated</code> and
          <code class="literal">services.xserver.startDbusSession</code> have
          therefore been removed and you will receive a warning if they
          are present in your configuration. This change makes the user
          D-Bus session available also for non-graphical logins.
        </p></li><li class="listitem"><p>
          The <code class="literal">networking.wireless.iwd</code> module now
          installs the upstream-provided 80-iwd.link file, which sets
          the NamePolicy= for all wlan devices to "keep
          kernel", to avoid race conditions between iwd and
          networkd. If you don't want this, you can set
          <code class="literal">systemd.network.links."80-iwd" = lib.mkForce {}</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">rubyMinimal</code> was removed due to being unused
          and unusable. The default ruby interpreter includes JIT
          support, which makes it reference it's compiler. Since JIT
          support is probably needed by some Gems, it was decided to
          enable this feature with all cc references by default, and
          allow to build a Ruby derivation without references to cc, by
          setting <code class="literal">jitSupport = false;</code> in an overlay.
          See
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/90151" target="_top">#90151</a>
          for more info.
        </p></li><li class="listitem"><p>
          Setting
          <code class="literal">services.openssh.authorizedKeysFiles</code> now
          also affects which keys
          <code class="literal">security.pam.enableSSHAgentAuth</code> will use.
          WARNING: If you are using these options in combination do make
          sure that any key paths you use are present in
          <code class="literal">services.openssh.authorizedKeysFiles</code>!
        </p></li><li class="listitem"><p>
          The option <code class="literal">fonts.enableFontDir</code> has been
          renamed to
          <a class="link" href="options.html#opt-fonts.fontDir.enable" target="_top">fonts.fontDir.enable</a>.
          The path of font directory has also been changed to
          <code class="literal">/run/current-system/sw/share/X11/fonts</code>, for
          consistency with other X11 resources.
        </p></li><li class="listitem"><p>
          A number of options have been renamed in the kicad interface.
          <code class="literal">oceSupport</code> has been renamed to
          <code class="literal">withOCE</code>, <code class="literal">withOCCT</code> has
          been renamed to <code class="literal">withOCC</code>,
          <code class="literal">ngspiceSupport</code> has been renamed to
          <code class="literal">withNgspice</code>, and
          <code class="literal">scriptingSupport</code> has been renamed to
          <code class="literal">withScripting</code>. Additionally,
          <code class="literal">kicad/base.nix</code> no longer provides default
          argument values since these are provided by
          <code class="literal">kicad/default.nix</code>.
        </p></li><li class="listitem"><p>
          The socket for the <code class="literal">pdns-recursor</code> module was
          moved from <code class="literal">/var/lib/pdns-recursor</code> to
          <code class="literal">/run/pdns-recursor</code> to match upstream.
        </p></li><li class="listitem"><p>
          Paperwork was updated to version 2. The on-disk format
          slightly changed, and it is not possible to downgrade from
          Paperwork 2 back to Paperwork 1.3. Back your documents up
          before upgrading. See
          <a class="link" href="https://forum.openpaper.work/t/paperwork-2-0/112/5" target="_top">this
          thread</a> for more details.
        </p></li><li class="listitem"><p>
          PowerDNS has been updated from <code class="literal">4.2.x</code> to
          <code class="literal">4.3.x</code>. Please be sure to review the
          <a class="link" href="https://doc.powerdns.com/authoritative/upgrading.html#x-to-4-3-0" target="_top">Upgrade
          Notes</a> provided by upstream before upgrading. Worth
          specifically noting is that the service now runs entirely as a
          dedicated <code class="literal">pdns</code> user, instead of starting as
          <code class="literal">root</code> and dropping privileges, as well as
          the default <code class="literal">socket-dir</code> location changing
          from <code class="literal">/var/lib/powerdns</code> to
          <code class="literal">/run/pdns</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">mediatomb</code> service is now using by
          default the new and maintained fork <code class="literal">gerbera</code>
          package instead of the unmaintained
          <code class="literal">mediatomb</code> package. If you want to keep the
          old behavior, you must declare it with:
        </p><pre class="programlisting">
{
  services.mediatomb.package = pkgs.mediatomb;
}
</pre><p>
          One new option <code class="literal">openFirewall</code> has been
          introduced which defaults to false. If you relied on the
          service declaration to add the firewall rules itself before,
          you should now declare it with:
        </p><pre class="programlisting">
{
  services.mediatomb.openFirewall = true;
}
</pre></li><li class="listitem"><p>
          xfsprogs was update from 4.19 to 5.11. It now enables reflink
          support by default on filesystem creation. Support for
          reflinks was added with an experimental status to kernel 4.9
          and deemed stable in kernel 4.16. If you want to be able to
          mount XFS filesystems created with this release of xfsprogs on
          kernel releases older than those, you need to format them with
          <code class="literal">mkfs.xfs -m reflink=0</code>.
        </p></li><li class="listitem"><p>
          The uWSGI server is now built with POSIX capabilities. As a
          consequence, root is no longer required in emperor mode and
          the service defaults to running as the unprivileged
          <code class="literal">uwsgi</code> user. Any additional capability can
          be added via the new option
          <a class="link" href="options.html#opt-services.uwsgi.capabilities" target="_top">services.uwsgi.capabilities</a>.
          The previous behaviour can be restored by setting:
        </p><pre class="programlisting">
{
  services.uwsgi.user = "root";
  services.uwsgi.group = "root";
  services.uwsgi.instance =
    {
      uid = "uwsgi";
      gid = "uwsgi";
    };
}
</pre><p>
          Another incompatibility from the previous release is that
          vassals running under a different user or group need to use
          <code class="literal">immediate-{uid,gid}</code> instead of the usual
          <code class="literal">uid,gid</code> options.
        </p></li><li class="listitem"><p>
          btc1 has been abandoned upstream, and removed.
        </p></li><li class="listitem"><p>
          cpp_ethereum (aleth) has been abandoned upstream, and removed.
        </p></li><li class="listitem"><p>
          riak-cs package removed along with
          <code class="literal">services.riak-cs</code> module.
        </p></li><li class="listitem"><p>
          stanchion package removed along with
          <code class="literal">services.stanchion</code> module.
        </p></li><li class="listitem"><p>
          mutt has been updated to a new major version (2.x), which
          comes with some backward incompatible changes that are
          described in the
          <a class="link" href="http://www.mutt.org/relnotes/2.0/" target="_top">release
          notes for Mutt 2.0</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">vim</code> and <code class="literal">neovim</code> switched
          to Python 3, dropping all Python 2 support.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-networking.wireguard.interfaces" target="_top">networking.wireguard.interfaces.&lt;name&gt;.generatePrivateKeyFile</a>,
          which is off by default, had a <code class="literal">chmod</code> race
          condition fixed. As an aside, the parent directory's
          permissions were widened, and the key files were made
          owner-writable. This only affects newly created keys. However,
          if the exact permissions are important for your setup, read
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/121294" target="_top">#121294</a>.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-boot.zfs.forceImportAll" target="_top">boot.zfs.forceImportAll</a>
          previously did nothing, but has been fixed. However its
          default has been changed to <code class="literal">false</code> to
          preserve the existing default behaviour. If you have this
          explicitly set to <code class="literal">true</code>, please note that
          your non-root pools will now be forcibly imported.
        </p></li><li class="listitem"><p>
          openafs now points to openafs_1_8, which is the new stable
          release. OpenAFS 1.6 was removed.
        </p></li><li class="listitem"><p>
          The WireGuard module gained a new option
          <code class="literal">networking.wireguard.interfaces.&lt;name&gt;.peers.*.dynamicEndpointRefreshSeconds</code>
          that implements refreshing the IP of DNS-based endpoints
          periodically (which WireGuard itself
          <a class="link" href="https://lists.zx2c4.com/pipermail/wireguard/2017-November/002028.html" target="_top">cannot
          do</a>).
        </p></li><li class="listitem"><p>
          MariaDB has been updated to 10.5. Before you upgrade, it would
          be best to take a backup of your database and read
          <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-104-to-mariadb-105/#incompatible-changes-between-104-and-105" target="_top">
          Incompatible Changes Between 10.4 and 10.5</a>. After the
          upgrade you will need to run <code class="literal">mysql_upgrade</code>.
        </p></li><li class="listitem"><p>
          The TokuDB storage engine dropped in mariadb 10.5 and removed
          in mariadb 10.6. It is recommended to switch to RocksDB. See
          also
          <a class="link" href="https://mariadb.com/kb/en/tokudb/" target="_top">TokuDB</a>
          and
          <a class="link" href="https://jira.mariadb.org/browse/MDEV-19780" target="_top">MDEV-19780:
          Remove the TokuDB storage engine</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">openldap</code> module now has support for
          OLC-style configuration, users of the
          <code class="literal">configDir</code> option may wish to migrate. If
          you continue to use <code class="literal">configDir</code>, ensure that
          <code class="literal">olcPidFile</code> is set to
          <code class="literal">/run/slapd/slapd.pid</code>.
        </p><p>
          As a result, <code class="literal">extraConfig</code> and
          <code class="literal">extraDatabaseConfig</code> are removed. To help
          with migration, you can convert your
          <code class="literal">slapd.conf</code> file to OLC configuration with
          the following script (find the location of this configuration
          file by running <code class="literal">systemctl status openldap</code>,
          it is the <code class="literal">-f</code> option.
        </p><pre class="programlisting">
$ TMPDIR=$(mktemp -d)
$ slaptest -f /path/to/slapd.conf -F $TMPDIR
$ slapcat -F $TMPDIR -n0 -H 'ldap:///???(!(objectClass=olcSchemaConfig))'
</pre><p>
          This will dump your current configuration in LDIF format,
          which should be straightforward to convert into Nix settings.
          This does not show your schema configuration, as this is
          unnecessarily verbose for users of the default schemas and
          <code class="literal">slaptest</code> is buggy with schemas directly in
          the config file.
        </p></li><li class="listitem"><p>
          Amazon EC2 and OpenStack Compute (nova) images now re-fetch
          instance meta data and user data from the instance metadata
          service (IMDS) on each boot. For example: stopping an EC2
          instance, changing its user data, and restarting the instance
          will now cause it to fetch and apply the new user data.
        </p><div class="warning"><h3 class="title">Warning</h3><p>
            Specifically, <code class="literal">/etc/ec2-metadata</code> is
            re-populated on each boot. Some NixOS scripts that read from
            this directory are guarded to only run if the files they
            want to manipulate do not already exist, and so will not
            re-apply their changes if the IMDS response changes.
            Examples: <code class="literal">root</code>'s SSH key is only added if
            <code class="literal">/root/.ssh/authorized_keys</code> does not
            exist, and SSH host keys are only set from user data if they
            do not exist in <code class="literal">/etc/ssh</code>.
          </p></div></li><li class="listitem"><p>
          The <code class="literal">rspamd</code> services is now sandboxed. It is
          run as a dynamic user instead of root, so secrets and other
          files may have to be moved or their permissions may have to be
          fixed. The sockets are now located in
          <code class="literal">/run/rspamd</code> instead of
          <code class="literal">/run</code>.
        </p></li><li class="listitem"><p>
          Enabling the Tor client no longer silently also enables and
          configures Privoxy, and the
          <code class="literal">services.tor.client.privoxy.enable</code> option
          has been removed. To enable Privoxy, and to configure it to
          use Tor's faster port, use the following configuration:
        </p><pre class="programlisting">
{
  opt-services.privoxy.enable = true;
  opt-services.privoxy.enableTor = true;
}
</pre></li><li class="listitem"><p>
          The <code class="literal">services.tor</code> module has a new
          exhaustively typed
          <a class="link" href="options.html#opt-services.tor.settings" target="_top">services.tor.settings</a>
          option following RFC 0042; backward compatibility with old
          options has been preserved when aliasing was possible. The
          corresponding systemd service has been hardened, but there is
          a chance that the service still requires more permissions, so
          please report any related trouble on the bugtracker. Onion
          services v3 are now supported in
          <a class="link" href="options.html#opt-services.tor.relay.onionServices" target="_top">services.tor.relay.onionServices</a>.
          A new
          <a class="link" href="options.html#opt-services.tor.openFirewall" target="_top">services.tor.openFirewall</a>
          option as been introduced for allowing connections on all the
          TCP ports configured.
        </p></li><li class="listitem"><p>
          The options
          <code class="literal">services.slurm.dbdserver.storagePass</code> and
          <code class="literal">services.slurm.dbdserver.configFile</code> have
          been removed. Use
          <code class="literal">services.slurm.dbdserver.storagePassFile</code>
          instead to provide the database password. Extra config options
          can be given via the option
          <code class="literal">services.slurm.dbdserver.extraConfig</code>. The
          actual configuration file is created on the fly on startup of
          the service. This avoids that the password gets exposed in the
          nix store.
        </p></li><li class="listitem"><p>
          The <code class="literal">wafHook</code> hook does not wrap Python
          anymore. Packages depending on <code class="literal">wafHook</code> need
          to include any Python into their
          <code class="literal">nativeBuildInputs</code>.
        </p></li><li class="listitem"><p>
          Starting with version 1.7.0, the project formerly named
          <code class="literal">CodiMD</code> is now named
          <code class="literal">HedgeDoc</code>. New installations will no longer
          use the old name for users, state directories and such, this
          needs to be considered when moving state to a more recent
          NixOS installation. Based on
          <a class="link" href="options.html#opt-system.stateVersion" target="_top">system.stateVersion</a>,
          existing installations will continue to work.
        </p></li><li class="listitem"><p>
          The fish-foreign-env package has been replaced with
          fishPlugins.foreign-env, in which the fish functions have been
          relocated to the <code class="literal">vendor_functions.d</code>
          directory to be loaded automatically.
        </p></li><li class="listitem"><p>
          The prometheus json exporter is now managed by the prometheus
          community. Together with additional features some backwards
          incompatibilities were introduced. Most importantly the
          exporter no longer accepts a fixed command-line parameter to
          specify the URL of the endpoint serving JSON. It now expects
          this URL to be passed as an URL parameter, when scraping the
          exporter's <code class="literal">/probe</code> endpoint. In the
          prometheus scrape configuration the scrape target might look
          like this:
        </p><pre class="programlisting">
http://some.json-exporter.host:7979/probe?target=https://example.com/some/json/endpoint
</pre><p>
          Existing configuration for the exporter needs to be updated,
          but can partially be re-used. Documentation is available in
          the upstream repository and a small example for NixOS is
          available in the corresponding NixOS test.
        </p><p>
          These changes also affect
          <a class="link" href="options.html#opt-services.prometheus.exporters.rspamd.enable" target="_top">services.prometheus.exporters.rspamd.enable</a>,
          which is just a preconfigured instance of the json exporter.
        </p><p>
          For more information, take a look at the
          <a class="link" href="https://github.com/prometheus-community/json_exporter" target="_top">
          official documentation</a> of the json_exporter.
        </p></li><li class="listitem"><p>
          Androidenv was updated, removing the
          <code class="literal">includeDocs</code> and
          <code class="literal">lldbVersions</code> arguments. Docs only covered a
          single version of the Android SDK, LLDB is now bundled with
          the NDK, and both are no longer available to download from the
          Android package repositories. Additionally, since the package
          lists have been updated, some older versions of Android
          packages may not be bundled. If you depend on older versions
          of Android packages, we recommend overriding the repo.
        </p><p>
          Android packages are now loaded from a repo.json file created
          by parsing Android repo XML files. The arguments
          <code class="literal">repoJson</code> and <code class="literal">repoXmls</code>
          have been added to allow overriding the built-in androidenv
          repo.json with your own. Additionally, license files are now
          written to allow compatibility with Gradle-based tools, and
          the <code class="literal">extraLicenses</code> argument has been added
          to accept more SDK licenses if your project requires it. See
          the androidenv documentation for more details.
        </p></li><li class="listitem"><p>
          The attribute <code class="literal">mpi</code> is now consistently used
          to provide a default, system-wide MPI implementation. The
          default implementation is openmpi, which has been used before
          by all derivations affects by this change. Note that all
          packages that have used <code class="literal">mpi ? null</code> in the
          input for optional MPI builds, have been changed to the
          boolean input paramater <code class="literal">useMpi</code> to enable
          building with MPI. Building all packages with
          <code class="literal">mpich</code> instead of the default
          <code class="literal">openmpi</code> can now be achived like this:
        </p><pre class="programlisting">
self: super:
{
  mpi = super.mpich;
}
</pre></li><li class="listitem"><p>
          The Searx module has been updated with the ability to
          configure the service declaratively and uWSGI integration. The
          option <code class="literal">services.searx.configFile</code> has been
          renamed to
          <a class="link" href="options.html#opt-services.searx.settingsFile" target="_top">services.searx.settingsFile</a>
          for consistency with the new
          <a class="link" href="options.html#opt-services.searx.settings" target="_top">services.searx.settings</a>.
          In addition, the <code class="literal">searx</code> uid and gid
          reservations have been removed since they were not necessary:
          the service is now running with a dynamically allocated uid.
        </p></li><li class="listitem"><p>
          The libinput module has been updated with the ability to
          configure mouse and touchpad settings separately. The options
          in <code class="literal">services.xserver.libinput</code> have been
          renamed to
          <code class="literal">services.xserver.libinput.touchpad</code>, while
          there is a new
          <code class="literal">services.xserver.libinput.mouse</code> for mouse
          related configuration.
        </p><p>
          Since touchpad options no longer apply to all devices, you may
          want to replicate your touchpad configuration in mouse
          section.
        </p></li><li class="listitem"><p>
          ALSA OSS emulation
          (<code class="literal">sound.enableOSSEmulation</code>) is now disabled
          by default.
        </p></li><li class="listitem"><p>
          Thinkfan as been updated to <code class="literal">1.2.x</code>, which
          comes with a new YAML based configuration format. For this
          reason, several NixOS options of the thinkfan module have been
          changed to non-backward compatible types. In addition, a new
          <a class="link" href="options.html#opt-services.thinkfan.settings" target="_top">services.thinkfan.settings</a>
          option has been added.
        </p><p>
          Please read the
          <a class="link" href="https://github.com/vmatare/thinkfan#readme" target="_top">
          thinkfan documentation</a> before updating.
        </p></li><li class="listitem"><p>
          Adobe Flash Player support has been dropped from the tree. In
          particular, the following packages no longer support it:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              chromium
            </p></li><li class="listitem"><p>
              firefox
            </p></li><li class="listitem"><p>
              qt48
            </p></li><li class="listitem"><p>
              qt5.qtwebkit
            </p></li></ul></div><p>
          Additionally, packages flashplayer and hal-flash were removed
          along with the <code class="literal">services.flashpolicyd</code>
          module.
        </p></li><li class="listitem"><p>
          The <code class="literal">security.rngd</code> module has been removed.
          It was disabled by default in 20.09 as it was functionally
          redundant with krngd in the linux kernel. It is not necessary
          for any device that the kernel recognises as an hardware RNG,
          as it will automatically run the krngd task to periodically
          collect random data from the device and mix it into the
          kernel's RNG.
        </p><p>
          The default SMTP port for GitLab has been changed to
          <code class="literal">25</code> from its previous default of
          <code class="literal">465</code>. If you depended on this default, you
          should now set the
          <a class="link" href="options.html#opt-services.gitlab.smtp.port" target="_top">services.gitlab.smtp.port</a>
          option.
        </p></li><li class="listitem"><p>
          The default version of ImageMagick has been updated from 6 to
          7. You can use imagemagick6, imagemagick6_light, and
          imagemagick6Big if you need the older version.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-services.xserver.videoDrivers" target="_top">services.xserver.videoDrivers</a>
          no longer uses the deprecated <code class="literal">cirrus</code> and
          <code class="literal">vesa</code> device dependent X drivers by default.
          It also enables both <code class="literal">amdgpu</code> and
          <code class="literal">nouveau</code> drivers by default now.
        </p></li><li class="listitem"><p>
          The <code class="literal">kindlegen</code> package is gone, because it
          is no longer supported or hosted by Amazon. Sadly, its
          replacement, Kindle Previewer, has no Linux support. However,
          there are other ways to generate MOBI files. See
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/96439" target="_top">the
          discussion</a> for more info.
        </p></li><li class="listitem"><p>
          The apacheKafka packages are now built with version-matched
          JREs. Versions 2.6 and above, the ones that recommend it, use
          jdk11, while versions below remain on jdk8. The NixOS service
          has been adjusted to start the service using the same version
          as the package, adjustable with the new
          <a class="link" href="options.html#opt-services.apache-kafka.jre" target="_top">services.apache-kafka.jre</a>
          option. Furthermore, the default list of
          <a class="link" href="options.html#opt-services.apache-kafka.jvmOptions" target="_top">services.apache-kafka.jvmOptions</a>
          have been removed. You should set your own according to the
          <a class="link" href="https://kafka.apache.org/documentation/#java" target="_top">upstream
          documentation</a> for your Kafka version.
        </p></li><li class="listitem"><p>
          The kodi package has been modified to allow concise addon
          management. Consider the following configuration from previous
          releases of NixOS to install kodi, including the
          kodiPackages.inputstream-adaptive and kodiPackages.vfs-sftp
          addons:
        </p><pre class="programlisting">
{
  environment.systemPackages = [
    pkgs.kodi
  ];

  nixpkgs.config.kodi = {
    enableInputStreamAdaptive = true;
    enableVFSSFTP = true;
  };
}
</pre><p>
          All Kodi <code class="literal">config</code> flags have been removed,
          and as a result the above configuration should now be written
          as:
        </p><pre class="programlisting">
{
  environment.systemPackages = [
    (pkgs.kodi.withPackages (p: with p; [
      inputstream-adaptive
      vfs-sftp
    ]))
  ];
}
</pre></li><li class="listitem"><p>
          <code class="literal">environment.defaultPackages</code> now includes
          the nano package. If pkgs.nano is not added to the list, make
          sure another editor is installed and the
          <code class="literal">EDITOR</code> environment variable is set to it.
          Environment variables can be set using
          <code class="literal">environment.variables</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.minio.dataDir</code> changed type to a
          list of paths, required for specifiyng multiple data
          directories for using with erasure coding. Currently, the
          service doesn't enforce nor checks the correct number of paths
          to correspond to minio requirements.
        </p></li><li class="listitem"><p>
          All CUDA toolkit versions prior to CUDA 10 have been removed.
        </p></li><li class="listitem"><p>
          The kbdKeymaps package was removed since dvp and neo are now
          included in kbd. If you want to use the Programmer Dvorak
          Keyboard Layout, you have to use
          <code class="literal">dvorak-programmer</code> in
          <code class="literal">console.keyMap</code> now instead of
          <code class="literal">dvp</code>. In
          <code class="literal">services.xserver.xkbVariant</code> it's still
          <code class="literal">dvp</code>.
        </p></li><li class="listitem"><p>
          The babeld service is now being run as an unprivileged user.
          To achieve that the module configures
          <code class="literal">skip-kernel-setup true</code> and takes care of
          setting forwarding and rp_filter sysctls by itself as well as
          for each interface in
          <code class="literal">services.babeld.interfaces</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.zigbee2mqtt.config</code> option has
          been renamed to
          <code class="literal">services.zigbee2mqtt.settings</code> and now
          follows
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">RFC
          0042</a>.
        </p></li></ul></div><p>
      The yadm dotfile manager has been updated from 2.x to 3.x, which
      has new (XDG) default locations for some data/state files. Most
      yadm commands will fail and print a legacy path warning (which
      describes how to upgrade/migrate your repository). If you have
      scripts, daemons, scheduled jobs, shell profiles, etc. that invoke
      yadm, expect them to fail or misbehave until you perform this
      migration and prepare accordingly.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Instead of determining
          <code class="literal">services.radicale.package</code> automatically
          based on <code class="literal">system.stateVersion</code>, the latest
          version is always used because old versions are not officially
          supported.
        </p><p>
          Furthermore, Radicale's systemd unit was hardened which might
          break some deployments. In particular, a non-default
          <code class="literal">filesystem_folder</code> has to be added to
          <code class="literal">systemd.services.radicale.serviceConfig.ReadWritePaths</code>
          if the deprecated <code class="literal">services.radicale.config</code>
          is used.
        </p></li><li class="listitem"><p>
          In the <code class="literal">security.acme</code> module, use of
          <code class="literal">--reuse-key</code> parameter for Lego has been
          removed. It was introduced for HKPK, but this security feature
          is now deprecated. It is a better security practice to rotate
          key pairs instead of always keeping the same. If you need to
          keep this parameter, you can add it back using
          <code class="literal">extraLegoRenewFlags</code> as an option for the
          appropriate certificate.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-21.05-notable-changes"></a>B.3.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">stdenv.lib</code> has been deprecated and will
          break eval in 21.11. Please use <code class="literal">pkgs.lib</code>
          instead. See
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/108938" target="_top">#108938</a>
          for details.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.gnuradio.org/" target="_top">GNURadio</a>
          has a <code class="literal">pkgs</code> attribute set, and there's a
          <code class="literal">gnuradio.callPackage</code> function that extends
          <code class="literal">pkgs</code> with a
          <code class="literal">mkDerivation</code>, and a
          <code class="literal">mkDerivationWith</code>, like Qt5. Now all
          <code class="literal">gnuradio.pkgs</code> are defined with
          <code class="literal">gnuradio.callPackage</code> and some packages that
          depend on gnuradio are defined with this as well.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.privoxy.org/" target="_top">Privoxy</a> has
          been updated to version 3.0.32 (See
          <a class="link" href="https://lists.privoxy.org/pipermail/privoxy-announce/2021-February/000007.html" target="_top">announcement</a>).
          Compared to the previous release, Privoxy has gained support
          for HTTPS inspection (still experimental), Brotli
          decompression, several new filters and lots of bug fixes,
          including security ones. In addition, the package is now built
          with compression and external filters support, which were
          previously disabled.
        </p><p>
          Regarding the NixOS module, new options for HTTPS inspection
          have been added and
          <code class="literal">services.privoxy.extraConfig</code> has been
          replaced by the new
          <a class="link" href="options.html#opt-services.privoxy.settings" target="_top">services.privoxy.settings</a>
          (See
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">RFC
          0042</a> for the motivation).
        </p></li><li class="listitem"><p>
          <a class="link" href="https://kodi.tv/" target="_top">Kodi</a> has been
          updated to version 19.1 "Matrix". See the
          <a class="link" href="https://kodi.tv/article/kodi-19-0-matrix-release" target="_top">announcement</a>
          for further details.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.packagekit.backend</code> option has
          been removed as it only supported a single setting which would
          always be the default. Instead new
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">RFC
          0042</a> compliant
          <a class="link" href="options.html#opt-services.packagekit.settings" target="_top">services.packagekit.settings</a>
          and
          <a class="link" href="options.html#opt-services.packagekit.vendorSettings" target="_top">services.packagekit.vendorSettings</a>
          options have been introduced.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://nginx.org" target="_top">Nginx</a> has been
          updated to stable version 1.20.0. Now nginx uses the zlib-ng
          library by default.
        </p></li><li class="listitem"><p>
          KDE Gear (formerly KDE Applications) is upgraded to 21.04, see
          its
          <a class="link" href="https://kde.org/announcements/gear/21.04/" target="_top">release
          notes</a> for details.
        </p><p>
          The <code class="literal">kdeApplications</code> package set is now
          <code class="literal">kdeGear</code>, in keeping with the new name. The
          old name remains for compatibility, but it is deprecated.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://libreswan.org/" target="_top">Libreswan</a> has
          been updated to version 4.4. The package now includes example
          configurations and manual pages by default. The NixOS module
          has been changed to use the upstream systemd units and write
          the configuration in the <code class="literal">/etc/ipsec.d/ </code>
          directory. In addition, two new options have been added to
          specify connection policies
          (<a class="link" href="options.html#opt-services.libreswan.policies" target="_top">services.libreswan.policies</a>)
          and disable send/receive redirects
          (<a class="link" href="options.html#opt-services.libreswan.disableRedirects" target="_top">services.libreswan.disableRedirects</a>).
        </p></li><li class="listitem"><p>
          The Mailman NixOS module (<code class="literal">services.mailman</code>)
          has a new option
          <a class="link" href="options.html#opt-services.mailman.enablePostfix" target="_top">services.mailman.enablePostfix</a>,
          defaulting to true, that controls integration with Postfix.
        </p><p>
          If this option is disabled, default MTA config becomes not set
          and you should set the options in
          <code class="literal">services.mailman.settings.mta</code> according to
          the desired configuration as described in
          <a class="link" href="https://mailman.readthedocs.io/en/latest/src/mailman/docs/mta.html" target="_top">Mailman
          documentation</a>.
        </p></li><li class="listitem"><p>
          The default-version of <code class="literal">nextcloud</code> is
          nextcloud21. Please note that it's <span class="emphasis"><em>not</em></span>
          possible to upgrade <code class="literal">nextcloud</code> across
          multiple major versions! This means that it's e.g. not
          possible to upgrade from nextcloud18 to nextcloud20 in a
          single deploy and most <code class="literal">20.09</code> users will
          have to upgrade to nextcloud20 first.
        </p><p>
          The package can be manually upgraded by setting
          <a class="link" href="options.html#opt-services.nextcloud.package" target="_top">services.nextcloud.package</a>
          to nextcloud21.
        </p></li><li class="listitem"><p>
          The setting
          <a class="link" href="options.html#opt-services.redis.bind" target="_top">services.redis.bind</a>
          defaults to <code class="literal">127.0.0.1</code> now, making Redis
          listen on the loopback interface only, and not all public
          network interfaces.
        </p></li><li class="listitem"><p>
          NixOS now emits a deprecation warning if systemd's
          <code class="literal">StartLimitInterval</code> setting is used in a
          <code class="literal">serviceConfig</code> section instead of in a
          <code class="literal">unitConfig</code>; that setting is deprecated and
          now undocumented for the service section by systemd upstream,
          but still effective and somewhat buggy there, which can be
          confusing. See
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/45785" target="_top">#45785</a>
          for details.
        </p><p>
          All services should use
          <a class="link" href="options.html#opt-systemd.services._name_.startLimitIntervalSec" target="_top">systemd.services.<span class="emphasis"><em>name</em></span>.startLimitIntervalSec</a>
          or <code class="literal">StartLimitIntervalSec</code> in
          <a class="link" href="options.html#opt-systemd.services._name_.unitConfig" target="_top">systemd.services.<span class="emphasis"><em>name</em></span>.unitConfig</a>
          instead.
        </p></li><li class="listitem"><p>
          The <code class="literal">mediatomb</code> service declares new options.
          It also adapts existing options so the configuration
          generation is now lazy. The existing option
          <code class="literal">customCfg</code> (defaults to false), when
          enabled, stops the service configuration generation
          completely. It then expects the users to provide their own
          correct configuration at the right location (whereas the
          configuration was generated and not used at all before). The
          new option <code class="literal">transcodingOption</code> (defaults to
          no) allows a generated configuration. It makes the mediatomb
          service pulls the necessary runtime dependencies in the nix
          store (whereas it was generated with hardcoded values before).
          The new option <code class="literal">mediaDirectories</code> allows the
          users to declare autoscan media directories from their nixos
          configuration:
        </p><pre class="programlisting">
{
  services.mediatomb.mediaDirectories = [
    { path = "/var/lib/mediatomb/pictures"; recursive = false; hidden-files = false; }
    { path = "/var/lib/mediatomb/audio"; recursive = true; hidden-files = false; }
  ];
}
</pre></li><li class="listitem"><p>
          The Unbound DNS resolver service
          (<code class="literal">services.unbound</code>) has been refactored to
          allow reloading, control sockets and to fix startup ordering
          issues.
        </p><p>
          It is now possible to enable a local UNIX control socket for
          unbound by setting the
          <a class="link" href="options.html#opt-services.unbound.localControlSocketPath" target="_top">services.unbound.localControlSocketPath</a>
          option.
        </p><p>
          Previously we just applied a very minimal set of restrictions
          and trusted unbound to properly drop root privs and
          capabilities.
        </p><p>
          As of this we are (for the most part) just using the upstream
          example unit file for unbound. The main difference is that we
          start unbound as <code class="literal">unbound</code> user with the
          required capabilities instead of letting unbound do the chroot
          &amp; uid/gid changes.
        </p><p>
          The upstream unit configuration this is based on is a lot
          stricter with all kinds of permissions then our previous
          variant. It also came with the default of having the
          <code class="literal">Type</code> set to <code class="literal">notify</code>,
          therefore we are now also using the
          <code class="literal">unbound-with-systemd</code> package here. Unbound
          will start up, read the configuration files and start
          listening on the configured ports before systemd will declare
          the unit <code class="literal">active (running)</code>. This will likely
          help with startup order and the occasional race condition
          during system activation where the DNS service is started but
          not yet ready to answer queries. Services depending on
          <code class="literal">nss-lookup.target</code> or
          <code class="literal">unbound.service</code> are now be able to use
          unbound when those targets have been reached.
        </p><p>
          Additionally to the much stricter runtime environment the
          <code class="literal">/dev/urandom</code> mount lines we previously had
          in the code (that randomly failed during the stop-phase) have
          been removed as systemd will take care of those for us.
        </p><p>
          The <code class="literal">preStart</code> script is now only required if
          we enabled the trust anchor updates (which are still enabled
          by default).
        </p><p>
          Another benefit of the refactoring is that we can now issue
          reloads via either <code class="literal">pkill -HUP unbound</code> and
          <code class="literal">systemctl reload unbound</code> to reload the
          running configuration without taking the daemon offline. A
          prerequisite of this was that unbound configuration is
          available on a well known path on the file system. We are
          using the path <code class="literal">/etc/unbound/unbound.conf</code> as
          that is the default in the CLI tooling which in turn enables
          us to use <code class="literal">unbound-control</code> without passing a
          custom configuration location.
        </p><p>
          The module has also been reworked to be
          <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md" target="_top">RFC
          0042</a> compliant. As such,
          <code class="literal">sevices.unbound.extraConfig</code> has been
          removed and replaced by
          <a class="link" href="options.html#opt-services.unbound.settings" target="_top">services.unbound.settings</a>.
          <code class="literal">services.unbound.interfaces</code> has been
          renamed to
          <code class="literal">services.unbound.settings.server.interface</code>.
        </p><p>
          <code class="literal">services.unbound.forwardAddresses</code> and
          <code class="literal">services.unbound.allowedAccess</code> have also
          been changed to use the new settings interface. You can follow
          the instructions when executing
          <code class="literal">nixos-rebuild</code> to upgrade your configuration
          to use the new interface.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.dnscrypt-proxy2</code> module now
          takes the upstream's example configuration and updates it with
          the user's settings. An option has been added to restore the
          old behaviour if you prefer to declare the configuration from
          scratch.
        </p></li><li class="listitem"><p>
          NixOS now defaults to the unified cgroup hierarchy
          (cgroupsv2). See the
          <a class="link" href="https://www.redhat.com/sysadmin/fedora-31-control-group-v2" target="_top">Fedora
          Article for 31</a> for details on why this is desirable,
          and how it impacts containers.
        </p><p>
          If you want to run containers with a runtime that does not yet
          support cgroupsv2, you can switch back to the old behaviour by
          setting
          <a class="link" href="options.html#opt-systemd.enableUnifiedCgroupHierarchy" target="_top">systemd.enableUnifiedCgroupHierarchy</a>
          = <code class="literal">false</code>; and rebooting.
        </p></li><li class="listitem"><p>
          PulseAudio was upgraded to 14.0, with changes to the handling
          of default sinks. See its
          <a class="link" href="https://www.freedesktop.org/wiki/Software/PulseAudio/Notes/14.0/" target="_top">release
          notes</a>.
        </p></li><li class="listitem"><p>
          GNOME users may wish to delete their
          <code class="literal">~/.config/pulse</code> due to the changes to
          stream routing logic. See
          <a class="link" href="https://gitlab.freedesktop.org/pulseaudio/pulseaudio/-/issues/832" target="_top">PulseAudio
          bug 832</a> for more information.
        </p></li><li class="listitem"><p>
          The zookeeper package does not provide
          <code class="literal">zooInspector.sh</code> anymore, as that
          "contrib" has been dropped from upstream releases.
        </p></li><li class="listitem"><p>
          In the ACME module, the data used to build the hash for the
          account directory has changed to accomodate new features to
          reduce account rate limit issues. This will trigger new
          account creation on the first rebuild following this update.
          No issues are expected to arise from this, thanks to the new
          account creation handling.
        </p></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-users.users._name_.createHome" target="_top">users.users.<span class="emphasis"><em>name</em></span>.createHome</a>
          now always ensures home directory permissions to be
          <code class="literal">0700</code>. Permissions had previously been
          ignored for already existing home directories, possibly
          leaving them readable by others. The option's description was
          incorrect regarding ownership management and has been
          simplified greatly.
        </p></li><li class="listitem"><p>
          When defining a new user, one of
          <a class="link" href="options.html#opt-users.users._name_.isNormalUser" target="_top">users.users.<span class="emphasis"><em>name</em></span>.isNormalUser</a>
          and
          <a class="link" href="options.html#opt-users.users._name_.isSystemUser" target="_top">users.users.<span class="emphasis"><em>name</em></span>.isSystemUser</a>
          is now required. This is to prevent accidentally giving a UID
          above 1000 to system users, which could have unexpected
          consequences, like running user activation scripts for system
          users. Note that users defined with an explicit UID below 500
          are exempted from this check, as
          <a class="link" href="options.html#opt-users.users._name_.isSystemUser" target="_top">users.users.<span class="emphasis"><em>name</em></span>.isSystemUser</a>
          has no effect for those.
        </p></li><li class="listitem"><p>
          The <code class="literal">security.apparmor</code> module, for the
          <a class="link" href="https://gitlab.com/apparmor/apparmor/-/wikis/Documentation" target="_top">AppArmor</a>
          Mandatory Access Control system, has been substantialy
          improved along with related tools, so that module maintainers
          can now more easily write AppArmor profiles for NixOS. The
          most notable change on the user-side is the new option
          <a class="link" href="options.html#opt-security.apparmor.policies" target="_top">security.apparmor.policies</a>,
          replacing the previous <code class="literal">profiles</code> option to
          provide a way to disable a profile and to select whether to
          confine in enforce mode (default) or in complain mode (see
          <code class="literal">journalctl -b --grep apparmor</code>).
          Security-minded users may also want to enable
          <a class="link" href="options.html#opt-security.apparmor.killUnconfinedConfinables" target="_top">security.apparmor.killUnconfinedConfinables</a>,
          at the cost of having some of their processes killed when
          updating to a NixOS version introducing new AppArmor profiles.
        </p></li><li class="listitem"><p>
          The GNOME desktop manager once again installs gnome.epiphany
          by default.
        </p></li><li class="listitem"><p>
          NixOS now generates empty <code class="literal">/etc/netgroup</code>.
          <code class="literal">/etc/netgroup</code> defines network-wide groups
          and may affect to setups using NIS.
        </p></li><li class="listitem"><p>
          Platforms, like <code class="literal">stdenv.hostPlatform</code>, no
          longer have a <code class="literal">platform</code> attribute. It has
          been (mostly) flattened away:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">platform.gcc</code> is now
              <code class="literal">gcc</code>
            </p></li><li class="listitem"><p>
              <code class="literal">platform.kernel*</code> is now
              <code class="literal">linux-kernel.*</code>
            </p></li></ul></div><p>
          Additionally, <code class="literal">platform.kernelArch</code> moved to
          the top level as <code class="literal">linuxArch</code> to match the
          other <code class="literal">*Arch</code> variables.
        </p><p>
          The <code class="literal">platform</code> grouping of these things never
          meant anything, and was just a historial/implementation
          artifact that was overdue removal.
        </p></li><li class="listitem"><p>
          <code class="literal">services.restic</code> now uses a dedicated cache
          directory for every backup defined in
          <code class="literal">services.restic.backups</code>. The old global
          cache directory, <code class="literal">/root/.cache/restic</code>, is
          now unused and can be removed to free up disk space.
        </p></li><li class="listitem"><p>
          <code class="literal">isync</code>: The <code class="literal">isync</code>
          compatibility wrapper was removed and the Master/Slave
          terminology has been deprecated and should be replaced with
          Far/Near in the configuration file.
        </p></li><li class="listitem"><p>
          The nix-gc service now accepts randomizedDelaySec (default: 0)
          and persistent (default: true) parameters. By default nix-gc
          will now run immediately if it would have been triggered at
          least once during the time when the timer was inactive.
        </p></li><li class="listitem"><p>
          The <code class="literal">rustPlatform.buildRustPackage</code> function
          is split into several hooks: cargoSetupHook to set up
          vendoring for Cargo-based projects, cargoBuildHook to build a
          project using Cargo, cargoInstallHook to install a project
          using Cargo, and cargoCheckHook to run tests in Cargo-based
          projects. With this change, mixed-language projects can use
          the relevant hooks within builders other than
          <code class="literal">buildRustPackage</code>. However, these changes
          also required several API changes to
          <code class="literal">buildRustPackage</code> itself:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <code class="literal">target</code> argument was removed.
              Instead, <code class="literal">buildRustPackage</code> will always
              use the same target as the C/C++ compiler that is used.
            </p></li><li class="listitem"><p>
              The <code class="literal">cargoParallelTestThreads</code> argument
              was removed. Parallel tests are now disabled through
              <code class="literal">dontUseCargoParallelTests</code>.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">rustPlatform.maturinBuildHook</code> hook was
          added. This hook can be used with
          <code class="literal">buildPythonPackage</code> to build Python packages
          that are written in Rust and use Maturin as their build tool.
        </p></li><li class="listitem"><p>
          Kubernetes has
          <a class="link" href="https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/" target="_top">deprecated
          docker</a> as container runtime. As a consequence, the
          Kubernetes module now has support for configuration of custom
          remote container runtimes and enables containerd by default.
          Note that containerd is more strict regarding container image
          OCI-compliance. As an example, images with CMD or ENTRYPOINT
          defined as strings (not lists) will fail on containerd, while
          working fine on docker. Please test your setup and container
          images with containerd prior to upgrading.
        </p></li><li class="listitem"><p>
          The GitLab module now has support for automatic backups. A
          schedule can be set with the
          <a class="link" href="options.html#opt-services.gitlab.backup.startAt" target="_top">services.gitlab.backup.startAt</a>
          option.
        </p></li><li class="listitem"><p>
          Prior to this release, systemd would also read system units
          from an undocumented
          <code class="literal">/etc/systemd-mutable/system</code> path. This path
          has been dropped from the defaults. That path (or others) can
          be re-enabled by adding it to the
          <a class="link" href="options.html#opt-boot.extraSystemdUnitPaths" target="_top">boot.extraSystemdUnitPaths</a>
          list.
        </p></li><li class="listitem"><p>
          PostgreSQL 9.5 is scheduled EOL during the 21.05 life cycle
          and has been removed.
        </p></li><li class="listitem"><p>
          <a class="link" href="https://www.xfce.org/" target="_top">Xfce4</a> relies
          on GIO/GVfs for userspace virtual filesystem access in
          applications like
          <a class="link" href="https://docs.xfce.org/xfce/thunar/" target="_top">thunar</a>
          and
          <a class="link" href="https://docs.xfce.org/apps/gigolo/" target="_top">gigolo</a>.
          For that to work, the gvfs nixos service is enabled by
          default, and it can be configured with the specific package
          that provides GVfs. Until now Xfce4 was setting it to use a
          lighter version of GVfs (without support for samba). To avoid
          conflicts with other desktop environments this setting has
          been dropped. Users that still want it should add the
          following to their system configuration:
        </p><pre class="programlisting">
{
  services.gvfs.package = pkgs.gvfs.override { samba = null; };
}
</pre></li><li class="listitem"><p>
          The newly enabled <code class="literal">systemd-pstore.service</code>
          now automatically evacuates crashdumps and panic logs from the
          persistent storage to
          <code class="literal">/var/lib/systemd/pstore</code>. This prevents
          NVRAM from filling up, which ensures the latest diagnostic
          data is always stored and alleviates problems with writing new
          boot configurations.
        </p></li><li class="listitem"><p>
          Nixpkgs now contains
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/118232" target="_top">automatically
          packaged GNOME Shell extensions</a> from the
          <a class="link" href="https://extensions.gnome.org/" target="_top">GNOME
          Extensions</a> portal. You can find them, filed by their
          UUID, under <code class="literal">gnome38Extensions</code> attribute for
          GNOME 3.38 and under <code class="literal">gnome40Extensions</code> for
          GNOME 40. Finally, the <code class="literal">gnomeExtensions</code>
          attribute contains extensions for the latest GNOME Shell
          version in Nixpkgs, listed under a more human-friendly name.
          The unqualified attribute scope also contains manually
          packaged extensions. Note that the automatically packaged
          extensions are provided for convenience and are not checked or
          guaranteed to work.
        </p></li><li class="listitem"><p>
          Erlang/OTP versions older than R21 got dropped. We also
          dropped the cuter package, as it was purely an example of how
          to build a package. We also dropped <code class="literal">lfe_1_2</code>
          as it could not build with R21+. Moving forward, we expect to
          only support 3 yearly releases of OTP.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-20.09"></a>B.4. Release 20.09 (<span class="quote">“<span class="quote">Nightingale</span>”</span>, 2020.10/27)</h2></div></div></div><p>
    Support is planned until the end of June 2021, handing over to
    21.05. (Plans
    <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0080-nixos-release-schedule.md#core-changes" target="_top">
    have shifted</a> by two months since release of 20.09.)
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.09-highlights"></a>B.4.1. Highlights</h3></div></div></div><p>
      In addition to 7349 new, 14442 updated, and 8181 removed packages,
      this release has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Core version changes:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              gcc: 9.2.0 -&gt; 9.3.0
            </p></li><li class="listitem"><p>
              glibc: 2.30 -&gt; 2.31
            </p></li><li class="listitem"><p>
              linux: still defaults to 5.4.x, all supported kernels
              available
            </p></li><li class="listitem"><p>
              mesa: 19.3.5 -&gt; 20.1.7
            </p></li></ul></div></li><li class="listitem"><p>
          Desktop Environments:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              plasma5: 5.17.5 -&gt; 5.18.5
            </p></li><li class="listitem"><p>
              kdeApplications: 19.12.3 -&gt; 20.08.1
            </p></li><li class="listitem"><p>
              gnome3: 3.34 -&gt; 3.36, see its
              <a class="link" href="https://help.gnome.org/misc/release-notes/3.36/" target="_top">release
              notes</a>
            </p></li><li class="listitem"><p>
              cinnamon: added at 4.6
            </p></li><li class="listitem"><p>
              NixOS now distributes an official
              <a class="link" href="https://nixos.org/download.html#nixos-iso" target="_top">GNOME
              ISO</a>
            </p></li></ul></div></li><li class="listitem"><p>
          Programming Languages and Frameworks:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Agda ecosystem was heavily reworked (see more details
              below)
            </p></li><li class="listitem"><p>
              PHP now defaults to PHP 7.4, updated from 7.3
            </p></li><li class="listitem"><p>
              PHP 7.2 is no longer supported due to upstream not
              supporting this version for the entire lifecycle of the
              20.09 release
            </p></li><li class="listitem"><p>
              Python 3 now defaults to Python 3.8 instead of 3.7
            </p></li><li class="listitem"><p>
              Python 3.5 reached its upstream EOL at the end of
              September 2020: it has been removed from the list of
              available packages
            </p></li></ul></div></li><li class="listitem"><p>
          Databases and Service Monitoring:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              MariaDB has been updated to 10.4, MariaDB Galera to 26.4.
              Please read the related upgrade instructions under
              <a class="link" href="release-notes.html#sec-release-20.09-incompatibilities" title="B.4.3. Backward Incompatibilities">backwards
              incompatibilities</a> before upgrading.
            </p></li><li class="listitem"><p>
              Zabbix now defaults to 5.0, updated from 4.4. Please read
              related sections under
              <a class="link" href="release-notes.html#sec-release-20.09-incompatibilities" title="B.4.3. Backward Incompatibilities">backwards
              compatibilities</a> before upgrading.
            </p></li></ul></div></li><li class="listitem"><p>
          Major module changes:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Quickly configure a complete, private, self-hosted video
              conferencing solution with the new Jitsi Meet module.
            </p></li><li class="listitem"><p>
              Two new options,
              <a class="link" href="options.html#opt-services.openssh.authorizedKeysCommand" target="_top">authorizedKeysCommand</a>
              and
              <a class="link" href="options.html#opt-services.openssh.authorizedKeysCommandUser" target="_top">authorizedKeysCommandUser</a>,
              have been added to the <code class="literal">openssh</code> module.
              If you have <code class="literal">AuthorizedKeysCommand</code> in
              your
              <a class="link" href="options.html#opt-services.openssh.extraConfig" target="_top">services.openssh.extraConfig</a>
              you should make use of these new options instead.
            </p></li><li class="listitem"><p>
              There is a new module for Podman
              (<code class="literal">virtualisation.podman</code>), a drop-in
              replacement for the Docker command line.
            </p></li><li class="listitem"><p>
              The new <code class="literal">virtualisation.containers</code>
              module manages configuration shared by the CRI-O and
              Podman modules.
            </p></li><li class="listitem"><p>
              Declarative Docker containers are renamed from
              <code class="literal">docker-containers</code> to
              <code class="literal">virtualisation.oci-containers.containers</code>.
              This is to make it possible to use
              <code class="literal">podman</code> instead of
              <code class="literal">docker</code>.
            </p></li><li class="listitem"><p>
              The new option
              <a class="link" href="options.html#opt-documentation.man.generateCaches" target="_top">documentation.man.generateCaches</a>
              has been added to automatically generate the
              <code class="literal">man-db</code> caches, which are needed by
              utilities like <code class="literal">whatis</code> and
              <code class="literal">apropos</code>. The caches are generated
              during the build of the NixOS configuration: since this
              can be expensive when a large number of packages are
              installed, the feature is disabled by default.
            </p></li><li class="listitem"><p>
              <code class="literal">services.postfix.sslCACert</code> was replaced
              by
              <code class="literal">services.postfix.tlsTrustedAuthorities</code>
              which now defaults to system certificate authorities.
            </p></li><li class="listitem"><p>
              The various documented workarounds to use steam have been
              converted to a module.
              <code class="literal">programs.steam.enable</code> enables steam,
              controller support and the workarounds.
            </p></li><li class="listitem"><p>
              Support for built-in LCDs in various pieces of Logitech
              hardware (keyboards and USB speakers).
              <code class="literal">hardware.logitech.lcd.enable</code> enables
              support for all hardware supported by the
              <a class="link" href="https://sourceforge.net/projects/g15daemon/" target="_top">g15daemon
              project</a>.
            </p></li><li class="listitem"><p>
              The GRUB module gained support for basic password
              protection, which allows to restrict non-default entries
              in the boot menu to one or more users. The users and
              passwords are defined via the option
              <code class="literal">boot.loader.grub.users</code>. Note: Password
              support is only available in GRUB version 2.
            </p></li></ul></div></li><li class="listitem"><p>
          NixOS module changes:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The NixOS module system now supports freeform modules as a
              mix between <code class="literal">types.attrsOf</code> and
              <code class="literal">types.submodule</code>. These allow you to
              explicitly declare a subset of options while still
              permitting definitions without an associated option. See
              <a class="xref" href="index.html#sec-freeform-modules" title="66.8. Freeform modules">Section 66.8, “Freeform modules”</a> for how to use
              them.
            </p></li><li class="listitem"><p>
              Following its deprecation in 20.03, the Perl NixOS test
              driver has been removed. All remaining tests have been
              ported to the Python test framework. Code outside nixpkgs
              using <code class="literal">make-test.nix</code> or
              <code class="literal">testing.nix</code> needs to be ported to
              <code class="literal">make-test-python.nix</code> and
              <code class="literal">testing-python.nix</code> respectively.
            </p></li><li class="listitem"><p>
              Subordinate GID and UID mappings are now set up
              automatically for all normal users. This will make
              container tools like Podman work as non-root users out of
              the box.
            </p></li></ul></div></li><li class="listitem"><p>
          Starting with this release, the hydra-build-result
          <code class="literal">nixos-YY.MM</code> branches no longer exist in the
          <a class="link" href="https://github.com/nixos/nixpkgs-channels" target="_top">deprecated
          nixpkgs-channels repository</a>. These branches are now in
          <a class="link" href="https://github.com/nixos/nixpkgs" target="_top">the main
          nixpkgs repository</a>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.09-new-services"></a>B.4.2. New Services</h3></div></div></div><p>
      In addition to 1119 new, 118 updated, and 476 removed options; 61
      new modules were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Hardware:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-hardware.system76.firmware-daemon.enable" target="_top">hardware.system76.firmware-daemon.enable</a>
              adds easy support of system76 firmware
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-hardware.uinput.enable" target="_top">hardware.uinput.enable</a>
              loads uinput kernel module
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-hardware.video.hidpi.enable" target="_top">hardware.video.hidpi.enable</a>
              enable good defaults for HiDPI displays
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-hardware.wooting.enable" target="_top">hardware.wooting.enable</a>
              support for Wooting keyboards
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-hardware.xpadneo.enable" target="_top">hardware.xpadneo.enable</a>
              xpadneo driver for Xbox One wireless controllers
            </p></li></ul></div></li><li class="listitem"><p>
          Programs:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-programs.hamster.enable" target="_top">programs.hamster.enable</a>
              enable hamster time tracking
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-programs.steam.enable" target="_top">programs.steam.enable</a>
              adds easy enablement of steam and related system
              configuration
            </p></li></ul></div></li><li class="listitem"><p>
          Security:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-security.doas.enable" target="_top">security.doas.enable</a>
              alternative to sudo, allows non-root users to execute
              commands as root
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-security.tpm2.enable" target="_top">security.tpm2.enable</a>
              add Trusted Platform Module 2 support
            </p></li></ul></div></li><li class="listitem"><p>
          System:
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-boot.initrd.network.openvpn.enable" target="_top">boot.initrd.network.openvpn.enable</a>
              start an OpenVPN client during initrd boot
            </p></li></ul></div></li><li class="listitem"><p>
          Virtualization:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-boot.enableContainers" target="_top">boot.enableContainers</a>
              use nixos-containers
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-virtualisation.oci-containers.containers" target="_top">virtualisation.oci-containers.containers</a>
              run OCI (Docker) containers
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-virtualisation.podman.enable" target="_top">virtualisation.podman.enable</a>
              daemonless container engine
            </p></li></ul></div></li><li class="listitem"><p>
          Services:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.ankisyncd.enable" target="_top">services.ankisyncd.enable</a>
              Anki sync server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.bazarr.enable" target="_top">services.bazarr.enable</a>
              Subtitle manager for Sonarr and Radarr
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.biboumi.enable" target="_top">services.biboumi.enable</a>
              Biboumi XMPP gateway to IRC
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.blockbook-frontend" target="_top">services.blockbook-frontend</a>
              Blockbook-frontend, a service for the Trezor wallet
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.cage.enable" target="_top">services.cage.enable</a>
              Wayland cage service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.convos.enable" target="_top">services.convos.enable</a>
              IRC daemon, which can be accessed throught the browser
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.engelsystem.enable" target="_top">services.engelsystem.enable</a>
              Tool for coordinating volunteers and shifts on large
              events
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.espanso.enable" target="_top">services.espanso.enable</a>
              text-expander written in rust
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.foldingathome.enable" target="_top">services.foldingathome.enable</a>
              Folding@home client
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.gerrit.enable" target="_top">services.gerrit.enable</a>
              Web-based team code collaboration tool
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.go-neb.enable" target="_top">services.go-neb.enable</a>
              Matrix bot
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.hardware.xow.enable" target="_top">services.hardware.xow.enable</a>
              xow as a systemd service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.hercules-ci-agent.enable" target="_top">services.hercules-ci-agent.enable</a>
              Hercules CI build agent
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.jicofo.enable" target="_top">services.jicofo.enable</a>
              Jitsi Conference Focus, component of Jitsi Meet
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.jirafeau.enable" target="_top">services.jirafeau.enable</a>
              A web file repository
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.jitsi-meet.enable" target="_top">services.jitsi-meet.enable</a>
              Secure, simple and scalable video conferences
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.jitsi-videobridge.enable" target="_top">services.jitsi-videobridge.enable</a>
              Jitsi Videobridge, a WebRTC compatible router
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.jupyterhub.enable" target="_top">services.jupyterhub.enable</a>
              Jupyterhub development server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.k3s.enable" target="_top">services.k3s.enable</a>
              Lightweight Kubernetes distribution
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.magic-wormhole-mailbox-server.enable" target="_top">services.magic-wormhole-mailbox-server.enable</a>
              Magic Wormhole Mailbox Server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.malcontent.enable" target="_top">services.malcontent.enable</a>
              Parental Control support
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.matrix-appservice-discord.enable" target="_top">services.matrix-appservice-discord.enable</a>
              Matrix and Discord bridge
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.mautrix-telegram.enable" target="_top">services.mautrix-telegram.enable</a>
              Matrix-Telegram puppeting/relaybot bridge
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.mirakurun.enable" target="_top">services.mirakurun.enable</a>
              Japanese DTV Tuner Server Service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.molly-brown.enable" target="_top">services.molly-brown.enable</a>
              Molly-Brown Gemini server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.mullvad-vpn.enable" target="_top">services.mullvad-vpn.enable</a>
              Mullvad VPN daemon
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.ncdns.enable" target="_top">services.ncdns.enable</a>
              Namecoin to DNS bridge
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.nextdns.enable" target="_top">services.nextdns.enable</a>
              NextDNS to DoH Proxy service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.nix-store-gcs-proxy" target="_top">services.nix-store-gcs-proxy</a>
              Google storage bucket to be used as a nix store
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.onedrive.enable" target="_top">services.onedrive.enable</a>
              OneDrive sync service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.pinnwand.enable" target="_top">services.pinnwand.enable</a>
              Pastebin-like service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.pixiecore.enable" target="_top">services.pixiecore.enable</a>
              Manage network booting of machines
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.privacyidea.enable" target="_top">services.privacyidea.enable</a>
              Privacy authentication server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.quorum.enable" target="_top">services.quorum.enable</a>
              Quorum blockchain daemon
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.robustirc-bridge.enable" target="_top">services.robustirc-bridge.enable</a>
              RobustIRC bridge
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.rss-bridge.enable" target="_top">services.rss-bridge.enable</a>
              Generate RSS and Atom feeds
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.rtorrent.enable" target="_top">services.rtorrent.enable</a>
              rTorrent service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.smartdns.enable" target="_top">services.smartdns.enable</a>
              SmartDNS DNS server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.sogo.enable" target="_top">services.sogo.enable</a>
              SOGo groupware
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.teeworlds.enable" target="_top">services.teeworlds.enable</a>
              Teeworlds game server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.torque.mom.enable" target="_top">services.torque.mom.enable</a>
              torque computing node
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.torque.server.enable" target="_top">services.torque.server.enable</a>
              torque server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.tuptime.enable" target="_top">services.tuptime.enable</a>
              A total uptime service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.urserver.enable" target="_top">services.urserver.enable</a>
              X11 remote server
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.wasabibackend.enable" target="_top">services.wasabibackend.enable</a>
              Wasabi backend service
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.yubikey-agent.enable" target="_top">services.yubikey-agent.enable</a>
              Yubikey agent
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.zigbee2mqtt.enable" target="_top">services.zigbee2mqtt.enable</a>
              Zigbee to MQTT bridge
            </p></li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.09-incompatibilities"></a>B.4.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          MariaDB has been updated to 10.4, MariaDB Galera to 26.4.
          Before you upgrade, it would be best to take a backup of your
          database. For MariaDB Galera Cluster, see
          <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-103-to-mariadb-104-with-galera-cluster/" target="_top">Upgrading
          from MariaDB 10.3 to MariaDB 10.4 with Galera Cluster</a>
          instead. Before doing the upgrade read
          <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-103-to-mariadb-104/#incompatible-changes-between-103-and-104" target="_top">Incompatible
          Changes Between 10.3 and 10.4</a>. After the upgrade you
          will need to run <code class="literal">mysql_upgrade</code>. MariaDB
          10.4 introduces a number of changes to the authentication
          process, intended to make things easier and more intuitive.
          See
          <a class="link" href="https://mariadb.com/kb/en/authentication-from-mariadb-104/" target="_top">Authentication
          from MariaDB 10.4</a>. unix_socket auth plugin does not use
          a password, and uses the connecting user's UID instead. When a
          new MariaDB data directory is initialized, two MariaDB users
          are created and can be used with new unix_socket auth plugin,
          as well as traditional mysql_native_password plugin:
          root@localhost and mysql@localhost. To actually use the
          traditional mysql_native_password plugin method, one must run
          the following:
        </p><pre class="programlisting">
{
services.mysql.initialScript = pkgs.writeText "mariadb-init.sql" ''
  ALTER USER root@localhost IDENTIFIED VIA mysql_native_password USING PASSWORD("verysecret");
'';
}
</pre><p>
          When MariaDB data directory is just upgraded (not
          initialized), the users are not created or modified.
        </p></li><li class="listitem"><p>
          MySQL server is now started with additional systemd
          sandbox/hardening options for better security. The PrivateTmp,
          ProtectHome, and ProtectSystem options may be problematic when
          MySQL is attempting to read from or write to your filesystem
          anywhere outside of its own state directory, for example when
          calling
          <code class="literal">LOAD DATA INFILE or SELECT * INTO OUTFILE</code>.
          In this scenario a variant of the following may be required: -
          allow MySQL to read from /home and /tmp directories when using
          <code class="literal">LOAD DATA INFILE</code>
        </p><pre class="programlisting">
{
  systemd.services.mysql.serviceConfig.ProtectHome = lib.mkForce "read-only";
}
</pre><p>
          - allow MySQL to write to custom folder
          <code class="literal">/var/data</code> when using
          <code class="literal">SELECT * INTO OUTFILE</code>, assuming the mysql
          user has write access to <code class="literal">/var/data</code>
        </p><pre class="programlisting">
{
  systemd.services.mysql.serviceConfig.ReadWritePaths = [ "/var/data" ];
}
</pre><p>
          The MySQL service no longer runs its
          <code class="literal">systemd</code> service startup script as
          <code class="literal">root</code> anymore. A dedicated non
          <code class="literal">root</code> super user account is required for
          operation. This means users with an existing MySQL or MariaDB
          database server are required to run the following SQL
          statements as a super admin user before upgrading:
        </p><pre class="programlisting">
CREATE USER IF NOT EXISTS 'mysql'@'localhost' identified with unix_socket;
GRANT ALL PRIVILEGES ON *.* TO 'mysql'@'localhost' WITH GRANT OPTION;
</pre><p>
          If you use MySQL instead of MariaDB please replace
          <code class="literal">unix_socket</code> with
          <code class="literal">auth_socket</code>. If you have changed the value
          of
          <a class="link" href="options.html#opt-services.mysql.user" target="_top">services.mysql.user</a>
          from the default of <code class="literal">mysql</code> to a different
          user please change <code class="literal">'mysql'@'localhost'</code> to
          the corresponding user instead.
        </p></li><li class="listitem"><p>
          Zabbix now defaults to 5.0, updated from 4.4. Please carefully
          read through
          <a class="link" href="https://www.zabbix.com/documentation/current/manual/installation/upgrade/sources" target="_top">the
          upgrade guide</a> and apply any changes required. Be sure
          to take special note of the section on
          <a class="link" href="https://www.zabbix.com/documentation/current/manual/installation/upgrade_notes_500#enabling_extended_range_of_numeric_float_values" target="_top">enabling
          extended range of numeric (float) values</a> as you will
          need to apply this database migration manually.
        </p><p>
          If you are using Zabbix Server with a MySQL or MariaDB
          database you should note that using a character set of
          <code class="literal">utf8</code> and a collate of
          <code class="literal">utf8_bin</code> has become mandatory with this
          release. See the upstream
          <a class="link" href="https://support.zabbix.com/browse/ZBX-17357" target="_top">issue</a>
          for further discussion. Before upgrading you should check the
          character set and collation used by your database and ensure
          they are correct:
        </p><pre class="programlisting">
SELECT
  default_character_set_name,
  default_collation_name
FROM
  information_schema.schemata
WHERE
  schema_name = 'zabbix';
</pre><p>
          If these values are not correct you should take a backup of
          your database and convert the character set and collation as
          required. Here is an
          <a class="link" href="https://www.zabbix.com/forum/zabbix-help/396573-reinstall-after-upgrade?p=396891#post396891" target="_top">example</a>
          of how to do so, taken from the Zabbix forums:
        </p><pre class="programlisting">
ALTER DATABASE `zabbix` DEFAULT CHARACTER SET utf8 COLLATE utf8_bin;

-- the following will produce a list of SQL commands you should subsequently execute
SELECT CONCAT("ALTER TABLE ", TABLE_NAME," CONVERT TO CHARACTER SET utf8 COLLATE utf8_bin;") AS ExecuteTheString
FROM information_schema.`COLUMNS`
WHERE table_schema = "zabbix" AND COLLATION_NAME = "utf8_general_ci";
</pre></li><li class="listitem"><p>
          maxx package removed along with
          <code class="literal">services.xserver.desktopManager.maxx</code>
          module. Please migrate to cdesktopenv and
          <code class="literal">services.xserver.desktopManager.cde</code> module.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.matrix-synapse.enable" target="_top">matrix-synapse</a>
          module no longer includes optional dependencies by default,
          they have to be added through the
          <a class="link" href="options.html#opt-services.matrix-synapse.plugins" target="_top">plugins</a>
          option.
        </p></li><li class="listitem"><p>
          <code class="literal">buildGoModule</code> now internally creates a
          vendor directory in the source tree for downloaded modules
          instead of using go's
          <a class="link" href="https://golang.org/cmd/go/#hdr-Module_proxy_protocol" target="_top">module
          proxy protocol</a>. This storage format is simpler and
          therefore less likely to break with future versions of go. As
          a result <code class="literal">buildGoModule</code> switched from
          <code class="literal">modSha256</code> to the
          <code class="literal">vendorSha256</code> attribute to pin fetched
          version data.
        </p></li><li class="listitem"><p>
          Grafana is now built without support for phantomjs by default.
          Phantomjs support has been
          <a class="link" href="https://grafana.com/docs/grafana/latest/guides/whats-new-in-v6-4/" target="_top">deprecated
          in Grafana</a> and the phantomjs project is
          <a class="link" href="https://github.com/ariya/phantomjs/issues/15344#issue-302015362" target="_top">currently
          unmaintained</a>. It can still be enabled by providing
          <code class="literal">phantomJsSupport = true</code> to the package
          instantiation:
        </p><pre class="programlisting">
{
  services.grafana.package = pkgs.grafana.overrideAttrs (oldAttrs: rec {
    phantomJsSupport = true;
  });
}
</pre></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.supybot.enable" target="_top">supybot</a>
          module now uses <code class="literal">/var/lib/supybot</code> as its
          default
          <a class="link" href="options.html#opt-services.supybot.stateDir" target="_top">stateDir</a>
          path if <code class="literal">stateVersion</code> is 20.09 or higher. It
          also enables a number of
          <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Sandboxing" target="_top">systemd
          sandboxing options</a> which may possibly interfere with
          some plugins. If this is the case you can disable the options
          through attributes in
          <code class="literal">systemd.services.supybot.serviceConfig</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">security.duosec.skey</code> option, which
          stored a secret in the nix store, has been replaced by a new
          <a class="link" href="options.html#opt-security.duosec.secretKeyFile" target="_top">security.duosec.secretKeyFile</a>
          option for better security.
        </p><p>
          <code class="literal">security.duosec.ikey</code> has been renamed to
          <a class="link" href="options.html#opt-security.duosec.integrationKey" target="_top">security.duosec.integrationKey</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">vmware</code> has been removed from the
          <code class="literal">services.x11.videoDrivers</code> defaults. For
          VMWare guests set
          <code class="literal">virtualisation.vmware.guest.enable</code> to
          <code class="literal">true</code> which will include the appropriate
          drivers.
        </p></li><li class="listitem"><p>
          The initrd SSH support now uses OpenSSH rather than Dropbear
          to allow the use of Ed25519 keys and other OpenSSH-specific
          functionality. Host keys must now be in the OpenSSH format,
          and at least one pre-generated key must be specified.
        </p><p>
          If you used the
          <code class="literal">boot.initrd.network.ssh.host*Key</code> options,
          you'll get an error explaining how to convert your host keys
          and migrate to the new
          <code class="literal">boot.initrd.network.ssh.hostKeys</code> option.
          Otherwise, if you don't have any host keys set, you'll need to
          generate some; see the <code class="literal">hostKeys</code> option
          documentation for instructions.
        </p></li><li class="listitem"><p>
          Since this release there's an easy way to customize your PHP
          install to get a much smaller base PHP with only wanted
          extensions enabled. See the following snippet installing a
          smaller PHP with the extensions <code class="literal">imagick</code>,
          <code class="literal">opcache</code>, <code class="literal">pdo</code> and
          <code class="literal">pdo_mysql</code> loaded:
        </p><pre class="programlisting">
{
  environment.systemPackages = [
    (pkgs.php.withExtensions
      ({ all, ... }: with all; [
        imagick
        opcache
        pdo
        pdo_mysql
      ])
    )
  ];
}
</pre><p>
          The default <code class="literal">php</code> attribute hasn't lost any
          extensions. The <code class="literal">opcache</code> extension has been
          added. All upstream PHP extensions are available under
          php.extensions.&lt;name?&gt;.
        </p><p>
          All PHP <code class="literal">config</code> flags have been removed for
          the following reasons:
        </p></li><li class="listitem"><p>
          The updated <code class="literal">php</code> attribute is now easily
          customizable to your liking by using
          <code class="literal">php.withExtensions</code> or
          <code class="literal">php.buildEnv</code> instead of writing config
          files or changing configure flags.
        </p></li><li class="listitem"><p>
          The remaining configuration flags can now be set directly on
          the <code class="literal">php</code> attribute. For example, instead of
        </p><pre class="programlisting">
{
  php.override {
    config.php.embed = true;
    config.php.apxs2 = false;
  }
}
</pre><p>
          you should now write
        </p><pre class="programlisting">
{
  php.override {
    embedSupport = true;
    apxs2Support = false;
  }
}
</pre></li><li class="listitem"><p>
          The ACME module has been overhauled for simplicity and
          maintainability. Cert generation now implicitly uses the
          <code class="literal">acme</code> user, and the
          <code class="literal">security.acme.certs._name_.user</code> option has
          been removed. Instead, certificate access from other services
          is now managed through group permissions. The module no longer
          runs lego twice under certain conditions, and will correctly
          renew certificates if their configuration is changed. Services
          which reload nginx and httpd after certificate renewal are now
          properly configured too so you no longer have to do this
          manually if you are using HTTPS enabled virtual hosts. A
          mechanism for regenerating certs on demand has also been added
          and documented.
        </p></li><li class="listitem"><p>
          Gollum received a major update to version 5.x and you may have
          to change some links in your wiki when migrating from gollum
          4.x. More information can be found
          <a class="link" href="https://github.com/gollum/gollum/wiki/5.0-release-notes#migrating-your-wiki" target="_top">here</a>.
        </p></li><li class="listitem"><p>
          Deluge 2.x was added and is used as default for new NixOS
          installations where stateVersion is &gt;= 20.09. If you are
          upgrading from a previous NixOS version, you can set
          <code class="literal">service.deluge.package = pkgs.deluge-2_x</code> to
          upgrade to Deluge 2.x and migrate the state to the new format.
          Be aware that backwards state migrations are not supported by
          Deluge.
        </p></li><li class="listitem"><p>
          Nginx web server now starting with additional
          sandbox/hardening options. By default, write access to
          <code class="literal">/var/log/nginx</code> and
          <code class="literal">/var/cache/nginx</code> is allowed. To allow
          writing to other folders, use
          <code class="literal">systemd.services.nginx.serviceConfig.ReadWritePaths</code>
        </p><pre class="programlisting">
{
  systemd.services.nginx.serviceConfig.ReadWritePaths = [ "/var/www" ];
}
</pre><p>
          Nginx is also started with the systemd option
          <code class="literal">ProtectHome = mkDefault true;</code> which forbids
          it to read anything from <code class="literal">/home</code>,
          <code class="literal">/root</code> and <code class="literal">/run/user</code> (see
          <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectHome=" target="_top">ProtectHome
          docs</a> for details). If you require serving files from
          home directories, you may choose to set e.g.
        </p><pre class="programlisting">
{
  systemd.services.nginx.serviceConfig.ProtectHome = "read-only";
}
</pre></li><li class="listitem"><p>
          The NixOS options <code class="literal">nesting.clone</code> and
          <code class="literal">nesting.children</code> have been deleted, and
          replaced with named
          <a class="link" href="options.html#opt-specialisation" target="_top">specialisation</a>
          configurations.
        </p><p>
          Replace a <code class="literal">nesting.clone</code> entry with:
        </p><pre class="programlisting">
{
  specialisation.example-sub-configuration = {
    configuration = {
      ...
    };
};
</pre><p>
          Replace a <code class="literal">nesting.children</code> entry with:
        </p><pre class="programlisting">
{
  specialisation.example-sub-configuration = {
    inheritParentConfig = false;
    configuration = {
      ...
    };
};
</pre><p>
          To switch to a specialised configuration at runtime you need
          to run:
        </p><pre class="programlisting">
$ sudo /run/current-system/specialisation/example-sub-configuration/bin/switch-to-configuration test
</pre><p>
          Before you would have used:
        </p><pre class="programlisting">
$ sudo /run/current-system/fine-tune/child-1/bin/switch-to-configuration test
</pre></li><li class="listitem"><p>
          The Nginx log directory has been moved to
          <code class="literal">/var/log/nginx</code>, the cache directory to
          <code class="literal">/var/cache/nginx</code>. The option
          <code class="literal">services.nginx.stateDir</code> has been removed.
        </p></li><li class="listitem"><p>
          The httpd web server previously started its main process as
          root privileged, then ran worker processes as a less
          privileged identity user. This was changed to start all of
          httpd as a less privileged user (defined by
          <a class="link" href="options.html#opt-services.httpd.user" target="_top">services.httpd.user</a>
          and
          <a class="link" href="options.html#opt-services.httpd.group" target="_top">services.httpd.group</a>).
          As a consequence, all files that are needed for httpd to run
          (included configuration fragments, SSL certificates and keys,
          etc.) must now be readable by this less privileged user/group.
        </p><p>
          The default value for
          <a class="link" href="options.html#opt-services.httpd.mpm" target="_top">services.httpd.mpm</a>
          has been changed from <code class="literal">prefork</code> to
          <code class="literal">event</code>. Along with this change the default
          value for
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.http2</a>
          has been set to <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">systemd-networkd</code> option
          <code class="literal">systemd.network.networks.&lt;name&gt;.dhcp.CriticalConnection</code>
          has been removed following upstream systemd's deprecation of
          the same. It is recommended to use
          <code class="literal">systemd.network.networks.&lt;name&gt;.networkConfig.KeepConfiguration</code>
          instead. See systemd.network 5 for details.
        </p></li><li class="listitem"><p>
          The <code class="literal">systemd-networkd</code> option
          <code class="literal">systemd.network.networks._name_.dhcpConfig</code>
          has been renamed to
          <a class="link" href="options.html#opt-systemd.network.networks._name_.dhcpV4Config" target="_top">systemd.network.networks.<span class="emphasis"><em>name</em></span>.dhcpV4Config</a>
          following upstream systemd's documentation change. See
          systemd.network 5 for details.
        </p></li><li class="listitem"><p>
          In the <code class="literal">picom</code> module, several options that
          accepted floating point numbers encoded as strings (for
          example
          <a class="link" href="options.html#opt-services.picom.activeOpacity" target="_top">services.picom.activeOpacity</a>)
          have been changed to the (relatively) new native
          <code class="literal">float</code> type. To migrate your configuration
          simply remove the quotes around the numbers.
        </p></li><li class="listitem"><p>
          When using <code class="literal">buildBazelPackage</code> from Nixpkgs,
          <code class="literal">flat</code> hash mode is now used for dependencies
          instead of <code class="literal">recursive</code>. This is to better
          allow using hashed mirrors where needed. As a result, these
          hashes will have changed.
        </p></li><li class="listitem"><p>
          The syntax of the PostgreSQL configuration file is now checked
          at build time. If your configuration includes a file
          inaccessible inside the build sandbox, set
          <code class="literal">services.postgresql.checkConfig</code> to
          <code class="literal">false</code>.
        </p></li><li class="listitem"><p>
          The rkt module has been removed, it was archived by upstream.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="https://bazaar.canonical.com" target="_top">Bazaar</a>
          VCS is unmaintained and, as consequence of the Python 2 EOL,
          the packages <code class="literal">bazaar</code> and
          <code class="literal">bazaarTools</code> were removed. Breezy, the
          backward compatible fork of Bazaar (see the
          <a class="link" href="https://www.jelmer.uk/breezy-intro.html" target="_top">announcement</a>),
          was packaged as <code class="literal">breezy</code> and can be used
          instead.
        </p><p>
          Regarding Nixpkgs, <code class="literal">fetchbzr</code>,
          <code class="literal">nix-prefetch-bzr</code> and Bazaar support in
          Hydra will continue to work through Breezy.
        </p></li><li class="listitem"><p>
          In addition to the hostname, the fully qualified domain name
          (FQDN), which consists of
          <code class="literal">${networking.hostName}</code> and
          <code class="literal">${networking.domain}</code> is now added to
          <code class="literal">/etc/hosts</code>, to allow local FQDN resolution,
          as used by the <code class="literal">hostname --fqdn</code> command and
          other applications that try to determine the FQDN. These new
          entries take precedence over entries from the DNS which could
          cause regressions in some very specific setups. Additionally
          the hostname is now resolved to <code class="literal">127.0.0.2</code>
          instead of <code class="literal">127.0.1.1</code> to be consistent with
          what <code class="literal">nss-myhostname</code> (from systemd) returns.
          The old behaviour can e.g. be restored by using
          <code class="literal">networking.hosts = lib.mkForce { "127.0.1.1" = [ config.networking.hostName ]; };</code>.
        </p></li><li class="listitem"><p>
          The hostname (<code class="literal">networking.hostName</code>) must now
          be a valid DNS label (see RFC 1035, RFC 1123) and as such must
          not contain the domain part. This means that the hostname must
          start with a letter or digit, end with a letter or digit, and
          have as interior characters only letters, digits, and hyphen.
          The maximum length is 63 characters. Additionally it is
          recommended to only use lower-case characters. If (e.g. for
          legacy reasons) a FQDN is required as the Linux kernel network
          node hostname (<code class="literal">uname --nodename</code>) the option
          <code class="literal">boot.kernel.sysctl."kernel.hostname"</code>
          can be used as a workaround (but be aware of the 64 character
          limit).
        </p></li><li class="listitem"><p>
          The GRUB specific option
          <code class="literal">boot.loader.grub.extraInitrd</code> has been
          replaced with the generic option
          <code class="literal">boot.initrd.secrets</code>. This option creates a
          secondary initrd from the specified files, rather than using a
          manually created initrd file. Due to an existing bug with
          <code class="literal">boot.loader.grub.extraInitrd</code>, it is not
          possible to directly boot an older generation that used that
          option. It is still possible to rollback to that generation if
          the required initrd file has not been deleted.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="https://github.com/okTurtles/dnschain" target="_top">DNSChain</a>
          package and NixOS module have been removed from Nixpkgs as the
          software is unmaintained and can't be built. For more
          information see issue
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/89205" target="_top">#89205</a>.
        </p></li><li class="listitem"><p>
          In the <code class="literal">resilio</code> module,
          <a class="link" href="options.html#opt-services.resilio.httpListenAddr" target="_top">services.resilio.httpListenAddr</a>
          has been changed to listen to <code class="literal">[::1]</code> instead
          of <code class="literal">0.0.0.0</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">sslh</code> has been updated to version
          <code class="literal">1.21</code>. The <code class="literal">ssl</code> probe must
          be renamed to <code class="literal">tls</code> in
          <a class="link" href="options.html#opt-services.sslh.appendConfig" target="_top">services.sslh.appendConfig</a>.
        </p></li><li class="listitem"><p>
          Users of <a class="link" href="http://openafs.org" target="_top">OpenAFS
          1.6</a> must upgrade their services to OpenAFS 1.8! In this
          release, the OpenAFS package version 1.6.24 is marked broken
          but can be used during transition to OpenAFS 1.8.x. Use the
          options
          <code class="literal">services.openafsClient.packages.module</code>,
          <code class="literal">services.openafsClient.packages.programs</code>
          and <code class="literal">services.openafsServer.package</code> to
          select a different OpenAFS package. OpenAFS 1.6 will be
          removed in the next release. The package
          <code class="literal">openafs</code> and the service options will then
          silently point to the OpenAFS 1.8 release.
        </p><p>
          See also the OpenAFS
          <a class="link" href="http://docs.openafs.org/AdminGuide/index.html" target="_top">Administrator
          Guide</a> for instructions. Beware of the following when
          updating servers:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The storage format of the server key has changed and the
              key must be converted before running the new release.
            </p></li><li class="listitem"><p>
              When updating multiple database servers, turn off the
              database servers from the highest IP down to the lowest
              with resting periods in between. Start up in reverse
              order. Do not concurrently run database servers working
              with different OpenAFS releases!
            </p></li><li class="listitem"><p>
              Update servers first, then clients.
            </p></li></ul></div></li><li class="listitem"><p>
          Radicale's default package has changed from 2.x to 3.x. An
          upgrade checklist can be found
          <a class="link" href="https://github.com/Kozea/Radicale/blob/3.0.x/NEWS.md#upgrade-checklist" target="_top">here</a>.
          You can use the newer version in the NixOS service by setting
          the <code class="literal">package</code> to
          <code class="literal">radicale3</code>, which is done automatically if
          <code class="literal">stateVersion</code> is 20.09 or higher.
        </p></li><li class="listitem"><p>
          <code class="literal">udpt</code> experienced a complete rewrite from
          C++ to rust. The configuration format changed from ini to
          toml. The new configuration documentation can be found at
          <a class="link" href="https://naim94a.github.io/udpt/config.html" target="_top">the
          official website</a> and example configuration is packaged
          in <code class="literal">${udpt}/share/udpt/udpt.toml</code>.
        </p></li><li class="listitem"><p>
          We now have a unified
          <a class="link" href="options.html#opt-services.xserver.displayManager.autoLogin" target="_top">services.xserver.displayManager.autoLogin</a>
          option interface to be used for every display-manager in
          NixOS.
        </p></li><li class="listitem"><p>
          The <code class="literal">bitcoind</code> module has changed to
          multi-instance, using submodules. Therefore, it is now
          mandatory to name each instance. To use this new
          multi-instance config with an existing bitcoind data directory
          and user, you have to adjust the original config, e.g.:
        </p><pre class="programlisting">
{
  services.bitcoind = {
    enable = true;
    extraConfig = "...";
    ...
  };
}
</pre><p>
          To something similar:
        </p><pre class="programlisting">
{
  services.bitcoind.mainnet = {
    enable = true;
    dataDir = "/var/lib/bitcoind";
    user = "bitcoin";
    extraConfig = "...";
    ...
  };
}
</pre><p>
          The key settings are:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">dataDir</code> - to continue using the same
              data directory.
            </p></li><li class="listitem"><p>
              <code class="literal">user</code> - to continue using the same user
              so that bitcoind maintains access to its files.
            </p></li></ul></div></li><li class="listitem"><p>
          Graylog introduced a change in the LDAP server certificate
          validation behaviour for version 3.3.3 which might break
          existing setups. When updating Graylog from a version before
          3.3.3 make sure to check the Graylog
          <a class="link" href="https://www.graylog.org/post/announcing-graylog-v3-3-3" target="_top">release
          info</a> for information on how to avoid the issue.
        </p></li><li class="listitem"><p>
          The <code class="literal">dokuwiki</code> module has changed to
          multi-instance, using submodules. Therefore, it is now
          mandatory to name each instance. Moreover, forcing SSL by
          default has been dropped, so <code class="literal">nginx.forceSSL</code>
          and <code class="literal">nginx.enableACME</code> are no longer set to
          <code class="literal">true</code>. To continue using your service with
          the original SSL settings, you have to adjust the original
          config, e.g.:
        </p><pre class="programlisting">
{
  services.dokuwiki = {
    enable = true;
    ...
  };
}
</pre><p>
          To something similar:
        </p><pre class="programlisting">
{
  services.dokuwiki."mywiki" = {
    enable = true;
    nginx = {
      forceSSL = true;
      enableACME = true;
    };
    ...
  };
}
</pre><p>
          The base package has also been upgraded to the 2020-07-29
          "Hogfather" release. Plugins might be incompatible
          or require upgrading.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.postgresql.dataDir" target="_top">services.postgresql.dataDir</a>
          option is now set to
          <code class="literal">"/var/lib/postgresql/${cfg.package.psqlSchema}"</code>
          regardless of your
          <a class="link" href="options.html#opt-system.stateVersion" target="_top">system.stateVersion</a>.
          Users with an existing postgresql install that have a
          <a class="link" href="options.html#opt-system.stateVersion" target="_top">system.stateVersion</a>
          of <code class="literal">17.03</code> or below should double check what
          the value of their
          <a class="link" href="options.html#opt-services.postgresql.dataDir" target="_top">services.postgresql.dataDir</a>
          option is (<code class="literal">/var/db/postgresql</code>) and then
          explicitly set this value to maintain compatibility:
        </p><pre class="programlisting">
{
  services.postgresql.dataDir = "/var/db/postgresql";
}
</pre><p>
          The postgresql module now expects there to be a database super
          user account called <code class="literal">postgres</code> regardless of
          your
          <a class="link" href="options.html#opt-system.stateVersion" target="_top">system.stateVersion</a>.
          Users with an existing postgresql install that have a
          <a class="link" href="options.html#opt-system.stateVersion" target="_top">system.stateVersion</a>
          of <code class="literal">17.03</code> or below should run the following
          SQL statements as a database super admin user before
          upgrading:
        </p><pre class="programlisting">
CREATE ROLE postgres LOGIN SUPERUSER;
</pre></li><li class="listitem"><p>
          The USBGuard module now removes options and instead hardcodes
          values for <code class="literal">IPCAccessControlFiles</code>,
          <code class="literal">ruleFiles</code>, and
          <code class="literal">auditFilePath</code>. Audit logs can be found in
          the journal.
        </p></li><li class="listitem"><p>
          The NixOS module system now evaluates option definitions more
          strictly, allowing it to detect a larger set of problems. As a
          result, what previously evaluated may not do so anymore. See
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/82743#issuecomment-674520472" target="_top">the
          PR that changed this</a> for more info.
        </p></li><li class="listitem"><p>
          For NixOS configuration options, the type
          <code class="literal">loaOf</code>, after its initial deprecation in
          release 20.03, has been removed. In NixOS and Nixpkgs options
          using this type have been converted to
          <code class="literal">attrsOf</code>. For more information on this
          change have look at these links:
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/1800" target="_top">issue
          #1800</a>,
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/63103" target="_top">PR
          #63103</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">config.systemd.services.${name}.path</code> now
          returns a list of paths instead of a colon-separated string.
        </p></li><li class="listitem"><p>
          Caddy module now uses Caddy v2 by default. Caddy v1 can still
          be used by setting
          <a class="link" href="options.html#opt-services.caddy.package" target="_top">services.caddy.package</a>
          to <code class="literal">pkgs.caddy1</code>.
        </p><p>
          New option
          <a class="link" href="options.html#opt-services.caddy.adapter" target="_top">services.caddy.adapter</a>
          has been added.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.jellyfin.enable" target="_top">jellyfin</a>
          module will use and stay on the Jellyfin version
          <code class="literal">10.5.5</code> if <code class="literal">stateVersion</code>
          is lower than <code class="literal">20.09</code>. This is because
          significant changes were made to the database schema, and it
          is highly recommended to backup your instance before
          upgrading. After making your backup, you can upgrade to the
          latest version either by setting your
          <code class="literal">stateVersion</code> to <code class="literal">20.09</code> or
          higher, or set the
          <code class="literal">services.jellyfin.package</code> to
          <code class="literal">pkgs.jellyfin</code>. If you do not wish to
          upgrade Jellyfin, but want to change your
          <code class="literal">stateVersion</code>, you can set the value of
          <code class="literal">services.jellyfin.package</code> to
          <code class="literal">pkgs.jellyfin_10_5</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">security.rngd</code> service is now disabled
          by default. This choice was made because there's krngd in the
          linux kernel space making it (for most usecases) functionally
          redundent.
        </p></li><li class="listitem"><p>
          The <code class="literal">hardware.nvidia.optimus_prime.enable</code>
          service has been renamed to
          <code class="literal">hardware.nvidia.prime.sync.enable</code> and has
          many new enhancements. Related nvidia prime settings may have
          also changed.
        </p></li><li class="listitem"><p>
          The package nextcloud17 has been removed and nextcloud18 was
          marked as insecure since both of them will
          <a class="link" href="https://docs.nextcloud.com/server/19/admin_manual/release_schedule.html" target="_top">
          will be EOL (end of life) within the lifetime of 20.09</a>.
        </p><p>
          It's necessary to upgrade to nextcloud19:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              From nextcloud17, you have to upgrade to nextcloud18 first
              as Nextcloud doesn't allow going multiple major revisions
              forward in a single upgrade. This is possible by setting
              <a class="link" href="options.html#opt-services.nextcloud.package" target="_top">services.nextcloud.package</a>
              to nextcloud18.
            </p></li><li class="listitem"><p>
              From nextcloud18, it's possible to directly upgrade to
              nextcloud19 by setting
              <a class="link" href="options.html#opt-services.nextcloud.package" target="_top">services.nextcloud.package</a>
              to nextcloud19.
            </p></li></ul></div></li><li class="listitem"><p>
          The GNOME desktop manager no longer default installs
          gnome3.epiphany. It was chosen to do this as it has a
          usability breaking issue (see issue
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/98819" target="_top">#98819</a>)
          that makes it unsuitable to be a default app.
        </p><div class="note"><h3 class="title">Note</h3><p>
            Issue
            <a class="link" href="https://github.com/NixOS/nixpkgs/issues/98819" target="_top">#98819</a>
            is now fixed and gnome3.epiphany is once again installed by
            default.
          </p></div></li><li class="listitem"><p>
          If you want to manage the configuration of wpa_supplicant
          outside of NixOS you must ensure that none of
          <a class="link" href="options.html#opt-networking.wireless.networks" target="_top">networking.wireless.networks</a>,
          <a class="link" href="options.html#opt-networking.wireless.extraConfig" target="_top">networking.wireless.extraConfig</a>
          or
          <a class="link" href="options.html#opt-networking.wireless.userControlled.enable" target="_top">networking.wireless.userControlled.enable</a>
          is being used or <code class="literal">true</code>. Using any of those
          options will cause wpa_supplicant to be started with a NixOS
          generated configuration file instead of your own.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.09-notable-changes"></a>B.4.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          SD images are now compressed by default using
          <code class="literal">zstd</code>. The compression for ISO images has
          also been changed to <code class="literal">zstd</code>, but ISO images
          are still not compressed by default.
        </p></li><li class="listitem"><p>
          <code class="literal">services.journald.rateLimitBurst</code> was
          updated from <code class="literal">1000</code> to
          <code class="literal">10000</code> to follow the new upstream systemd
          default.
        </p></li><li class="listitem"><p>
          The notmuch package moves its emacs-related binaries and emacs
          lisp files to a separate output. They're not part of the
          default <code class="literal">out</code> output anymore - if you relied
          on the <code class="literal">notmuch-emacs-mua</code> binary or the
          emacs lisp files, access them via the
          <code class="literal">notmuch.emacs</code> output.
        </p></li><li class="listitem"><p>
          Device tree overlay support was improved in
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/79370" target="_top">#79370</a>
          and now uses
          <a class="link" href="options.html#opt-hardware.deviceTree.kernelPackage" target="_top">hardware.deviceTree.kernelPackage</a>
          instead of <code class="literal">hardware.deviceTree.base</code>.
          <a class="link" href="options.html#opt-hardware.deviceTree.overlays" target="_top">hardware.deviceTree.overlays</a>
          configuration was extended to support <code class="literal">.dts</code>
          files with symbols. Device trees can now be filtered by
          setting
          <a class="link" href="options.html#opt-hardware.deviceTree.filter" target="_top">hardware.deviceTree.filter</a>
          option.
        </p></li><li class="listitem"><p>
          The default output of <code class="literal">buildGoPackage</code> is now
          <code class="literal">$out</code> instead of <code class="literal">$bin</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">buildGoModule</code> <code class="literal">doCheck</code>
          now defaults to <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          Packages built using <code class="literal">buildRustPackage</code> now
          use <code class="literal">release</code> mode for the
          <code class="literal">checkPhase</code> by default.
        </p><p>
          Please note that Rust packages utilizing a custom
          build/install procedure (e.g. by using a
          <code class="literal">Makefile</code>) or test suites that rely on the
          structure of the <code class="literal">target/</code> directory may
          break due to those assumptions. For further information,
          please read the Rust section in the Nixpkgs manual.
        </p></li><li class="listitem"><p>
          The cc- and binutils-wrapper's "infix salt" and
          <code class="literal">_BUILD_</code> and <code class="literal">_TARGET_</code>
          user infixes have been replaced with with a "suffix
          salt" and suffixes and <code class="literal">_FOR_BUILD</code> and
          <code class="literal">_FOR_TARGET</code>. This matches the autotools
          convention for env vars which standard for these things,
          making interfacing with other tools easier.
        </p></li><li class="listitem"><p>
          Additional Git documentation (HTML and text files) is now
          available via the <code class="literal">git-doc</code> package.
        </p></li><li class="listitem"><p>
          Default algorithm for ZRAM swap was changed to
          <code class="literal">zstd</code>.
        </p></li><li class="listitem"><p>
          The installer now enables sshd by default. This improves
          installation on headless machines especially ARM
          single-board-computer. To login through ssh, either a password
          or an ssh key must be set for the root user or the nixos user.
        </p></li><li class="listitem"><p>
          The scripted networking system now uses
          <code class="literal">.link</code> files in
          <code class="literal">/etc/systemd/network</code> to configure mac
          address and link MTU, instead of the sometimes buggy
          <code class="literal">network-link-*</code> units, which have been
          removed. Bringing the interface up has been moved to the
          beginning of the <code class="literal">network-addresses-*</code> unit.
          Note this doesn't require <code class="literal">systemd-networkd</code>
          - it's udev that parses <code class="literal">.link</code> files. Extra
          care needs to be taken in the presence of
          <a class="link" href="https://wiki.debian.org/NetworkInterfaceNames#THE_.22PERSISTENT_NAMES.22_SCHEME" target="_top">legacy
          udev rules</a> to rename interfaces, as MAC Address and MTU
          defined in these options can only match on the original link
          name. In such cases, you most likely want to create a
          <code class="literal">10-*.link</code> file through
          <a class="link" href="options.html#opt-systemd.network.links" target="_top">systemd.network.links</a>
          and set both name and MAC Address / MTU there.
        </p></li><li class="listitem"><p>
          Grafana received a major update to version 7.x. A plugin is
          now needed for image rendering support, and plugins must now
          be signed by default. More information can be found
          <a class="link" href="https://grafana.com/docs/grafana/latest/installation/upgrading/#upgrading-to-v7-0" target="_top">in
          the Grafana documentation</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">hardware.u2f</code> module, which was
          installing udev rules was removed, as udev gained native
          support to handle FIDO security tokens.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.transmission</code> module was
          enhanced with the new options:
          <a class="link" href="options.html#opt-services.transmission.credentialsFile" target="_top">services.transmission.credentialsFile</a>,
          <a class="link" href="options.html#opt-services.transmission.openFirewall" target="_top">services.transmission.openFirewall</a>,
          and
          <a class="link" href="options.html#opt-services.transmission.performanceNetParameters" target="_top">services.transmission.performanceNetParameters</a>.
        </p><p>
          <code class="literal">transmission-daemon</code> is now started with
          additional systemd sandbox/hardening options for better
          security. Please
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues" target="_top">report</a>
          any use case where this is not working well. In particular,
          the <code class="literal">RootDirectory</code> option newly set forbids
          uploading or downloading a torrent outside of the default
          directory configured at
          <a class="link" href="options.html#opt-services.transmission.settings" target="_top">settings.download-dir</a>.
          If you really need Transmission to access other directories,
          you must include those directories into the
          <code class="literal">BindPaths</code> of the service:
        </p><pre class="programlisting">
{
  systemd.services.transmission.serviceConfig.BindPaths = [ "/path/to/alternative/download-dir" ];
}
</pre><p>
          Also, connection to the RPC (Remote Procedure Call) of
          <code class="literal">transmission-daemon</code> is now only available
          on the local network interface by default. Use:
        </p><pre class="programlisting">
{
  services.transmission.settings.rpc-bind-address = "0.0.0.0";
}
</pre><p>
          to get the previous behavior of listening on all network
          interfaces.
        </p></li><li class="listitem"><p>
          With this release <code class="literal">systemd-networkd</code> (when
          enabled through
          <a class="link" href="options.html#opt-networking.useNetworkd" target="_top">networking.useNetworkd</a>)
          has it's netlink socket created through a
          <code class="literal">systemd.socket</code> unit. This gives us control
          over socket buffer sizes and other parameters. For larger
          setups where networkd has to create a lot of (virtual) devices
          the default buffer size (currently 128MB) is not enough.
        </p><p>
          On a machine with &gt;100 virtual interfaces (e.g., wireguard
          tunnels, VLANs, …), that all have to be brought up during
          system startup, the receive buffer size will spike for a brief
          period. Eventually some of the message will be dropped since
          there is not enough (permitted) buffer space available.
        </p><p>
          By having <code class="literal">systemd-networkd</code> start with a
          netlink socket created by <code class="literal">systemd</code> we can
          configure the <code class="literal">ReceiveBufferSize=</code> parameter
          in the socket options (i.e.
          <code class="literal">systemd.sockets.systemd-networkd.socketOptions.ReceiveBufferSize</code>)
          without recompiling <code class="literal">systemd-networkd</code>.
        </p><p>
          Since the actual memory requirements depend on hardware,
          timing, exact configurations etc. it isn't currently possible
          to infer a good default from within the NixOS module system.
          Administrators are advised to monitor the logs of
          <code class="literal">systemd-networkd</code> for
          <code class="literal">rtnl: kernel receive buffer overrun</code> spam
          and increase the memory limit as they see fit.
        </p><p>
          Note: Increasing the <code class="literal">ReceiveBufferSize=</code>
          doesn't allocate any memory. It just increases the upper bound
          on the kernel side. The memory allocation depends on the
          amount of messages that are queued on the kernel side of the
          netlink socket.
        </p></li><li class="listitem"><p>
          Specifying
          <a class="link" href="options.html#opt-services.dovecot2.mailboxes" target="_top">mailboxes</a>
          in the dovecot2 module as a list is deprecated and will break
          eval in 21.05. Instead, an attribute-set should be specified
          where the <code class="literal">name</code> should be the key of the
          attribute.
        </p><p>
          This means that a configuration like this
        </p><pre class="programlisting">
{
  services.dovecot2.mailboxes = [
    { name = "Junk";
      auto = "create";
    }
  ];
}
</pre><p>
          should now look like this:
        </p><pre class="programlisting">
{
  services.dovecot2.mailboxes = {
    Junk.auto = "create";
  };
}
</pre></li><li class="listitem"><p>
          netbeans was upgraded to 12.0 and now defaults to OpenJDK 11.
          This might cause problems if your projects depend on packages
          that were removed in Java 11.
        </p></li><li class="listitem"><p>
          nextcloud has been updated to
          <a class="link" href="https://nextcloud.com/blog/nextcloud-hub-brings-productivity-to-home-office/" target="_top">v19</a>.
        </p><p>
          If you have an existing installation, please make sure that
          you're on nextcloud18 before upgrading to nextcloud19 since
          Nextcloud doesn't support upgrades across multiple major
          versions.
        </p></li><li class="listitem"><p>
          The <code class="literal">nixos-run-vms</code> script now deletes the
          previous run machines states on test startup. You can use the
          <code class="literal">--keep-vm-state</code> flag to match the previous
          behaviour and keep the same VM state between different test
          runs.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-nix.buildMachines" target="_top">nix.buildMachines</a>
          option is now type-checked. There are no functional changes,
          however this may require updating some configurations to use
          correct types for all attributes.
        </p></li><li class="listitem"><p>
          The <code class="literal">fontconfig</code> module stopped generating
          config and cache files for fontconfig 2.10.x, the
          <code class="literal">/etc/fonts/fonts.conf</code> now belongs to the
          latest fontconfig, just like on other Linux distributions, and
          we will
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/95358" target="_top">no
          longer</a> be versioning the config directories.
        </p><p>
          Fontconfig 2.10.x was removed from Nixpkgs since it hasn’t
          been used in any Nixpkgs package for years now.
        </p></li><li class="listitem"><p>
          Nginx module
          <code class="literal">nginxModules.fastcgi-cache-purge</code> renamed to
          official name <code class="literal">nginxModules.cache-purge</code>.
          Nginx module <code class="literal">nginxModules.ngx_aws_auth</code>
          renamed to official name
          <code class="literal">nginxModules.aws-auth</code>.
        </p></li><li class="listitem"><p>
          The option <code class="literal">defaultPackages</code> was added. It
          installs the packages perl, rsync and strace for now. They
          were added unconditionally to
          <code class="literal">systemPackages</code> before, but are not strictly
          necessary for a minimal NixOS install. You can set it to an
          empty list to have a more minimal system. Be aware that some
          functionality might still have an impure dependency on those
          packages, so things might break.
        </p></li><li class="listitem"><p>
          The <code class="literal">undervolt</code> option no longer needs to
          apply its settings every 30s. If they still become undone,
          open an issue and restore the previous behaviour using
          <code class="literal">undervolt.useTimer</code>.
        </p></li><li class="listitem"><p>
          Agda has been heavily reworked.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">agda.mkDerivation</code> has been heavily
              changed and is now located at agdaPackages.mkDerivation.
            </p></li><li class="listitem"><p>
              New top-level packages agda and
              <code class="literal">agda.withPackages</code> have been added, the
              second of which sets up agda with access to chosen
              libraries.
            </p></li><li class="listitem"><p>
              All agda libraries now live under
              <code class="literal">agdaPackages</code>.
            </p></li><li class="listitem"><p>
              Many broken libraries have been removed.
            </p></li></ul></div><p>
          See the
          <a class="link" href="https://nixos.org/nixpkgs/manual/#agda" target="_top">new
          documentation</a> for more information.
        </p></li><li class="listitem"><p>
          The <code class="literal">deepin</code> package set has been removed
          from nixpkgs. It was a work in progress to package the
          <a class="link" href="https://www.deepin.org/en/dde/" target="_top">Deepin
          Desktop Environment (DDE)</a>, including libraries, tools
          and applications, and it was still missing a service to launch
          the desktop environment. It has shown to no longer be a
          feasible goal due to reasons discussed in
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/94870" target="_top">issue
          #94870</a>. The package
          <code class="literal">netease-cloud-music</code> has also been removed,
          as it depends on libraries from deepin.
        </p></li><li class="listitem"><p>
          The <code class="literal">opendkim</code> module now uses systemd
          sandboxing features to limit the exposure of the system
          towards the opendkim service.
        </p></li><li class="listitem"><p>
          Kubernetes has been upgraded to 1.19.1, which also means that
          the golang version to build it has been bumped to 1.15. This
          may have consequences for your existing clusters and their
          certificates. Please consider
          <a class="link" href="https://relnotes.k8s.io/?markdown=93264" target="_top">
          the release notes for Kubernetes 1.19 carefully </a> before
          upgrading.
        </p></li><li class="listitem"><p>
          For AMD GPUs, Vulkan can now be used by adding
          <code class="literal">amdvlk</code> to
          <code class="literal">hardware.opengl.extraPackages</code>.
        </p></li><li class="listitem"><p>
          Similarly, still for AMD GPUs, the ROCm OpenCL stack can now
          be used by adding <code class="literal">rocm-opencl-icd</code> to
          <code class="literal">hardware.opengl.extraPackages</code>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.09-contributions"></a>B.4.5. Contributions</h3></div></div></div><p>
      I, Jonathan Ringer, would like to thank the following individuals
      for their work on nixpkgs. This release could not be done without
      the hard work of the NixOS community. There were 31282
      contributions across 1313 contributors.
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          2288 Mario Rodas
        </p></li><li class="listitem"><p>
          1837 Frederik Rietdijk
        </p></li><li class="listitem"><p>
          946 Jörg Thalheim
        </p></li><li class="listitem"><p>
          925 Maximilian Bosch
        </p></li><li class="listitem"><p>
          687 Jonathan Ringer
        </p></li><li class="listitem"><p>
          651 Jan Tojnar
        </p></li><li class="listitem"><p>
          622 Daniël de Kok
        </p></li><li class="listitem"><p>
          605 WORLDofPEACE
        </p></li><li class="listitem"><p>
          597 Florian Klink
        </p></li><li class="listitem"><p>
          528 José Romildo Malaquias
        </p></li><li class="listitem"><p>
          281 volth
        </p></li><li class="listitem"><p>
          101 Robert Scott
        </p></li><li class="listitem"><p>
          86 Tim Steinbach
        </p></li><li class="listitem"><p>
          76 WORLDofPEACE
        </p></li><li class="listitem"><p>
          49 Maximilian Bosch
        </p></li><li class="listitem"><p>
          42 Thomas Tuegel
        </p></li><li class="listitem"><p>
          37 Doron Behar
        </p></li><li class="listitem"><p>
          36 Vladimír Čunát
        </p></li><li class="listitem"><p>
          27 Jonathan Ringer
        </p></li><li class="listitem"><p>
          27 Maciej Krüger
        </p></li></ol></div><p>
      I, Jonathan Ringer, would also like to personally thank
      @WORLDofPEACE for their help in mentoring me on the release
      process. Special thanks also goes to Thomas Tuegel for helping
      immensely with stabilizing Qt, KDE, and Plasma5; I would also like
      to thank Robert Scott for his numerous fixes and pull request
      reviews.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-20.03"></a>B.5. Release 20.03 (<span class="quote">“<span class="quote">Markhor</span>”</span>, 2020.04/20)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.03-highlights"></a>B.5.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Support is planned until the end of October 2020, handing over
          to 20.09.
        </p></li><li class="listitem"><p>
          Core version changes:
        </p><p>
          gcc: 8.3.0 -&gt; 9.2.0
        </p><p>
          glibc: 2.27 -&gt; 2.30
        </p><p>
          linux: 4.19 -&gt; 5.4
        </p><p>
          mesa: 19.1.5 -&gt; 19.3.3
        </p><p>
          openssl: 1.0.2u -&gt; 1.1.1d
        </p></li><li class="listitem"><p>
          Desktop version changes:
        </p><p>
          plasma5: 5.16.5 -&gt; 5.17.5
        </p><p>
          kdeApplications: 19.08.2 -&gt; 19.12.3
        </p><p>
          gnome3: 3.32 -&gt; 3.34
        </p><p>
          pantheon: 5.0 -&gt; 5.1.3
        </p></li><li class="listitem"><p>
          Linux kernel is updated to branch 5.4 by default (from 4.19).
        </p></li><li class="listitem"><p>
          Grub is updated to 2.04, adding support for booting from F2FS
          filesystems and Btrfs volumes using zstd compression. Note
          that some users have been unable to boot after upgrading to
          2.04 - for more information, please see
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/61718#issuecomment-617618503" target="_top">this
          discussion</a>.
        </p></li><li class="listitem"><p>
          Postgresql for NixOS service now defaults to v11.
        </p></li><li class="listitem"><p>
          The graphical installer image starts the graphical session
          automatically. Before you'd be greeted by a tty and asked to
          enter <code class="literal">systemctl start display-manager</code>. It
          is now possible to disable the display-manager from running by
          selecting the <code class="literal">Disable display-manager</code> quirk
          in the boot menu.
        </p></li><li class="listitem"><p>
          GNOME 3 has been upgraded to 3.34. Please take a look at their
          <a class="link" href="https://help.gnome.org/misc/release-notes/3.34" target="_top">Release
          Notes</a> for details.
        </p></li><li class="listitem"><p>
          If you enable the Pantheon Desktop Manager via
          <a class="link" href="options.html#opt-services.xserver.desktopManager.pantheon.enable" target="_top">services.xserver.desktopManager.pantheon.enable</a>,
          we now default to also use
          <a class="link" href="https://blog.elementary.io/say-hello-to-the-new-greeter/" target="_top">
          Pantheon's newly designed greeter </a>. Contrary to NixOS's
          usual update policy, Pantheon will receive updates during the
          cycle of NixOS 20.03 when backwards compatible.
        </p></li><li class="listitem"><p>
          By default zfs pools will now be trimmed on a weekly basis.
          Trimming is only done on supported devices (i.e. NVME or SSDs)
          and should improve throughput and lifetime of these devices.
          It is controlled by the
          <code class="literal">services.zfs.trim.enable</code> varname. The zfs
          scrub service
          (<code class="literal">services.zfs.autoScrub.enable</code>) and the zfs
          autosnapshot service
          (<code class="literal">services.zfs.autoSnapshot.enable</code>) are now
          only enabled if zfs is set in
          <code class="literal">config.boot.initrd.supportedFilesystems</code> or
          <code class="literal">config.boot.supportedFilesystems</code>. These
          lists will automatically contain zfs as soon as any zfs
          mountpoint is configured in <code class="literal">fileSystems</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">nixos-option</code> has been rewritten in C++,
          speeding it up, improving correctness, and adding a
          <code class="literal">-r</code> option which prints all options and
          their values recursively.
        </p></li><li class="listitem"><p>
          <code class="literal">services.xserver.desktopManager.default</code> and
          <code class="literal">services.xserver.windowManager.default</code>
          options were replaced by a single
          <a class="link" href="options.html#opt-services.xserver.displayManager.defaultSession" target="_top">services.xserver.displayManager.defaultSession</a>
          option to improve support for upstream session files. If you
          used something like:
        </p><pre class="programlisting">
{
  services.xserver.desktopManager.default = "xfce";
  services.xserver.windowManager.default = "icewm";
}
</pre><p>
          you should change it to:
        </p><pre class="programlisting">
{
  services.xserver.displayManager.defaultSession = "xfce+icewm";
}
</pre></li><li class="listitem"><p>
          The testing driver implementation in NixOS is now in Python
          <code class="literal">make-test-python.nix</code>. This was done by
          Jacek Galowicz
          (<a class="link" href="https://github.com/tfc" target="_top">@tfc</a>), and
          with the collaboration of Julian Stecklina
          (<a class="link" href="https://github.com/blitz" target="_top">@blitz</a>)
          and Jana Traue
          (<a class="link" href="https://github.com/jtraue" target="_top">@jtraue</a>).
          All documentation has been updated to use this testing driver,
          and a vast majority of the 286 tests in NixOS were ported to
          python driver. In 20.09 the Perl driver implementation,
          <code class="literal">make-test.nix</code>, is slated for removal. This
          should give users of the NixOS integration framework a
          transitory period to rewrite their tests to use the Python
          implementation. Users of the Perl driver will see this warning
          everytime they use it:
        </p><pre class="programlisting">
$ warning: Perl VM tests are deprecated and will be removed for 20.09.
Please update your tests to use the python test driver.
See https://github.com/NixOS/nixpkgs/pull/71684 for details.
</pre><p>
          API compatibility is planned to be kept for at least the next
          release with the perl driver.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.03-new-services"></a>B.5.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The kubernetes kube-proxy now supports a new hostname
          configuration
          <code class="literal">services.kubernetes.proxy.hostname</code> which
          has to be set if the hostname of the node should be non
          default.
        </p></li><li class="listitem"><p>
          UPower's configuration is now managed by NixOS and can be
          customized via <code class="literal">services.upower</code>.
        </p></li><li class="listitem"><p>
          To use Geary you should enable
          <a class="link" href="options.html#opt-programs.geary.enable" target="_top">programs.geary.enable</a>
          instead of just adding it to
          <a class="link" href="options.html#opt-environment.systemPackages" target="_top">environment.systemPackages</a>.
          It was created so Geary could function properly outside of
          GNOME.
        </p></li><li class="listitem"><p>
          <code class="literal">./config/console.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./hardware/brillo.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./hardware/tuxedo-keyboard.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/bandwhich.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/bash-my-aws.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/liboping.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/traceroute.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/sanoid.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/syncoid.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/zfs-replication.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/continuous-integration/buildkite-agents.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/databases/victoriametrics.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/gnome3/gnome-initial-setup.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/neard.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/games/openarena.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/fancontrol.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/mail/sympa.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/freeswitch.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/mame.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/monitoring/do-agent.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/monitoring/prometheus/xmpp-alerts.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/orangefs/server.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/orangefs/client.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/3proxy.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/corerad.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/go-shadowsocks2.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/ntp/openntpd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/shorewall.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/shorewall6.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/spacecookie.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/trickster.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/v2ray.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/xandikos.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/yggdrasil.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/dokuwiki.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/gotify-server.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/grocy.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/ihatemoney</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/moinmoin.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/trac.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/trilium.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/shiori.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-servers/ttyd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/x11/picom.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/x11/hardware/digimend.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/x11/imwheel.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./virtualisation/cri-o.nix</code>
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.03-incompatibilities"></a>B.5.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The dhcpcd package
          <a class="link" href="https://roy.marples.name/archives/dhcpcd-discuss/0002621.html" target="_top">
          does not request IPv4 addresses for tap and bridge interfaces
          anymore by default</a>. In order to still get an address on
          a bridge interface, one has to disable
          <code class="literal">networking.useDHCP</code> and explicitly enable
          <code class="literal">networking.interfaces.&lt;name&gt;.useDHCP</code>
          on every interface, that should get an address via DHCP. This
          way, dhcpcd is configured in an explicit way about which
          interface to run on.
        </p></li><li class="listitem"><p>
          GnuPG is now built without support for a graphical passphrase
          entry by default. Please enable the
          <code class="literal">gpg-agent</code> user service via the NixOS option
          <code class="literal">programs.gnupg.agent.enable</code>. Note that
          upstream recommends using <code class="literal">gpg-agent</code> and
          will spawn a <code class="literal">gpg-agent</code> on the first
          invocation of GnuPG anyway.
        </p></li><li class="listitem"><p>
          The <code class="literal">dynamicHosts</code> option has been removed
          from the
          <a class="link" href="options.html#opt-networking.networkmanager.enable" target="_top">NetworkManager</a>
          module. Allowing (multiple) regular users to override host
          entries affecting the whole system opens up a huge attack
          vector. There seem to be very rare cases where this might be
          useful. Consider setting system-wide host entries using
          <a class="link" href="options.html#opt-networking.hosts" target="_top">networking.hosts</a>,
          provide them via the DNS server in your network, or use
          <a class="link" href="options.html#opt-environment.etc" target="_top">environment.etc</a>
          to add a file into
          <code class="literal">/etc/NetworkManager/dnsmasq.d</code> reconfiguring
          <code class="literal">hostsdir</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">99-main.network</code> file was removed.
          Matching all network interfaces caused many breakages, see
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/18962" target="_top">#18962</a>
          and
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/71106" target="_top">#71106</a>.
        </p><p>
          We already don't support the global
          <a class="link" href="options.html#opt-networking.useDHCP" target="_top">networking.useDHCP</a>,
          <a class="link" href="options.html#opt-networking.defaultGateway" target="_top">networking.defaultGateway</a>
          and
          <a class="link" href="options.html#opt-networking.defaultGateway6" target="_top">networking.defaultGateway6</a>
          options if
          <a class="link" href="options.html#opt-networking.useNetworkd" target="_top">networking.useNetworkd</a>
          is enabled, but direct users to configure the per-device
          <a class="link" href="options.html#opt-networking.interfaces" target="_top">networking.interfaces.&lt;name&gt;….</a>
          options.
        </p></li><li class="listitem"><p>
          The stdenv now runs all bash with <code class="literal">set -u</code>,
          to catch the use of undefined variables. Before, it itself
          used <code class="literal">set -u</code> but was careful to unset it so
          other packages' code ran as before. Now, all bash code is held
          to the same high standard, and the rather complex stateful
          manipulation of the options can be discarded.
        </p></li><li class="listitem"><p>
          The SLIM Display Manager has been removed, as it has been
          unmaintained since 2013. Consider migrating to a different
          display manager such as LightDM (current default in NixOS),
          SDDM, GDM, or using the startx module which uses Xinitrc.
        </p></li><li class="listitem"><p>
          The Way Cooler wayland compositor has been removed, as the
          project has been officially canceled. There are no more
          <code class="literal">way-cooler</code> attribute and
          <code class="literal">programs.way-cooler</code> options.
        </p></li><li class="listitem"><p>
          The BEAM package set has been deleted. You will only find
          there the different interpreters. You should now use the
          different build tools coming with the languages with sandbox
          mode disabled.
        </p></li><li class="listitem"><p>
          There is now only one Xfce package-set and module. This means
          that attributes <code class="literal">xfce4-14</code> and
          <code class="literal">xfceUnstable</code> all now point to the latest
          Xfce 4.14 packages. And in the future NixOS releases will be
          the latest released version of Xfce available at the time of
          the release's development (if viable).
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.phpfpm.pools" target="_top">phpfpm</a>
          module now sets <code class="literal">PrivateTmp=true</code> in its
          systemd units for better process isolation. If you rely on
          <code class="literal">/tmp</code> being shared with other services,
          explicitly override this by setting
          <code class="literal">serviceConfig.PrivateTmp</code> to
          <code class="literal">false</code> for each phpfpm unit.
        </p></li><li class="listitem"><p>
          KDE’s old multimedia framework Phonon no longer supports Qt 4.
          For that reason, Plasma desktop also does not have
          <code class="literal">enableQt4Support</code> option any more.
        </p></li><li class="listitem"><p>
          The BeeGFS module has been removed.
        </p></li><li class="listitem"><p>
          The osquery module has been removed.
        </p></li><li class="listitem"><p>
          Going forward, <code class="literal">~/bin</code> in the users home
          directory will no longer be in <code class="literal">PATH</code> by
          default. If you depend on this you should set the option
          <code class="literal">environment.homeBinInPath</code> to
          <code class="literal">true</code>. The aforementioned option was added
          this release.
        </p></li><li class="listitem"><p>
          The <code class="literal">buildRustCrate</code> infrastructure now
          produces <code class="literal">lib</code> outputs in addition to the
          <code class="literal">out</code> output. This has led to drastically
          reduced closure sizes for some rust crates since development
          dependencies are now in the <code class="literal">lib</code> output.
        </p></li><li class="listitem"><p>
          Pango was upgraded to 1.44, which no longer uses freetype for
          font loading. This means that type1 and bitmap fonts are no
          longer supported in applications relying on Pango for font
          rendering (notably, GTK application). See
          <a class="link" href="https://gitlab.gnome.org/GNOME/pango/issues/386" target="_top">
          upstream issue</a> for more information.
        </p></li><li class="listitem"><p>
          The <code class="literal">roundcube</code> module has been hardened.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The password of the database is not written world readable
              in the store any more. If <code class="literal">database.host</code>
              is set to <code class="literal">localhost</code>, then a unix user
              of the same name as the database will be created and
              PostreSQL peer authentication will be used, removing the
              need for a password. Otherwise, a password is still needed
              and can be provided with the new option
              <code class="literal">database.passwordFile</code>, which should be
              set to the path of a file containing the password and
              readable by the user <code class="literal">nginx</code> only. The
              <code class="literal">database.password</code> option is insecure
              and deprecated. Usage of this option will print a warning.
            </p></li><li class="listitem"><p>
              A random <code class="literal">des_key</code> is set by default in
              the configuration of roundcube, instead of using the
              hardcoded and insecure default. To ensure a clean
              migration, all users will be logged out when you upgrade
              to this release.
            </p></li></ul></div></li><li class="listitem"><p>
          The packages <code class="literal">openobex</code> and
          <code class="literal">obexftp</code> are no longer installed when
          enabling Bluetooth via
          <code class="literal">hardware.bluetooth.enable</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">dump1090</code> derivation has been changed to
          use FlightAware's dump1090 as its upstream. However, this
          version does not have an internal webserver anymore. The
          assets in the <code class="literal">share/dump1090</code> directory of
          the derivation can be used in conjunction with an external
          webserver to replace this functionality.
        </p></li><li class="listitem"><p>
          The fourStore and fourStoreEndpoint modules have been removed.
        </p></li><li class="listitem"><p>
          Polkit no longer has the user of uid 0 (root) as an admin
          identity. We now follow the upstream default of only having
          every member of the wheel group admin privileged. Before it
          was root and members of wheel. The positive outcome of this is
          pkexec GUI popups or terminal prompts will no longer require
          the user to choose between two essentially equivalent choices
          (whether to perform the action as themselves with wheel
          permissions, or as the root user).
        </p></li><li class="listitem"><p>
          NixOS containers no longer build NixOS manual by default. This
          saves evaluation time, especially if there are many
          declarative containers defined. Note that this is already done
          when
          <code class="literal">&lt;nixos/modules/profiles/minimal.nix&gt;</code>
          module is included in container config.
        </p></li><li class="listitem"><p>
          The <code class="literal">kresd</code> services deprecates the
          <code class="literal">interfaces</code> option in favor of the
          <code class="literal">listenPlain</code> option which requires full
          <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.socket.html#ListenStream=" target="_top">systemd.socket
          compatible</a> declaration which always include a port.
        </p></li><li class="listitem"><p>
          Virtual console options have been reorganized and can be found
          under a single top-level attribute:
          <code class="literal">console</code>. The full set of changes is as
          follows:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">i18n.consoleFont</code> renamed to
              <a class="link" href="options.html#opt-console.font" target="_top">console.font</a>
            </p></li><li class="listitem"><p>
              <code class="literal">i18n.consoleKeyMap</code> renamed to
              <a class="link" href="options.html#opt-console.keyMap" target="_top">console.keyMap</a>
            </p></li><li class="listitem"><p>
              <code class="literal">i18n.consoleColors</code> renamed to
              <a class="link" href="options.html#opt-console.colors" target="_top">console.colors</a>
            </p></li><li class="listitem"><p>
              <code class="literal">i18n.consolePackages</code> renamed to
              <a class="link" href="options.html#opt-console.packages" target="_top">console.packages</a>
            </p></li><li class="listitem"><p>
              <code class="literal">i18n.consoleUseXkbConfig</code> renamed to
              <a class="link" href="options.html#opt-console.useXkbConfig" target="_top">console.useXkbConfig</a>
            </p></li><li class="listitem"><p>
              <code class="literal">boot.earlyVconsoleSetup</code> renamed to
              <a class="link" href="options.html#opt-console.earlySetup" target="_top">console.earlySetup</a>
            </p></li><li class="listitem"><p>
              <code class="literal">boot.extraTTYs</code> renamed to
              <code class="literal">console.extraTTYs</code>.
            </p></li></ul></div></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.awstats.enable" target="_top">awstats</a>
          module has been rewritten to serve stats via static html
          pages, updated on a timer, over
          <a class="link" href="options.html#opt-services.nginx.virtualHosts" target="_top">nginx</a>,
          instead of dynamic cgi pages over
          <a class="link" href="options.html#opt-services.httpd.enable" target="_top">apache</a>.
        </p><p>
          Minor changes will be required to migrate existing
          configurations. Details of the required changes can seen by
          looking through the
          <a class="link" href="options.html#opt-services.awstats.enable" target="_top">awstats</a>
          module.
        </p></li><li class="listitem"><p>
          The httpd module no longer provides options to support serving
          web content without defining a virtual host. As a result of
          this the
          <a class="link" href="options.html#opt-services.httpd.logPerVirtualHost" target="_top">services.httpd.logPerVirtualHost</a>
          option now defaults to <code class="literal">true</code> instead of
          <code class="literal">false</code>. Please update your configuration to
          make use of
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts</a>.
        </p><p>
          The
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;</a>
          option has changed type from a list of submodules to an
          attribute set of submodules, better matching
          <a class="link" href="options.html#opt-services.nginx.virtualHosts" target="_top">services.nginx.virtualHosts.&lt;name&gt;</a>.
        </p><p>
          This change comes with the addition of the following options
          which mimic the functionality of their
          <code class="literal">nginx</code> counterparts:
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.addSSL</a>,
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.forceSSL</a>,
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.onlySSL</a>,
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.enableACME</a>,
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.acmeRoot</a>,
          and
          <a class="link" href="options.html#opt-services.httpd.virtualHosts" target="_top">services.httpd.virtualHosts.&lt;name&gt;.useACMEHost</a>.
        </p></li><li class="listitem"><p>
          For NixOS configuration options, the <code class="literal">loaOf</code>
          type has been deprecated and will be removed in a future
          release. In nixpkgs, options of this type will be changed to
          <code class="literal">attrsOf</code> instead. If you were using one of
          these in your configuration, you will see a warning suggesting
          what changes will be required.
        </p><p>
          For example,
          <a class="link" href="options.html#opt-users.users" target="_top">users.users</a>
          is a <code class="literal">loaOf</code> option that is commonly used as
          follows:
        </p><pre class="programlisting">
{
  users.users =
    [ { name = "me";
        description = "My personal user.";
        isNormalUser = true;
      }
    ];
}
</pre><p>
          This should be rewritten by removing the list and using the
          value of <code class="literal">name</code> as the name of the attribute
          set:
        </p><pre class="programlisting">
{
  users.users.me =
    { description = "My personal user.";
      isNormalUser = true;
    };
}
</pre><p>
          For more information on this change have look at these links:
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/1800" target="_top">issue
          #1800</a>,
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/63103" target="_top">PR
          #63103</a>.
        </p></li><li class="listitem"><p>
          For NixOS modules, the types
          <code class="literal">types.submodule</code> and
          <code class="literal">types.submoduleWith</code> now support paths as
          allowed values, similar to how <code class="literal">imports</code>
          supports paths. Because of this, if you have a module that
          defines an option of type
          <code class="literal">either (submodule ...) path</code>, it will break
          since a path is now treated as the first type instead of the
          second. To fix this, change the type to
          <code class="literal">either path (submodule ...)</code>.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.buildkite-agents" target="_top">Buildkite
          Agent</a> module and corresponding packages have been
          updated to 3.x, and to support multiple instances of the agent
          running at the same time. This means you will have to rename
          <code class="literal">services.buildkite-agent</code> to
          <code class="literal">services.buildkite-agents.&lt;name&gt;</code>.
          Furthermore, the following options have been changed:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.buildkite-agent.meta-data</code> has
              been renamed to
              <a class="link" href="options.html#opt-services.buildkite-agents" target="_top">services.buildkite-agents.&lt;name&gt;.tags</a>,
              to match upstreams naming for 3.x. Its type has also
              changed - it now accepts an attrset of strings.
            </p></li><li class="listitem"><p>
              The<code class="literal">services.buildkite-agent.openssh.publicKeyPath</code>
              option has been removed, as it's not necessary to deploy
              public keys to clone private repositories.
            </p></li><li class="listitem"><p>
              <code class="literal">services.buildkite-agent.openssh.privateKeyPath</code>
              has been renamed to
              <a class="link" href="options.html#opt-services.buildkite-agents" target="_top">buildkite-agents.&lt;name&gt;.privateSshKeyPath</a>,
              as the whole <code class="literal">openssh</code> now only contained
              that single option.
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.buildkite-agents" target="_top">services.buildkite-agents.&lt;name&gt;.shell</a>
              has been introduced, allowing to specify a custom shell to
              be used.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">citrix_workspace_19_3_0</code> package has
          been removed as it will be EOLed within the lifespan of 20.03.
          For further information, please refer to the
          <a class="link" href="https://www.citrix.com/de-de/support/product-lifecycle/milestones/receiver.html" target="_top">support
          and maintenance information</a> from upstream.
        </p></li><li class="listitem"><p>
          The <code class="literal">gcc5</code> and <code class="literal">gfortran5</code>
          packages have been removed.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.xserver.displayManager.auto</code>
          module has been removed. It was only intended for use in
          internal NixOS tests, and gave the false impression of it
          being a special display manager when it's actually LightDM.
          Please use the
          <code class="literal">services.xserver.displayManager.lightdm.autoLogin</code>
          options instead, or any other display manager in NixOS as they
          all support auto-login. If you used this module specifically
          because it permitted root auto-login you can override the
          lightdm-autologin pam module like:
        </p><pre class="programlisting">
{
  security.pam.services.lightdm-autologin.text = lib.mkForce ''
      auth     requisite pam_nologin.so
      auth     required  pam_succeed_if.so quiet
      auth     required  pam_permit.so

      account  include   lightdm

      password include   lightdm

      session  include   lightdm
  '';
}
</pre><p>
          The difference is the:
        </p><pre class="programlisting">
auth required pam_succeed_if.so quiet
</pre><p>
          line, where default it's:
        </p><pre class="programlisting">
 auth required pam_succeed_if.so uid &gt;= 1000 quiet
</pre><p>
          not permitting users with uid's below 1000 (like root). All
          other display managers in NixOS are configured like this.
        </p></li><li class="listitem"><p>
          There have been lots of improvements to the Mailman module. As
          a result,
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <code class="literal">services.mailman.hyperkittyBaseUrl</code>
              option has been renamed to
              <a class="link" href="options.html#opt-services.mailman.hyperkitty.baseUrl" target="_top">services.mailman.hyperkitty.baseUrl</a>.
            </p></li><li class="listitem"><p>
              The <code class="literal">services.mailman.hyperkittyApiKey</code>
              option has been removed. This is because having an option
              for the Hyperkitty API key meant that the API key would be
              stored in the world-readable Nix store, which was a
              security vulnerability. A new Hyperkitty API key will be
              generated the first time the new Hyperkitty service is
              run, and it will then be persisted outside of the Nix
              store. To continue using Hyperkitty, you must set
              <a class="link" href="options.html#opt-services.mailman.hyperkitty.enable" target="_top">services.mailman.hyperkitty.enable</a>
              to <code class="literal">true</code>.
            </p></li><li class="listitem"><p>
              Additionally, some Postfix configuration must now be set
              manually instead of automatically by the Mailman module:
            </p><pre class="programlisting">
{
  services.postfix.relayDomains = [ "hash:/var/lib/mailman/data/postfix_domains" ];
  services.postfix.config.transport_maps = [ "hash:/var/lib/mailman/data/postfix_lmtp" ];
  services.postfix.config.local_recipient_maps = [ "hash:/var/lib/mailman/data/postfix_lmtp" ];
}
</pre><p>
              This is because some users may want to include other
              values in these lists as well, and this was not possible
              if they were set automatically by the Mailman module. It
              would not have been possible to just concatenate values
              from multiple modules each setting the values they needed,
              because the order of elements in the list is significant.
            </p></li></ul></div></li><li class="listitem"><p>
          The LLVM versions 3.5, 3.9 and 4 (including the corresponding
          CLang versions) have been dropped.
        </p></li><li class="listitem"><p>
          The
          <code class="literal">networking.interfaces.*.preferTempAddress</code>
          option has been replaced by
          <code class="literal">networking.interfaces.*.tempAddress</code>. The
          new option allows better control of the IPv6 temporary
          addresses, including completely disabling them for interfaces
          where they are not needed.
        </p></li><li class="listitem"><p>
          Rspamd was updated to version 2.2. Read
          <a class="link" href="https://rspamd.com/doc/migration.html#migration-to-rspamd-20" target="_top">
          the upstream migration notes</a> carefully. Please be
          especially aware that some modules were removed and the
          default Bayes backend is now Redis.
        </p></li><li class="listitem"><p>
          The <code class="literal">*psu</code> versions of oraclejdk8 have been
          removed as they aren't provided by upstream anymore.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.dnscrypt-proxy</code> module has been
          removed as it used the deprecated version of dnscrypt-proxy.
          We've added
          <a class="link" href="options.html#opt-services.dnscrypt-proxy2.enable" target="_top">services.dnscrypt-proxy2.enable</a>
          to use the supported version. This module supports
          configuration via the Nix attribute set
          <a class="link" href="options.html#opt-services.dnscrypt-proxy2.settings" target="_top">services.dnscrypt-proxy2.settings</a>,
          or by passing a TOML configuration file via
          <a class="link" href="options.html#opt-services.dnscrypt-proxy2.configFile" target="_top">services.dnscrypt-proxy2.configFile</a>.
        </p><pre class="programlisting">
{
  # Example configuration:
  services.dnscrypt-proxy2.enable = true;
  services.dnscrypt-proxy2.settings = {
    listen_addresses = [ "127.0.0.1:43" ];
    sources.public-resolvers = {
      urls = [ "https://download.dnscrypt.info/resolvers-list/v2/public-resolvers.md" ];
      cache_file = "public-resolvers.md";
      minisign_key = "RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3";
      refresh_delay = 72;
    };
  };

  services.dnsmasq.enable = true;
  services.dnsmasq.servers = [ "127.0.0.1#43" ];
}
</pre></li><li class="listitem"><p>
          <code class="literal">qesteidutil</code> has been deprecated in favor of
          <code class="literal">qdigidoc</code>.
        </p></li><li class="listitem"><p>
          sqldeveloper_18 has been removed as it's not maintained
          anymore, sqldeveloper has been updated to version
          <code class="literal">19.4</code>. Please note that this means that this
          means that the oraclejdk is now required. For further
          information please read the
          <a class="link" href="https://www.oracle.com/technetwork/developer-tools/sql-developer/downloads/sqldev-relnotes-194-5908846.html" target="_top">release
          notes</a>.
        </p></li><li class="listitem"><p>
          Haskell <code class="literal">env</code> and <code class="literal">shellFor</code>
          dev shell environments now organize dependencies the same way
          as regular builds. In particular, rather than receiving all
          the different lists of dependencies mashed together as one big
          list, and then partitioning into Haskell and non-Hakell
          dependencies, they work from the original many different
          dependency parameters and don't need to algorithmically
          partition anything.
        </p><p>
          This means that if you incorrectly categorize a dependency,
          e.g. non-Haskell library dependency as a
          <code class="literal">buildDepends</code> or run-time Haskell dependency
          as a <code class="literal">setupDepends</code>, whereas things would
          have worked before they may not work now.
        </p></li><li class="listitem"><p>
          The gcc-snapshot-package has been removed. It's marked as
          broken for &gt;2 years and used to point to a fairly old
          snapshot from the gcc7-branch.
        </p></li><li class="listitem"><p>
          The nixos-build-vms8 -script now uses the python test-driver.
        </p></li><li class="listitem"><p>
          The riot-web package now accepts configuration overrides as an
          attribute set instead of a string. A formerly used JSON
          configuration can be converted to an attribute set with
          <code class="literal">builtins.fromJSON</code>.
        </p><p>
          The new default configuration also disables automatic guest
          account registration and analytics to improve privacy. The
          previous behavior can be restored by setting
          <code class="literal">config.riot-web.conf = { disable_guests = false; piwik = true; }</code>.
        </p></li><li class="listitem"><p>
          Stand-alone usage of <code class="literal">Upower</code> now requires
          <code class="literal">services.upower.enable</code> instead of just
          installing into
          <a class="link" href="options.html#opt-environment.systemPackages" target="_top">environment.systemPackages</a>.
        </p></li><li class="listitem"><p>
          nextcloud has been updated to <code class="literal">v18.0.2</code>. This
          means that users from NixOS 19.09 can't upgrade directly since
          you can only move one version forward and 19.09 uses
          <code class="literal">v16.0.8</code>.
        </p><p>
          To provide a safe upgrade-path and to circumvent similar
          issues in the future, the following measures were taken:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The pkgs.nextcloud-attribute has been removed and replaced
              with versioned attributes (currently pkgs.nextcloud17 and
              pkgs.nextcloud18). With this change major-releases can be
              backported without breaking stuff and to make
              upgrade-paths easier.
            </p></li><li class="listitem"><p>
              Existing setups will be detected using
              <a class="link" href="options.html#opt-system.stateVersion" target="_top">system.stateVersion</a>:
              by default, nextcloud17 will be used, but will raise a
              warning which notes that after that deploy it's
              recommended to update to the latest stable version
              (nextcloud18) by declaring the newly introduced setting
              <a class="link" href="options.html#opt-services.nextcloud.package" target="_top">services.nextcloud.package</a>.
            </p></li><li class="listitem"><p>
              Users with an overlay (e.g. to use nextcloud at version
              <code class="literal">v18</code> on <code class="literal">19.09</code>) will
              get an evaluation error by default. This is done to ensure
              that our
              <a class="link" href="options.html#opt-services.nextcloud.package" target="_top">package</a>-option
              doesn't select an older version by accident. It's
              recommended to use pkgs.nextcloud18 or to set
              <a class="link" href="options.html#opt-services.nextcloud.package" target="_top">package</a>
              to pkgs.nextcloud explicitly.
            </p></li></ul></div><div class="warning"><h3 class="title">Warning</h3><p>
            Please note that if you're coming from
            <code class="literal">19.03</code> or older, you have to manually
            upgrade to <code class="literal">19.09</code> first to upgrade your
            server to Nextcloud v16.
          </p></div></li><li class="listitem"><p>
          Hydra has gained a massive performance improvement due to
          <a class="link" href="https://github.com/NixOS/hydra/pull/710" target="_top">some
          database schema changes</a> by adding several IDs and
          better indexing. However, it's necessary to upgrade Hydra in
          multiple steps:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              At first, an older version of Hydra needs to be deployed
              which adds those (nullable) columns. When having set
              <a class="link" href="options.html#opt-system.stateVersion" target="_top">stateVersion
              </a> to a value older than <code class="literal">20.03</code>,
              this package will be selected by default from the module
              when upgrading. Otherwise, the package can be deployed
              using the following config:
            </p><pre class="programlisting">
{ pkgs, ... }: {
  services.hydra.package = pkgs.hydra-migration;
}
</pre></li></ul></div></li><li class="listitem"><p>
          Automatically fill the newly added ID columns on the server by
          running the following command:
        </p><pre class="programlisting">
$ hydra-backfill-ids
</pre><div class="warning"><h3 class="title">Warning</h3><p>
            Please note that this process can take a while depending on
            your database-size!
          </p></div></li><li class="listitem"><p>
          Deploy a newer version of Hydra to activate the DB
          optimizations. This can be done by using hydra-unstable. This
          package already includes
          <a class="link" href="https://github.com/nixos/rfcs/pull/49" target="_top">flake-support</a>
          and is therefore compiled against pkgs.nixFlakes.
        </p><div class="warning"><h3 class="title">Warning</h3><p>
            If your
            <a class="link" href="options.html#opt-system.stateVersion" target="_top">stateVersion</a>
            is set to <code class="literal">20.03</code> or greater,
            hydra-unstable will be used automatically! This will break
            your setup if you didn't run the migration.
          </p></div><p>
          Please note that Hydra is currently not available with
          nixStable as this doesn't compile anymore.
        </p><div class="warning"><h3 class="title">Warning</h3><p>
            pkgs.hydra has been removed to ensure a graceful
            database-migration using the dedicated package-attributes.
            If you still have pkgs.hydra defined in e.g. an overlay, an
            assertion error will be thrown. To circumvent this, you need
            to set
            <a class="link" href="options.html#opt-services.hydra.package" target="_top">services.hydra.package</a>
            to pkgs.hydra explicitly and make sure you know what you're
            doing!
          </p></div></li><li class="listitem"><p>
          The TokuDB storage engine will be disabled in mariadb 10.5. It
          is recommended to switch to RocksDB. See also
          <a class="link" href="https://mariadb.com/kb/en/tokudb/" target="_top">TokuDB</a>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-20.03-notable-changes"></a>B.5.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          SD images are now compressed by default using
          <code class="literal">bzip2</code>.
        </p></li><li class="listitem"><p>
          The nginx web server previously started its master process as
          root privileged, then ran worker processes as a less
          privileged identity user (the <code class="literal">nginx</code> user).
          This was changed to start all of nginx as a less privileged
          user (defined by <code class="literal">services.nginx.user</code> and
          <code class="literal">services.nginx.group</code>). As a consequence,
          all files that are needed for nginx to run (included
          configuration fragments, SSL certificates and keys, etc.) must
          now be readable by this less privileged user/group.
        </p><p>
          To continue to use the old approach, you can configure:
        </p><pre class="programlisting">
{
  services.nginx.appendConfig = let cfg = config.services.nginx; in ''user ${cfg.user} ${cfg.group};'';
  systemd.services.nginx.serviceConfig.User = lib.mkForce "root";
}
</pre></li><li class="listitem"><p>
          OpenSSH has been upgraded from 7.9 to 8.1, improving security
          and adding features but with potential incompatibilities.
          Consult the
          <a class="link" href="https://www.openssh.com/txt/release-8.1" target="_top">
          release announcement</a> for more information.
        </p></li><li class="listitem"><p>
          <code class="literal">PRETTY_NAME</code> in
          <code class="literal">/etc/os-release</code> now uses the short rather
          than full version string.
        </p></li><li class="listitem"><p>
          The ACME module has switched from simp-le to
          <a class="link" href="https://github.com/go-acme/lego" target="_top">lego</a>
          which allows us to support DNS-01 challenges and wildcard
          certificates. The following options have been added:
          <a class="link" href="options.html#opt-security.acme.acceptTerms" target="_top">security.acme.acceptTerms</a>,
          <a class="link" href="options.html#opt-security.acme.certs" target="_top">security.acme.certs.&lt;name&gt;.dnsProvider</a>,
          <a class="link" href="options.html#opt-security.acme.certs" target="_top">security.acme.certs.&lt;name&gt;.credentialsFile</a>,
          <a class="link" href="options.html#opt-security.acme.certs" target="_top">security.acme.certs.&lt;name&gt;.dnsPropagationCheck</a>.
          As well as this, the options
          <code class="literal">security.acme.acceptTerms</code> and either
          <code class="literal">security.acme.email</code> or
          <code class="literal">security.acme.certs.&lt;name&gt;.email</code> must
          be set in order to use the ACME module. Certificates will be
          regenerated on activation, no account or certificate will be
          migrated from simp-le. In particular private keys will not be
          preserved. However, the credentials for simp-le are preserved
          and thus it is possible to roll back to previous versions
          without breaking certificate generation. Note also that in
          contrary to simp-le a new private key is recreated at each
          renewal by default, which can have consequences if you embed
          your public key in apps.
        </p></li><li class="listitem"><p>
          It is now possible to unlock LUKS-Encrypted file systems using
          a FIDO2 token via
          <code class="literal">boot.initrd.luks.fido2Support</code>.
        </p></li><li class="listitem"><p>
          Predictably named network interfaces get renamed in stage-1.
          This means that it is possible to use the proper interface
          name for e.g. Dropbear setups.
        </p><p>
          For further reference, please read
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/68953" target="_top">#68953</a>
          or the corresponding
          <a class="link" href="https://discourse.nixos.org/t/predictable-network-interface-names-in-initrd/4055" target="_top">discourse
          thread</a>.
        </p></li><li class="listitem"><p>
          The matrix-synapse-package has been updated to
          <a class="link" href="https://github.com/matrix-org/synapse/releases/tag/v1.11.1" target="_top">v1.11.1</a>.
          Due to
          <a class="link" href="https://github.com/matrix-org/synapse/releases/tag/v1.10.0rc1" target="_top">stricter
          requirements</a> for database configuration when using
          postgresql, the automated database setup of the module has
          been removed to avoid any further edge-cases.
        </p><p>
          matrix-synapse expects <code class="literal">postgresql</code>-databases
          to have the options <code class="literal">LC_COLLATE</code> and
          <code class="literal">LC_CTYPE</code> set to
          <a class="link" href="https://www.postgresql.org/docs/12/locale.html" target="_top"><code class="literal">'C'</code></a>
          which basically instructs <code class="literal">postgresql</code> to
          ignore any locale-based preferences.
        </p><p>
          Depending on your setup, you need to incorporate one of the
          following changes in your setup to upgrade to 20.03:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If you use <code class="literal">sqlite3</code> you don't need to do
              anything.
            </p></li><li class="listitem"><p>
              If you use <code class="literal">postgresql</code> on a different
              server, you don't need to change anything as well since
              this module was never designed to configure remote
              databases.
            </p></li><li class="listitem"><p>
              If you use <code class="literal">postgresql</code> and configured
              your synapse initially on <code class="literal">19.09</code> or
              older, you simply need to enable postgresql-support
              explicitly:
            </p><pre class="programlisting">
{ ... }: {
  services.matrix-synapse = {
    enable = true;
    /* and all the other config you've defined here */
  };
  services.postgresql.enable = true;
}
</pre></li></ul></div></li><li class="listitem"><p>
          If you deploy a fresh matrix-synapse, you need to configure
          the database yourself (e.g. by using the
          <a class="link" href="options.html#opt-services.postgresql.initialScript" target="_top">services.postgresql.initialScript</a>
          option). An example for this can be found in the
          <a class="link" href="index.html#module-services-matrix" title="Chapter 41. Matrix">documentation of the
          Matrix module</a>.
        </p></li><li class="listitem"><p>
          If you initially deployed your matrix-synapse on
          <code class="literal">nixos-unstable</code> <span class="emphasis"><em>after</em></span>
          the <code class="literal">19.09</code>-release, your database is
          misconfigured due to a regression in NixOS. For now,
          matrix-synapse will startup with a warning, but it's
          recommended to reconfigure the database to set the values
          <code class="literal">LC_COLLATE</code> and <code class="literal">LC_CTYPE</code>
          to
          <a class="link" href="https://www.postgresql.org/docs/12/locale.html" target="_top"><code class="literal">'C'</code></a>.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-systemd.network.links" target="_top">systemd.network.links</a>
          option is now respected even when
          <a class="link" href="options.html#opt-systemd.network.enable" target="_top">systemd-networkd</a>
          is disabled. This mirrors the behaviour of systemd - It's udev
          that parses <code class="literal">.link</code> files, not
          <code class="literal">systemd-networkd</code>.
        </p></li><li class="listitem"><p>
          mongodb has been updated to version <code class="literal">3.4.24</code>.
        </p><div class="warning"><h3 class="title">Warning</h3><p>
            Please note that mongodb has been relicensed under their own
            <a class="link" href="https://www.mongodb.com/licensing/server-side-public-license/faq" target="_top"><code class="literal"> sspl</code></a>-license.
            Since it's not entirely free and not OSI-approved, it's
            listed as non-free. This means that Hydra doesn't provide
            prebuilt mongodb-packages and needs to be built locally.
          </p></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-19.09"></a>B.6. Release 19.09 (<span class="quote">“<span class="quote">Loris</span>”</span>, 2019/10/09)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.09-highlights"></a>B.6.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          End of support is planned for end of April 2020, handing over
          to 20.03.
        </p></li><li class="listitem"><p>
          Nix has been updated to 2.3; see its
          <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-2.3" target="_top">release
          notes</a>.
        </p></li><li class="listitem"><p>
          Core version changes:
        </p><p>
          systemd: 239 -&gt; 243
        </p><p>
          gcc: 7 -&gt; 8
        </p><p>
          glibc: 2.27 (unchanged)
        </p><p>
          linux: 4.19 LTS (unchanged)
        </p><p>
          openssl: 1.0 -&gt; 1.1
        </p></li><li class="listitem"><p>
          Desktop version changes:
        </p><p>
          plasma5: 5.14 -&gt; 5.16
        </p><p>
          gnome3: 3.30 -&gt; 3.32
        </p></li><li class="listitem"><p>
          PHP now defaults to PHP 7.3, updated from 7.2.
        </p></li><li class="listitem"><p>
          PHP 7.1 is no longer supported due to upstream not supporting
          this version for the entire lifecycle of the 19.09 release.
        </p></li><li class="listitem"><p>
          The binfmt module is now easier to use. Additional systems can
          be added through
          <code class="literal">boot.binfmt.emulatedSystems</code>. For instance,
          <code class="literal">boot.binfmt.emulatedSystems = [ "wasm32-wasi" "x86_64-windows" "aarch64-linux" ];</code>
          will set up binfmt interpreters for each of those listed
          systems.
        </p></li><li class="listitem"><p>
          The installer now uses a less privileged
          <code class="literal">nixos</code> user whereas before we logged in as
          root. To gain root privileges use <code class="literal">sudo -i</code>
          without a password.
        </p></li><li class="listitem"><p>
          We've updated to Xfce 4.14, which brings a new module
          <code class="literal">services.xserver.desktopManager.xfce4-14</code>.
          If you'd like to upgrade, please switch from the
          <code class="literal">services.xserver.desktopManager.xfce</code> module
          as it will be deprecated in a future release. They're
          incompatibilities with the current Xfce module; it doesn't
          support <code class="literal">thunarPlugins</code> and it isn't
          recommended to use
          <code class="literal">services.xserver.desktopManager.xfce</code> and
          <code class="literal">services.xserver.desktopManager.xfce4-14</code>
          simultaneously or to downgrade from Xfce 4.14 after upgrading.
        </p></li><li class="listitem"><p>
          The GNOME 3 desktop manager module sports an interface to
          enable/disable core services, applications, and optional GNOME
          packages like games.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.gnome3.core-os-services.enable</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.gnome3.core-shell.enable</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.gnome3.core-utilities.enable</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.gnome3.games.enable</code>
            </p></li></ul></div><p>
          With these options we hope to give users finer grained control
          over their systems. Prior to this change you'd either have to
          manually disable options or use
          <code class="literal">environment.gnome3.excludePackages</code> which
          only excluded the optional applications.
          <code class="literal">environment.gnome3.excludePackages</code> is now
          unguarded, it can exclude any package installed with
          <code class="literal">environment.systemPackages</code> in the GNOME 3
          module.
        </p></li><li class="listitem"><p>
          Orthogonal to the previous changes to the GNOME 3 desktop
          manager module, we've updated all default services and
          applications to match as close as possible to a default
          reference GNOME 3 experience.
        </p><p>
          <span class="strong"><strong>The following changes were enacted in
          <code class="literal">services.gnome3.core-utilities.enable</code></strong></span>
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">accerciser</code>
            </p></li><li class="listitem"><p>
              <code class="literal">dconf-editor</code>
            </p></li><li class="listitem"><p>
              <code class="literal">evolution</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gnome-documents</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gnome-nettool</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gnome-power-manager</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gnome-todo</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gnome-tweaks</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gnome-usage</code>
            </p></li><li class="listitem"><p>
              <code class="literal">gucharmap</code>
            </p></li><li class="listitem"><p>
              <code class="literal">nautilus-sendto</code>
            </p></li><li class="listitem"><p>
              <code class="literal">vinagre</code>
            </p></li><li class="listitem"><p>
              <code class="literal">cheese</code>
            </p></li><li class="listitem"><p>
              <code class="literal">geary</code>
            </p></li></ul></div><p>
          <span class="strong"><strong>The following changes were enacted in
          <code class="literal">services.gnome3.core-shell.enable</code></strong></span>
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">gnome-color-manager</code>
            </p></li><li class="listitem"><p>
              <code class="literal">orca</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.avahi.enable</code>
            </p></li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.09-new-services"></a>B.6.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">./programs/dwm-status.nix</code>
        </p></li><li class="listitem"><p>
          The new <code class="literal">hardware.printers</code> module allows to
          declaratively configure CUPS printers via the
          <code class="literal">ensurePrinters</code> and
          <code class="literal">ensureDefaultPrinter</code> options.
          <code class="literal">ensurePrinters</code> will never delete existing
          printers, but will make sure that the given printers are
          configured as declared.
        </p></li><li class="listitem"><p>
          There is a new
          <a class="link" href="options.html#opt-services.system-config-printer.enable" target="_top">services.system-config-printer.enable</a>
          and
          <a class="link" href="options.html#opt-programs.system-config-printer.enable" target="_top">programs.system-config-printer.enable</a>
          module for the program of the same name. If you previously had
          <code class="literal">system-config-printer</code> enabled through some
          other means you should migrate to using one of these modules.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.xserver.desktopManager.plasma5</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.xserver.desktopManager.gnome3</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.xserver.desktopManager.pantheon</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.xserver.desktopManager.mate</code>
              Note Mate uses
              <code class="literal">programs.system-config-printer</code> as it
              doesn't use it as a service, but its graphical interface
              directly.
            </p></li></ul></div></li><li class="listitem"><p>
          <a class="link" href="options.html#opt-services.blueman.enable" target="_top">services.blueman.enable</a>
          has been added. If you previously had blueman installed via
          <code class="literal">environment.systemPackages</code> please migrate
          to using the NixOS module, as this would result in an
          insufficiently configured blueman.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.09-incompatibilities"></a>B.6.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Buildbot no longer supports Python 2, as support was dropped
          upstream in version 2.0.0. Configurations may need to be
          modified to make them compatible with Python 3.
        </p></li><li class="listitem"><p>
          PostgreSQL now uses <code class="literal">/run/postgresql</code> as its
          socket directory instead of <code class="literal">/tmp</code>. So if you
          run an application like eg. Nextcloud, where you need to use
          the Unix socket path as the database host name, you need to
          change it accordingly.
        </p></li><li class="listitem"><p>
          PostgreSQL 9.4 is scheduled EOL during the 19.09 life cycle
          and has been removed.
        </p></li><li class="listitem"><p>
          The options
          <code class="literal">services.prometheus.alertmanager.user</code> and
          <code class="literal">services.prometheus.alertmanager.group</code> have
          been removed because the alertmanager service is now using
          systemd's
          <a class="link" href="http://0pointer.net/blog/dynamic-users-with-systemd.html" target="_top">
          DynamicUser mechanism</a> which obviates these options.
        </p></li><li class="listitem"><p>
          The NetworkManager systemd unit was renamed back from
          network-manager.service to NetworkManager.service for better
          compatibility with other applications expecting this name. The
          same applies to ModemManager where modem-manager.service is
          now called ModemManager.service again.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.nzbget.configFile</code> and
          <code class="literal">services.nzbget.openFirewall</code> options were
          removed as they are managed internally by the nzbget. The
          <code class="literal">services.nzbget.dataDir</code> option hadn't
          actually been used by the module for some time and so was
          removed as cleanup.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.mysql.pidDir</code> option was
          removed, as it was only used by the wordpress apache-httpd
          service to wait for mysql to have started up. This can be
          accomplished by either describing a dependency on
          mysql.service (preferred) or waiting for the (hardcoded)
          <code class="literal">/run/mysqld/mysql.sock</code> file to appear.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.emby.enable</code> module has been
          removed, see <code class="literal">services.jellyfin.enable</code>
          instead for a free software fork of Emby. See the Jellyfin
          documentation:
          <a class="link" href="https://jellyfin.readthedocs.io/en/latest/administrator-docs/migrate-from-emby/" target="_top">
          Migrating from Emby to Jellyfin </a>
        </p></li><li class="listitem"><p>
          IPv6 Privacy Extensions are now enabled by default for
          undeclared interfaces. The previous behaviour was quite
          misleading — even though the default value for
          <code class="literal">networking.interfaces.*.preferTempAddress</code>
          was <code class="literal">true</code>, undeclared interfaces would not
          prefer temporary addresses. Now, interfaces not mentioned in
          the config will prefer temporary addresses. EUI64 addresses
          can still be set as preferred by explicitly setting the option
          to <code class="literal">false</code> for the interface in question.
        </p></li><li class="listitem"><p>
          Since Bittorrent Sync was superseded by Resilio Sync in 2016,
          the <code class="literal">bittorrentSync</code>,
          <code class="literal">bittorrentSync14</code>, and
          <code class="literal">bittorrentSync16</code> packages have been removed
          in favor of <code class="literal">resilio-sync</code>.
        </p><p>
          The corresponding module, <code class="literal">services.btsync</code>
          has been replaced by the <code class="literal">services.resilio</code>
          module.
        </p></li><li class="listitem"><p>
          The httpd service no longer attempts to start the postgresql
          service. If you have come to depend on this behaviour then you
          can preserve the behavior with the following configuration:
          <code class="literal">systemd.services.httpd.after = [ "postgresql.service" ];</code>
        </p><p>
          The option <code class="literal">services.httpd.extraSubservices</code>
          has been marked as deprecated. You may still use this feature,
          but it will be removed in a future release of NixOS. You are
          encouraged to convert any httpd subservices you may have
          written to a full NixOS module.
        </p><p>
          Most of the httpd subservices packaged with NixOS have been
          replaced with full NixOS modules including LimeSurvey,
          WordPress, and Zabbix. These modules can be enabled using the
          <code class="literal">services.limesurvey.enable</code>,
          <code class="literal">services.mediawiki.enable</code>,
          <code class="literal">services.wordpress.enable</code>, and
          <code class="literal">services.zabbixWeb.enable</code> options.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">systemd.network.networks.&lt;name&gt;.routes.*.routeConfig.GatewayOnlink</code>
          was renamed to
          <code class="literal">systemd.network.networks.&lt;name&gt;.routes.*.routeConfig.GatewayOnLink</code>
          (capital <code class="literal">L</code>). This follows
          <a class="link" href="https://github.com/systemd/systemd/commit/9cb8c5593443d24c19e40bfd4fc06d672f8c554c" target="_top">
          upstreams renaming </a> of the setting.
        </p></li><li class="listitem"><p>
          As of this release the NixOps feature
          <code class="literal">autoLuks</code> is deprecated. It no longer works
          with our systemd version without manual intervention.
        </p><p>
          Whenever the usage of the module is detected the evaluation
          will fail with a message explaining why and how to deal with
          the situation.
        </p><p>
          A new knob named
          <code class="literal">nixops.enableDeprecatedAutoLuks</code> has been
          introduced to disable the eval failure and to acknowledge the
          notice was received and read. If you plan on using the feature
          please note that it might break with subsequent updates.
        </p><p>
          Make sure you set the <code class="literal">_netdev</code> option for
          each of the file systems referring to block devices provided
          by the autoLuks module. Not doing this might render the system
          in a state where it doesn't boot anymore.
        </p><p>
          If you are actively using the <code class="literal">autoLuks</code>
          module please let us know in
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/62211" target="_top">issue
          #62211</a>.
        </p></li><li class="listitem"><p>
          The setopt declarations will be evaluated at the end of
          <code class="literal">/etc/zshrc</code>, so any code in
          <a class="link" href="options.html#opt-programs.zsh.interactiveShellInit" target="_top">programs.zsh.interactiveShellInit</a>,
          <a class="link" href="options.html#opt-programs.zsh.loginShellInit" target="_top">programs.zsh.loginShellInit</a>
          and
          <a class="link" href="options.html#opt-programs.zsh.promptInit" target="_top">programs.zsh.promptInit</a>
          may break if it relies on those options being set.
        </p></li><li class="listitem"><p>
          The <code class="literal">prometheus-nginx-exporter</code> package now
          uses the offical exporter provided by NGINX Inc. Its metrics
          are differently structured and are incompatible to the old
          ones. For information about the metrics, have a look at the
          <a class="link" href="https://github.com/nginxinc/nginx-prometheus-exporter" target="_top">official
          repo</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">shibboleth-sp</code> package has been updated
          to version 3. It is largely backward compatible, for further
          information refer to the
          <a class="link" href="https://wiki.shibboleth.net/confluence/display/SP3/ReleaseNotes" target="_top">release
          notes</a> and
          <a class="link" href="https://wiki.shibboleth.net/confluence/display/SP3/UpgradingFromV2" target="_top">upgrade
          guide</a>.
        </p><p>
          Nodejs 8 is scheduled EOL under the lifetime of 19.09 and has
          been dropped.
        </p></li><li class="listitem"><p>
          By default, prometheus exporters are now run with
          <code class="literal">DynamicUser</code> enabled. Exporters that need a
          real user, now run under a seperate user and group which
          follow the pattern
          <code class="literal">&lt;exporter-name&gt;-exporter</code>, instead of
          the previous default <code class="literal">nobody</code> and
          <code class="literal">nogroup</code>. Only some exporters are affected
          by the latter, namely the exporters
          <code class="literal">dovecot</code>, <code class="literal">node</code>,
          <code class="literal">postfix</code> and <code class="literal">varnish</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">ibus-qt</code> package is not installed by
          default anymore when
          <a class="link" href="options.html#opt-i18n.inputMethod.enabled" target="_top">i18n.inputMethod.enabled</a>
          is set to <code class="literal">ibus</code>. If IBus support in Qt 4.x
          applications is required, add the <code class="literal">ibus-qt</code>
          package to your
          <a class="link" href="options.html#opt-environment.systemPackages" target="_top">environment.systemPackages</a>
          manually.
        </p></li><li class="listitem"><p>
          The CUPS Printing service now uses socket-based activation by
          default, only starting when needed. The previous behavior can
          be restored by setting
          <code class="literal">services.cups.startWhenNeeded</code> to
          <code class="literal">false</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.systemhealth</code> module has been
          removed from nixpkgs due to lack of maintainer.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.mantisbt</code> module has been
          removed from nixpkgs due to lack of maintainer.
        </p></li><li class="listitem"><p>
          Squid 3 has been removed and the <code class="literal">squid</code>
          derivation now refers to Squid 4.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.pdns-recursor.extraConfig</code>
          option has been replaced by
          <code class="literal">services.pdns-recursor.settings</code>. The new
          option allows setting extra configuration while being better
          type-checked and mergeable.
        </p></li><li class="listitem"><p>
          No service depends on <code class="literal">keys.target</code> anymore
          which is a systemd target that indicates if all
          <a class="link" href="https://nixos.org/nixops/manual/#idm140737322342384" target="_top">NixOps
          keys</a> were successfully uploaded. Instead,
          <code class="literal">&lt;key-name&gt;-key.service</code> should be used
          to define a dependency of a key in a service. The full issue
          behind the <code class="literal">keys.target</code> dependency is
          described at
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/67265" target="_top">NixOS/nixpkgs#67265</a>.
        </p><p>
          The following services are affected by this:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.dovecot2.enable" target="_top"><code class="literal">services.dovecot2</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.nsd.enable" target="_top"><code class="literal">services.nsd</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.softether.enable" target="_top"><code class="literal">services.softether</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.strongswan.enable" target="_top"><code class="literal">services.strongswan</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.strongswan-swanctl.enable" target="_top"><code class="literal">services.strongswan-swanctl</code></a>
            </p></li><li class="listitem"><p>
              <a class="link" href="options.html#opt-services.httpd.enable" target="_top"><code class="literal">services.httpd</code></a>
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">security.acme.directory</code> option has been
          replaced by a read-only
          <code class="literal">security.acme.certs.&lt;cert&gt;.directory</code>
          option for each certificate you define. This will be a
          subdirectory of <code class="literal">/var/lib/acme</code>. You can use
          this read-only option to figure out where the certificates are
          stored for a specific certificate. For example, the
          <code class="literal">services.nginx.virtualhosts.&lt;name&gt;.enableACME</code>
          option will use this directory option to find the certs for
          the virtual host.
        </p><p>
          <code class="literal">security.acme.preDelay</code> and
          <code class="literal">security.acme.activationDelay</code> options have
          been removed. To execute a service before certificates are
          provisioned or renewed add a
          <code class="literal">RequiredBy=acme-${cert}.service</code> to any
          service.
        </p><p>
          Furthermore, the acme module will not automatically add a
          dependency on <code class="literal">lighttpd.service</code> anymore. If
          you are using certficates provided by letsencrypt for
          lighttpd, then you should depend on the certificate service
          <code class="literal">acme-${cert}.service&gt;</code> manually.
        </p><p>
          For nginx, the dependencies are still automatically managed
          when
          <code class="literal">services.nginx.virtualhosts.&lt;name&gt;.enableACME</code>
          is enabled just like before. What changed is that nginx now
          directly depends on the specific certificates that it needs,
          instead of depending on the catch-all
          <code class="literal">acme-certificates.target</code>. This target unit
          was also removed from the codebase. This will mean nginx will
          no longer depend on certificates it isn't explicitly managing
          and fixes a bug with certificate renewal ordering racing with
          nginx restarting which could lead to nginx getting in a broken
          state as described at
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/60180" target="_top">NixOS/nixpkgs#60180</a>.
        </p></li><li class="listitem"><p>
          The old deprecated <code class="literal">emacs</code> package sets have
          been dropped. What used to be called
          <code class="literal">emacsPackagesNg</code> is now simply called
          <code class="literal">emacsPackages</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.xserver.desktopManager.xterm</code> is
          now disabled by default if <code class="literal">stateVersion</code> is
          19.09 or higher. Previously the xterm desktopManager was
          enabled when xserver was enabled, but it isn't useful for all
          people so it didn't make sense to have any desktopManager
          enabled default.
        </p></li><li class="listitem"><p>
          The WeeChat plugin
          <code class="literal">pkgs.weechatScripts.weechat-xmpp</code> has been
          removed as it doesn't receive any updates from upstream and
          depends on outdated Python2-based modules.
        </p></li><li class="listitem"><p>
          Old unsupported versions (<code class="literal">logstash5</code>,
          <code class="literal">kibana5</code>, <code class="literal">filebeat5</code>,
          <code class="literal">heartbeat5</code>, <code class="literal">metricbeat5</code>,
          <code class="literal">packetbeat5</code>) of the ELK-stack and Elastic
          beats have been removed.
        </p></li><li class="listitem"><p>
          For NixOS 19.03, both Prometheus 1 and 2 were available to
          allow for a seamless transition from version 1 to 2 with
          existing setups. Because Prometheus 1 is no longer developed,
          it was removed. Prometheus 2 is now configured with
          <code class="literal">services.prometheus</code>.
        </p></li><li class="listitem"><p>
          Citrix Receiver (<code class="literal">citrix_receiver</code>) has been
          dropped in favor of Citrix Workspace
          (<code class="literal">citrix_workspace</code>).
        </p></li><li class="listitem"><p>
          The <code class="literal">services.gitlab</code> module has had its
          literal secret options
          (<code class="literal">services.gitlab.smtp.password</code>,
          <code class="literal">services.gitlab.databasePassword</code>,
          <code class="literal">services.gitlab.initialRootPassword</code>,
          <code class="literal">services.gitlab.secrets.secret</code>,
          <code class="literal">services.gitlab.secrets.db</code>,
          <code class="literal">services.gitlab.secrets.otp</code> and
          <code class="literal">services.gitlab.secrets.jws</code>) replaced by
          file-based versions
          (<code class="literal">services.gitlab.smtp.passwordFile</code>,
          <code class="literal">services.gitlab.databasePasswordFile</code>,
          <code class="literal">services.gitlab.initialRootPasswordFile</code>,
          <code class="literal">services.gitlab.secrets.secretFile</code>,
          <code class="literal">services.gitlab.secrets.dbFile</code>,
          <code class="literal">services.gitlab.secrets.otpFile</code> and
          <code class="literal">services.gitlab.secrets.jwsFile</code>). This was
          done so that secrets aren't stored in the world-readable nix
          store, but means that for each option you'll have to create a
          file with the same exact string, add "File" to the
          end of the option name, and change the definition to a string
          pointing to the corresponding file; e.g.
          <code class="literal">services.gitlab.databasePassword = "supersecurepassword"</code>
          becomes
          <code class="literal">services.gitlab.databasePasswordFile = "/path/to/secret_file"</code>
          where the file <code class="literal">secret_file</code> contains the
          string <code class="literal">supersecurepassword</code>.
        </p><p>
          The state path (<code class="literal">services.gitlab.statePath</code>)
          now has the following restriction: no parent directory can be
          owned by any other user than <code class="literal">root</code> or the
          user specified in <code class="literal">services.gitlab.user</code>;
          i.e. if <code class="literal">services.gitlab.statePath</code> is set to
          <code class="literal">/var/lib/gitlab/state</code>,
          <code class="literal">gitlab</code> and all parent directories must be
          owned by either <code class="literal">root</code> or the user specified
          in <code class="literal">services.gitlab.user</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">networking.useDHCP</code> option is
          unsupported in combination with
          <code class="literal">networking.useNetworkd</code> in anticipation of
          defaulting to it. It has to be set to <code class="literal">false</code>
          and enabled per interface with
          <code class="literal">networking.interfaces.&lt;name&gt;.useDHCP = true;</code>
        </p></li><li class="listitem"><p>
          The Twitter client <code class="literal">corebird</code> has been
          dropped as
          <a class="link" href="https://www.patreon.com/posts/corebirds-future-18921328" target="_top">it
          is discontinued and does not work against the new Twitter
          API</a>. Please use the fork <code class="literal">cawbird</code>
          instead which has been adapted to the API changes and is still
          maintained.
        </p></li><li class="listitem"><p>
          The <code class="literal">nodejs-11_x</code> package has been removed as
          it's EOLed by upstream.
        </p></li><li class="listitem"><p>
          Because of the systemd upgrade, systemd-timesyncd will no
          longer work if <code class="literal">system.stateVersion</code> is not
          set correctly. When upgrading from NixOS 19.03, please make
          sure that <code class="literal">system.stateVersion</code> is set to
          <code class="literal">"19.03"</code>, or lower if the
          installation dates back to an earlier version of NixOS.
        </p></li><li class="listitem"><p>
          Due to the short lifetime of non-LTS kernel releases package
          attributes like <code class="literal">linux_5_1</code>,
          <code class="literal">linux_5_2</code> and <code class="literal">linux_5_3</code>
          have been removed to discourage dependence on specific non-LTS
          kernel versions in stable NixOS releases. Going forward,
          versioned attributes like <code class="literal">linux_4_9</code> will
          exist for LTS versions only. Please use
          <code class="literal">linux_latest</code> or
          <code class="literal">linux_testing</code> if you depend on non-LTS
          releases. Keep in mind that <code class="literal">linux_latest</code>
          and <code class="literal">linux_testing</code> will change versions
          under the hood during the lifetime of a stable release and
          might include breaking changes.
        </p></li><li class="listitem"><p>
          Because of the systemd upgrade, some network interfaces might
          change their name. For details see
          <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.net-naming-scheme.html#History" target="_top">
          upstream docs</a> or
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/71086" target="_top">
          our ticket</a>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.09-notable-changes"></a>B.6.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">documentation</code> module gained an option
          named <code class="literal">documentation.nixos.includeAllModules</code>
          which makes the generated configuration.nix 5 manual page
          include all options from all NixOS modules included in a given
          <code class="literal">configuration.nix</code> configuration file.
          Currently, it is set to <code class="literal">false</code> by default as
          enabling it frequently prevents evaluation. But the plan is to
          eventually have it set to <code class="literal">true</code> by default.
          Please set it to <code class="literal">true</code> now in your
          <code class="literal">configuration.nix</code> and fix all the bugs it
          uncovers.
        </p></li><li class="listitem"><p>
          The <code class="literal">vlc</code> package gained support for
          Chromecast streaming, enabled by default. TCP port 8010 must
          be open for it to work, so something like
          <code class="literal">networking.firewall.allowedTCPPorts = [ 8010 ];</code>
          may be required in your configuration. Also consider enabling
          <a class="link" href="https://nixos.wiki/wiki/Accelerated_Video_Playback" target="_top">
          Accelerated Video Playback</a> for better transcoding
          performance.
        </p></li><li class="listitem"><p>
          The following changes apply if the
          <code class="literal">stateVersion</code> is changed to 19.09 or higher.
          For <code class="literal">stateVersion = "19.03"</code> or
          lower the old behavior is preserved.
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">solr.package</code> defaults to
              <code class="literal">pkgs.solr_8</code>.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">hunspellDicts.fr-any</code> dictionary now
          ships with <code class="literal">fr_FR.{aff,dic}</code> which is linked
          to <code class="literal">fr-toutesvariantes.{aff,dic}</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">mysql</code> service now runs as
          <code class="literal">mysql</code> user. Previously, systemd did execute
          it as root, and mysql dropped privileges itself. This includes
          <code class="literal">ExecStartPre=</code> and
          <code class="literal">ExecStartPost=</code> phases. To accomplish that,
          runtime and data directory setup was delegated to
          RuntimeDirectory and tmpfiles.
        </p></li><li class="listitem"><p>
          With the upgrade to systemd version 242 the
          <code class="literal">systemd-timesyncd</code> service is no longer
          using <code class="literal">DynamicUser=yes</code>. In order for the
          upgrade to work we rely on an activation script to move the
          state from the old to the new directory. The older directory
          (prior <code class="literal">19.09</code>) was
          <code class="literal">/var/lib/private/systemd/timesync</code>.
        </p><p>
          As long as the <code class="literal">system.config.stateVersion</code>
          is below <code class="literal">19.09</code> the state folder will
          migrated to its proper location
          (<code class="literal">/var/lib/systemd/timesync</code>), if required.
        </p></li><li class="listitem"><p>
          The package <code class="literal">avahi</code> is now built to look up
          service definitions from
          <code class="literal">/etc/avahi/services</code> instead of its output
          directory in the nix store. Accordingly the module
          <code class="literal">avahi</code> now supports custom service
          definitions via
          <code class="literal">services.avahi.extraServiceFiles</code>, which are
          then placed in the aforementioned directory. See
          avahi.service5 for more information on custom service
          definitions.
        </p></li><li class="listitem"><p>
          Since version 0.1.19, <code class="literal">cargo-vendor</code> honors
          package includes that are specified in the
          <code class="literal">Cargo.toml</code> file of Rust crates.
          <code class="literal">rustPlatform.buildRustPackage</code> uses
          <code class="literal">cargo-vendor</code> to collect and build dependent
          crates. Since this change in <code class="literal">cargo-vendor</code>
          changes the set of vendored files for most Rust packages, the
          hash that use used to verify the dependencies,
          <code class="literal">cargoSha256</code>, also changes.
        </p><p>
          The <code class="literal">cargoSha256</code> hashes of all in-tree
          derivations that use <code class="literal">buildRustPackage</code> have
          been updated to reflect this change. However, third-party
          derivations that use <code class="literal">buildRustPackage</code> may
          have to be updated as well.
        </p></li><li class="listitem"><p>
          The <code class="literal">consul</code> package was upgraded past
          version <code class="literal">1.5</code>, so its deprecated legacy UI is
          no longer available.
        </p></li><li class="listitem"><p>
          The default resample-method for PulseAudio has been changed
          from the upstream default <code class="literal">speex-float-1</code> to
          <code class="literal">speex-float-5</code>. Be aware that low-powered
          ARM-based and MIPS-based boards will struggle with this so
          you'll need to set
          <code class="literal">hardware.pulseaudio.daemon.config.resample-method</code>
          back to <code class="literal">speex-float-1</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">phabricator</code> package and associated
          <code class="literal">httpd.extraSubservice</code>, as well as the
          <code class="literal">phd</code> service have been removed from nixpkgs
          due to lack of maintainer.
        </p></li><li class="listitem"><p>
          The <code class="literal">mercurial</code>
          <code class="literal">httpd.extraSubservice</code> has been removed from
          nixpkgs due to lack of maintainer.
        </p></li><li class="listitem"><p>
          The <code class="literal">trac</code>
          <code class="literal">httpd.extraSubservice</code> has been removed from
          nixpkgs because it was unmaintained.
        </p></li><li class="listitem"><p>
          The <code class="literal">foswiki</code> package and associated
          <code class="literal">httpd.extraSubservice</code> have been removed
          from nixpkgs due to lack of maintainer.
        </p></li><li class="listitem"><p>
          The <code class="literal">tomcat-connector</code>
          <code class="literal">httpd.extraSubservice</code> has been removed from
          nixpkgs.
        </p></li><li class="listitem"><p>
          It's now possible to change configuration in
          <a class="link" href="options.html#opt-services.nextcloud.enable" target="_top">services.nextcloud</a>
          after the initial deploy since all config parameters are
          persisted in an additional config file generated by the
          module. Previously core configuration like database parameters
          were set using their imperative installer after creating
          <code class="literal">/var/lib/nextcloud</code>.
        </p></li><li class="listitem"><p>
          There exists now <code class="literal">lib.forEach</code>, which is like
          <code class="literal">map</code>, but with arguments flipped. When
          mapping function body spans many lines (or has nested
          <code class="literal">map</code>s), it is often hard to follow which
          list is modified.
        </p><p>
          Previous solution to this problem was either to use
          <code class="literal">lib.flip map</code> idiom or extract that
          anonymous mapping function to a named one. Both can still be
          used but <code class="literal">lib.forEach</code> is preferred over
          <code class="literal">lib.flip map</code>.
        </p><p>
          The <code class="literal">/etc/sysctl.d/nixos.conf</code> file
          containing all the options set via
          <a class="link" href="options.html#opt-boot.kernel.sysctl" target="_top">boot.kernel.sysctl</a>
          was moved to <code class="literal">/etc/sysctl.d/60-nixos.conf</code>,
          as sysctl.d5 recommends prefixing all filenames in
          <code class="literal">/etc/sysctl.d</code> with a two-digit number and a
          dash to simplify the ordering of the files.
        </p></li><li class="listitem"><p>
          We now install the sysctl snippets shipped with systemd.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Loose reverse path filtering
            </p></li><li class="listitem"><p>
              Source route filtering
            </p></li><li class="listitem"><p>
              <code class="literal">fq_codel</code> as a packet scheduler (this
              helps to fight bufferbloat)
            </p></li></ul></div><p>
          This also configures the kernel to pass core dumps to
          <code class="literal">systemd-coredump</code>, and restricts the SysRq
          key combinations to the sync command only. These sysctl
          snippets can be found in
          <code class="literal">/etc/sysctl.d/50-*.conf</code>, and overridden via
          <a class="link" href="options.html#opt-boot.kernel.sysctl" target="_top">boot.kernel.sysctl</a>
          (which will place the parameters in
          <code class="literal">/etc/sysctl.d/60-nixos.conf</code>).
        </p></li><li class="listitem"><p>
          Core dumps are now processed by
          <code class="literal">systemd-coredump</code> by default.
          <code class="literal">systemd-coredump</code> behaviour can still be
          modified via <code class="literal">systemd.coredump.extraConfig</code>.
          To stick to the old behaviour (having the kernel dump to a
          file called <code class="literal">core</code> in the working directory),
          without piping it through <code class="literal">systemd-coredump</code>,
          set <code class="literal">systemd.coredump.enable</code> to
          <code class="literal">false</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">systemd.packages</code> option now also supports
          generators and shutdown scripts. Old
          <code class="literal">systemd.generator-packages</code> option has been
          removed.
        </p></li><li class="listitem"><p>
          The <code class="literal">rmilter</code> package was removed with
          associated module and options due deprecation by upstream
          developer. Use <code class="literal">rspamd</code> in proxy mode
          instead.
        </p></li><li class="listitem"><p>
          systemd cgroup accounting via the
          <a class="link" href="options.html#opt-systemd.enableCgroupAccounting" target="_top">systemd.enableCgroupAccounting</a>
          option is now enabled by default. It now also enables the more
          recent Block IO and IP accounting features.
        </p></li><li class="listitem"><p>
          We no longer enable custom font rendering settings with
          <code class="literal">fonts.fontconfig.penultimate.enable</code> by
          default. The defaults from fontconfig are sufficient.
        </p></li><li class="listitem"><p>
          The <code class="literal">crashplan</code> package and the
          <code class="literal">crashplan</code> service have been removed from
          nixpkgs due to crashplan shutting down the service, while the
          <code class="literal">crashplansb</code> package and
          <code class="literal">crashplan-small-business</code> service have been
          removed from nixpkgs due to lack of maintainer.
        </p><p>
          The
          <a class="link" href="options.html#opt-services.redis.enable" target="_top">redis
          module</a> was hardcoded to use the
          <code class="literal">redis</code> user, <code class="literal">/run/redis</code>
          as runtime directory and <code class="literal">/var/lib/redis</code> as
          state directory. Note that the NixOS module for Redis now
          disables kernel support for Transparent Huge Pages (THP),
          because this features causes major performance problems for
          Redis, e.g. (https://redis.io/topics/latency).
        </p></li><li class="listitem"><p>
          Using <code class="literal">fonts.enableDefaultFonts</code> adds a
          default emoji font <code class="literal">noto-fonts-emoji</code>.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.xserver.enable</code>
            </p></li><li class="listitem"><p>
              <code class="literal">programs.sway.enable</code>
            </p></li><li class="listitem"><p>
              <code class="literal">programs.way-cooler.enable</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.xrdp.enable</code>
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">altcoins</code> categorization of packages has
          been removed. You now access these packages at the top level,
          ie. <code class="literal">nix-shell -p dogecoin</code> instead of
          <code class="literal">nix-shell -p altcoins.dogecoin</code>, etc.
        </p></li><li class="listitem"><p>
          Ceph has been upgraded to v14.2.1. See the
          <a class="link" href="https://ceph.com/releases/v14-2-0-nautilus-released/" target="_top">release
          notes</a> for details. The mgr dashboard as well as osds
          backed by loop-devices is no longer explicitly supported by
          the package and module. Note: There's been some issues with
          python-cherrypy, which is used by the dashboard and prometheus
          mgr modules (and possibly others), hence
          0000-dont-check-cherrypy-version.patch.
        </p></li><li class="listitem"><p>
          <code class="literal">pkgs.weechat</code> is now compiled against
          <code class="literal">pkgs.python3</code>. Weechat also recommends
          <a class="link" href="https://weechat.org/scripts/python3/" target="_top">to use
          Python3 in their docs.</a>
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-19.03"></a>B.7. Release 19.03 (<span class="quote">“<span class="quote">Koi</span>”</span>, 2019/04/11)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.03-highlights"></a>B.7.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          End of support is planned for end of October 2019, handing
          over to 19.09.
        </p></li><li class="listitem"><p>
          The default Python 3 interpreter is now CPython 3.7 instead of
          CPython 3.6.
        </p></li><li class="listitem"><p>
          Added the Pantheon desktop environment. It can be enabled
          through
          <code class="literal">services.xserver.desktopManager.pantheon.enable</code>.
        </p><div class="note"><h3 class="title">Note</h3><p>
            By default,
            <code class="literal">services.xserver.desktopManager.pantheon</code>
            enables LightDM as a display manager, as pantheon's screen
            locking implementation relies on it. Because of that it is
            recommended to leave LightDM enabled. If you'd like to
            disable it anyway, set
            <code class="literal">services.xserver.displayManager.lightdm.enable</code>
            to <code class="literal">false</code> and enable your preferred
            display manager.
          </p></div><p>
          Also note that Pantheon's LightDM greeter is not enabled by
          default, because it has numerous issues in NixOS and isn't
          optimal for use here yet.
        </p></li><li class="listitem"><p>
          A major refactoring of the Kubernetes module has been
          completed. Refactorings primarily focus on decoupling
          components and enhancing security. Two-way TLS and RBAC has
          been enabled by default for all components, which slightly
          changes the way the module is configured. See:
          <a class="xref" href="index.html#sec-kubernetes" title="Chapter 56. Kubernetes">Chapter 56, <em>Kubernetes</em></a> for details.
        </p></li><li class="listitem"><p>
          There is now a set of <code class="literal">confinement</code> options
          for <code class="literal">systemd.services</code>, which allows to
          restrict services into a chroot 2 ed environment that only
          contains the store paths from the runtime closure of the
          service.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.03-new-services"></a>B.7.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">./programs/nm-applet.nix</code>
        </p></li><li class="listitem"><p>
          There is a new <code class="literal">security.googleOsLogin</code>
          module for using
          <a class="link" href="https://cloud.google.com/compute/docs/instances/managing-instance-access" target="_top">OS
          Login</a> to manage SSH access to Google Compute Engine
          instances, which supersedes the imperative and broken
          <code class="literal">google-accounts-daemon</code> used in
          <code class="literal">nixos/modules/virtualisation/google-compute-config.nix</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/beanstalkd.nix</code>
        </p></li><li class="listitem"><p>
          There is a new <code class="literal">services.cockroachdb</code> module
          for running CockroachDB databases. NixOS now ships with
          CockroachDB 2.1.x as well, available on
          <code class="literal">x86_64-linux</code> and
          <code class="literal">aarch64-linux</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">./security/duosec.nix</code>
        </p></li><li class="listitem"><p>
          The <a class="link" href="https://duo.com/docs/duounix" target="_top">PAM module
          for Duo Security</a> has been enabled for use. One can
          configure it using the <code class="literal">security.duosec</code>
          options along with the corresponding PAM option in
          <code class="literal">security.pam.services.&lt;name?&gt;.duoSecurity.enable</code>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.03-incompatibilities"></a>B.7.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The minimum version of Nix required to evaluate Nixpkgs is now
          2.0.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For users of NixOS 18.03 and 19.03, NixOS defaults to Nix
              2.0, but supports using Nix 1.11 by setting
              <code class="literal">nix.package = pkgs.nix1;</code>. If this
              option is set to a Nix 1.11 package, you will need to
              either unset the option or upgrade it to Nix 2.0.
            </p></li><li class="listitem"><p>
              For users of NixOS 17.09, you will first need to upgrade
              Nix by setting
              <code class="literal">nix.package = pkgs.nixStable2;</code> and run
              <code class="literal">nixos-rebuild switch</code> as the
              <code class="literal">root</code> user.
            </p></li><li class="listitem"><p>
              For users of a daemon-less Nix installation on Linux or
              macOS, you can upgrade Nix by running
              <code class="literal">curl -L https://nixos.org/nix/install | sh</code>,
              or prior to doing a channel update, running
              <code class="literal">nix-env -iA nix</code>. If you have already
              run a channel update and Nix is no longer able to evaluate
              Nixpkgs, the error message printed should provide adequate
              directions for upgrading Nix.
            </p></li><li class="listitem"><p>
              For users of the Nix daemon on macOS, you can upgrade Nix
              by running
              <code class="literal">sudo -i sh -c 'nix-channel --update &amp;&amp; nix-env -iA nixpkgs.nix'; sudo launchctl stop org.nixos.nix-daemon; sudo launchctl start org.nixos.nix-daemon</code>.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">buildPythonPackage</code> function now sets
          <code class="literal">strictDeps = true</code> to help distinguish
          between native and non-native dependencies in order to improve
          cross-compilation compatibility. Note however that this may
          break user expressions.
        </p></li><li class="listitem"><p>
          The <code class="literal">buildPythonPackage</code> function now sets
          <code class="literal">LANG = C.UTF-8</code> to enable Unicode support.
          The <code class="literal">glibcLocales</code> package is no longer
          needed as a build input.
        </p></li><li class="listitem"><p>
          The Syncthing state and configuration data has been moved from
          <code class="literal">services.syncthing.dataDir</code> to the newly
          defined <code class="literal">services.syncthing.configDir</code>, which
          default to
          <code class="literal">/var/lib/syncthing/.config/syncthing</code>. This
          change makes possible to share synced directories using ACLs
          without Syncthing resetting the permission on every start.
        </p></li><li class="listitem"><p>
          The <code class="literal">ntp</code> module now has sane default
          restrictions. If you're relying on the previous defaults,
          which permitted all queries and commands from all
          firewall-permitted sources, you can set
          <code class="literal">services.ntp.restrictDefault</code> and
          <code class="literal">services.ntp.restrictSource</code> to
          <code class="literal">[]</code>.
        </p></li><li class="listitem"><p>
          Package <code class="literal">rabbitmq_server</code> is renamed to
          <code class="literal">rabbitmq-server</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">light</code> module no longer uses setuid
          binaries, but udev rules. As a consequence users of that
          module have to belong to the <code class="literal">video</code> group in
          order to use the executable (i.e.
          <code class="literal">users.users.yourusername.extraGroups = ["video"];</code>).
        </p></li><li class="listitem"><p>
          Buildbot now supports Python 3 and its packages have been
          moved to <code class="literal">pythonPackages</code>. The options
          <code class="literal">services.buildbot-master.package</code> and
          <code class="literal">services.buildbot-worker.package</code> can be
          used to select the Python 2 or 3 version of the package.
        </p></li><li class="listitem"><p>
          Options
          <code class="literal">services.znc.confOptions.networks.name.userName</code>
          and
          <code class="literal">services.znc.confOptions.networks.name.modulePackages</code>
          were removed. They were never used for anything and can
          therefore safely be removed.
        </p></li><li class="listitem"><p>
          Package <code class="literal">wasm</code> has been renamed
          <code class="literal">proglodyte-wasm</code>. The package
          <code class="literal">wasm</code> will be pointed to
          <code class="literal">ocamlPackages.wasm</code> in 19.09, so make sure
          to update your configuration if you want to keep
          <code class="literal">proglodyte-wasm</code>
        </p></li><li class="listitem"><p>
          When the <code class="literal">nixpkgs.pkgs</code> option is set, NixOS
          will no longer ignore the <code class="literal">nixpkgs.overlays</code>
          option. The old behavior can be recovered by setting
          <code class="literal">nixpkgs.overlays = lib.mkForce [];</code>.
        </p></li><li class="listitem"><p>
          OpenSMTPD has been upgraded to version 6.4.0p1. This release
          makes backwards-incompatible changes to the configuration file
          format. See <code class="literal">man smtpd.conf</code> for more
          information on the new file format.
        </p></li><li class="listitem"><p>
          The versioned <code class="literal">postgresql</code> have been renamed
          to use underscore number seperators. For example,
          <code class="literal">postgresql96</code> has been renamed to
          <code class="literal">postgresql_9_6</code>.
        </p></li><li class="listitem"><p>
          Package <code class="literal">consul-ui</code> and passthrough
          <code class="literal">consul.ui</code> have been removed. The package
          <code class="literal">consul</code> now uses upstream releases that
          vendor the UI into the binary. See
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/48714#issuecomment-433454834" target="_top">#48714</a>
          for details.
        </p></li><li class="listitem"><p>
          Slurm introduces the new option
          <code class="literal">services.slurm.stateSaveLocation</code>, which is
          now set to <code class="literal">/var/spool/slurm</code> by default
          (instead of <code class="literal">/var/spool</code>). Make sure to move
          all files to the new directory or to set the option
          accordingly.
        </p><p>
          The slurmctld now runs as user <code class="literal">slurm</code>
          instead of <code class="literal">root</code>. If you want to keep
          slurmctld running as <code class="literal">root</code>, set
          <code class="literal">services.slurm.user = root</code>.
        </p><p>
          The options <code class="literal">services.slurm.nodeName</code> and
          <code class="literal">services.slurm.partitionName</code> are now sets
          of strings to correctly reflect that fact that each of these
          options can occour more than once in the configuration.
        </p></li><li class="listitem"><p>
          The <code class="literal">solr</code> package has been upgraded from
          4.10.3 to 7.5.0 and has undergone some major changes. The
          <code class="literal">services.solr</code> module has been updated to
          reflect these changes. Please review
          http://lucene.apache.org/solr/ carefully before upgrading.
        </p></li><li class="listitem"><p>
          Package <code class="literal">ckb</code> is renamed to
          <code class="literal">ckb-next</code>, and options
          <code class="literal">hardware.ckb.*</code> are renamed to
          <code class="literal">hardware.ckb-next.*</code>.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.xserver.displayManager.job.logToFile</code>
          which was previously set to <code class="literal">true</code> when using
          the display managers <code class="literal">lightdm</code>,
          <code class="literal">sddm</code> or <code class="literal">xpra</code> has been
          reset to the default value (<code class="literal">false</code>).
        </p></li><li class="listitem"><p>
          Network interface indiscriminate NixOS firewall options
          (<code class="literal">networking.firewall.allow*</code>) are now
          preserved when also setting interface specific rules such as
          <code class="literal">networking.firewall.interfaces.en0.allow*</code>.
          These rules continue to use the pseudo device
          "default"
          (<code class="literal">networking.firewall.interfaces.default.*</code>),
          and assigning to this pseudo device will override the
          (<code class="literal">networking.firewall.allow*</code>) options.
        </p></li><li class="listitem"><p>
          The <code class="literal">nscd</code> service now disables all caching
          of <code class="literal">passwd</code> and <code class="literal">group</code>
          databases by default. This was interferring with the correct
          functioning of the <code class="literal">libnss_systemd.so</code> module
          which is used by <code class="literal">systemd</code> to manage uids and
          usernames in the presence of <code class="literal">DynamicUser=</code>
          in systemd services. This was already the default behaviour in
          presence of <code class="literal">services.sssd.enable = true</code>
          because nscd caching would interfere with
          <code class="literal">sssd</code> in unpredictable ways as well. Because
          we're using nscd not for caching, but for convincing glibc to
          find NSS modules in the nix store instead of an absolute path,
          we have decided to disable caching globally now, as it's
          usually not the behaviour the user wants and can lead to
          surprising behaviour. Furthermore, negative caching of host
          lookups is also disabled now by default. This should fix the
          issue of dns lookups failing in the presence of an unreliable
          network.
        </p><p>
          If the old behaviour is desired, this can be restored by
          setting the <code class="literal">services.nscd.config</code> option
          with the desired caching parameters.
        </p><pre class="programlisting">
{
  services.nscd.config =
  ''
  server-user             nscd
  threads                 1
  paranoia                no
  debug-level             0

  enable-cache            passwd          yes
  positive-time-to-live   passwd          600
  negative-time-to-live   passwd          20
  suggested-size          passwd          211
  check-files             passwd          yes
  persistent              passwd          no
  shared                  passwd          yes

  enable-cache            group           yes
  positive-time-to-live   group           3600
  negative-time-to-live   group           60
  suggested-size          group           211
  check-files             group           yes
  persistent              group           no
  shared                  group           yes

  enable-cache            hosts           yes
  positive-time-to-live   hosts           600
  negative-time-to-live   hosts           5
  suggested-size          hosts           211
  check-files             hosts           yes
  persistent              hosts           no
  shared                  hosts           yes
  '';
}
</pre><p>
          See
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/50316" target="_top">#50316</a>
          for details.
        </p></li><li class="listitem"><p>
          GitLab Shell previously used the nix store paths for the
          <code class="literal">gitlab-shell</code> command in its
          <code class="literal">authorized_keys</code> file, which might stop
          working after garbage collection. To circumvent that, we
          regenerated that file on each startup. As
          <code class="literal">gitlab-shell</code> has now been changed to use
          <code class="literal">/var/run/current-system/sw/bin/gitlab-shell</code>,
          this is not necessary anymore, but there might be leftover
          lines with a nix store path. Regenerate the
          <code class="literal">authorized_keys</code> file via
          <code class="literal">sudo -u git -H gitlab-rake gitlab:shell:setup</code>
          in that case.
        </p></li><li class="listitem"><p>
          The <code class="literal">pam_unix</code> account module is now loaded
          with its control field set to <code class="literal">required</code>
          instead of <code class="literal">sufficient</code>, so that later PAM
          account modules that might do more extensive checks are being
          executed. Previously, the whole account module verification
          was exited prematurely in case a nss module provided the
          account name to <code class="literal">pam_unix</code>. The LDAP and SSSD
          NixOS modules already add their NSS modules when enabled. In
          case your setup breaks due to some later PAM account module
          previosuly shadowed, or failing NSS lookups, please file a
          bug. You can get back the old behaviour by manually setting
          <code class="literal">security.pam.services.&lt;name?&gt;.text</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">pam_unix</code> password module is now loaded
          with its control field set to <code class="literal">sufficient</code>
          instead of <code class="literal">required</code>, so that password
          managed only by later PAM password modules are being executed.
          Previously, for example, changing an LDAP account's password
          through PAM was not possible: the whole password module
          verification was exited prematurely by
          <code class="literal">pam_unix</code>, preventing
          <code class="literal">pam_ldap</code> to manage the password as it
          should.
        </p></li><li class="listitem"><p>
          <code class="literal">fish</code> has been upgraded to 3.0. It comes
          with a number of improvements and backwards incompatible
          changes. See the <code class="literal">fish</code>
          <a class="link" href="https://github.com/fish-shell/fish-shell/releases/tag/3.0.0" target="_top">release
          notes</a> for more information.
        </p></li><li class="listitem"><p>
          The ibus-table input method has had a change in config format,
          which causes all previous settings to be lost. See
          <a class="link" href="https://github.com/mike-fabian/ibus-table/commit/f9195f877c5212fef0dfa446acb328c45ba5852b" target="_top">this
          commit message</a> for details.
        </p></li><li class="listitem"><p>
          NixOS module system type <code class="literal">types.optionSet</code>
          and <code class="literal">lib.mkOption</code> argument
          <code class="literal">options</code> are deprecated. Use
          <code class="literal">types.submodule</code> instead.
          (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/54637" target="_top">#54637</a>)
        </p></li><li class="listitem"><p>
          <code class="literal">matrix-synapse</code> has been updated to version
          0.99. It will
          <a class="link" href="https://github.com/matrix-org/synapse/pull/4509" target="_top">no
          longer generate a self-signed certificate on first
          launch</a> and will be
          <a class="link" href="https://matrix.org/blog/2019/02/05/synapse-0-99-0/" target="_top">the
          last version to accept self-signed certificates</a>. As
          such, it is now recommended to use a proper certificate
          verified by a root CA (for example Let's Encrypt). The new
          <a class="link" href="index.html#module-services-matrix" title="Chapter 41. Matrix">manual chapter on
          Matrix</a> contains a working example of using nginx as a
          reverse proxy in front of <code class="literal">matrix-synapse</code>,
          using Let's Encrypt certificates.
        </p></li><li class="listitem"><p>
          <code class="literal">mailutils</code> now works by default when
          <code class="literal">sendmail</code> is not in a setuid wrapper. As a
          consequence, the <code class="literal">sendmailPath</code> argument,
          having lost its main use, has been removed.
        </p></li><li class="listitem"><p>
          <code class="literal">graylog</code> has been upgraded from version 2.*
          to 3.*. Some setups making use of extraConfig (especially
          those exposing Graylog via reverse proxies) need to be updated
          as upstream removed/replaced some settings. See
          <a class="link" href="http://docs.graylog.org/en/3.0/pages/upgrade/graylog-3.0.html#simplified-http-interface-configuration" target="_top">Upgrading
          Graylog</a> for details.
        </p></li><li class="listitem"><p>
          The option <code class="literal">users.ldap.bind.password</code> was
          renamed to <code class="literal">users.ldap.bind.passwordFile</code>,
          and needs to be readable by the <code class="literal">nslcd</code> user.
          Same applies to the new
          <code class="literal">users.ldap.daemon.rootpwmodpwFile</code> option.
        </p></li><li class="listitem"><p>
          <code class="literal">nodejs-6_x</code> is end-of-life.
          <code class="literal">nodejs-6_x</code>,
          <code class="literal">nodejs-slim-6_x</code> and
          <code class="literal">nodePackages_6_x</code> are removed.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-19.03-notable-changes"></a>B.7.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">services.matomo</code> module gained the
          option <code class="literal">services.matomo.package</code> which
          determines the used Matomo version.
        </p><p>
          The Matomo module now also comes with the systemd service
          <code class="literal">matomo-archive-processing.service</code> and a
          timer that automatically triggers archive processing every
          hour. This means that you can safely
          <a class="link" href="https://matomo.org/docs/setup-auto-archiving/#disable-browser-triggers-for-matomo-archiving-and-limit-matomo-reports-to-updating-every-hour" target="_top">
          disable browser triggers for Matomo archiving </a> at
          <code class="literal">Administration &gt; System &gt; General Settings</code>.
        </p><p>
          Additionally, you can enable to
          <a class="link" href="https://matomo.org/docs/privacy/#step-2-delete-old-visitors-logs" target="_top">
          delete old visitor logs </a> at
          <code class="literal">Administration &gt; System &gt; Privacy</code>,
          but make sure that you run
          <code class="literal">systemctl start matomo-archive-processing.service</code>
          at least once without errors if you have already collected
          data before, so that the reports get archived before the
          source data gets deleted.
        </p></li><li class="listitem"><p>
          <code class="literal">composableDerivation</code> along with supporting
          library functions has been removed.
        </p></li><li class="listitem"><p>
          The deprecated <code class="literal">truecrypt</code> package has been
          removed and <code class="literal">truecrypt</code> attribute is now an
          alias for <code class="literal">veracrypt</code>. VeraCrypt is
          backward-compatible with TrueCrypt volumes. Note that
          <code class="literal">cryptsetup</code> also supports loading TrueCrypt
          volumes.
        </p></li><li class="listitem"><p>
          The Kubernetes DNS addons, kube-dns, has been replaced with
          CoreDNS. This change is made in accordance with Kubernetes
          making CoreDNS the official default starting from
          <a class="link" href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.11.md#sig-cluster-lifecycle" target="_top">Kubernetes
          v1.11</a>. Please beware that upgrading DNS-addon on
          existing clusters might induce minor downtime while the
          DNS-addon terminates and re-initializes. Also note that the
          DNS-service now runs with 2 pod replicas by default. The
          desired number of replicas can be configured using:
          <code class="literal">services.kubernetes.addons.dns.replicas</code>.
        </p></li><li class="listitem"><p>
          The quassel-webserver package and module was removed from
          nixpkgs due to the lack of maintainers.
        </p></li><li class="listitem"><p>
          The manual gained a <a class="link" href="index.html#module-services-matrix" title="Chapter 41. Matrix">
          new chapter on self-hosting <code class="literal">matrix-synapse</code>
          and <code class="literal">riot-web</code> </a>, the most prevalent
          server and client implementations for the
          <a class="link" href="https://matrix.org/" target="_top">Matrix</a> federated
          communication network.
        </p></li><li class="listitem"><p>
          The astah-community package was removed from nixpkgs due to it
          being discontinued and the downloads not being available
          anymore.
        </p></li><li class="listitem"><p>
          The httpd service now saves log files with a .log file
          extension by default for easier integration with the logrotate
          service.
        </p></li><li class="listitem"><p>
          The owncloud server packages and httpd subservice module were
          removed from nixpkgs due to the lack of maintainers.
        </p></li><li class="listitem"><p>
          It is possible now to uze ZRAM devices as general purpose
          ephemeral block devices, not only as swap. Using more than 1
          device as ZRAM swap is no longer recommended, but is still
          possible by setting <code class="literal">zramSwap.swapDevices</code>
          explicitly.
        </p><p>
          ZRAM algorithm can be changed now.
        </p><p>
          Changes to ZRAM algorithm are applied during
          <code class="literal">nixos-rebuild switch</code>, so make sure you have
          enough swap space on disk to survive ZRAM device rebuild.
          Alternatively, use
          <code class="literal">nixos-rebuild boot; reboot</code>.
        </p></li><li class="listitem"><p>
          Flat volumes are now disabled by default in
          <code class="literal">hardware.pulseaudio</code>. This has been done to
          prevent applications, which are unaware of this feature,
          setting their volumes to 100% on startup causing harm to your
          audio hardware and potentially your ears.
        </p><div class="note"><h3 class="title">Note</h3><p>
            With this change application specific volumes are relative
            to the master volume which can be adjusted independently,
            whereas before they were absolute; meaning that in effect,
            it scaled the device-volume with the volume of the loudest
            application.
          </p></div></li><li class="listitem"><p>
          The
          <a class="link" href="https://github.com/DanielAdolfsson/ndppd" target="_top"><code class="literal">ndppd</code></a>
          module now supports
          <a class="link" href="options.html#opt-services.ndppd.enable" target="_top">all
          config options</a> provided by the current upstream version
          as service options. Additionally the <code class="literal">ndppd</code>
          package doesn't contain the systemd unit configuration from
          upstream anymore, the unit is completely configured by the
          NixOS module now.
        </p></li><li class="listitem"><p>
          New installs of NixOS will default to the Redmine 4.x series
          unless otherwise specified in
          <code class="literal">services.redmine.package</code> while existing
          installs of NixOS will default to the Redmine 3.x series.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="options.html#opt-services.grafana.enable" target="_top">Grafana
          module</a> now supports declarative
          <a class="link" href="http://docs.grafana.org/administration/provisioning/" target="_top">datasource
          and dashboard</a> provisioning.
        </p></li><li class="listitem"><p>
          The use of insecure ports on kubernetes has been deprecated.
          Thus options:
          <code class="literal">services.kubernetes.apiserver.port</code> and
          <code class="literal">services.kubernetes.controllerManager.port</code>
          has been renamed to <code class="literal">.insecurePort</code>, and
          default of both options has changed to 0 (disabled).
        </p></li><li class="listitem"><p>
          Note that the default value of
          <code class="literal">services.kubernetes.apiserver.bindAddress</code>
          has changed from 127.0.0.1 to 0.0.0.0, allowing the apiserver
          to be accessible from outside the master node itself. If the
          apiserver insecurePort is enabled, it is strongly recommended
          to only bind on the loopback interface. See:
          <code class="literal">services.kubernetes.apiserver.insecurebindAddress</code>.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.kubernetes.apiserver.allowPrivileged</code>
          and
          <code class="literal">services.kubernetes.kubelet.allowPrivileged</code>
          now defaults to false. Disallowing privileged containers on
          the cluster.
        </p></li><li class="listitem"><p>
          The kubernetes module does no longer add the kubernetes
          package to <code class="literal">environment.systemPackages</code>
          implicitly.
        </p></li><li class="listitem"><p>
          The <code class="literal">intel</code> driver has been removed from the
          default list of
          <a class="link" href="options.html#opt-services.xserver.videoDrivers" target="_top">X.org
          video drivers</a>. The <code class="literal">modesetting</code>
          driver should take over automatically, it is better maintained
          upstream and has less problems with advanced X11 features.
          This can lead to a change in the output names used by
          <code class="literal">xrandr</code>. Some performance regressions on
          some GPU models might happen. Some OpenCL and VA-API
          applications might also break (Beignet seems to provide OpenCL
          support with <code class="literal">modesetting</code> driver, too).
          Kernel mode setting API does not support backlight control, so
          <code class="literal">xbacklight</code> tool will not work; backlight
          level can be controlled directly via <code class="literal">/sys/</code>
          or with <code class="literal">brightnessctl</code>. Users who need this
          functionality more than multi-output XRandR are advised to add
          `intel` to `videoDrivers` and report an issue (or provide
          additional details in an existing one)
        </p></li><li class="listitem"><p>
          Openmpi has been updated to version 4.0.0, which removes some
          deprecated MPI-1 symbols. This may break some older
          applications that still rely on those symbols. An upgrade
          guide can be found
          <a class="link" href="https://www.open-mpi.org/faq/?category=mpi-removed" target="_top">here</a>.
        </p><p>
          The nginx package now relies on OpenSSL 1.1 and supports TLS
          1.3 by default. You can set the protocols used by the nginx
          service using
          <a class="link" href="options.html#opt-services.nginx.sslProtocols" target="_top">services.nginx.sslProtocols</a>.
        </p></li><li class="listitem"><p>
          A new subcommand <code class="literal">nixos-rebuild edit</code> was
          added.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-18.09"></a>B.8. Release 18.09 (<span class="quote">“<span class="quote">Jellyfish</span>”</span>, 2018/10/05)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.09-highlights"></a>B.8.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following notable updates:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          End of support is planned for end of April 2019, handing over
          to 19.03.
        </p></li><li class="listitem"><p>
          Platform support: x86_64-linux and x86_64-darwin as always.
          Support for aarch64-linux is as with the previous releases,
          not equivalent to the x86-64-linux release, but with efforts
          to reach parity.
        </p></li><li class="listitem"><p>
          Nix has been updated to 2.1; see its
          <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-2.1" target="_top">release
          notes</a>.
        </p></li><li class="listitem"><p>
          Core versions: linux: 4.14 LTS (unchanged), glibc: 2.26 →
          2.27, gcc: 7 (unchanged), systemd: 237 → 239.
        </p></li><li class="listitem"><p>
          Desktop version changes: gnome: 3.26 → 3.28, (KDE)
          plasma-desktop: 5.12 → 5.13.
        </p></li></ul></div><p>
      Notable changes and additions for 18.09 include:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Support for wrapping binaries using
          <code class="literal">firejail</code> has been added through
          <code class="literal">programs.firejail.wrappedBinaries</code>.
        </p><p>
          For example
        </p><pre class="programlisting">
{
  programs.firejail = {
    enable = true;
    wrappedBinaries = {
      firefox = "${lib.getBin pkgs.firefox}/bin/firefox";
      mpv = "${lib.getBin pkgs.mpv}/bin/mpv";
    };
  };
}
</pre><p>
          This will place <code class="literal">firefox</code> and
          <code class="literal">mpv</code> binaries in the global path wrapped by
          firejail.
        </p></li><li class="listitem"><p>
          User channels are now in the default
          <code class="literal">NIX_PATH</code>, allowing users to use their
          personal <code class="literal">nix-channel</code> defined channels in
          <code class="literal">nix-build</code> and <code class="literal">nix-shell</code>
          commands, as well as in imports like
          <code class="literal">import &lt;mychannel&gt;</code>.
        </p><p>
          For example
        </p><pre class="programlisting">
$ nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgsunstable
$ nix-channel --update
$ nix-build '&lt;nixpkgsunstable&gt;' -A gitFull
$ nix run -f '&lt;nixpkgsunstable&gt;' gitFull
$ nix-instantiate -E '(import &lt;nixpkgsunstable&gt; {}).gitFull'
</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.09-new-services"></a>B.8.2. New Services</h3></div></div></div><p>
      A curated selection of new services that were added since the last
      release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The <code class="literal">services.cassandra</code> module has been
          reworked and was rewritten from scratch. The service has
          succeeding tests for the versions 2.1, 2.2, 3.0 and 3.11 of
          <a class="link" href="https://cassandra.apache.org/" target="_top">Apache
          Cassandra</a>.
        </p></li><li class="listitem"><p>
          There is a new <code class="literal">services.foundationdb</code> module
          for deploying
          <a class="link" href="https://www.foundationdb.org" target="_top">FoundationDB</a>
          clusters.
        </p></li><li class="listitem"><p>
          When enabled the <code class="literal">iproute2</code> will copy the
          files expected by ip route (e.g.,
          <code class="literal">rt_tables</code>) in
          <code class="literal">/etc/iproute2</code>. This allows to write aliases
          for routing tables for instance.
        </p></li><li class="listitem"><p>
          <code class="literal">services.strongswan-swanctl</code> is a modern
          replacement for <code class="literal">services.strongswan</code>. You
          can use either one of them to setup IPsec VPNs but not both at
          the same time.
        </p><p>
          <code class="literal">services.strongswan-swanctl</code> uses the
          <a class="link" href="https://wiki.strongswan.org/projects/strongswan/wiki/swanctl" target="_top">swanctl</a>
          command which uses the modern
          <a class="link" href="https://github.com/strongswan/strongswan/blob/master/src/libcharon/plugins/vici/README.md" target="_top">vici</a>
          <span class="emphasis"><em>Versatile IKE Configuration Interface</em></span>.
          The deprecated <code class="literal">ipsec</code> command used in
          <code class="literal">services.strongswan</code> is using the legacy
          <a class="link" href="https://github.com/strongswan/strongswan/blob/master/README_LEGACY.md" target="_top">stroke
          configuration interface</a>.
        </p></li><li class="listitem"><p>
          The new <code class="literal">services.elasticsearch-curator</code>
          service periodically curates or manages, your Elasticsearch
          indices and snapshots.
        </p></li></ul></div><p>
      Every new services:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">./config/xdg/autostart.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./config/xdg/icons.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./config/xdg/menus.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./config/xdg/mime.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./hardware/brightnessctl.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./hardware/onlykey.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./hardware/video/uvcvideo/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./misc/documentation.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/firejail.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/iftop.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/sedutil.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/singularity.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/xss-lock.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/zsh/zsh-autosuggestions.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/admin/oxidized.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/duplicati.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/restic.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/restic-rest-server.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/cluster/hadoop/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/databases/aerospike.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/databases/monetdb.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/bamf.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/flatpak.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/zeitgeist.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/development/bloop.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/development/jupyter/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/lcd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/undervolt.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/clipmenu.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/gitweb.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/serviio.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/safeeyes.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/sysprof.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/weechat.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/monitoring/datadog-agent.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/monitoring/incron.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/dnsdist.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/freeradius.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/hans.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/morty.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/ndppd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/ocserv.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/owamp.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/quagga.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/shadowsocks.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/stubby.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/zeronet.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/security/certmgr.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/security/cfssl.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/security/oauth2_proxy_nginx.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/virtlyst.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/youtrack.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-servers/hitch/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-servers/hydron.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-servers/meguca.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-servers/nginx/gitweb.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./virtualisation/kvmgt.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./virtualisation/qemu-guest-agent.nix</code>
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.09-incompatibilities"></a>B.8.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Some licenses that were incorrectly not marked as unfree now
          are. This is the case for:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              cc-by-nc-sa-20: Creative Commons Attribution Non
              Commercial Share Alike 2.0
            </p></li><li class="listitem"><p>
              cc-by-nc-sa-25: Creative Commons Attribution Non
              Commercial Share Alike 2.5
            </p></li><li class="listitem"><p>
              cc-by-nc-sa-30: Creative Commons Attribution Non
              Commercial Share Alike 3.0
            </p></li><li class="listitem"><p>
              cc-by-nc-sa-40: Creative Commons Attribution Non
              Commercial Share Alike 4.0
            </p></li><li class="listitem"><p>
              cc-by-nd-30: Creative Commons Attribution-No Derivative
              Works v3.00
            </p></li><li class="listitem"><p>
              msrla: Microsoft Research License Agreement
            </p></li></ul></div></li><li class="listitem"><p>
          The deprecated <code class="literal">services.cassandra</code> module
          has seen a complete rewrite. (See above.)
        </p></li><li class="listitem"><p>
          <code class="literal">lib.strict</code> is removed. Use
          <code class="literal">builtins.seq</code> instead.
        </p></li><li class="listitem"><p>
          The <code class="literal">clementine</code> package points now to the
          free derivation. <code class="literal">clementineFree</code> is removed
          now and <code class="literal">clementineUnfree</code> points to the
          package which is bundled with the unfree
          <code class="literal">libspotify</code> package.
        </p></li><li class="listitem"><p>
          The <code class="literal">netcat</code> package is now taken directly
          from OpenBSD's <code class="literal">libressl</code>, instead of relying
          on Debian's fork. The new version should be very close to the
          old version, but there are some minor differences.
          Importantly, flags like -b, -q, -C, and -Z are no longer
          accepted by the nc command.
        </p></li><li class="listitem"><p>
          The <code class="literal">services.docker-registry.extraConfig</code>
          object doesn't contain environment variables anymore. Instead
          it needs to provide an object structure that can be mapped
          onto the YAML configuration defined in
          <a class="link" href="https://github.com/docker/distribution/blob/v2.6.2/docs/configuration.md" target="_top">the
          <code class="literal">docker/distribution</code> docs</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">gnucash</code> has changed from version 2.4 to
          3.x. If you've been using <code class="literal">gnucash</code> (version
          2.4) instead of <code class="literal">gnucash26</code> (version 2.6) you
          must open your Gnucash data file(s) with
          <code class="literal">gnucash26</code> and then save them to upgrade the
          file format. Then you may use your data file(s) with Gnucash
          3.x. See the upgrade
          <a class="link" href="https://wiki.gnucash.org/wiki/FAQ#Using_Different_Versions.2C_Up_And_Downgrade" target="_top">documentation</a>.
          Gnucash 2.4 is still available under the attribute
          <code class="literal">gnucash24</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">services.munge</code> now runs as user (and group)
          <code class="literal">munge</code> instead of root. Make sure the key
          file is accessible to the daemon.
        </p></li><li class="listitem"><p>
          <code class="literal">dockerTools.buildImage</code> now uses
          <code class="literal">null</code> as default value for
          <code class="literal">tag</code>, which indicates that the nix output
          hash will be used as tag.
        </p></li><li class="listitem"><p>
          The ELK stack: <code class="literal">elasticsearch</code>,
          <code class="literal">logstash</code> and <code class="literal">kibana</code> has
          been upgraded from 2.* to 6.3.*. The 2.* versions have been
          <a class="link" href="https://www.elastic.co/support/eol" target="_top">unsupported
          since last year</a> so they have been removed. You can
          still use the 5.* versions under the names
          <code class="literal">elasticsearch5</code>,
          <code class="literal">logstash5</code> and <code class="literal">kibana5</code>.
        </p><p>
          The elastic beats: <code class="literal">filebeat</code>,
          <code class="literal">heartbeat</code>, <code class="literal">metricbeat</code>
          and <code class="literal">packetbeat</code> have had the same treatment:
          they now target 6.3.* as well. The 5.* versions are available
          under the names: <code class="literal">filebeat5</code>,
          <code class="literal">heartbeat5</code>, <code class="literal">metricbeat5</code>
          and <code class="literal">packetbeat5</code>
        </p><p>
          The ELK-6.3 stack now comes with
          <a class="link" href="https://www.elastic.co/products/x-pack/open" target="_top">X-Pack
          by default</a>. Since X-Pack is licensed under the
          <a class="link" href="https://github.com/elastic/elasticsearch/blob/master/licenses/ELASTIC-LICENSE.txt" target="_top">Elastic
          License</a> the ELK packages now have an unfree license. To
          use them you need to specify
          <code class="literal">allowUnfree = true;</code> in your nixpkgs
          configuration.
        </p><p>
          Fortunately there is also a free variant of the ELK stack
          without X-Pack. The packages are available under the names:
          <code class="literal">elasticsearch-oss</code>,
          <code class="literal">logstash-oss</code> and
          <code class="literal">kibana-oss</code>.
        </p></li><li class="listitem"><p>
          Options
          <code class="literal">boot.initrd.luks.devices.name.yubikey.ramfsMountPoint</code>
          <code class="literal">boot.initrd.luks.devices.name.yubikey.storage.mountPoint</code>
          were removed. <code class="literal">luksroot.nix</code> module never
          supported more than one YubiKey at a time anyway, hence those
          options never had any effect. You should be able to remove
          them from your config without any issues.
        </p></li><li class="listitem"><p>
          <code class="literal">stdenv.system</code> and <code class="literal">system</code>
          in nixpkgs now refer to the host platform instead of the build
          platform. For native builds this is not change, let alone a
          breaking one. For cross builds, it is a breaking change, and
          <code class="literal">stdenv.buildPlatform.system</code> can be used
          instead for the old behavior. They should be using that
          anyways for clarity.
        </p></li><li class="listitem"><p>
          Groups <code class="literal">kvm</code> and <code class="literal">render</code>
          are introduced now, as systemd requires them.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.09-notable-changes"></a>B.8.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">dockerTools.pullImage</code> relies on image
          digest instead of image tag to download the image. The
          <code class="literal">sha256</code> of a pulled image has to be updated.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.attrNamesToStr</code> has been deprecated. Use
          more specific concatenation
          (<code class="literal">lib.concat(Map)StringsSep</code>) instead.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.addErrorContextToAttrs</code> has been
          deprecated. Use <code class="literal">builtins.addErrorContext</code>
          directly.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.showVal</code> has been deprecated. Use
          <code class="literal">lib.traceSeqN</code> instead.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.traceXMLVal</code> has been deprecated. Use
          <code class="literal">lib.traceValFn builtins.toXml</code> instead.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.traceXMLValMarked</code> has been deprecated.
          Use
          <code class="literal">lib.traceValFn (x: str + builtins.toXML x)</code>
          instead.
        </p></li><li class="listitem"><p>
          The <code class="literal">pkgs</code> argument to NixOS modules can now
          be set directly using <code class="literal">nixpkgs.pkgs</code>.
          Previously, only the <code class="literal">system</code>,
          <code class="literal">config</code> and <code class="literal">overlays</code>
          arguments could be used to influence <code class="literal">pkgs</code>.
        </p></li><li class="listitem"><p>
          A NixOS system can now be constructed more easily based on a
          preexisting invocation of Nixpkgs. For example:
        </p><pre class="programlisting">
{
  inherit (pkgs.nixos {
    boot.loader.grub.enable = false;
    fileSystems."/".device = "/dev/xvda1";
  }) toplevel kernel initialRamdisk manual;
}
</pre><p>
          This benefits evaluation performance, lets you write Nixpkgs
          packages that depend on NixOS images and is consistent with a
          deployment architecture that would be centered around Nixpkgs
          overlays.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.traceValIfNot</code> has been deprecated. Use
          <code class="literal">if/then/else</code> and
          <code class="literal">lib.traceValSeq</code> instead.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.traceCallXml</code> has been deprecated.
          Please complain if you use the function regularly.
        </p></li><li class="listitem"><p>
          The attribute <code class="literal">lib.nixpkgsVersion</code> has been
          deprecated in favor of <code class="literal">lib.version</code>. Please
          refer to the discussion in
          <a class="link" href="https://github.com/NixOS/nixpkgs/pull/39416#discussion_r183845745" target="_top">NixOS/nixpkgs#39416</a>
          for further reference.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.recursiveUpdateUntil</code> was not acting
          according to its specification. It has been fixed to act
          according to the docstring, and a test has been added.
        </p></li><li class="listitem"><p>
          The module for <code class="literal">security.dhparams</code> has two
          new options now:
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
              <code class="literal">security.dhparams.stateless</code>
            </span></dt><dd><p>
                Puts the generated Diffie-Hellman parameters into the
                Nix store instead of managing them in a stateful manner
                in <code class="literal">/var/lib/dhparams</code>.
              </p></dd><dt><span class="term">
              <code class="literal">security.dhparams.defaultBitSize</code>
            </span></dt><dd><p>
                The default bit size to use for the generated
                Diffie-Hellman parameters.
              </p></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>
            The path to the actual generated parameter files should now
            be queried using
            <code class="literal">config.security.dhparams.params.name.path</code>
            because it might be either in the Nix store or in a
            directory configured by
            <code class="literal">security.dhparams.path</code>.
          </p></div><div class="note"><h3 class="title">Note</h3><p>
            <span class="strong"><strong>For developers:</strong></span>
          </p><p>
            Module implementers should not set a specific bit size in
            order to let users configure it by themselves if they want
            to have a different bit size than the default (2048).
          </p><p>
            An example usage of this would be:
          </p><pre class="programlisting">
{ config, ... }:

{
  security.dhparams.params.myservice = {};
  environment.etc."myservice.conf".text = ''
    dhparams = ${config.security.dhparams.params.myservice.path}
  '';
}
</pre></div></li><li class="listitem"><p>
          <code class="literal">networking.networkmanager.useDnsmasq</code> has
          been deprecated. Use
          <code class="literal">networking.networkmanager.dns</code> instead.
        </p></li><li class="listitem"><p>
          The Kubernetes package has been bumped to major version 1.11.
          Please consult the
          <a class="link" href="https://github.com/kubernetes/kubernetes/blob/release-1.11/CHANGELOG-1.11.md" target="_top">release
          notes</a> for details on new features and api changes.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.kubernetes.apiserver.admissionControl</code>
          was renamed to
          <code class="literal">services.kubernetes.apiserver.enableAdmissionPlugins</code>.
        </p></li><li class="listitem"><p>
          Recommended way to access the Kubernetes Dashboard is via
          HTTPS (TLS) Therefore; public service port for the dashboard
          has changed to 443 (container port 8443) and scheme to https.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.kubernetes.apiserver.address</code> was
          renamed to
          <code class="literal">services.kubernetes.apiserver.bindAddress</code>.
          Note that the default value has changed from 127.0.0.1 to
          0.0.0.0.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.kubernetes.apiserver.publicAddress</code>
          was not used and thus has been removed.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">services.kubernetes.addons.dashboard.enableRBAC</code>
          was renamed to
          <code class="literal">services.kubernetes.addons.dashboard.rbac.enable</code>.
        </p></li><li class="listitem"><p>
          The Kubernetes Dashboard now has only minimal RBAC permissions
          by default. If dashboard cluster-admin rights are desired, set
          <code class="literal">services.kubernetes.addons.dashboard.rbac.clusterAdmin</code>
          to true. On existing clusters, in order for the revocation of
          privileges to take effect, the current ClusterRoleBinding for
          kubernetes-dashboard must be manually removed:
          <code class="literal">kubectl delete clusterrolebinding kubernetes-dashboard</code>
        </p></li><li class="listitem"><p>
          The <code class="literal">programs.screen</code> module provides allows
          to configure <code class="literal">/etc/screenrc</code>, however the
          module behaved fairly counterintuitive as the config exists,
          but the package wasn't available. Since 18.09
          <code class="literal">pkgs.screen</code> will be added to
          <code class="literal">environment.systemPackages</code>.
        </p></li><li class="listitem"><p>
          The module <code class="literal">services.networking.hostapd</code> now
          uses WPA2 by default.
        </p></li><li class="listitem"><p>
          <code class="literal">s6Dns</code>, <code class="literal">s6Networking</code>,
          <code class="literal">s6LinuxUtils</code> and
          <code class="literal">s6PortableUtils</code> renamed to
          <code class="literal">s6-dns</code>, <code class="literal">s6-networking</code>,
          <code class="literal">s6-linux-utils</code> and
          <code class="literal">s6-portable-utils</code> respectively.
        </p></li><li class="listitem"><p>
          The module option <code class="literal">nix.useSandbox</code> is now
          defaulted to <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          The config activation script of
          <code class="literal">nixos-rebuild</code> now
          <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemctl.html#Manager%20Lifecycle%20Commands" target="_top">reloads</a>
          all user units for each authenticated user.
        </p></li><li class="listitem"><p>
          The default display manager is now LightDM. To use SLiM set
          <code class="literal">services.xserver.displayManager.slim.enable</code>
          to <code class="literal">true</code>.
        </p></li><li class="listitem"><p>
          NixOS option descriptions are now automatically broken up into
          individual paragraphs if the text contains two consecutive
          newlines, so it's no longer necessary to use
          <code class="literal">&lt;/para&gt;&lt;para&gt;</code> to start a new
          paragraph.
        </p></li><li class="listitem"><p>
          Top-level <code class="literal">buildPlatform</code>,
          <code class="literal">hostPlatform</code>, and
          <code class="literal">targetPlatform</code> in Nixpkgs are deprecated.
          Please use their equivalents in <code class="literal">stdenv</code>
          instead: <code class="literal">stdenv.buildPlatform</code>,
          <code class="literal">stdenv.hostPlatform</code>, and
          <code class="literal">stdenv.targetPlatform</code>.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-18.03"></a>B.9. Release 18.03 (<span class="quote">“<span class="quote">Impala</span>”</span>, 2018/04/04)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.03-highlights"></a>B.9.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          End of support is planned for end of October 2018, handing
          over to 18.09.
        </p></li><li class="listitem"><p>
          Platform support: x86_64-linux and x86_64-darwin since release
          time (the latter isn't NixOS, really). Binaries for
          aarch64-linux are available, but no channel exists yet, as
          it's waiting for some test fixes, etc.
        </p></li><li class="listitem"><p>
          Nix now defaults to 2.0; see its
          <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-2.0" target="_top">release
          notes</a>.
        </p></li><li class="listitem"><p>
          Core version changes: linux: 4.9 -&gt; 4.14, glibc: 2.25 -&gt;
          2.26, gcc: 6 -&gt; 7, systemd: 234 -&gt; 237.
        </p></li><li class="listitem"><p>
          Desktop version changes: gnome: 3.24 -&gt; 3.26, (KDE)
          plasma-desktop: 5.10 -&gt; 5.12.
        </p></li><li class="listitem"><p>
          MariaDB 10.2, updated from 10.1, is now the default MySQL
          implementation. While upgrading a few changes have been made
          to the infrastructure involved:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">libmysql</code> has been deprecated, please
              use <code class="literal">mysql.connector-c</code> instead, a
              compatibility passthru has been added to the MySQL
              packages.
            </p></li><li class="listitem"><p>
              The <code class="literal">mysql57</code> package has a new
              <code class="literal">static</code> output containing the static
              libraries including <code class="literal">libmysqld.a</code>
            </p></li></ul></div></li><li class="listitem"><p>
          PHP now defaults to PHP 7.2, updated from 7.1.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.03-new-services"></a>B.9.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">./config/krb5/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./hardware/digitalbitbox.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./misc/label.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/ccache.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/criu.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/digitalbitbox/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/less.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/npm.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/plotinus.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/rootston.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/systemtap.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/sway.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/udevil.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/way-cooler.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/yabar.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./programs/zsh/zsh-autoenv.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/borgbackup.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/backup/crashplan-small-business.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/dleyna-renderer.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/dleyna-server.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/pipewire.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/gnome3/chrome-gnome-shell.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/desktops/gnome3/tracker-miners.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/fwupd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/interception-tools.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/u2f.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/hardware/usbmuxd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/mail/clamsmtp.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/mail/dkimproxy-out.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/mail/pfix-srsd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/gitea.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/home-assistant.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/ihaskell.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/logkeys.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/novacomd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/osrm.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/plexpy.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/pykms.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/misc/tzupdate.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/monitoring/fusion-inventory.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/monitoring/prometheus/exporters.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/beegfs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/davfs2.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/openafs/client.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/openafs/server.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/network-filesystems/ceph.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/aria2.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/monero.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/nghttpx/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/nixops-dns.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/rxe.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/networking/stunnel.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/matomo.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-apps/restya-board.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/web-servers/mighttpd2.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./services/x11/fractalart.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./system/boot/binfmt.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./system/boot/grow-partition.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./tasks/filesystems/ecryptfs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">./virtualisation/hyperv-guest.nix</code>
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.03-incompatibilities"></a>B.9.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">sound.enable</code> now defaults to false.
        </p></li><li class="listitem"><p>
          Dollar signs in options under
          <code class="literal">services.postfix</code> are passed verbatim to
          Postfix, which will interpret them as the beginning of a
          parameter expression. This was already true for string-valued
          options in the previous release, but not for list-valued
          options. If you need to pass literal dollar signs through
          Postfix, double them.
        </p></li><li class="listitem"><p>
          The <code class="literal">postage</code> package (for web-based
          PostgreSQL administration) has been renamed to
          <code class="literal">pgmanage</code>. The corresponding module has also
          been renamed. To migrate please rename all
          <code class="literal">services.postage</code> options to
          <code class="literal">services.pgmanage</code>.
        </p></li><li class="listitem"><p>
          Package attributes starting with a digit have been prefixed
          with an underscore sign. This is to avoid quoting in the
          configuration and other issues with command-line tools like
          <code class="literal">nix-env</code>. The change affects the following
          packages:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">2048-in-terminal</code> →
              <code class="literal">_2048-in-terminal</code>
            </p></li><li class="listitem"><p>
              <code class="literal">90secondportraits</code> →
              <code class="literal">_90secondportraits</code>
            </p></li><li class="listitem"><p>
              <code class="literal">2bwm</code> → <code class="literal">_2bwm</code>
            </p></li><li class="listitem"><p>
              <code class="literal">389-ds-base</code> →
              <code class="literal">_389-ds-base</code>
            </p></li></ul></div></li><li class="listitem"><p>
          <span class="strong"><strong>The OpenSSH service no longer enables
          support for DSA keys by default, which could cause a system
          lock out. Update your keys or, unfavorably, re-enable DSA
          support manually.</strong></span>
        </p><p>
          DSA support was
          <a class="link" href="https://www.openssh.com/legacy.html" target="_top">deprecated
          in OpenSSH 7.0</a>, due to it being too weak. To re-enable
          support, add
          <code class="literal">PubkeyAcceptedKeyTypes +ssh-dss</code> to the end
          of your <code class="literal">services.openssh.extraConfig</code>.
        </p><p>
          After updating the keys to be stronger, anyone still on a
          pre-17.03 version is safe to jump to 17.03, as vetted
          <a class="link" href="https://search.nix.gsc.io/?q=stateVersion" target="_top">here</a>.
        </p></li><li class="listitem"><p>
          The <code class="literal">openssh</code> package now includes Kerberos
          support by default; the
          <code class="literal">openssh_with_kerberos</code> package is now a
          deprecated alias. If you do not want Kerberos support, you can
          do
          <code class="literal">openssh.override { withKerberos = false; }</code>.
          Note, this also applies to the <code class="literal">openssh_hpn</code>
          package.
        </p></li><li class="listitem"><p>
          <code class="literal">cc-wrapper</code> has been split in two; there is
          now also a <code class="literal">bintools-wrapper</code>. The most
          commonly used files in <code class="literal">nix-support</code> are now
          split between the two wrappers. Some commonly used ones, like
          <code class="literal">nix-support/dynamic-linker</code>, are duplicated
          for backwards compatability, even though they rightly belong
          only in <code class="literal">bintools-wrapper</code>. Other more
          obscure ones are just moved.
        </p></li><li class="listitem"><p>
          The propagation logic has been changed. The new logic, along
          with new types of dependencies that go with, is thoroughly
          documented in the "Specifying dependencies" section
          of the "Standard Environment" chapter of the nixpkgs
          manual. The old logic isn't but is easy to describe:
          dependencies were propagated as the same type of dependency no
          matter what. In practice, that means that many
          <code class="literal">propagatedNativeBuildInputs</code> should instead
          be <code class="literal">propagatedBuildInputs</code>. Thankfully, that
          was and is the least used type of dependency. Also, it means
          that some <code class="literal">propagatedBuildInputs</code> should
          instead be <code class="literal">depsTargetTargetPropagated</code>.
          Other types dependencies should be unaffected.
        </p></li><li class="listitem"><p>
          <code class="literal">lib.addPassthru drv passthru</code> is removed.
          Use <code class="literal">lib.extendDerivation true passthru drv</code>
          instead.
        </p></li><li class="listitem"><p>
          The <code class="literal">memcached</code> service no longer accept
          dynamic socket paths via
          <code class="literal">services.memcached.socket</code>. Unix sockets can
          be still enabled by
          <code class="literal">services.memcached.enableUnixSocket</code> and
          will be accessible at
          <code class="literal">/run/memcached/memcached.sock</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">hardware.amdHybridGraphics.disable</code>
          option was removed for lack of a maintainer. If you still need
          this module, you may wish to include a copy of it from an
          older version of nixos in your imports.
        </p></li><li class="listitem"><p>
          The merging of config options for
          <code class="literal">services.postfix.config</code> was buggy.
          Previously, if other options in the Postfix module like
          <code class="literal">services.postfix.useSrs</code> were set and the
          user set config options that were also set by such options,
          the resulting config wouldn't include all options that were
          needed. They are now merged correctly. If config options need
          to be overridden, <code class="literal">lib.mkForce</code> or
          <code class="literal">lib.mkOverride</code> can be used.
        </p></li><li class="listitem"><p>
          The following changes apply if the
          <code class="literal">stateVersion</code> is changed to 18.03 or higher.
          For <code class="literal">stateVersion = "17.09"</code> or
          lower the old behavior is preserved.
        </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">matrix-synapse</code> uses postgresql by
              default instead of sqlite. Migration instructions can be
              found
              <a class="link" href="https://github.com/matrix-org/synapse/blob/master/docs/postgres.rst#porting-from-sqlite" target="_top">
              here </a>.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">jid</code> package has been removed, due to
          maintenance overhead of a go package having non-versioned
          dependencies.
        </p></li><li class="listitem"><p>
          When using <code class="literal">services.xserver.libinput</code>
          (enabled by default in GNOME), it now handles all input
          devices, not just touchpads. As a result, you might need to
          re-evaluate any custom Xorg configuration. In particular,
          <code class="literal">Option "XkbRules" "base"</code>
          may result in broken keyboard layout.
        </p></li><li class="listitem"><p>
          The <code class="literal">attic</code> package was removed. A maintained
          fork called
          <a class="link" href="https://www.borgbackup.org/" target="_top">Borg</a>
          should be used instead. Migration instructions can be found
          <a class="link" href="http://borgbackup.readthedocs.io/en/stable/usage/upgrade.html#attic-and-borg-0-xx-to-borg-1-x" target="_top">here</a>.
        </p></li><li class="listitem"><p>
          The Piwik analytics software was renamed to Matomo:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The package <code class="literal">pkgs.piwik</code> was renamed to
              <code class="literal">pkgs.matomo</code>.
            </p></li><li class="listitem"><p>
              The service <code class="literal">services.piwik</code> was renamed
              to <code class="literal">services.matomo</code>.
            </p></li><li class="listitem"><p>
              The data directory <code class="literal">/var/lib/piwik</code> was
              renamed to <code class="literal">/var/lib/matomo</code>. All files
              will be moved automatically on first startup, but you
              might need to adjust your backup scripts.
            </p></li><li class="listitem"><p>
              The default <code class="literal">serverName</code> for the nginx
              configuration changed from
              <code class="literal">piwik.${config.networking.hostName}</code> to
              <code class="literal">matomo.${config.networking.hostName}.${config.networking.domain}</code>
              if <code class="literal">config.networking.domain</code> is set,
              <code class="literal">matomo.${config.networking.hostName}</code> if
              it is not set. If you change your
              <code class="literal">serverName</code>, remember you'll need to
              update the <code class="literal">trustedHosts[]</code> array in
              <code class="literal">/var/lib/matomo/config/config.ini.php</code>
              as well.
            </p></li><li class="listitem"><p>
              The <code class="literal">piwik</code> user was renamed to
              <code class="literal">matomo</code>. The service will adjust
              ownership automatically for files in the data directory.
              If you use unix socket authentication, remember to give
              the new <code class="literal">matomo</code> user access to the
              database and to change the <code class="literal">username</code> to
              <code class="literal">matomo</code> in the
              <code class="literal">[database]</code> section of
              <code class="literal">/var/lib/matomo/config/config.ini.php</code>.
            </p></li><li class="listitem"><p>
              If you named your database `piwik`, you might want to
              rename it to `matomo` to keep things clean, but this is
              neither enforced nor required.
            </p></li></ul></div></li><li class="listitem"><p>
          <code class="literal">nodejs-4_x</code> is end-of-life.
          <code class="literal">nodejs-4_x</code>,
          <code class="literal">nodejs-slim-4_x</code> and
          <code class="literal">nodePackages_4_x</code> are removed.
        </p></li><li class="listitem"><p>
          The <code class="literal">pump.io</code> NixOS module was removed. It is
          now maintained as an
          <a class="link" href="https://github.com/rvl/pump.io-nixos" target="_top">external
          module</a>.
        </p></li><li class="listitem"><p>
          The Prosody XMPP server has received a major update. The
          following modules were renamed:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">services.prosody.modules.httpserver</code> is
              now <code class="literal">services.prosody.modules.http_files</code>
            </p></li><li class="listitem"><p>
              <code class="literal">services.prosody.modules.console</code> is now
              <code class="literal">services.prosody.modules.admin_telnet</code>
            </p></li></ul></div><p>
          Many new modules are now core modules, most notably
          <code class="literal">services.prosody.modules.carbons</code> and
          <code class="literal">services.prosody.modules.mam</code>.
        </p><p>
          The better-performing <code class="literal">libevent</code> backend is
          now enabled by default.
        </p><p>
          <code class="literal">withCommunityModules</code> now passes through the
          modules to <code class="literal">services.prosody.extraModules</code>.
          Use <code class="literal">withOnlyInstalledCommunityModules</code> for
          modules that should not be enabled directly, e.g
          <code class="literal">lib_ldap</code>.
        </p></li><li class="listitem"><p>
          All prometheus exporter modules are now defined as submodules.
          The exporters are configured using
          <code class="literal">services.prometheus.exporters</code>.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-18.03-notable-changes"></a>B.9.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          ZNC option <code class="literal">services.znc.mutable</code> now
          defaults to <code class="literal">true</code>. That means that old
          configuration is not overwritten by default when update to the
          znc options are made.
        </p></li><li class="listitem"><p>
          The option
          <code class="literal">networking.wireless.networks.&lt;name&gt;.auth</code>
          has been added for wireless networks with WPA-Enterprise
          authentication. There is also a new
          <code class="literal">extraConfig</code> option to directly configure
          <code class="literal">wpa_supplicant</code> and
          <code class="literal">hidden</code> to connect to hidden networks.
        </p></li><li class="listitem"><p>
          In the module
          <code class="literal">networking.interfaces.&lt;name&gt;</code> the
          following options have been removed:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">ipAddress</code>
            </p></li><li class="listitem"><p>
              <code class="literal">ipv6Address</code>
            </p></li><li class="listitem"><p>
              <code class="literal">prefixLength</code>
            </p></li><li class="listitem"><p>
              <code class="literal">ipv6PrefixLength</code>
            </p></li><li class="listitem"><p>
              <code class="literal">subnetMask</code>
            </p></li></ul></div><p>
          To assign static addresses to an interface the options
          <code class="literal">ipv4.addresses</code> and
          <code class="literal">ipv6.addresses</code> should be used instead. The
          options <code class="literal">ip4</code> and <code class="literal">ip6</code> have
          been renamed to <code class="literal">ipv4.addresses</code>
          <code class="literal">ipv6.addresses</code> respectively. The new
          options <code class="literal">ipv4.routes</code> and
          <code class="literal">ipv6.routes</code> have been added to set up
          static routing.
        </p></li><li class="listitem"><p>
          The option <code class="literal">services.logstash.listenAddress</code>
          is now <code class="literal">127.0.0.1</code> by default. Previously the
          default behaviour was to listen on all interfaces.
        </p></li><li class="listitem"><p>
          <code class="literal">services.btrfs.autoScrub</code> has been added, to
          periodically check btrfs filesystems for data corruption. If
          there's a correct copy available, it will automatically repair
          corrupted blocks.
        </p></li><li class="listitem"><p>
          <code class="literal">displayManager.lightdm.greeters.gtk.clock-format.</code>
          has been added, the clock format string (as expected by
          strftime, e.g. <code class="literal">%H:%M</code>) to use with the
          lightdm gtk greeter panel.
        </p><p>
          If set to null the default clock format is used.
        </p></li><li class="listitem"><p>
          <code class="literal">displayManager.lightdm.greeters.gtk.indicators</code>
          has been added, a list of allowed indicator modules to use
          with the lightdm gtk greeter panel.
        </p><p>
          Built-in indicators include <code class="literal">~a11y</code>,
          <code class="literal">~language</code>, <code class="literal">~session</code>,
          <code class="literal">~power</code>, <code class="literal">~clock</code>,
          <code class="literal">~host</code>, <code class="literal">~spacer</code>. Unity
          indicators can be represented by short name (e.g.
          <code class="literal">sound</code>, <code class="literal">power</code>), service
          file name, or absolute path.
        </p><p>
          If set to <code class="literal">null</code> the default indicators are
          used.
        </p><p>
          In order to have the previous default configuration add
        </p><pre class="programlisting">
{
  services.xserver.displayManager.lightdm.greeters.gtk.indicators = [
    "~host" "~spacer"
    "~clock" "~spacer"
    "~session"
    "~language"
    "~a11y"
    "~power"
  ];
}
</pre><p>
          to your <code class="literal">configuration.nix</code>.
        </p></li><li class="listitem"><p>
          The NixOS test driver supports user services declared by
          <code class="literal">systemd.user.services</code>. The methods
          <code class="literal">waitForUnit</code>,
          <code class="literal">getUnitInfo</code>, <code class="literal">startJob</code>
          and <code class="literal">stopJob</code> provide an optional
          <code class="literal">$user</code> argument for that purpose.
        </p></li><li class="listitem"><p>
          Enabling bash completion on NixOS,
          <code class="literal">programs.bash.enableCompletion</code>, will now
          also enable completion for the Nix command line tools by
          installing the
          <a class="link" href="https://github.com/hedning/nix-bash-completions" target="_top">nix-bash-completions</a>
          package.
        </p></li><li class="listitem"><p>
          The vim/kakoune plugin updater now reads from a CSV file:
          check
          <code class="literal">pkgs/applications/editors/vim/plugins/vim-plugin-names</code>
          out to see the new format
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-17.09"></a>B.10. Release 17.09 (<span class="quote">“<span class="quote">Hummingbird</span>”</span>, 2017/09/??)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.09-highlights"></a>B.10.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The GNOME version is now 3.24. KDE Plasma was upgraded to
          5.10, KDE Applications to 17.08.1 and KDE Frameworks to 5.37.
        </p></li><li class="listitem"><p>
          The user handling now keeps track of deallocated UIDs/GIDs.
          When a user or group is revived, this allows it to be
          allocated the UID/GID it had before. A consequence is that
          UIDs and GIDs are no longer reused.
        </p></li><li class="listitem"><p>
          The module option
          <code class="literal">services.xserver.xrandrHeads</code> now causes the
          first head specified in this list to be set as the primary
          head. Apart from that, it's now possible to also set
          additional options by using an attribute set, for example:
        </p><pre class="programlisting">
{ services.xserver.xrandrHeads = [
    "HDMI-0"
    {
      output = "DVI-0";
      primary = true;
      monitorConfig = ''
        Option "Rotate" "right"
      '';
    }
  ];
}
</pre><p>
          This will set the <code class="literal">DVI-0</code> output to be the
          primary head, even though <code class="literal">HDMI-0</code> is the
          first head in the list.
        </p></li><li class="listitem"><p>
          The handling of SSL in the <code class="literal">services.nginx</code>
          module has been cleaned up, renaming the misnamed
          <code class="literal">enableSSL</code> to <code class="literal">onlySSL</code>
          which reflects its original intention. This is not to be used
          with the already existing <code class="literal">forceSSL</code> which
          creates a second non-SSL virtual host redirecting to the SSL
          virtual host. This by chance had worked earlier due to
          specific implementation details. In case you had specified
          both please remove the <code class="literal">enableSSL</code> option to
          keep the previous behaviour.
        </p><p>
          Another <code class="literal">addSSL</code> option has been introduced
          to configure both a non-SSL virtual host and an SSL virtual
          host with the same configuration.
        </p><p>
          Options to configure <code class="literal">resolver</code> options and
          <code class="literal">upstream</code> blocks have been introduced. See
          their information for further details.
        </p><p>
          The <code class="literal">port</code> option has been replaced by a more
          generic <code class="literal">listen</code> option which makes it
          possible to specify multiple addresses, ports and SSL configs
          dependant on the new SSL handling mentioned above.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.09-new-services"></a>B.10.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">config/fonts/fontconfig-penultimate.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">config/fonts/fontconfig-ultimate.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">config/terminfo.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">hardware/sensor/iio.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">hardware/nitrokey.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">hardware/raid/hpsa.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/browserpass.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/gnupg.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/qt5ct.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/slock.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/thefuck.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">security/auditd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">security/lock-kernel-modules.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">service-managers/docker.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">service-managers/trivial.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/admin/salt/master.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/admin/salt/minion.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/audio/slimserver.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/cluster/kubernetes/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/cluster/kubernetes/dns.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/cluster/kubernetes/dashboard.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/continuous-integration/hail.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/databases/clickhouse.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/databases/postage.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/desktops/gnome3/gnome-disks.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/desktops/gnome3/gpaste.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/logging/SystemdJournal2Gelf.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/logging/heartbeat.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/logging/journalwatch.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/logging/syslogd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/mail/mailhog.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/mail/nullmailer.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/airsonic.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/autorandr.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/exhibitor.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/fstrim.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/gollum.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/irkerd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/jackett.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/radarr.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/snapper.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/osquery.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/collectd-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/fritzbox-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/network-filesystems/kbfs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/dnscache.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/fireqos.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/iwd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/keepalived/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/keybase.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/lldpd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/matterbridge.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/squid.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/tinydns.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/xrdp.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/security/shibboleth-sp.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/security/sks.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/security/sshguard.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/security/torify.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/security/usbguard.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/security/vault.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/system/earlyoom.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/system/saslauthd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/nexus.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/pgpkeyserver-lite.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/piwik.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-servers/lighttpd/collectd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-servers/minio.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/x11/display-managers/xpra.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/x11/xautolock.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">tasks/filesystems/bcachefs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">tasks/powertop.nix</code>
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.09-incompatibilities"></a>B.10.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="strong"><strong>In an Qemu-based virtualization
          environment, the network interface names changed from i.e.
          <code class="literal">enp0s3</code> to
          <code class="literal">ens3</code>.</strong></span>
        </p><p>
          This is due to a kernel configuration change. The new naming
          is consistent with those of other Linux distributions with
          systemd. See
          <a class="link" href="https://github.com/NixOS/nixpkgs/issues/29197" target="_top">#29197</a>
          for more information.
        </p><p>
          A machine is affected if the <code class="literal">virt-what</code> tool
          either returns <code class="literal">qemu</code> or
          <code class="literal">kvm</code> <span class="emphasis"><em>and</em></span> has interface
          names used in any part of its NixOS configuration, in
          particular if a static network configuration with
          <code class="literal">networking.interfaces</code> is used.
        </p><p>
          Before rebooting affected machines, please ensure:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Change the interface names in your NixOS configuration.
              The first interface will be called
              <code class="literal">ens3</code>, the second one
              <code class="literal">ens8</code> and starting from there
              incremented by 1.
            </p></li><li class="listitem"><p>
              After changing the interface names, rebuild your system
              with <code class="literal">nixos-rebuild boot</code> to activate the
              new configuration after a reboot. If you switch to the new
              configuration right away you might lose network
              connectivity! If using <code class="literal">nixops</code>, deploy
              with <code class="literal">nixops deploy --force-reboot</code>.
            </p></li></ul></div></li><li class="listitem"><p>
          The following changes apply if the
          <code class="literal">stateVersion</code> is changed to 17.09 or higher.
          For <code class="literal">stateVersion = "17.03"</code> or
          lower the old behavior is preserved.
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <code class="literal">postgres</code> default version was
              changed from 9.5 to 9.6.
            </p></li><li class="listitem"><p>
              The <code class="literal">postgres</code> superuser name has changed
              from <code class="literal">root</code> to
              <code class="literal">postgres</code> to more closely follow what
              other Linux distributions are doing.
            </p></li><li class="listitem"><p>
              The <code class="literal">postgres</code> default
              <code class="literal">dataDir</code> has changed from
              <code class="literal">/var/db/postgres</code> to
              <code class="literal">/var/lib/postgresql/$psqlSchema</code> where
              $psqlSchema is 9.6 for example.
            </p></li><li class="listitem"><p>
              The <code class="literal">mysql</code> default
              <code class="literal">dataDir</code> has changed from
              <code class="literal">/var/mysql</code> to
              <code class="literal">/var/lib/mysql</code>.
            </p></li><li class="listitem"><p>
              Radicale's default package has changed from 1.x to 2.x.
              Instructions to migrate can be found
              <a class="link" href="http://radicale.org/1to2/" target="_top"> here
              </a>. It is also possible to use the newer version by
              setting the <code class="literal">package</code> to
              <code class="literal">radicale2</code>, which is done automatically
              when <code class="literal">stateVersion</code> is 17.09 or higher.
              The <code class="literal">extraArgs</code> option has been added to
              allow passing the data migration arguments specified in
              the instructions; see the <code class="literal">radicale.nix</code>
              NixOS test for an example migration.
            </p></li></ul></div></li><li class="listitem"><p>
          The <code class="literal">aiccu</code> package was removed. This is due
          to SixXS <a class="link" href="https://www.sixxs.net/main/" target="_top">
          sunsetting</a> its IPv6 tunnel.
        </p></li><li class="listitem"><p>
          The <code class="literal">fanctl</code> package and
          <code class="literal">fan</code> module have been removed due to the
          developers not upstreaming their iproute2 patches and lagging
          with compatibility to recent iproute2 versions.
        </p></li><li class="listitem"><p>
          Top-level <code class="literal">idea</code> package collection was
          renamed. All JetBrains IDEs are now at
          <code class="literal">jetbrains</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">flexget</code>'s state database cannot be upgraded
          to its new internal format, requiring removal of any existing
          <code class="literal">db-config.sqlite</code> which will be
          automatically recreated.
        </p></li><li class="listitem"><p>
          The <code class="literal">ipfs</code> service now doesn't ignore the
          <code class="literal">dataDir</code> option anymore. If you've ever set
          this option to anything other than the default you'll have to
          either unset it (so the default gets used) or migrate the old
          data manually with
        </p><pre class="programlisting">
dataDir=&lt;valueOfDataDir&gt;
mv /var/lib/ipfs/.ipfs/* $dataDir
rmdir /var/lib/ipfs/.ipfs
</pre></li><li class="listitem"><p>
          The <code class="literal">caddy</code> service was previously using an
          extra <code class="literal">.caddy</code> directory in the data
          directory specified with the <code class="literal">dataDir</code>
          option. The contents of the <code class="literal">.caddy</code>
          directory are now expected to be in the
          <code class="literal">dataDir</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">ssh-agent</code> user service is not started
          by default anymore. Use
          <code class="literal">programs.ssh.startAgent</code> to enable it if
          needed. There is also a new
          <code class="literal">programs.gnupg.agent</code> module that creates a
          <code class="literal">gpg-agent</code> user service. It can also serve
          as a SSH agent if <code class="literal">enableSSHSupport</code> is set.
        </p></li><li class="listitem"><p>
          The
          <code class="literal">services.tinc.networks.&lt;name&gt;.listenAddress</code>
          option had a misleading name that did not correspond to its
          behavior. It now correctly defines the ip to listen for
          incoming connections on. To keep the previous behaviour, use
          <code class="literal">services.tinc.networks.&lt;name&gt;.bindToAddress</code>
          instead. Refer to the description of the options for more
          details.
        </p></li><li class="listitem"><p>
          <code class="literal">tlsdate</code> package and module were removed.
          This is due to the project being dead and not building with
          openssl 1.1.
        </p></li><li class="listitem"><p>
          <code class="literal">wvdial</code> package and module were removed.
          This is due to the project being dead and not building with
          openssl 1.1.
        </p></li><li class="listitem"><p>
          <code class="literal">cc-wrapper</code>'s setup-hook now exports a
          number of environment variables corresponding to binutils
          binaries, (e.g. <code class="literal">LD</code>,
          <code class="literal">STRIP</code>, <code class="literal">RANLIB</code>, etc).
          This is done to prevent packages' build systems guessing,
          which is harder to predict, especially when cross-compiling.
          However, some packages have broken due to this—their build
          systems either not supporting, or claiming to support without
          adequate testing, taking such environment variables as
          parameters.
        </p></li><li class="listitem"><p>
          <code class="literal">services.firefox.syncserver</code> now runs by
          default as a non-root user. To accomodate this change, the
          default sqlite database location has also been changed.
          Migration should work automatically. Refer to the description
          of the options for more details.
        </p></li><li class="listitem"><p>
          The <code class="literal">compiz</code> window manager and package was
          removed. The system support had been broken for several years.
        </p></li><li class="listitem"><p>
          Touchpad support should now be enabled through
          <code class="literal">libinput</code> as <code class="literal">synaptics</code> is
          now deprecated. See the option
          <code class="literal">services.xserver.libinput.enable</code>.
        </p></li><li class="listitem"><p>
          grsecurity/PaX support has been dropped, following upstream's
          decision to cease free support. See
          <a class="link" href="https://grsecurity.net/passing_the_baton.php" target="_top">
          upstream's announcement</a> for more information. No
          complete replacement for grsecurity/PaX is available
          presently.
        </p></li><li class="listitem"><p>
          <code class="literal">services.mysql</code> now has declarative
          configuration of databases and users with the
          <code class="literal">ensureDatabases</code> and
          <code class="literal">ensureUsers</code> options.
        </p><p>
          These options will never delete existing databases and users,
          especially not when the value of the options are changed.
        </p><p>
          The MySQL users will be identified using
          <a class="link" href="https://mariadb.com/kb/en/library/authentication-plugin-unix-socket/" target="_top">
          Unix socket authentication</a>. This authenticates the Unix
          user with the same name only, and that without the need for a
          password.
        </p><p>
          If you have previously created a MySQL <code class="literal">root</code>
          user <span class="emphasis"><em>with a password</em></span>, you will need to
          add <code class="literal">root</code> user for unix socket
          authentication before using the new options. This can be done
          by running the following SQL script:
        </p><pre class="programlisting">
CREATE USER 'root'@'%' IDENTIFIED BY '';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
FLUSH PRIVILEGES;

-- Optionally, delete the password-authenticated user:
-- DROP USER 'root'@'localhost';
</pre></li><li class="listitem"><p>
          <code class="literal">services.mysqlBackup</code> now works by default
          without any user setup, including for users other than
          <code class="literal">mysql</code>.
        </p><p>
          By default, the <code class="literal">mysql</code> user is no longer the
          user which performs the backup. Instead a system account
          <code class="literal">mysqlbackup</code> is used.
        </p><p>
          The <code class="literal">mysqlBackup</code> service is also now using
          systemd timers instead of <code class="literal">cron</code>.
        </p><p>
          Therefore, the <code class="literal">services.mysqlBackup.period</code>
          option no longer exists, and has been replaced with
          <code class="literal">services.mysqlBackup.calendar</code>, which is in
          the format of
          <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.time.html#Calendar%20Events" target="_top">systemd.time(7)</a>.
        </p><p>
          If you expect to be sent an e-mail when the backup fails,
          consider using a script which monitors the systemd journal for
          errors. Regretfully, at present there is no built-in
          functionality for this.
        </p><p>
          You can check that backups still work by running
          <code class="literal">systemctl start mysql-backup</code> then
          <code class="literal">systemctl status mysql-backup</code>.
        </p></li><li class="listitem"><p>
          Templated systemd services e.g
          <code class="literal">container@name</code> are now handled currectly
          when switching to a new configuration, resulting in them being
          reloaded.
        </p></li><li class="listitem"><p>
          Steam: the <code class="literal">newStdcpp</code> parameter was removed
          and should not be needed anymore.
        </p></li><li class="listitem"><p>
          Redis has been updated to version 4 which mandates a cluster
          mass-restart, due to changes in the network handling, in order
          to ensure compatibility with networks NATing traffic.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.09-notable-changes"></a>B.10.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Modules can now be disabled by using
          <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-replace-modules" target="_top">
          disabledModules</a>, allowing another to take it's place.
          This can be used to import a set of modules from another
          channel while keeping the rest of the system on a stable
          release.
        </p></li><li class="listitem"><p>
          Updated to FreeType 2.7.1, including a new TrueType engine.
          The new engine replaces the Infinality engine which was the
          default in NixOS. The default font rendering settings are now
          provided by fontconfig-penultimate, replacing
          fontconfig-ultimate; the new defaults are less invasive and
          provide rendering that is more consistent with other systems
          and hopefully with each font designer's intent. Some
          system-wide configuration has been removed from the Fontconfig
          NixOS module where user Fontconfig settings are available.
        </p></li><li class="listitem"><p>
          ZFS/SPL have been updated to 0.7.0,
          <code class="literal">zfsUnstable, splUnstable</code> have therefore
          been removed.
        </p></li><li class="listitem"><p>
          The <code class="literal">time.timeZone</code> option now allows the
          value <code class="literal">null</code> in addition to timezone strings.
          This value allows changing the timezone of a system
          imperatively using
          <code class="literal">timedatectl set-timezone</code>. The default
          timezone is still UTC.
        </p></li><li class="listitem"><p>
          Nixpkgs overlays may now be specified with a file as well as a
          directory. The value of
          <code class="literal">&lt;nixpkgs-overlays&gt;</code> may be a file, and
          <code class="literal">~/.config/nixpkgs/overlays.nix</code> can be used
          instead of the <code class="literal">~/.config/nixpkgs/overlays</code>
          directory.
        </p><p>
          See the overlays chapter of the Nixpkgs manual for more
          details.
        </p></li><li class="listitem"><p>
          Definitions for <code class="literal">/etc/hosts</code> can now be
          specified declaratively with
          <code class="literal">networking.hosts</code>.
        </p></li><li class="listitem"><p>
          Two new options have been added to the installer loader, in
          addition to the default having changed. The kernel log
          verbosity has been lowered to the upstream default for the
          default options, in order to not spam the console when e.g.
          joining a network.
        </p><p>
          This therefore leads to adding a new <code class="literal">debug</code>
          option to set the log level to the previous verbose mode, to
          make debugging easier, but still accessible easily.
        </p><p>
          Additionally a <code class="literal">copytoram</code> option has been
          added, which makes it possible to remove the install medium
          after booting. This allows tethering from your phone after
          booting from it.
        </p></li><li class="listitem"><p>
          <code class="literal">services.gitlab-runner.configOptions</code> has
          been added to specify the configuration of gitlab-runners
          declaratively.
        </p></li><li class="listitem"><p>
          <code class="literal">services.jenkins.plugins</code> has been added to
          install plugins easily, this can be generated with
          jenkinsPlugins2nix.
        </p></li><li class="listitem"><p>
          <code class="literal">services.postfix.config</code> has been added to
          specify the main.cf with NixOS options. Additionally other
          options have been added to the postfix module and has been
          improved further.
        </p></li><li class="listitem"><p>
          The GitLab package and module have been updated to the latest
          10.0 release.
        </p></li><li class="listitem"><p>
          The <code class="literal">systemd-boot</code> boot loader now lists the
          NixOS version, kernel version and build date of all bootable
          generations.
        </p></li><li class="listitem"><p>
          The dnscrypt-proxy service now defaults to using a random
          upstream resolver, selected from the list of public
          non-logging resolvers with DNSSEC support. Existing
          configurations can be migrated to this mode of operation by
          omitting the
          <code class="literal">services.dnscrypt-proxy.resolverName</code> option
          or setting it to <code class="literal">"random"</code>.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-17.03"></a>B.11. Release 17.03 (<span class="quote">“<span class="quote">Gorilla</span>”</span>, 2017/03/31)</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.03-highlights"></a>B.11.1. Highlights</h3></div></div></div><p>
      In addition to numerous new and upgraded packages, this release
      has the following highlights:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Nixpkgs is now extensible through overlays. See the
          <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-overlays-install" target="_top">Nixpkgs
          manual</a> for more information.
        </p></li><li class="listitem"><p>
          This release is based on Glibc 2.25, GCC 5.4.0 and systemd
          232. The default Linux kernel is 4.9 and Nix is at 1.11.8.
        </p></li><li class="listitem"><p>
          The default desktop environment now is KDE's Plasma 5. KDE 4
          has been removed
        </p></li><li class="listitem"><p>
          The setuid wrapper functionality now supports setting
          capabilities.
        </p></li><li class="listitem"><p>
          X.org server uses branch 1.19. Due to ABI incompatibilities,
          <code class="literal">ati_unfree</code> keeps forcing 1.17 and
          <code class="literal">amdgpu-pro</code> starts forcing 1.18.
        </p></li><li class="listitem"><p>
          Cross compilation has been rewritten. See the nixpkgs manual
          for details. The most obvious breaking change is that in
          derivations there is no <code class="literal">.nativeDrv</code> nor
          <code class="literal">.crossDrv</code> are now cross by default, not
          native.
        </p></li><li class="listitem"><p>
          The <code class="literal">overridePackages</code> function has been
          rewritten to be replaced by
          <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-overlays-install" target="_top">
          overlays</a>
        </p></li><li class="listitem"><p>
          Packages in nixpkgs can be marked as insecure through listed
          vulnerabilities. See the
          <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-allow-insecure" target="_top">Nixpkgs
          manual</a> for more information.
        </p></li><li class="listitem"><p>
          PHP now defaults to PHP 7.1
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.03-new-services"></a>B.11.2. New Services</h3></div></div></div><p>
      The following new services were added since the last release:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">hardware/ckb.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">hardware/mcelog.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">hardware/usb-wwan.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">hardware/video/capture/mwprocapture.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/adb.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/chromium.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/gphoto2.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/java.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/mtr.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/oblogout.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/vim.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">programs/wireshark.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">security/dhparams.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/audio/ympd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/computing/boinc/client.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/continuous-integration/buildbot/master.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/continuous-integration/buildbot/worker.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/continuous-integration/gitlab-runner.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/databases/riak-cs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/databases/stanchion.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/desktops/gnome3/gnome-terminal-server.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/editors/infinoted.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/hardware/illum.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/hardware/trezord.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/logging/journalbeat.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/mail/offlineimap.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/mail/postgrey.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/couchpotato.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/docker-registry.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/errbot.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/geoip-updater.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/gogs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/leaps.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/nix-optimise.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/ssm-agent.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/misc/sssd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/arbtt.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/netdata.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/default.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/alertmanager.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/blackbox-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/json-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/nginx-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/node-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/snmp-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/unifi-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/prometheus/varnish-exporter.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/sysstat.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/telegraf.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/monitoring/vnstat.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/network-filesystems/cachefilesd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/network-filesystems/glusterfs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/network-filesystems/ipfs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/dante.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/dnscrypt-wrapper.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/fakeroute.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/flannel.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/htpdate.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/miredo.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/nftables.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/powerdns.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/pdns-recursor.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/quagga.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/redsocks.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/networking/wireguard.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/system/cgmanager.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/torrent/opentracker.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/atlassian/confluence.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/atlassian/crowd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/atlassian/jira.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/frab.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/nixbot.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/selfoss.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/web-apps/quassel-webserver.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/x11/unclutter-xfixes.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">services/x11/urxvtd.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">system/boot/systemd-nspawn.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">virtualisation/ecs-agent.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">virtualisation/lxcfs.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">virtualisation/openstack/keystone.nix</code>
        </p></li><li class="listitem"><p>
          <code class="literal">virtualisation/openstack/glance.nix</code>
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.03-incompatibilities"></a>B.11.3. Backward Incompatibilities</h3></div></div></div><p>
      When upgrading from a previous release, please be aware of the
      following incompatible changes:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Derivations have no <code class="literal">.nativeDrv</code> nor
          <code class="literal">.crossDrv</code> and are now cross by default, not
          native.
        </p></li><li class="listitem"><p>
          <code class="literal">stdenv.overrides</code> is now expected to take
          <code class="literal">self</code> and <code class="literal">super</code>
          arguments. See <code class="literal">lib.trivial.extends</code> for what
          those parameters represent.
        </p></li><li class="listitem"><p>
          <code class="literal">ansible</code> now defaults to ansible version 2
          as version 1 has been removed due to a serious
          <a class="link" href="https://www.computest.nl/advisories/CT-2017-0109_Ansible.txt" target="_top">
          vulnerability</a> unpatched by upstream.
        </p></li><li class="listitem"><p>
          <code class="literal">gnome</code> alias has been removed along with
          <code class="literal">gtk</code>, <code class="literal">gtkmm</code> and several
          others. Now you need to use versioned attributes, like
          <code class="literal">gnome3</code>.
        </p></li><li class="listitem"><p>
          The attribute name of the Radicale daemon has been changed
          from <code class="literal">pythonPackages.radicale</code> to
          <code class="literal">radicale</code>.
        </p></li><li class="listitem"><p>
          The <code class="literal">stripHash</code> bash function in
          <code class="literal">stdenv</code> changed according to its
          documentation; it now outputs the stripped name to
          <code class="literal">stdout</code> instead of putting it in the
          variable <code class="literal">strippedName</code>.
        </p></li><li class="listitem"><p>
          PHP now scans for extra configuration .ini files in /etc/php.d
          instead of /etc. This prevents accidentally loading non-PHP
          .ini files that may be in /etc.
        </p></li><li class="listitem"><p>
          Two lone top-level dict dbs moved into
          <code class="literal">dictdDBs</code>. This affects:
          <code class="literal">dictdWordnet</code> which is now at
          <code class="literal">dictdDBs.wordnet</code> and
          <code class="literal">dictdWiktionary</code> which is now at
          <code class="literal">dictdDBs.wiktionary</code>
        </p></li><li class="listitem"><p>
          Parsoid service now uses YAML configuration format.
          <code class="literal">service.parsoid.interwikis</code> is now called
          <code class="literal">service.parsoid.wikis</code> and is a list of
          either API URLs or attribute sets as specified in parsoid's
          documentation.
        </p></li><li class="listitem"><p>
          <code class="literal">Ntpd</code> was replaced by
          <code class="literal">systemd-timesyncd</code> as the default service to
          synchronize system time with a remote NTP server. The old
          behavior can be restored by setting
          <code class="literal">services.ntp.enable</code> to
          <code class="literal">true</code>. Upstream time servers for all NTP
          implementations are now configured using
          <code class="literal">networking.timeServers</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">service.nylon</code> is now declared using named
          instances. As an example:
        </p><pre class="programlisting">
{
  services.nylon = {
    enable = true;
    acceptInterface = "br0";
    bindInterface = "tun1";
    port = 5912;
  };
}
</pre><p>
          should be replaced with:
        </p><pre class="programlisting">
{
  services.nylon.myvpn = {
    enable = true;
    acceptInterface = "br0";
    bindInterface = "tun1";
    port = 5912;
  };
}
</pre><p>
          this enables you to declare a SOCKS proxy for each uplink.
        </p></li><li class="listitem"><p>
          <code class="literal">overridePackages</code> function no longer exists.
          It is replaced by
          <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-overlays-install" target="_top">
          overlays</a>. For example, the following code:
        </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};
in
  pkgs.overridePackages (self: super: ...)
</pre><p>
          should be replaced by:
        </p><pre class="programlisting">
let
  pkgs = import &lt;nixpkgs&gt; {};
in
  import pkgs.path { overlays = [(self: super: ...)]; }
</pre></li><li class="listitem"><p>
          Autoloading connection tracking helpers is now disabled by
          default. This default was also changed in the Linux kernel and
          is considered insecure if not configured properly in your
          firewall. If you need connection tracking helpers (i.e. for
          active FTP) please enable
          <code class="literal">networking.firewall.autoLoadConntrackHelpers</code>
          and tune
          <code class="literal">networking.firewall.connectionTrackingModules</code>
          to suit your needs.
        </p></li><li class="listitem"><p>
          <code class="literal">local_recipient_maps</code> is not set to empty
          value by Postfix service. It's an insecure default as stated
          by Postfix documentation. Those who want to retain this
          setting need to set it via
          <code class="literal">services.postfix.extraConfig</code>.
        </p></li><li class="listitem"><p>
          Iputils no longer provide ping6 and traceroute6. The
          functionality of these tools has been integrated into ping and
          traceroute respectively. To enforce an address family the new
          flags <code class="literal">-4</code> and <code class="literal">-6</code> have
          been added. One notable incompatibility is that specifying an
          interface (for link-local IPv6 for instance) is no longer done
          with the <code class="literal">-I</code> flag, but by encoding the
          interface into the address
          (<code class="literal">ping fe80::1%eth0</code>).
        </p></li><li class="listitem"><p>
          The socket handling of the <code class="literal">services.rmilter</code>
          module has been fixed and refactored. As rmilter doesn't
          support binding to more than one socket, the options
          <code class="literal">bindUnixSockets</code> and
          <code class="literal">bindInetSockets</code> have been replaced by
          <code class="literal">services.rmilter.bindSocket.*</code>. The default
          is still a unix socket in
          <code class="literal">/run/rmilter/rmilter.sock</code>. Refer to the
          options documentation for more information.
        </p></li><li class="listitem"><p>
          The <code class="literal">fetch*</code> functions no longer support md5,
          please use sha256 instead.
        </p></li><li class="listitem"><p>
          The dnscrypt-proxy module interface has been streamlined
          around the <code class="literal">extraArgs</code> option. Where
          possible, legacy option declarations are mapped to
          <code class="literal">extraArgs</code> but will emit warnings. The
          <code class="literal">resolverList</code> has been outright removed: to
          use an unlisted resolver, use the
          <code class="literal">customResolver</code> option.
        </p></li><li class="listitem"><p>
          torbrowser now stores local state under
          <code class="literal">~/.local/share/tor-browser</code> by default. Any
          browser profile data from the old location,
          <code class="literal">~/.torbrowser4</code>, must be migrated manually.
        </p></li><li class="listitem"><p>
          The ihaskell, monetdb, offlineimap and sitecopy services have
          been removed.
        </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-release-17.03-notable-changes"></a>B.11.4. Other Notable Changes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Module type system have a new extensible option types feature
          that allow to extend certain types, such as enum, through
          multiple option declarations of the same option across
          multiple modules.
        </p></li><li class="listitem"><p>
          <code class="literal">jre</code> now defaults to GTK UI by default. This
          improves visual consistency and makes Java follow system font
          style, improving the situation on HighDPI displays. This has a
          cost of increased closure size; for server and other headless
          workloads it's recommended to use
          <code class="literal">jre_headless</code>.
        </p></li><li class="listitem"><p>
          Python 2.6 interpreter and package set have been removed.
        </p></li><li class="listitem"><p>
          The Python 2.7 interpreter does not use modules anymore.
          Instead, all CPython interpreters now include the whole
          standard library except for `tkinter`, which is available in
          the Python package set.
        </p></li><li class="listitem"><p>
          Python 2.7, 3.5 and 3.6 are now built deterministically and
          3.4 mostly. Minor modifications had to be made to the
          interpreters in order to generate deterministic bytecode. This
          has security implications and is relevant for those using
          Python in a <code class="literal">nix-shell</code>. See the Nixpkgs
          manual for details.
        </p></li><li class="listitem"><p>
          The Python package sets now use a fixed-point combinator and
          the sets are available as attributes of the interpreters.
        </p></li><li class="listitem"><p>
          The Python function <code class="literal">buildPythonPackage</code> has
          been improved and can be used to build from Setuptools source,
          Flit source, and precompiled Wheels.
        </p></li><li class="listitem"><p>
          When adding new or updating current Python libraries, the
          expressions should be put in separate files in
          <code class="literal">pkgs/development/python-modules</code> and called
          from <code class="literal">python-packages.nix</code>.
        </p></li><li class="listitem"><p>
          The dnscrypt-proxy service supports synchronizing the list of
          public resolvers without working DNS resolution. This fixes
          issues caused by the resolver list becoming outdated. It also
          improves the viability of DNSCrypt only configurations.
        </p></li><li class="listitem"><p>
          Containers using bridged networking no longer lose their
          connection after changes to the host networking.
        </p></li><li class="listitem"><p>
          ZFS supports pool auto scrubbing.
        </p></li><li class="listitem"><p>
          The bind DNS utilities (e.g. dig) have been split into their
          own output and are now also available in
          <code class="literal">pkgs.dnsutils</code> and it is no longer necessary
          to pull in all of <code class="literal">bind</code> to use them.
        </p></li><li class="listitem"><p>
          Per-user configuration was moved from
          <code class="literal">~/.nixpkgs</code> to
          <code class="literal">~/.config/nixpkgs</code>. The former is still
          valid for <code class="literal">config.nix</code> for backwards
          compatibility.
        </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-16.09"></a>B.12. Release 16.09 (<span class="quote">“<span class="quote">Flounder</span>”</span>, 2016/09/30)</h2></div></div></div><p>
    In addition to numerous new and upgraded packages, this release has
    the following highlights:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Many NixOS configurations and Nix packages now use significantly
        less disk space, thanks to the
        <a class="link" href="https://github.com/NixOS/nixpkgs/issues/7117" target="_top">extensive
        work on closure size reduction</a>. For example, the closure
        size of a minimal NixOS container went down from ~424 MiB in
        16.03 to ~212 MiB in 16.09, while the closure size of Firefox
        went from ~651 MiB to ~259 MiB.
      </p></li><li class="listitem"><p>
        To improve security, packages are now
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/12895" target="_top">built
        using various hardening features</a>. See the Nixpkgs manual
        for more information.
      </p></li><li class="listitem"><p>
        Support for PXE netboot. See
        <a class="xref" href="index.html#sec-booting-from-pxe" title="2.5.2. Booting from the “netboot” media (PXE)">Section 2.5.2, “Booting from the <span class="quote">“<span class="quote">netboot</span>”</span> media (PXE)”</a> for documentation.
      </p></li><li class="listitem"><p>
        X.org server 1.18. If you use the <code class="literal">ati_unfree</code>
        driver, 1.17 is still used due to an ABI incompatibility.
      </p></li><li class="listitem"><p>
        This release is based on Glibc 2.24, GCC 5.4.0 and systemd 231.
        The default Linux kernel remains 4.4.
      </p></li></ul></div><p>
    The following new services were added since the last release:
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">(this will get automatically generated at release time)</code>
      </p></li></ul></div><p>
    When upgrading from a previous release, please be aware of the
    following incompatible changes:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        A large number of packages have been converted to use the
        multiple outputs feature of Nix to greatly reduce the amount of
        required disk space, as mentioned above. This may require
        changes to any custom packages to make them build again; see the
        relevant chapter in the Nixpkgs manual for more information.
        (Additional caveat to packagers: some packaging conventions
        related to multiple-output packages
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/14766" target="_top">were
        changed</a> late (August 2016) in the release cycle and
        differ from the initial introduction of multiple outputs.)
      </p></li><li class="listitem"><p>
        Previous versions of Nixpkgs had support for all versions of the
        LTS Haskell package set. That support has been dropped. The
        previously provided <code class="literal">haskell.packages.lts-x_y</code>
        package sets still exist in name to aviod breaking user code,
        but these package sets don't actually contain the versions
        mandated by the corresponding LTS release. Instead, our package
        set it loosely based on the latest available LTS release, i.e.
        LTS 7.x at the time of this writing. New releases of NixOS and
        Nixpkgs will drop those old names entirely.
        <a class="link" href="https://nixos.org/nix-dev/2016-June/020585.html" target="_top">The
        motivation for this change</a> has been discussed at length
        on the <code class="literal">nix-dev</code> mailing list and in
        <a class="link" href="https://github.com/NixOS/nixpkgs/issues/14897" target="_top">Github
        issue #14897</a>. Development strategies for Haskell hackers
        who want to rely on Nix and NixOS have been described in
        <a class="link" href="https://nixos.org/nix-dev/2016-June/020642.html" target="_top">another
        nix-dev article</a>.
      </p></li><li class="listitem"><p>
        Shell aliases for systemd sub-commands
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/15598" target="_top">were
        dropped</a>: <code class="literal">start</code>,
        <code class="literal">stop</code>, <code class="literal">restart</code>,
        <code class="literal">status</code>.
      </p></li><li class="listitem"><p>
        Redis now binds to 127.0.0.1 only instead of listening to all
        network interfaces. This is the default behavior of Redis 3.2
      </p></li><li class="listitem"><p>
        <code class="literal">/var/empty</code> is now immutable. Activation
        script runs <code class="literal">chattr +i</code> to forbid any
        modifications inside the folder. See
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/18365" target="_top">
        the pull request</a> for what bugs this caused.
      </p></li><li class="listitem"><p>
        Gitlab's maintainance script <code class="literal">gitlab-runner</code>
        was removed and split up into the more clearer
        <code class="literal">gitlab-run</code> and <code class="literal">gitlab-rake</code>
        scripts, because <code class="literal">gitlab-runner</code> is a component
        of Gitlab CI.
      </p></li><li class="listitem"><p>
        <code class="literal">services.xserver.libinput.accelProfile</code>
        default changed from <code class="literal">flat</code> to
        <code class="literal">adaptive</code>, as per
        <a class="link" href="https://wayland.freedesktop.org/libinput/doc/latest/group__config.html#gad63796972347f318b180e322e35cee79" target="_top">
        official documentation</a>.
      </p></li><li class="listitem"><p>
        <code class="literal">fonts.fontconfig.ultimate.rendering</code> was
        removed because our presets were obsolete for some time. New
        presets are hardcoded into FreeType; you can select a preset via
        <code class="literal">fonts.fontconfig.ultimate.preset</code>. You can
        customize those presets via ordinary environment variables,
        using <code class="literal">environment.variables</code>.
      </p></li><li class="listitem"><p>
        The <code class="literal">audit</code> service is no longer enabled by
        default. Use <code class="literal">security.audit.enable = true</code> to
        explicitly enable it.
      </p></li><li class="listitem"><p>
        <code class="literal">pkgs.linuxPackages.virtualbox</code> now contains
        only the kernel modules instead of the VirtualBox user space
        binaries. If you want to reference the user space binaries, you
        have to use the new <code class="literal">pkgs.virtualbox</code> instead.
      </p></li><li class="listitem"><p>
        <code class="literal">goPackages</code> was replaced with separated Go
        applications in appropriate <code class="literal">nixpkgs</code>
        categories. Each Go package uses its own dependency set. There's
        also a new <code class="literal">go2nix</code> tool introduced to generate
        a Go package definition from its Go source automatically.
      </p></li><li class="listitem"><p>
        <code class="literal">services.mongodb.extraConfig</code> configuration
        format was changed to YAML.
      </p></li><li class="listitem"><p>
        PHP has been upgraded to 7.0
      </p></li></ul></div><p>
    Other notable improvements:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Revamped grsecurity/PaX support. There is now only a single
        general-purpose distribution kernel and the configuration
        interface has been streamlined. Desktop users should be able to
        simply set
      </p><pre class="programlisting">
{
  security.grsecurity.enable = true;
}
</pre><p>
        to get a reasonably secure system without having to sacrifice
        too much functionality.
      </p></li><li class="listitem"><p>
        Special filesystems, like <code class="literal">/proc</code>,
        <code class="literal">/run</code> and others, now have the same mount
        options as recommended by systemd and are unified across
        different places in NixOS. Mount options are updated during
        <code class="literal">nixos-rebuild switch</code> if possible. One benefit
        from this is improved security — most such filesystems are now
        mounted with <code class="literal">noexec</code>, <code class="literal">nodev</code>
        and/or <code class="literal">nosuid</code> options.
      </p></li><li class="listitem"><p>
        The reverse path filter was interfering with DHCPv4 server
        operation in the past. An exception for DHCPv4 and a new option
        to log packets that were dropped due to the reverse path filter
        was added
        (<code class="literal">networking.firewall.logReversePathDrops</code>) for
        easier debugging.
      </p></li><li class="listitem"><p>
        Containers configuration within
        <code class="literal">containers.&lt;name&gt;.config</code> is
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/17365" target="_top">now
        properly typed and checked</a>. In particular, partial
        configurations are merged correctly.
      </p></li><li class="listitem"><p>
        The directory container setuid wrapper programs,
        <code class="literal">/var/setuid-wrappers</code>,
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/18124" target="_top">is
        now updated atomically to prevent failures if the switch to a
        new configuration is interrupted.</a>
      </p></li><li class="listitem"><p>
        <code class="literal">services.xserver.startGnuPGAgent</code> has been
        removed due to GnuPG 2.1.x bump. See
        <a class="link" href="https://github.com/NixOS/nixpkgs/commit/5391882ebd781149e213e8817fba6ac3c503740c" target="_top">
        how to achieve similar behavior</a>. You might need to
        <code class="literal">pkill gpg-agent</code> after the upgrade to prevent
        a stale agent being in the way.
      </p></li><li class="listitem"><p>
        <a class="link" href="https://github.com/NixOS/nixpkgs/commit/e561edc322d275c3687fec431935095cfc717147" target="_top">
        Declarative users could share the uid due to the bug in the
        script handling conflict resolution. </a>
      </p></li><li class="listitem"><p>
        Gummi boot has been replaced using systemd-boot.
      </p></li><li class="listitem"><p>
        Hydra package and NixOS module were added for convenience.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-16.03"></a>B.13. Release 16.03 (<span class="quote">“<span class="quote">Emu</span>”</span>, 2016/03/31)</h2></div></div></div><p>
    In addition to numerous new and upgraded packages, this release has
    the following highlights:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Systemd 229, bringing
        <a class="link" href="https://github.com/systemd/systemd/blob/v229/NEWS" target="_top">numerous
        improvements</a> over 217.
      </p></li><li class="listitem"><p>
        Linux 4.4 (was 3.18).
      </p></li><li class="listitem"><p>
        GCC 5.3 (was 4.9). Note that GCC 5
        <a class="link" href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html" target="_top">changes
        the C++ ABI in an incompatible way</a>; this may cause
        problems if you try to link objects compiled with different
        versions of GCC.
      </p></li><li class="listitem"><p>
        Glibc 2.23 (was 2.21).
      </p></li><li class="listitem"><p>
        Binutils 2.26 (was 2.23.1). See #909
      </p></li><li class="listitem"><p>
        Improved support for ensuring
        <a class="link" href="https://reproducible-builds.org/" target="_top">bitwise
        reproducible builds</a>. For example,
        <code class="literal">stdenv</code> now sets the environment variable
        <code class="literal">SOURCE_DATE_EPOCH</code> to a deterministic value,
        and Nix has
        <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-1.11" target="_top">gained
        an option</a> to repeat a build a number of times to test
        determinism. An ongoing project, the goal of exact
        reproducibility is to allow binaries to be verified
        independently (e.g., a user might only trust binaries that
        appear in three independent binary caches).
      </p></li><li class="listitem"><p>
        Perl 5.22.
      </p></li></ul></div><p>
    The following new services were added since the last release:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">services/monitoring/longview.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">hardware/video/webcam/facetimehd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">i18n/input-method/default.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">i18n/input-method/fcitx.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">i18n/input-method/ibus.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">i18n/input-method/nabi.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">i18n/input-method/uim.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">programs/fish.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">security/acme.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">security/audit.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">security/oath.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/hardware/irqbalance.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/mail/dspam.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/mail/opendkim.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/mail/postsrsd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/mail/rspamd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/mail/rmilter.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/autofs.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/bepasty.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/calibre-server.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/cfdyndns.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/gammu-smsd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/mathics.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/matrix-synapse.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/octoprint.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/hdaps.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/heapster.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/longview.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/network-filesystems/netatalk.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/network-filesystems/xtreemfs.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/autossh.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/dnschain.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/gale.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/miniupnpd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/namecoind.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/ostinato.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/pdnsd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/shairport-sync.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/supplicant.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/search/kibana.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/security/haka.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/security/physlock.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/web-apps/pump.io.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/x11/hardware/libinput.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/x11/window-managers/windowlab.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/initrd-network.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/initrd-ssh.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/loader/loader.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/networkd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/resolved.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">virtualisation/lxd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">virtualisation/rkt.nix</code>
      </p></li></ul></div><p>
    When upgrading from a previous release, please be aware of the
    following incompatible changes:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        We no longer produce graphical ISO images and VirtualBox images
        for <code class="literal">i686-linux</code>. A minimal ISO image is still
        provided.
      </p></li><li class="listitem"><p>
        Firefox and similar browsers are now <span class="emphasis"><em>wrapped by
        default</em></span>. The package and attribute names are plain
        <code class="literal">firefox</code> or <code class="literal">midori</code>, etc.
        Backward-compatibility attributes were set up, but note that
        <code class="literal">nix-env -u</code> will <span class="emphasis"><em>not</em></span>
        update your current <code class="literal">firefox-with-plugins</code>; you
        have to uninstall it and install <code class="literal">firefox</code>
        instead.
      </p></li><li class="listitem"><p>
        <code class="literal">wmiiSnap</code> has been replaced with
        <code class="literal">wmii_hg</code>, but
        <code class="literal">services.xserver.windowManager.wmii.enable</code>
        has been updated respectively so this only affects you if you
        have explicitly installed <code class="literal">wmiiSnap</code>.
      </p></li><li class="listitem"><p>
        <code class="literal">jobs</code> NixOS option has been removed. It served
        as compatibility layer between Upstart jobs and SystemD
        services. All services have been rewritten to use
        <code class="literal">systemd.services</code>
      </p></li><li class="listitem"><p>
        <code class="literal">wmiimenu</code> is removed, as it has been removed
        by the developers upstream. Use <code class="literal">wimenu</code> from
        the <code class="literal">wmii-hg</code> package.
      </p></li><li class="listitem"><p>
        Gitit is no longer automatically added to the module list in
        NixOS and as such there will not be any manual entries for it.
        You will need to add an import statement to your NixOS
        configuration in order to use it, e.g.
      </p><pre class="programlisting">
{
  imports = [ &lt;nixpkgs/nixos/modules/services/misc/gitit.nix&gt; ];
}
</pre><p>
        will include the Gitit service configuration options.
      </p></li><li class="listitem"><p>
        <code class="literal">nginx</code> does not accept flags for enabling and
        disabling modules anymore. Instead it accepts
        <code class="literal">modules</code> argument, which is a list of modules
        to be built in. All modules now reside in
        <code class="literal">nginxModules</code> set. Example configuration:
      </p><pre class="programlisting">
nginx.override {
  modules = [ nginxModules.rtmp nginxModules.dav nginxModules.moreheaders ];
}
</pre></li><li class="listitem"><p>
        <code class="literal">s3sync</code> is removed, as it hasn't been
        developed by upstream for 4 years and only runs with ruby 1.8.
        For an actively-developer alternative look at
        <code class="literal">tarsnap</code> and others.
      </p></li><li class="listitem"><p>
        <code class="literal">ruby_1_8</code> has been removed as it's not
        supported from upstream anymore and probably contains security
        issues.
      </p></li><li class="listitem"><p>
        <code class="literal">tidy-html5</code> package is removed. Upstream only
        provided <code class="literal">(lib)tidy5</code> during development, and
        now they went back to <code class="literal">(lib)tidy</code> to work as a
        drop-in replacement of the original package that has been
        unmaintained for years. You can (still) use the
        <code class="literal">html-tidy</code> package, which got updated to a
        stable release from this new upstream.
      </p></li><li class="listitem"><p>
        <code class="literal">extraDeviceOptions</code> argument is removed from
        <code class="literal">bumblebee</code> package. Instead there are now two
        separate arguments: <code class="literal">extraNvidiaDeviceOptions</code>
        and <code class="literal">extraNouveauDeviceOptions</code> for setting
        extra X11 options for nvidia and nouveau drivers, respectively.
      </p></li><li class="listitem"><p>
        The <code class="literal">Ctrl+Alt+Backspace</code> key combination no
        longer kills the X server by default. There's a new option
        <code class="literal">services.xserver.enableCtrlAltBackspace</code>
        allowing to enable the combination again.
      </p></li><li class="listitem"><p>
        <code class="literal">emacsPackagesNg</code> now contains all packages
        from the ELPA, MELPA, and MELPA Stable repositories.
      </p></li><li class="listitem"><p>
        Data directory for Postfix MTA server is moved from
        <code class="literal">/var/postfix</code> to
        <code class="literal">/var/lib/postfix</code>. Old configurations are
        migrated automatically. <code class="literal">service.postfix</code>
        module has also received many improvements, such as correct
        directories' access rights, new <code class="literal">aliasFiles</code>
        and <code class="literal">mapFiles</code> options and more.
      </p></li><li class="listitem"><p>
        Filesystem options should now be configured as a list of
        strings, not a comma-separated string. The old style will
        continue to work, but print a warning, until the 16.09 release.
        An example of the new style:
      </p><pre class="programlisting">
{
  fileSystems."/example" = {
    device = "/dev/sdc";
    fsType = "btrfs";
    options = [ "noatime" "compress=lzo" "space_cache" "autodefrag" ];
  };
}
</pre></li><li class="listitem"><p>
        CUPS, installed by <code class="literal">services.printing</code> module,
        now has its data directory in <code class="literal">/var/lib/cups</code>.
        Old configurations from <code class="literal">/etc/cups</code> are moved
        there automatically, but there might be problems. Also
        configuration options
        <code class="literal">services.printing.cupsdConf</code> and
        <code class="literal">services.printing.cupsdFilesConf</code> were removed
        because they had been allowing one to override configuration
        variables required for CUPS to work at all on NixOS. For most
        use cases, <code class="literal">services.printing.extraConf</code> and
        new option <code class="literal">services.printing.extraFilesConf</code>
        should be enough; if you encounter a situation when they are
        not, please file a bug.
      </p><p>
        There are also Gutenprint improvements; in particular, a new
        option <code class="literal">services.printing.gutenprint</code> is added
        to enable automatic updating of Gutenprint PPMs; it's greatly
        recommended to enable it instead of adding
        <code class="literal">gutenprint</code> to the <code class="literal">drivers</code>
        list.
      </p></li><li class="listitem"><p>
        <code class="literal">services.xserver.vaapiDrivers</code> has been
        removed. Use
        <code class="literal">hardware.opengl.extraPackages{,32}</code> instead.
        You can also specify VDPAU drivers there.
      </p></li><li class="listitem"><p>
        <code class="literal">programs.ibus</code> moved to
        <code class="literal">i18n.inputMethod.ibus</code>. The option
        <code class="literal">programs.ibus.plugins</code> changed to
        <code class="literal">i18n.inputMethod.ibus.engines</code> and the option
        to enable ibus changed from
        <code class="literal">programs.ibus.enable</code> to
        <code class="literal">i18n.inputMethod.enabled</code>.
        <code class="literal">i18n.inputMethod.enabled</code> should be set to the
        used input method name, <code class="literal">"ibus"</code> for
        ibus. An example of the new style:
      </p><pre class="programlisting">
{
  i18n.inputMethod.enabled = "ibus";
  i18n.inputMethod.ibus.engines = with pkgs.ibus-engines; [ anthy mozc ];
}
</pre><p>
        That is equivalent to the old version:
      </p><pre class="programlisting">
{
  programs.ibus.enable = true;
  programs.ibus.plugins = with pkgs; [ ibus-anthy mozc ];
}
</pre></li><li class="listitem"><p>
        <code class="literal">services.udev.extraRules</code> option now writes
        rules to <code class="literal">99-local.rules</code> instead of
        <code class="literal">10-local.rules</code>. This makes all the user rules
        apply after others, so their results wouldn't be overriden by
        anything else.
      </p></li><li class="listitem"><p>
        Large parts of the <code class="literal">services.gitlab</code> module has
        been been rewritten. There are new configuration options
        available. The <code class="literal">stateDir</code> option was renamned
        to <code class="literal">statePath</code> and the
        <code class="literal">satellitesDir</code> option was removed. Please
        review the currently available options.
      </p></li><li class="listitem"><p>
        The option
        <code class="literal">services.nsd.zones.&lt;name&gt;.data</code> no
        longer interpret the dollar sign ($) as a shell variable, as
        such it should not be escaped anymore. Thus the following zone
        data:
      </p><pre class="programlisting">
$ORIGIN example.com.
$TTL 1800
@       IN      SOA     ns1.vpn.nbp.name.      admin.example.com. (
</pre><p>
        Should modified to look like the actual file expected by nsd:
      </p><pre class="programlisting">
$ORIGIN example.com.
$TTL 1800
@       IN      SOA     ns1.vpn.nbp.name.      admin.example.com. (
</pre></li><li class="listitem"><p>
        <code class="literal">service.syncthing.dataDir</code> options now has to
        point to exact folder where syncthing is writing to. Example
        configuration should look something like:
      </p><pre class="programlisting">
{
  services.syncthing = {
      enable = true;
      dataDir = "/home/somebody/.syncthing";
      user = "somebody";
  };
}
</pre></li><li class="listitem"><p>
        <code class="literal">networking.firewall.allowPing</code> is now enabled
        by default. Users are encouraged to configure an appropriate
        rate limit for their machines using the Kernel interface at
        <code class="literal">/proc/sys/net/ipv4/icmp_ratelimit</code> and
        <code class="literal">/proc/sys/net/ipv6/icmp/ratelimit</code> or using
        the firewall itself, i.e. by setting the NixOS option
        <code class="literal">networking.firewall.pingLimit</code>.
      </p></li><li class="listitem"><p>
        Systems with some broadcom cards used to result into a generated
        config that is no longer accepted. If you get errors like
      </p><pre class="programlisting">
error: path ‘/nix/store/*-broadcom-sta-*’ does not exist and cannot be created
</pre><p>
        you should either re-run
        <code class="literal">nixos-generate-config</code> or manually replace
        <code class="literal">"${config.boot.kernelPackages.broadcom_sta}"</code>
        by <code class="literal">config.boot.kernelPackages.broadcom_sta</code> in
        your <code class="literal">/etc/nixos/hardware-configuration.nix</code>.
        More discussion is on
        <a class="link" href="https://github.com/NixOS/nixpkgs/pull/12595" target="_top">
        the github issue</a>.
      </p></li><li class="listitem"><p>
        The <code class="literal">services.xserver.startGnuPGAgent</code> option
        has been removed. GnuPG 2.1.x changed the way the gpg-agent
        works, and that new approach no longer requires (or even
        supports) the "start everything as a child of the
        agent" scheme we've implemented in NixOS for older
        versions. To configure the gpg-agent for your X session, add the
        following code to <code class="literal">~/.bashrc</code> or some file
        that’s sourced when your shell is started:
      </p><pre class="programlisting">
GPG_TTY=$(tty)
export GPG_TTY
</pre><p>
        If you want to use gpg-agent for SSH, too, add the following to
        your session initialization (e.g.
        <code class="literal">displayManager.sessionCommands</code>)
      </p><pre class="programlisting">
    gpg-connect-agent /bye
    unset SSH_AGENT_PID
    export SSH_AUTH_SOCK="''${HOME}/.gnupg/S.gpg-agent.ssh"
</pre><p>
        and make sure that
      </p><pre class="programlisting">
    enable-ssh-support
</pre><p>
        is included in your <code class="literal">~/.gnupg/gpg-agent.conf</code>.
        You will need to use <code class="literal">ssh-add</code> to re-add your
        ssh keys. If gpg’s automatic transformation of the private keys
        to the new format fails, you will need to re-import your private
        keyring as well:
      </p><pre class="programlisting">
    gpg --import ~/.gnupg/secring.gpg
</pre><p>
        The <code class="literal">gpg-agent(1)</code> man page has more details
        about this subject, i.e. in the "EXAMPLES" section.
      </p></li></ul></div><p>
    Other notable improvements:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">ejabberd</code> module is brought back and now works
        on NixOS.
      </p></li><li class="listitem"><p>
        Input method support was improved. New NixOS modules (fcitx,
        nabi and uim), fcitx engines (chewing, hangul, m17n, mozc and
        table-other) and ibus engines (hangul and m17n) have been added.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-15.09"></a>B.14. Release 15.09 (<span class="quote">“<span class="quote">Dingo</span>”</span>, 2015/09/30)</h2></div></div></div><p>
    In addition to numerous new and upgraded packages, this release has
    the following highlights:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <a class="link" href="http://haskell.org/" target="_top">Haskell</a>
        packages infrastructure has been re-designed from the ground up
        ("Haskell NG"). NixOS now distributes the latest
        version of every single package registered on
        <a class="link" href="http://hackage.haskell.org/" target="_top">Hackage</a> --
        well in excess of 8,000 Haskell packages. Detailed instructions
        on how to use that infrastructure can be found in the
        <a class="link" href="https://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure" target="_top">User's
        Guide to the Haskell Infrastructure</a>. Users migrating from
        an earlier release may find helpful information below, in the
        list of backwards-incompatible changes. Furthermore, we
        distribute 51(!) additional Haskell package sets that provide
        every single <a class="link" href="http://www.stackage.org/" target="_top">LTS
        Haskell</a> release since version 0.0 as well as the most
        recent <a class="link" href="http://www.stackage.org/" target="_top">Stackage
        Nightly</a> snapshot. The announcement
        <a class="link" href="https://nixos.org/nix-dev/2015-September/018138.html" target="_top">"Full
        Stackage Support in Nixpkgs"</a> gives additional
        details.
      </p></li><li class="listitem"><p>
        Nix has been updated to version 1.10, which among other
        improvements enables cryptographic signatures on binary caches
        for improved security.
      </p></li><li class="listitem"><p>
        You can now keep your NixOS system up to date automatically by
        setting
      </p></li></ul></div><pre class="programlisting">
{
  system.autoUpgrade.enable = true;
}
</pre><p>
    This will cause the system to periodically check for updates in your
    current channel and run <code class="literal">nixos-rebuild</code>.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        This release is based on Glibc 2.21, GCC 4.9 and Linux 3.18.
      </p></li><li class="listitem"><p>
        GNOME has been upgraded to 3.16.
      </p></li><li class="listitem"><p>
        Xfce has been upgraded to 4.12.
      </p></li><li class="listitem"><p>
        KDE 5 has been upgraded to KDE Frameworks 5.10, Plasma 5.3.2 and
        Applications 15.04.3. KDE 4 has been updated to kdelibs-4.14.10.
      </p></li><li class="listitem"><p>
        E19 has been upgraded to 0.16.8.15.
      </p></li></ul></div><p>
    The following new services were added since the last release:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">services/mail/exim.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/apache-kafka.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/canto-daemon.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/confd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/devmon.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/gitit.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/ihaskell.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/mbpfan.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/mediatomb.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/mwlib.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/parsoid.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/plex.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/ripple-rest.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/ripple-data-api.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/subsonic.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/misc/sundtek.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/cadvisor.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/das_watchdog.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/grafana.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/riemann-tools.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/monitoring/teamviewer.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/network-filesystems/u9fs.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/aiccu.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/asterisk.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/bird.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/charybdis.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/docker-registry-server.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/fan.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/firefox/sync-server.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/gateone.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/heyefi.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/i2p.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/lambdabot.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/mstpd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/nix-serve.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/nylon.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/racoon.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/skydns.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/shout.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/softether.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/sslh.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/tinc.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/tlsdated.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/tox-bootstrapd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/tvheadend.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/networking/zerotierone.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/scheduling/marathon.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/security/fprintd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/security/hologram.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/security/munge.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/system/cloud-init.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/web-servers/shellinabox.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/web-servers/uwsgi.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/x11/unclutter.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">services/x11/display-managers/sddm.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/coredump.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/loader/loader.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/loader/generic-extlinux-compatible</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/networkd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/resolved.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">system/boot/timesyncd.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">tasks/filesystems/exfat.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">tasks/filesystems/ntfs.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">tasks/filesystems/vboxsf.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">virtualisation/virtualbox-host.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">virtualisation/vmware-guest.nix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">virtualisation/xen-dom0.nix</code>
      </p></li></ul></div><p>
    When upgrading from a previous release, please be aware of the
    following incompatible changes:
  </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">sshd</code> no longer supports DSA and ECDSA host
        keys by default. If you have existing systems with such host
        keys and want to continue to use them, please set
      </p></li></ul></div><pre class="programlisting">
{
  system.stateVersion = "14.12";
}
</pre><p>
    The new option <code class="literal">system.stateVersion</code> ensures that
    certain configuration changes that could break existing systems
    (such as the <code class="literal">sshd</code> host key setting) will maintain
    compatibility with the specified NixOS release. NixOps sets the
    state version of existing deployments automatically.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">cron</code> is no longer enabled by default, unless
        you have a non-empty
        <code class="literal">services.cron.systemCronJobs</code>. To force
        <code class="literal">cron</code> to be enabled, set
        <code class="literal">services.cron.enable = true</code>.
      </p></li><li class="listitem"><p>
        Nix now requires binary caches to be cryptographically signed.
        If you have unsigned binary caches that you want to continue to
        use, you should set
        <code class="literal">nix.requireSignedBinaryCaches = false</code>.
      </p></li><li class="listitem"><p>
        Steam now doesn't need root rights to work. Instead of using
        <code class="literal">*-steam-chrootenv</code>, you should now just run
        <code class="literal">steam</code>. <code class="literal">steamChrootEnv</code>
        package was renamed to <code class="literal">steam</code>, and old
        <code class="literal">steam</code> package -- to
        <code class="literal">steamOriginal</code>.
      </p></li><li class="listitem"><p>
        CMPlayer has been renamed to bomi upstream. Package
        <code class="literal">cmplayer</code> was accordingly renamed to
        <code class="literal">bomi</code>
      </p></li><li class="listitem"><p>
        Atom Shell has been renamed to Electron upstream. Package
        <code class="literal">atom-shell</code> was accordingly renamed to
        <code class="literal">electron</code>
      </p></li><li class="listitem"><p>
        Elm is not released on Hackage anymore. You should now use
        <code class="literal">elmPackages.elm</code> which contains the latest Elm
        platform.
      </p></li><li class="listitem"><p>
        The CUPS printing service has been updated to version
        <code class="literal">2.0.2</code>. Furthermore its systemd service has
        been renamed to <code class="literal">cups.service</code>.
      </p><p>
        Local printers are no longer shared or advertised by default.
        This behavior can be changed by enabling
        <code class="literal">services.printing.defaultShared</code> or
        <code class="literal">services.printing.browsing</code> respectively.
      </p></li><li class="listitem"><p>
        The VirtualBox host and guest options have been named more
        consistently. They can now found in
        <code class="literal">virtualisation.virtualbox.host.*</code> instead of
        <code class="literal">services.virtualboxHost.*</code> and
        <code class="literal">virtualisation.virtualbox.guest.*</code> instead of
        <code class="literal">services.virtualboxGuest.*</code>.
      </p><p>
        Also, there now is support for the <code class="literal">vboxsf</code>
        file system using the <code class="literal">fileSystems</code>
        configuration attribute. An example of how this can be used in a
        configuration:
      </p></li></ul></div><pre class="programlisting">
{
  fileSystems."/shiny" = {
    device = "myshinysharedfolder";
    fsType = "vboxsf";
  };
}
</pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>
        "<code class="literal">nix-env -qa</code>" no longer discovers
        Haskell packages by name. The only packages visible in the
        global scope are <code class="literal">ghc</code>,
        <code class="literal">cabal-install</code>, and <code class="literal">stack</code>,
        but all other packages are hidden. The reason for this
        inconvenience is the sheer size of the Haskell package set.
        Name-based lookups are expensive, and most
        <code class="literal">nix-env -qa</code> operations would become much
        slower if we'd add the entire Hackage database into the top
        level attribute set. Instead, the list of Haskell packages can
        be displayed by running:
      </p></li></ul></div><pre class="programlisting">
nix-env -f "&lt;nixpkgs&gt;" -qaP -A haskellPackages
</pre><p>
    Executable programs written in Haskell can be installed with:
  </p><pre class="programlisting">
nix-env -f "&lt;nixpkgs&gt;" -iA haskellPackages.pandoc
</pre><p>
    Installing Haskell <span class="emphasis"><em>libraries</em></span> this way, however,
    is no longer supported. See the next item for more details.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Previous versions of NixOS came with a feature called
        <code class="literal">ghc-wrapper</code>, a small script that allowed GHC
        to transparently pick up on libraries installed in the user's
        profile. This feature has been deprecated;
        <code class="literal">ghc-wrapper</code> was removed from the
        distribution. The proper way to register Haskell libraries with
        the compiler now is the
        <code class="literal">haskellPackages.ghcWithPackages</code> function. The
        <a class="link" href="https://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure" target="_top">User's
        Guide to the Haskell Infrastructure</a> provides more
        information about this subject.
      </p></li><li class="listitem"><p>
        All Haskell builds that have been generated with version 1.x of
        the <code class="literal">cabal2nix</code> utility are now invalid and
        need to be re-generated with a current version of
        <code class="literal">cabal2nix</code> to function. The most recent
        version of this tool can be installed by running
        <code class="literal">nix-env -i cabal2nix</code>.
      </p></li><li class="listitem"><p>
        The <code class="literal">haskellPackages</code> set in Nixpkgs used to
        have a function attribute called <code class="literal">extension</code>
        that users could override in their
        <code class="literal">~/.nixpkgs/config.nix</code> files to configure
        additional attributes, etc. That function still exists, but it's
        now called <code class="literal">overrides</code>.
      </p></li><li class="listitem"><p>
        The OpenBLAS library has been updated to version
        <code class="literal">0.2.14</code>. Support for the
        <code class="literal">x86_64-darwin</code> platform was added. Dynamic
        architecture detection was enabled; OpenBLAS now selects
        microarchitecture-optimized routines at runtime, so optimal
        performance is achieved without the need to rebuild OpenBLAS
        locally. OpenBLAS has replaced ATLAS in most packages which use
        an optimized BLAS or LAPACK implementation.
      </p></li><li class="listitem"><p>
        The <code class="literal">phpfpm</code> is now using the default PHP
        version (<code class="literal">pkgs.php</code>) instead of PHP 5.4
        (<code class="literal">pkgs.php54</code>).
      </p></li><li class="listitem"><p>
        The <code class="literal">locate</code> service no longer indexes the Nix
        store by default, preventing packages with potentially numerous
        versions from cluttering the output. Indexing the store can be
        activated by setting
        <code class="literal">services.locate.includeStore = true</code>.
      </p></li><li class="listitem"><p>
        The Nix expression search path (<code class="literal">NIX_PATH</code>) no
        longer contains <code class="literal">/etc/nixos/nixpkgs</code> by
        default. You can override <code class="literal">NIX_PATH</code> by setting
        <code class="literal">nix.nixPath</code>.
      </p></li><li class="listitem"><p>
        Python 2.6 has been marked as broken (as it no longer receives
        security updates from upstream).
      </p></li><li class="listitem"><p>
        Any use of module arguments such as <code class="literal">pkgs</code> to
        access library functions, or to define
        <code class="literal">imports</code> attributes will now lead to an
        infinite loop at the time of the evaluation.
      </p><p>
        In case of an infinite loop, use the
        <code class="literal">--show-trace</code> command line argument and read
        the line just above the error message.
      </p><pre class="programlisting">
$ nixos-rebuild build --show-trace
…
while evaluating the module argument `pkgs' in "/etc/nixos/my-module.nix":
infinite recursion encountered
</pre><p>
        Any use of <code class="literal">pkgs.lib</code>, should be replaced by
        <code class="literal">lib</code>, after adding it as argument of the
        module. The following module
      </p><pre class="programlisting">
{ config, pkgs, ... }:

with pkgs.lib;

{
  options = {
    foo = mkOption { … };
  };
  config = mkIf config.foo { … };
}
</pre><p>
        should be modified to look like:
      </p><pre class="programlisting">
{ config, pkgs, lib, ... }:

with lib;

{
  options = {
    foo = mkOption { option declaration };
  };
  config = mkIf config.foo { option definition };
}
</pre><p>
        When <code class="literal">pkgs</code> is used to download other projects
        to import their modules, and only in such cases, it should be
        replaced by <code class="literal">(import &lt;nixpkgs&gt; {})</code>. The
        following module
      </p><pre class="programlisting">
{ config, pkgs, ... }:

let
  myProject = pkgs.fetchurl {
    src = url;
    sha256 = hash;
  };
in

{
  imports = [ "${myProject}/module.nix" ];
}
</pre><p>
        should be modified to look like:
      </p><pre class="programlisting">
{ config, pkgs, ... }:

let
  myProject = (import &lt;nixpkgs&gt; {}).fetchurl {
    src = url;
    sha256 = hash;
  };
in

{
  imports = [ "${myProject}/module.nix" ];
}
</pre></li></ul></div><p>
    Other notable improvements:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The nixos and nixpkgs channels were unified, so one
        <span class="emphasis"><em>can</em></span> use
        <code class="literal">nix-env -iA nixos.bash</code> instead of
        <code class="literal">nix-env -iA nixos.pkgs.bash</code>. See
        <a class="link" href="https://github.com/NixOS/nixpkgs/commit/2cd7c1f198" target="_top">the
        commit</a> for details.
      </p></li><li class="listitem"><p>
        Users running an SSH server who worry about the quality of their
        <code class="literal">/etc/ssh/moduli</code> file with respect to the
        <a class="link" href="https://stribika.github.io/2015/01/04/secure-secure-shell.html" target="_top">vulnerabilities
        discovered in the Diffie-Hellman key exchange</a> can now
        replace OpenSSH's default version with one they generated
        themselves using the new
        <code class="literal">services.openssh.moduliFile</code> option.
      </p></li><li class="listitem"><p>
        A newly packaged TeX Live 2015 is provided in
        <code class="literal">pkgs.texlive</code>, split into 6500 nix packages.
        For basic user documentation see
        <a class="link" href="https://github.com/NixOS/nixpkgs/blob/release-15.09/pkgs/tools/typesetting/tex/texlive/default.nix#L1" target="_top">the
        source</a>. Beware of
        <a class="link" href="https://github.com/NixOS/nixpkgs/issues/9757" target="_top">an
        issue</a> when installing a too large package set. The plan
        is to deprecate and maybe delete the original TeX packages until
        the next release.
      </p></li><li class="listitem"><p>
        <code class="literal">buildEnv.env</code> on all Python interpreters is
        now available for nix-shell interoperability.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-14.12"></a>B.15. Release 14.12 (<span class="quote">“<span class="quote">Caterpillar</span>”</span>, 2014/12/30)</h2></div></div></div><p>
    In addition to numerous new and upgraded packages, this release has
    the following highlights:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Systemd has been updated to version 217, which has numerous
        <a class="link" href="http://lists.freedesktop.org/archives/systemd-devel/2014-October/024662.html" target="_top">improvements.</a>
      </p></li><li class="listitem"><p>
        <a class="link" href="https://www.mail-archive.com/nix-dev@lists.science.uu.nl/msg13957.html" target="_top">Nix
        has been updated to 1.8.</a>
      </p></li><li class="listitem"><p>
        NixOS is now based on Glibc 2.20.
      </p></li><li class="listitem"><p>
        KDE has been updated to 4.14.
      </p></li><li class="listitem"><p>
        The default Linux kernel has been updated to 3.14.
      </p></li><li class="listitem"><p>
        If <code class="literal">users.mutableUsers</code> is enabled (the
        default), changes made to the declaration of a user or group
        will be correctly realised when running
        <code class="literal">nixos-rebuild</code>. For instance, removing a user
        specification from <code class="literal">configuration.nix</code> will
        cause the actual user account to be deleted. If
        <code class="literal">users.mutableUsers</code> is disabled, it is no
        longer necessary to specify UIDs or GIDs; if omitted, they are
        allocated dynamically.
      </p></li></ul></div><p>
    Following new services were added since the last release:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">atftpd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">bosun</code>
      </p></li><li class="listitem"><p>
        <code class="literal">bspwm</code>
      </p></li><li class="listitem"><p>
        <code class="literal">chronos</code>
      </p></li><li class="listitem"><p>
        <code class="literal">collectd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">consul</code>
      </p></li><li class="listitem"><p>
        <code class="literal">cpuminer-cryptonight</code>
      </p></li><li class="listitem"><p>
        <code class="literal">crashplan</code>
      </p></li><li class="listitem"><p>
        <code class="literal">dnscrypt-proxy</code>
      </p></li><li class="listitem"><p>
        <code class="literal">docker-registry</code>
      </p></li><li class="listitem"><p>
        <code class="literal">docker</code>
      </p></li><li class="listitem"><p>
        <code class="literal">etcd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">fail2ban</code>
      </p></li><li class="listitem"><p>
        <code class="literal">fcgiwrap</code>
      </p></li><li class="listitem"><p>
        <code class="literal">fleet</code>
      </p></li><li class="listitem"><p>
        <code class="literal">fluxbox</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gdm</code>
      </p></li><li class="listitem"><p>
        <code class="literal">geoclue2</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gitlab</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gitolite</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gnome3.gnome-documents</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gnome3.gnome-online-miners</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gnome3.gvfs</code>
      </p></li><li class="listitem"><p>
        <code class="literal">gnome3.seahorse</code>
      </p></li><li class="listitem"><p>
        <code class="literal">hbase</code>
      </p></li><li class="listitem"><p>
        <code class="literal">i2pd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">influxdb</code>
      </p></li><li class="listitem"><p>
        <code class="literal">kubernetes</code>
      </p></li><li class="listitem"><p>
        <code class="literal">liquidsoap</code>
      </p></li><li class="listitem"><p>
        <code class="literal">lxc</code>
      </p></li><li class="listitem"><p>
        <code class="literal">mailpile</code>
      </p></li><li class="listitem"><p>
        <code class="literal">mesos</code>
      </p></li><li class="listitem"><p>
        <code class="literal">mlmmj</code>
      </p></li><li class="listitem"><p>
        <code class="literal">monetdb</code>
      </p></li><li class="listitem"><p>
        <code class="literal">mopidy</code>
      </p></li><li class="listitem"><p>
        <code class="literal">neo4j</code>
      </p></li><li class="listitem"><p>
        <code class="literal">nsd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">openntpd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">opentsdb</code>
      </p></li><li class="listitem"><p>
        <code class="literal">openvswitch</code>
      </p></li><li class="listitem"><p>
        <code class="literal">parallels-guest</code>
      </p></li><li class="listitem"><p>
        <code class="literal">peerflix</code>
      </p></li><li class="listitem"><p>
        <code class="literal">phd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">polipo</code>
      </p></li><li class="listitem"><p>
        <code class="literal">prosody</code>
      </p></li><li class="listitem"><p>
        <code class="literal">radicale</code>
      </p></li><li class="listitem"><p>
        <code class="literal">redmine</code>
      </p></li><li class="listitem"><p>
        <code class="literal">riemann</code>
      </p></li><li class="listitem"><p>
        <code class="literal">scollector</code>
      </p></li><li class="listitem"><p>
        <code class="literal">seeks</code>
      </p></li><li class="listitem"><p>
        <code class="literal">siproxd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">strongswan</code>
      </p></li><li class="listitem"><p>
        <code class="literal">tcsd</code>
      </p></li><li class="listitem"><p>
        <code class="literal">teamspeak3</code>
      </p></li><li class="listitem"><p>
        <code class="literal">thermald</code>
      </p></li><li class="listitem"><p>
        <code class="literal">torque/mrom</code>
      </p></li><li class="listitem"><p>
        <code class="literal">torque/server</code>
      </p></li><li class="listitem"><p>
        <code class="literal">uhub</code>
      </p></li><li class="listitem"><p>
        <code class="literal">unifi</code>
      </p></li><li class="listitem"><p>
        <code class="literal">znc</code>
      </p></li><li class="listitem"><p>
        <code class="literal">zookeeper</code>
      </p></li></ul></div><p>
    When upgrading from a previous release, please be aware of the
    following incompatible changes:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The default version of Apache httpd is now 2.4. If you use the
        <code class="literal">extraConfig</code> option to pass literal Apache
        configuration text, you may need to update it — see
        <a class="link" href="http://httpd.apache.org/docs/2.4/upgrading.html" target="_top">Apache’s
        documentation</a> for details. If you wish to continue to use
        httpd 2.2, add the following line to your NixOS configuration:
      </p><pre class="programlisting">
{
  services.httpd.package = pkgs.apacheHttpd_2_2;
}
</pre></li><li class="listitem"><p>
        PHP 5.3 has been removed because it is no longer supported by
        the PHP project. A
        <a class="link" href="http://php.net/migration54" target="_top">migration
        guide</a> is available.
      </p></li><li class="listitem"><p>
        The host side of a container virtual Ethernet pair is now called
        <code class="literal">ve-container-name</code> rather than
        <code class="literal">c-container-name</code>.
      </p></li><li class="listitem"><p>
        GNOME 3.10 support has been dropped. The default GNOME version
        is now 3.12.
      </p></li><li class="listitem"><p>
        VirtualBox has been upgraded to 4.3.20 release. Users may be
        required to run <code class="literal">rm -rf /tmp/.vbox*</code>. The line
        <code class="literal">imports = [ &lt;nixpkgs/nixos/modules/programs/virtualbox.nix&gt; ]</code>
        is no longer necessary, use
        <code class="literal">services.virtualboxHost.enable = true</code>
        instead.
      </p><p>
        Also, hardening mode is now enabled by default, which means that
        unless you want to use USB support, you no longer need to be a
        member of the <code class="literal">vboxusers</code> group.
      </p></li><li class="listitem"><p>
        Chromium has been updated to 39.0.2171.65.
        <code class="literal">enablePepperPDF</code> is now enabled by default.
        <code class="literal">chromium*Wrapper</code> packages no longer exist,
        because upstream removed NSAPI support.
        <code class="literal">chromium-stable</code> has been renamed to
        <code class="literal">chromium</code>.
      </p></li><li class="listitem"><p>
        Python packaging documentation is now part of nixpkgs manual. To
        override the python packages available to a custom python you
        now use <code class="literal">pkgs.pythonFull.buildEnv.override</code>
        instead of <code class="literal">pkgs.pythonFull.override</code>.
      </p></li><li class="listitem"><p>
        <code class="literal">boot.resumeDevice = "8:6"</code> is no
        longer supported. Most users will want to leave it undefined,
        which takes the swap partitions automatically. There is an
        evaluation assertion to ensure that the string starts with a
        slash.
      </p></li><li class="listitem"><p>
        The system-wide default timezone for NixOS installations changed
        from <code class="literal">CET</code> to <code class="literal">UTC</code>. To choose
        a different timezone for your system, configure
        <code class="literal">time.timeZone</code> in
        <code class="literal">configuration.nix</code>. A fairly complete list of
        possible values for that setting is available at
        <a class="link" href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_top">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a>.
      </p></li><li class="listitem"><p>
        GNU screen has been updated to 4.2.1, which breaks the ability
        to connect to sessions created by older versions of screen.
      </p></li><li class="listitem"><p>
        The Intel GPU driver was updated to the 3.x prerelease version
        (used by most distributions) and supports DRI3 now.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-14.04"></a>B.16. Release 14.04 (<span class="quote">“<span class="quote">Baboon</span>”</span>, 2014/04/30)</h2></div></div></div><p>
    This is the second stable release branch of NixOS. In addition to
    numerous new and upgraded packages and modules, this release has the
    following highlights:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Installation on UEFI systems is now supported. See
        <a class="xref" href="index.html#sec-installation" title="Chapter 2. Installing NixOS">Chapter 2, <em>Installing NixOS</em></a> for details.
      </p></li><li class="listitem"><p>
        Systemd has been updated to version 212, which has
        <a class="link" href="http://cgit.freedesktop.org/systemd/systemd/plain/NEWS?id=v212" target="_top">numerous
        improvements</a>. NixOS now automatically starts systemd user
        instances when you log in. You can define global user units
        through the <code class="literal">systemd.unit.*</code> options.
      </p></li><li class="listitem"><p>
        NixOS is now based on Glibc 2.19 and GCC 4.8.
      </p></li><li class="listitem"><p>
        The default Linux kernel has been updated to 3.12.
      </p></li><li class="listitem"><p>
        KDE has been updated to 4.12.
      </p></li><li class="listitem"><p>
        GNOME 3.10 experimental support has been added.
      </p></li><li class="listitem"><p>
        Nix has been updated to 1.7
        (<a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-1.7" target="_top">details</a>).
      </p></li><li class="listitem"><p>
        NixOS now supports fully declarative management of users and
        groups. If you set <code class="literal">users.mutableUsers</code> to
        <code class="literal">false</code>, then the contents of
        <code class="literal">/etc/passwd</code> and <code class="literal">/etc/group</code>
        will be
        <a class="link" href="https://www.usenix.org/legacy/event/lisa02/tech/full_papers/traugott/traugott_html/" target="_top">congruent</a>
        to your NixOS configuration. For instance, if you remove a user
        from <code class="literal">users.extraUsers</code> and run
        <code class="literal">nixos-rebuild</code>, the user account will cease to
        exist. Also, imperative commands for managing users and groups,
        such as <code class="literal">useradd</code>, are no longer available. If
        <code class="literal">users.mutableUsers</code> is <code class="literal">true</code>
        (the default), then behaviour is unchanged from NixOS 13.10.
      </p></li><li class="listitem"><p>
        NixOS now has basic container support, meaning you can easily
        run a NixOS instance as a container in a NixOS host system.
        These containers are suitable for testing and experimentation
        but not production use, since they’re not fully isolated from
        the host. See <a class="xref" href="index.html#ch-containers" title="Chapter 63. Container Management">Chapter 63, <em>Container Management</em></a> for details.
      </p></li><li class="listitem"><p>
        Systemd units provided by packages can now be overridden from
        the NixOS configuration. For instance, if a package
        <code class="literal">foo</code> provides systemd units, you can say:
      </p><pre class="programlisting">
{
  systemd.packages = [ pkgs.foo ];
}
</pre><p>
        to enable those units. You can then set or override unit options
        in the usual way, e.g.
      </p><pre class="programlisting">
{
  systemd.services.foo.wantedBy = [ "multi-user.target" ];
  systemd.services.foo.serviceConfig.MemoryLimit = "512M";
}
</pre><p>
        When upgrading from a previous release, please be aware of the
        following incompatible changes:
      </p></li><li class="listitem"><p>
        Nixpkgs no longer exposes unfree packages by default. If your
        NixOS configuration requires unfree packages from Nixpkgs, you
        need to enable support for them explicitly by setting:
      </p><pre class="programlisting">
{
  nixpkgs.config.allowUnfree = true;
}
</pre><p>
        Otherwise, you get an error message such as:
      </p><pre class="programlisting">
    error: package ‘nvidia-x11-331.49-3.12.17’ in ‘…/nvidia-x11/default.nix:56’
      has an unfree license, refusing to evaluate
</pre></li><li class="listitem"><p>
        The Adobe Flash player is no longer enabled by default in the
        Firefox and Chromium wrappers. To enable it, you must set:
      </p><pre class="programlisting">
{
  nixpkgs.config.allowUnfree = true;
  nixpkgs.config.firefox.enableAdobeFlash = true; # for Firefox
  nixpkgs.config.chromium.enableAdobeFlash = true; # for Chromium
}
</pre></li><li class="listitem"><p>
        The firewall is now enabled by default. If you don’t want this,
        you need to disable it explicitly:
      </p><pre class="programlisting">
{
  networking.firewall.enable = false;
}
</pre></li><li class="listitem"><p>
        The option <code class="literal">boot.loader.grub.memtest86</code> has
        been renamed to
        <code class="literal">boot.loader.grub.memtest86.enable</code>.
      </p></li><li class="listitem"><p>
        The <code class="literal">mysql55</code> service has been merged into the
        <code class="literal">mysql</code> service, which no longer sets a default
        for the option <code class="literal">services.mysql.package</code>.
      </p></li><li class="listitem"><p>
        Package variants are now differentiated by suffixing the name,
        rather than the version. For instance,
        <code class="literal">sqlite-3.8.4.3-interactive</code> is now called
        <code class="literal">sqlite-interactive-3.8.4.3</code>. This ensures that
        <code class="literal">nix-env -i sqlite</code> is unambiguous, and that
        <code class="literal">nix-env -u</code> won’t <span class="quote">“<span class="quote">upgrade</span>”</span>
        <code class="literal">sqlite</code> to
        <code class="literal">sqlite-interactive</code> or vice versa. Notably,
        this change affects the Firefox wrapper (which provides
        plugins), as it is now called
        <code class="literal">firefox-wrapper</code>. So when using
        <code class="literal">nix-env</code>, you should do
        <code class="literal">nix-env -e firefox; nix-env -i firefox-wrapper</code>
        if you want to keep using the wrapper. This change does not
        affect declarative package management, since attribute names
        like <code class="literal">pkgs.firefoxWrapper</code> were already
        unambiguous.
      </p></li><li class="listitem"><p>
        The symlink <code class="literal">/etc/ca-bundle.crt</code> is gone.
        Programs should instead use the environment variable
        <code class="literal">OPENSSL_X509_CERT_FILE</code> (which points to
        <code class="literal">/etc/ssl/certs/ca-bundle.crt</code>).
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-release-13.10"></a>B.17. Release 13.10 (<span class="quote">“<span class="quote">Aardvark</span>”</span>, 2013/10/31)</h2></div></div></div><p>
    This is the first stable release branch of NixOS.
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="options.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> </td></tr><tr><td width="40%" align="left" valign="top">Appendix A. Configuration Options </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>